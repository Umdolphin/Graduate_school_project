<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="202140191 엄태훈" />


<title>통계방법론2 실습코드 정리</title>

<script src="Statistical_Method2_files/header-attrs-2.16/header-attrs.js"></script>
<script src="Statistical_Method2_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Statistical_Method2_files/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="Statistical_Method2_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Statistical_Method2_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Statistical_Method2_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="Statistical_Method2_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="Statistical_Method2_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="Statistical_Method2_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="Statistical_Method2_files/navigation-1.1/tabsets.js"></script>
<script src="Statistical_Method2_files/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">통계방법론2 실습코드 정리</h1>
<h4 class="author">202140191 엄태훈</h4>
<h4 class="date">2021-12-10(Fri)</h4>

</div>


<style type="text/css">
  body{
     font-size: 16px;
     font-family: 맑은 고딕
  }
  td{
     font-size: 16px;
     font-family: 맑은 고딕
  }
  code.r{
    font-size: 16px;
    font-weight: bold;
    font-family: 맑은 고딕
  }
  pre {
    font-size: 14px
    font-family: 맑은 고딕
  }
  h1,h2,h3,h4,h5,h6{
    font-family: 맑은 고딕;
  }
  h1{
    font-size: 22pt;
  }
  h2{
    font-size: 20pt;
  }
  h3{
    font-size: 18pt;
  }
</style>
<p><br></p>
<p>본 Markdwon은 가천대학교 일반대학원 응용통계학과 고승곤 교수님의
2021년 통계방법론2 수업내용 및 실습코드를 정리한 것이다.<br />
통계적인 다양한 개념 및 관련된 예제, 함수설명과 사용법 등의 실습코드가
포함돼있다.<br />
함수설명의 경우, R에서 그 함수를 실행시키고자할 때 필요한 최소의
옵션만을 설명했으며, 함수에 관해 더 자세한 설명을 보고싶은경우
<code>?함수명</code>을 활용한다.<br />
함수와 관련된 패키지가 설치가 돼있지 않다면, 패키지 설치 후 확인하거나
<code>??함수명</code>을 통해 확인하면된다.</p>
<p>설명하고자 하는 내용과 본 Markdown의 목차는 다음과 같다.</p>
<table>
<thead>
<tr class="header">
<th align="left">챕터</th>
<th align="right">제목</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Chapter1</td>
<td align="right">Introduction</td>
</tr>
<tr class="even">
<td align="left">Chapter2</td>
<td align="right">Working with Categorical Data</td>
</tr>
<tr class="odd">
<td align="left">Chapter3</td>
<td align="right">Fitting and Graphing Discrete Distributions</td>
</tr>
<tr class="even">
<td align="left">Chapter4</td>
<td align="right">Two-Way Contingency Tables</td>
</tr>
<tr class="odd">
<td align="left">Chapter5</td>
<td align="right">Mosaic Display for n-Way Tables</td>
</tr>
<tr class="even">
<td align="left">Chapter7</td>
<td align="right">Logistic Regression Models</td>
</tr>
<tr class="odd">
<td align="left">Chapter8</td>
<td align="right">Models for Polytomous Responses</td>
</tr>
<tr class="even">
<td align="left">Chapter9</td>
<td align="right">Loglinear and Logit Models for Contingency Tables</td>
</tr>
</tbody>
</table>
<hr />
<hr />
<div id="chap1-introduction" class="section level1">
<h1>Chap1 Introduction</h1>
<p>일반적으로 데이터 분석을 진행한다는 것은, 데이터 수집부터 결과
도출까지의 모든 과정을 일컫는다.<br />
이렇게 얻어진 결과들을 정리하여 우리는 다수의 사람들 앞에서 데이터를
통해 얻어진 결론이 무엇인지 설명하는 것이 필요하다.</p>
<p>그렇다면, 이때 가장 중요하게 여겨지는 요소가 무엇일까? 데이터의 분포,
모델의 성능, 분석기법 등을 생각해볼 수 있을 것이다. 하지만, 우리는
여기서 다수의 사람들이 통계를 전공한 사람들이 아닐수도 있다는 사실을
알아야한다. 복잡하고 어려운 분석기법과 모델의 성능에 대해서 아무리
설명을해도 그들에게는 크게 와닿지 않을 수도 있다. 따라서, 이러한 경우
가장 중요하게 여겨지는 요소가 바로
<strong>시각화(Visualization)</strong>이다.</p>
<p>우리가 전달하고자 하는 내용과 데이터들은 수많은 숫자 혹은 글로
구성돼있기 때문에 비전공자들이 해석하기에는 상당히 어려움이 따를수도
있다.</p>
<p><strong>시각화</strong>는 이렇게 데이터 또는 분석결과를 조금 더 쉽게
이해하고 한 눈에 볼 수 있도록 시각적인 요소를 나타내는 방법을 말한다.
이때, 통계에서 데이터 분석을 진행하기 전에 시각화를 통해 데이터를
살펴보는 방법을 <strong>탐색적 자료분석(Exploratory Data
Analysis)</strong>라고 한다.</p>
<p>특히, 데이터와 결론이 복잡해질수록 이러한 시각화 능력이 굉장히
중요시되기 때문에, 상황에 맞는 다양한 시각화 기법을 익히는 것은 데이터
분석가에게 있어서 매우 중요하게 여겨지는 능력 중 하나라고 할 수
있다.</p>
<p>통계에서 변수는 값을 숫자로 나타낼 수 있는
<strong>양적변수(Quantitative variable)</strong>와 변수의 값을 특정
범주에 포함시키는 <strong>질적변수(Quantitative variable)</strong>으로
나눠진다. 질적변수는 <strong>범주형 변수</strong>라고하기도 한다.</p>
<hr />
<div id="what-is-categorical-data" class="section level2">
<h2>1.1 What is categorical data?</h2>
<p><strong>범주형 변수(Categorical data)</strong>는 순서가
지정(<strong>순서형 변수</strong>)되거나 순서가 지정되지 않은
범주(<strong>명목형 변수</strong>)의 이산 집합으로 나눌 수 있다.</p>
<p>범주형 변수의 예시는 다음과 같이 생각할 수 있다.</p>
<p>EX)</p>
<ul>
<li>Gender: “Male”, “Female”<br />
</li>
<li>Marital status: “Never married”, “Married”, “Separated”, “Divorced”,
“Widowed”<br />
</li>
<li>Fielding position(baseball): “Pitcher”, “Catcher”, “1st base”, “2nd
base”, …“Left field”</li>
</ul>
<p><strong>범주형 데이터(Categorical data)</strong>는 우리가 많이 접해본
양적인 데이터와는 다른 변수의 값을 가지고 있으므로, 이에 따른 적합한
통계분석 및 시각화 방법을 익히는 것이 필요하다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span></code></pre></div>
<pre><code>## 필요한 패키지를 로딩중입니다: grid</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Arthritis,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   ID Treatment  Sex Age Improved
## 1 57   Treated Male  27     Some
## 2 46   Treated Male  29     None
## 3 77   Treated Male  30     None
## 4 17   Treated Male  32   Marked
## 5 36   Treated Male  46   Marked</code></pre>
<p><code>vcd</code>패키지는 시각화 기법, 데이터셋의 요약 및 추론절차를
간편하게 할 수 있는 패키지로, 특히 범주형 데이터를 다룰때 유용하게
사용할 수 있다.</p>
<p><code>Arthritis</code>데이터는 <code>vcd</code>패키지에 있는
데이터로, 류마티스 관절염의 새로운 치료법에 대한 데이터이다. 84개의
관측값과 5개의 변수로 이루어진 데이터이다.</p>
<ul>
<li>ID: 환자의 ID (Norminal variable)</li>
<li>Treatment: 치료 약의 요인 (Factor variable - Placebo, Treated)</li>
<li>Sex: 성별 (Factor variable - Female, Male)</li>
<li>Age: 나이 (Discrete variable)</li>
<li>Improved: (Ordered Factor variable - None, Some, Marked)</li>
</ul>
<p><code>vcd</code>패키지에서 <code>Arthritis</code> 데이터를 로드한 후,
<code>head</code>함수를 이용하여 데이터를 살펴본다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Arthritis <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment,Sex,Improved) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Freq=</span><span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Treatment&#39;, &#39;Sex&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 11 × 4
## # Groups:   Treatment, Sex [4]
##    Treatment Sex    Improved  Freq
##    &lt;fct&gt;     &lt;fct&gt;  &lt;ord&gt;    &lt;int&gt;
##  1 Placebo   Female None        19
##  2 Placebo   Female Some         7
##  3 Placebo   Female Marked       6
##  4 Placebo   Male   None        10
##  5 Placebo   Male   Marked       1
##  6 Treated   Female None         6
##  7 Treated   Female Some         5
##  8 Treated   Female Marked      16
##  9 Treated   Male   None         7
## 10 Treated   Male   Some         2
## 11 Treated   Male   Marked       5</code></pre>
<p><code>dplyr</code>패키지는 R에서 데이터 프레임에 대한 전처리 과정을
빠르고 유용하게 진행하고자 할때, 사용하는 패키지이다.</p>
<p><code>dplyr</code>패키지를 불러오면 <strong>파이프라인</strong>이라고
불리는 <code>%&gt;%</code>를 사용할 수 있고, 이를 통해 데이터 처리를
훨씬 간편하게 할 수 있으며, 코드 또한 깔끔한 형태로 만들 수 있다.</p>
<p><code>group_by</code>함수는 묶고자 하는 그룹들의 변수를 지정하여
그룹별로 데이터를 묶어준다.<br />
- <code>group_by(data)</code></p>
<ul>
<li>data: 묶고자하는 데이터의 변수</li>
</ul>
<p><code>summarise</code>함수는 새로운 데이터를 생성할 수 있는데, 특히
<code>group_by</code>함수를 통해 그룹별로 묶어진 데이터들의 요약값을
살펴보는데 유용하게 사용할 수 있다.<br />
- <code>summarise(create = function(columns))</code></p>
<ul>
<li>create: 만들고자하는 변수의 이름</li>
<li>function: 요약값을 구할 수 있는 함수</li>
<li>columns: 요약값을 보고자 하는 변수</li>
</ul>
<p>위의 코드는 <strong>Treatment, Sex, Improved</strong>을 그룹으로 묶고
그에 따른 데이터의 빈도수를 구하는 코드이다.</p>
<p><strong>Treatment = Placebo, Sex = Female, Improved = None</strong>인
환자의 빈도는 19로 가장 많다.<br />
<strong>Treatment = Placebo, Sex = Male, Improved = Marked</strong>인
환자의 빈도는 1로 가장 적다.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Arthritis <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Treatment,Improved) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Freq=</span><span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Treatment&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre><code>## # A tibble: 6 × 3
## # Groups:   Treatment [2]
##   Treatment Improved  Freq
##   &lt;fct&gt;     &lt;ord&gt;    &lt;int&gt;
## 1 Placebo   None        29
## 2 Placebo   Some         7
## 3 Placebo   Marked       7
## 4 Treated   None        13
## 5 Treated   Some         7
## 6 Treated   Marked      21</code></pre>
<p><strong>Treatment, Improved</strong>를 그룹으로 묶고 그에 따른
데이터의 빈도수를 살펴본다.<br />
<strong>Treatment = Placebo, Improved = None</strong> 환자의 빈도는 29로
가장 많다.<br />
<strong>Treatment = Placebo, Improved = Some</strong>, <strong>Treatment
= Placebo, Improved = Marked</strong>, <strong>Treatment = Treated,
Improved = Some</strong>인 환자의 빈도는 7로 가장 적다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Arthritis <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sex) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Average_Age_by_Sex =</span> <span class="fu">mean</span>(Age))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   Sex    Average_Age_by_Sex
##   &lt;fct&gt;               &lt;dbl&gt;
## 1 Female               53.5
## 2 Male                 53</code></pre>
<p><code>summarise</code>함수의 <code>mean</code>함수를 활용하여 성별에
따른 환자들의 평균 나이도 살펴볼 수 있다.</p>
<hr />
</div>
<div id="strategies-for-categorical-data-analysis"
class="section level2">
<h2>1.2 Strategies for categorical data analysis</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HairEyeColor&quot;</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>HairEyeColor</span></code></pre></div>
<pre><code>## , , Sex = Male
## 
##        Eye
## Hair    Brown Blue Hazel Green
##   Black    32   11    10     3
##   Brown    53   50    25    15
##   Red      10   10     7     7
##   Blond     3   30     5     8
## 
## , , Sex = Female
## 
##        Eye
## Hair    Brown Blue Hazel Green
##   Black    36    9     5     2
##   Brown    66   34    29    14
##   Red      16    7     7     7
##   Blond     4   64     5     8</code></pre>
<p><code>HairEyeColor</code>데이터는 592명의 통계학과 학생들의 눈과 머리
색깔에 대한 분포를 나타낸 분할표이다.<br />
성별, 눈의 색깔, 머리의 색깔 총 3개의 변수로 구성돼 있다.</p>
<ul>
<li>Sex: 성별 (Factor variable - Male, Female)</li>
<li>Hair Color: 머리의 색깔 (Factor variable - Black, Brown, Red,
Blond)</li>
<li>Eye Color: 눈의 색깔 (Facotr variable - Brown, Blue, Hazel,
Green)</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HairEyeColor,<span class="at">shade=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<p><code>vcd</code>패키지의 <code>mosaic</code>함수를 통해
<code>mosaic plot</code>을 그려보았다.<br />
<code>mosaic plot</code>에 대한 내용은 뒤에 챕터에서 더 자세히 살펴보기
때문에 그때 다시 한 번 알아보도록 한다.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Hair_eye_data <span class="ot">&lt;-</span> HairEyeColor[,,<span class="st">&quot;Female&quot;</span>] <span class="sc">+</span> HairEyeColor[,,<span class="st">&quot;Male&quot;</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(Hair_eye_data)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  Hair_eye_data
## X-squared = 138.29, df = 9, p-value &lt; 2.2e-16</code></pre>
<p><code>HairEyeColor</code>의 남성의 빈도와 여성의 빈도를 합쳐
<strong>Hair_eye_data</strong>에 저장한다.</p>
<p><code>chisq.test</code>함수는 분할표에 대한 적합도 검정을 피어슨
카이제곱 통계량과 유의확률을 통해 확인할 수 있게 해주는 함수이다.<br />
- <code>chisq.test(x)</code></p>
<ul>
<li><p>x: 분할표 데이터</p></li>
<li><p>H0 : 두 변수는 독립이다.</p></li>
<li><p>H1 : 두 변수는 독립이 아니다.</p></li>
</ul>
<p><code>chisq.test</code> 함수를 이용하여 독립성 검정을 진행한 결과,
카이제곱 통계량의 값이 매우 크고 P-value는 유의수준 0.05보다 작은 값을
가지므로 귀무가설 H0를 기각한다.<br />
따라서, <strong>두 변수(Eye, Hair)</strong>은 서로 연관성이 있으며
독립이 아니라고 할 수 있다.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assocstats</span>(Hair_eye_data)</span></code></pre></div>
<pre><code>##                     X^2 df P(&gt; X^2)
## Likelihood Ratio 146.44  9        0
## Pearson          138.29  9        0
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.435 
## Cramer&#39;s V        : 0.279</code></pre>
<p><code>assocstats</code>함수는 <code>vcd</code>패키지에 있으며,
분할표에 대한 피어슨 카이제곱 검정, 우도비 검정, Cramer’s V 등
<code>chisq.test</code>를 사용하는 것 보다 조금 더 많은 정보를 출력할 수
있다.<br />
- <code>assocstats(data)</code></p>
<ul>
<li>data: 연관성 분석을 진행할 분할표 데이터</li>
</ul>
<p><strong>Cramer’s V</strong>는 이산 범주형의 관련성을 나타내는
척도이며, 아무런 관련성 없을때는 0, 최대의 관련성이 있을때는 1을
가진다.<br />
<strong>Contigency coeff(분할계수)</strong> 또한 이산 범주형의 관련성을
나타내며, 1에 가까울수록 관련성이 크다고 할 수 있다.</p>
</div>
<div id="model-building-approaches" class="section level2">
<h2>1.3 Model building approaches</h2>
<ul>
<li><strong>로지스틱 회귀분석(Logistic Regression)</strong>은 선형
회귀와 같이 독립 변수와 종속 변수간의 함수 관계를 규명하여 종속 변수를
예측하는 모델이다.<br />
</li>
<li>하지만, 선형회귀와 다른 점은 로지스틱 회귀분석의 종속변수는
<strong>범주형</strong>이다.<br />
</li>
<li>따라서 선형회귀 같은 경우 독립변수를 통해 종속변수를 예측한다고
하며, 로지스틱 회귀의 경우 독립변수를 통해 결과를 0또는 1로 분류한다고
한다.</li>
</ul>
<p>로지스틱 회귀분석은 <strong>Chapter7</strong>에서 다루게 되므로,
뒤에서 더 자세히 알아보도록한다.</p>
</div>
<div id="graphical-methods-for-categorical-data" class="section level2">
<h2>1.4 Graphical methods for categorical data</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code></pre></div>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">parcoord</span>(iris[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> iris<span class="sc">$</span>Species,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">var.label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">1.4</span>,<span class="dv">1</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Setosa&quot;</span>,<span class="st">&quot;Versicolor&quot;</span>,<span class="st">&quot;Virginica&quot;</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex=</span><span class="fl">0.7</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-9-1.png" width="960" /></p>
<p><code>MASS</code>패키지의 <code>parcoord</code>함수를 이용하여
평행좌표 그림을 나타내었다. <code>MASS</code>패키지는 데이터를 시각화할
수 있는 다양한 함수 및 음이항 분포의 glm을 적합시킬 수 있는
<code>glm.nb</code>, 로그선형모델의 <code>loglm</code> 등 다양한 통계적
분석 함수 또한 같이 제공하는 패키지이다.<br />
- <code>parcoord(x,col,var.lable)</code></p>
<ul>
<li>x: 데이터</li>
<li>col: 선을 구분할 변수</li>
<li>var.label: 축 변수들의 최대값, 최소값 출력 여부</li>
</ul>
<p><strong>평행좌표 그래프</strong>는 데이터의 각 행에 대한 값을 선
하나로 나타낸 그림으로, 다변량의 자료를 파악하기에 좋은 방법이다.</p>
<p><strong>iris</strong>데이터는 유명한 꽃데이터로, 50송이의 꽃에 대한
꽃잎의 길이와 너비, 꽃받침의 길이와 너비, 꽃의 종으로 구성돼있다.</p>
<ul>
<li>Sepal.Length: 꽃받침의 길이 (Continuous variable)</li>
<li>Sepal.Width: 꽃받침의 너비 (Continuous variable)</li>
<li>Petal.Length: 꽃잎의 길이 (Continuous variable)</li>
<li>Petal.Width: 꽃잎의 너비 (Continuous variable)</li>
<li>Species 꽃의 종 (Factor variable - Setosa, versicolor,
virginica)</li>
</ul>
<p><strong>iris</strong>데이터의 평행좌표 그래프를 살펴본 결과,
<strong>Petal.Length, Petal.Width</strong> 변수는 <code>Setosa</code>일
때, 대부분 작은 값을 가지고 <code>Virginica</code>일 때 대부분 큰 값을
가지는 것을 확인할 수 있다.</p>
</div>
<div id="appendix-chapter1" class="section level2">
<h2>Appendix: Chapter1</h2>
<div id="regression-vs-correlation" class="section level3">
<h3>Regression vs Correlation</h3>
<p><strong>회귀분석(Regression)</strong>은 인과관계를 맺고 있는 변수
간에 함수관계를 규명하여 통계적인 분석을 실행하는 방법을 말한다.<br />
상관분석과 달리 두 변수만이 아닌 둘 이상의 변수들의 관계를 파악할 수
있다.</p>
<p><strong>상관분석(Correlation)</strong>은 두 변수간에 어떠한 선형적인
관계를 갖고있으며, 얼마나 밀접한 관계를 맺고 있는지 확인하는
방법이다.<br />
상관분석을 한 후에 도출된 상관계수는 -1부터 1의 값을 가지며, -1에
가까울수록 강한 음의 상관관계, 0에 가까우면 서로 관계가 없고 1에
가까울수록 양의 상관관계를 갖고 있다고 한다.</p>
<p>회귀분석과 상관분석의 가장 큰 차이점 중 하나는 구체적인 함수관계라고
할 수 있다.<br />
상관분석은 단순히 두 변수가 갖고있는 선형적 관계를 통해 함께 움직이는
정도만을 확인할 수 있다.<br />
하지만, 회귀분석은 상관분석과 달리 두 변수간의 함수관계를 규명함으로써
한 변수(독립변수)의 변화에 따라 한 변수(종속변수)에 얼마만큼의 영향을
미칠 수 있는지 확인할 수 있다.</p>
</div>
</div>
<div id="summary-of-chapter1" class="section level2">
<h2>Summary of Chapter1</h2>
<ul>
<li>통계에서 데이터 분석을 진행함에 있어, 일반적으로 양적 변수와 질적
변수를 고려할 수 있다. <strong>질적 변수(범주형 변수)</strong>를 다루는
것은 <strong>양적 변수</strong>보다는 약간의 어려움이 따르기 때문에 질적
변수를 다룰 수 있는 능력을 키우는 것은 중요하다.<br />
</li>
<li><strong>범주형 변수</strong>는 변수들의 수준의 순서를 고려하지 않는
<strong>명목형 변수</strong>와 변수들의 수준의 순서를 고려하는
<strong>순서형 변수</strong>로 나눌 수 있다.<br />
</li>
<li>데이터 분석가의 분석 결과를 보고서의 형태로 정리할 때에는 데이터,
분석비법, 모델등을 정리하는 것도 중요하지만 보고받는 사람이 쉽게 이해할
수 있게 적절한 시각화를 통해 나타내는 것도 매우 중요한 요소이다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap2-working-with-categorical-data" class="section level1">
<h1>Chap2 Working with Categorical Data</h1>
<p>범주형 변수를 다루기 위해서는 양적 변수를 다루는 기술 이상의 능력이
필요하다.<br />
<strong>양적 변수</strong>의 경우 숫자로 표현돼있기에 이상치, 데이터의
분포를 제외하고는 특별한 전처리 과정이 필요하지 않다.</p>
<p>하지만, <strong>범주형 변수</strong>의 경우 문자로 표현되는 데이터도
많기 때문에 이에 대한 전처리 과정 및 데이터의 <strong>수준(level)의
순서</strong>를 고려해야 될수도 있으며 특히, R에서는 범주형 변수의 저장
형태가 table의 형태로 이뤄지는 경우가 많기 때문에 이 부분 또한 고려해야
하는 요소이다.</p>
<p>Chapter2에서는 범주형 변수 데이터들의 주요 특성에 대해서
알아본다.</p>
<hr />
<div id="working-with-r-data-vectors-matrics-arrays-and-dataframes"
class="section level2">
<h2>2.1 Working with R data: vectors, matrics, arrays, and
dataframes</h2>
<div id="vectors" class="section level3">
<h3>2.1.1 Vectors</h3>
<ul>
<li>R에서 벡터(Vector)는 숫자, 문자, 또는 논리 같은 값을 가지는 것을
말하며, 종종 일부 분석에서 변수에 해당되기도 한다.<br />
</li>
<li>가장 단순한 데이터 구조이며, 동일한 요소의 1차원 집합이다.<br />
</li>
<li><code>c()</code>함수를 이용하여 인수를 결합한 벡터를 만들 수
있다.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">40</span>)</span></code></pre></div>
<pre><code>## [1] 17 20 15 40</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;female&quot; &quot;male&quot;   &quot;female&quot; &quot;male&quot;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE</code></pre>
<p>R의 기본 내장함수 <code>c</code>를 이용하여 동일한 요소를 가지고 있는
1차원 벡터를 만들 수 있다.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>count  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">15</span>, <span class="dv">40</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>count</span></code></pre></div>
<pre><code>## [1] 17 20 15 40</code></pre>
<p>만들어진 벡터를 <code>&lt;-</code> 혹은 <code>=</code>을 통해 특정
객체에 저장할 수도 있다.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(sex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;male&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;female&quot; &quot;male&quot;   &quot;female&quot; &quot;male&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>(passed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE</code></pre>
<p>객체 저장 후 바로 저장된 값을 출력하고 싶다면, 맨 앞과 맨 뒤에
<em>괄호()</em>를 입력하면 된다.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  10  20  30  40  50  60  70  80  90 100</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">11</span>)</span></code></pre></div>
<pre><code>##  [1] 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="at">length.out =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1]  10  20  30  40  50  60  70  80  90 100</code></pre>
<p><code>seq</code>함수는 분석자가 정한 특정 범위와 간격을 기준으로 양적
데이터를 생성해주는 함수이다. -
<code>seq(from, to, by | length.out)</code></p>
<ul>
<li>from: 분석자가 원하는 범위의 초기값</li>
<li>to: 분석자가 원하는 범위의 마지막값</li>
<li>by: 초기값부터 마지막값까지의 간격</li>
<li>length.out: 초기값부터 마지막값까지 몇 개를 출력하고자 하는지에 대한
옵션. 즉, 간격이 (from - to) / (length.out-1)이 된다.</li>
</ul>
<p><code>by</code>와 <code>length.out</code>은 혼합해서 사용할 수
없으며, 둘 중 하나의 옵션만을 사용해야 한다.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(number <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),<span class="at">times =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>##  [1] 1 2 3 4 5 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(sex <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>),<span class="at">times=</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] &quot;female&quot; &quot;male&quot;   &quot;female&quot; &quot;male&quot;</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(sex <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>), <span class="at">length.out =</span> <span class="dv">4</span>))</span></code></pre></div>
<pre><code>## [1] &quot;female&quot; &quot;male&quot;   &quot;female&quot; &quot;male&quot;</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(passed <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">each =</span> <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE</code></pre>
<p><code>rep</code>함수는 입력한 값들을 원하는 만큼 반복한 데이터를
만들어주는 함수이다. -
<code>rep(data,times | length.out | each)</code></p>
<ul>
<li>data: 반복하고자 하는 데이터 (숫자는 물론 문자형도 가능하다.)</li>
<li>times: 반복횟수</li>
<li>length.out: 총 갯수 (지정한 만큼의 숫자까지 반복한다.)</li>
<li>each: 각 데이터의 반복횟수 (times처럼 pair 형식으로 반복하는 것이
아니라 각각의 입력값들을 each만큼 반복한 후 다음 입력값을
반복해준다.)</li>
</ul>
</div>
<div id="matrics" class="section level3">
<h3>2.1.2 Matrics</h3>
<ul>
<li><strong>행렬(Matrics)</strong>은 열 또는 행의 벡터로 구성된 전통적인
표와 같은 직사각형 배열이다.<br />
</li>
<li>일반적으로 선형대수학, 공분산행렬, 다변량 정규분포 등의 계산식을
활용하고자 할때 많이 쓰인다.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>(matA <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">nrow=</span><span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">4</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    3    5    7
## [2,]    2    4    6    8</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(matB <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(matC <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">4</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    3    1    3
## [2,]    2    4    2    4</code></pre>
<p>R 에서는 <code>matrix</code>함수를 이용하여 행렬을 만들 수
있다.<br />
- <code>matrix(data,nrow,col,byrow)</code> * data: 입력 값 * nrow: 행의
개수 * ncol: 열의 개수 * byrow: 입력값을 행을 우선으로 채울이 열로
채울지 결정. (<strong>default는 False</strong>이며,
<strong>TRUE</strong>로 지정하게 되면 입력값을 행을 우선으로
채운다.)</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(matA)</span></code></pre></div>
<pre><code>## [1] 2 4</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(matA)</span></code></pre></div>
<pre><code>##  int [1:2, 1:4] 1 2 3 4 5 6 7 8</code></pre>
<p><code>dim</code>은 만들어진 행렬 또는 데이터 프레임의 차원을 볼 수
있다. (2 4)가 의미하는 것은 2x4 즉, (2행 4열)을 의미한다.<br />
- <code>dim(data)</code></p>
<ul>
<li>data: 행렬 또는 데이터 프레임</li>
</ul>
<p><code>str</code>은 만들어진 행렬 또는 데이터프레임의 데이터 타입,
크기, 입력값들을 볼 수 있다.<br />
- <code>str(data)</code></p>
<ul>
<li>data: 행렬 또는 데이터 프레임</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(matA) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>matA</span></code></pre></div>
<pre><code>##   A B C D
## M 1 3 5 7
## F 2 4 6 8</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(matA)</span></code></pre></div>
<pre><code>##  int [1:2, 1:4] 1 2 3 4 5 6 7 8
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:2] &quot;M&quot; &quot;F&quot;
##   ..$ : chr [1:4] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(matA) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">sex =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), <span class="at">group =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>matA</span></code></pre></div>
<pre><code>##    group
## sex A B C D
##   M 1 3 5 7
##   F 2 4 6 8</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(matA)</span></code></pre></div>
<pre><code>##  int [1:2, 1:4] 1 2 3 4 5 6 7 8
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ sex  : chr [1:2] &quot;M&quot; &quot;F&quot;
##   ..$ group: chr [1:4] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot;</code></pre>
<p><code>dimnames</code>를 이용하여 행렬의 행의 이름, 열의 이름을
지정해줄수도 있다.<br />
-
<code>dimnames(data) &lt;- list(create_row = (row), create_col = (columns)</code></p>
<ul>
<li>data: 행렬이 저장된 객체명</li>
<li>create_row: 분석자가 지정하고자 하는 행의 이름</li>
<li>row: 지정한 행 이름의 수준</li>
<li>create_col: 분석자가 지정하고자 하는 열의 이름</li>
<li>col: 지정한 열 이름의 수준</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(matA, <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span></code></pre></div>
<pre><code>##    A  B  C  D
## M  1  3  5  7
## F  2  4  6  8
##   10 20 10 20</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(matA, <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>))</span></code></pre></div>
<pre><code>##   A B C D   
## M 1 3 5 7 10
## F 2 4 6 8 20</code></pre>
<p><code>rbind</code>함수는 가지고 있는 행렬 또는 데이터 프레임의 행을
기준으로 데이터를 추가해준다.</p>
<p><code>cbind</code>함수는 반대로 열을 기준으로 데이터를
추가해준다.</p>
<p>특히, 두 함수 모두 추가하고자 하는 데이터가 행 또는 열보다 작은 경우,
R이 자동적으로 데이터를 반복하여 추가해주는 것을 알 수 있다.<br />
- <code>rbind | cbind (data, append)</code></p>
<ul>
<li>data: 행렬 또는 데이터 프레임이 저장된 객체</li>
<li>append: 추가하고자 하는 데이터</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t</span>(matA)</span></code></pre></div>
<pre><code>##      sex
## group M F
##     A 1 2
##     B 3 4
##     C 5 6
##     D 7 8</code></pre>
<p><code>t</code>함수는 행렬의 <code>전치(transpose)</code>를 만들어주는
역할을 한다.</p>
<ul>
<li><p><code>t(data)</code></p></li>
<li><p>data: 행렬이 저장된 객체</p></li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">*</span> matA <span class="sc">/</span> <span class="dv">100</span></span></code></pre></div>
<pre><code>##    group
## sex    A    B    C    D
##   M 0.02 0.06 0.10 0.14
##   F 0.04 0.08 0.12 0.16</code></pre>
<p>만들어진 행렬 객체에 수식을 입력하여 전체 행렬에 대한 연산을
진행할수도 있다.</p>
</div>
<div id="arrays" class="section level3">
<h3>2.1.3 Arrays</h3>
<ul>
<li><strong>배열(Arrays)</strong>은 행,열,계층으로 구성된 3원 테이블로
표현될 수 있도록 추가 차원을 추가한다.<br />
</li>
<li>중요한 것은 벡터, 행렬, 배열의 값이 모두 동일한 형태를 가지고 있어야
한다.<br />
</li>
<li>고차원 배열은 전통적인 데이터분석에서 빈번하게 쓰이진 않지만, 3개
이상의 변수의 빈도표가 테이블 변수에 대해 하나의 차원의 배열로 표현될 수
있는 범주형 데이터에 유용하다.</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dims <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>(arrayA <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">dim =</span> dims))</span></code></pre></div>
<pre><code>## , , 1
## 
##      [,1] [,2] [,3] [,4]
## [1,]    1    3    5    7
## [2,]    2    4    6    8
## 
## , , 2
## 
##      [,1] [,2] [,3] [,4]
## [1,]    9   11   13   15
## [2,]   10   12   14   16</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(arrayA)</span></code></pre></div>
<pre><code>##  int [1:2, 1:4, 1:2] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<p><code>array</code>는 R에서 배열을 만들어주는 함수이다.<br />
- <code>array(data,dim)</code></p>
<ul>
<li>data: 배열을 통해 표현하고자 하는 데이터</li>
<li>dim: 사용자가 지정하고자 하는 차원의 크기(행,열,계층)</li>
</ul>
<p>앞에서 설명했듯이, 행렬과 다르게 배열은 <strong>계층</strong>이라는
구조를 추가적으로 가진다.<br />
<code>str</code>을 통해서 배열이 갖고 있는 정보와 크기를 확인할 수
있는데 위 배열(array)의 경우, 2rows, 4columns, 2layers(계층)을 가지는
배열(array)이다.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(arrayB <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">8</span>)))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
## [1,]    1    3    5    7    9   11   13   15
## [2,]    2    4    6    8   10   12   14   16</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(arrayB)</span></code></pre></div>
<pre><code>##  int [1:2, 1:8] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<p><code>array</code>함수에서 <code>dim</code>옵션을 사용할때, 레이어를
별도로 지정해주지 않으면 mxn의 크기를 갖는 행렬과 같게 표현될 수
있다.<br />
<code>str</code>을 통해 차원이 2rows, 8columns을 갖는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(arrayA) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">sex =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">time =</span> <span class="fu">c</span>(<span class="st">&quot;Pre&quot;</span>, <span class="st">&quot;Post&quot;</span>))</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>arrayA</span></code></pre></div>
<pre><code>## , , time = Pre
## 
##    group
## sex a b c d
##   M 1 3 5 7
##   F 2 4 6 8
## 
## , , time = Post
## 
##    group
## sex  a  b  c  d
##   M  9 11 13 15
##   F 10 12 14 16</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(arrayA)</span></code></pre></div>
<pre><code>##  int [1:2, 1:4, 1:2] 1 2 3 4 5 6 7 8 9 10 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ sex  : chr [1:2] &quot;M&quot; &quot;F&quot;
##   ..$ group: chr [1:4] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;
##   ..$ time : chr [1:2] &quot;Pre&quot; &quot;Post&quot;</code></pre>
<p>배열(array) 또한 행렬과 같이 <code>dimnames</code>함수를 이용하여
행,열,계층마다 이름을 만들고 그에 따른 수준을 지정하는것이 가능한 것을
확인할 수 있다.</p>
</div>
<div id="data-frames" class="section level3">
<h3>2.1.4 Data frames</h3>
<ul>
<li><strong>데이터프레임(Dataframe)</strong>은 R에서 가장 일반적으로
사용되는 데이터 형식이다.<br />
</li>
<li>특히, 데이터를 분석하고자 할 때, 굉장히 유용하게 사용할 수
있다.<br />
</li>
<li>다른 통계 환경의 전통적인 데이터 세트처럼 직사각형 테이블이며 행과
열로 구성되지만 다른 유형의 변수를 추가할 수 있다.<br />
</li>
<li>데이터 프레임은 기본적으로 각각 데이터 프레임의 열을 나타내는 동일한
크기의 벡터 리스트이다.</li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>,<span class="st">&quot;a2&quot;</span>),n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;b2&quot;</span>),n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>),n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(A, B, sex, age)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mydata,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##    A  B sex age
## 1 a2 b1   F  22
## 2 a1 b1   M  33
## 3 a2 b1   F  31
## 4 a2 b2   M  26
## 5 a2 b1   M  29</code></pre>
<p>R에서 데이터프레임은 <code>data.frame</code>이라는 함수를 통해 생성할
수 있다. 단, 데이터프레임으로 만들 때 모든 변수들의 크기는 반드시 같아야
한다.<br />
- <code>data.frame(data)</code></p>
<ul>
<li>data: 데이터프레임으로 바꾸어줄 변수들(하나 혹은 다중도 가능)</li>
</ul>
<p>다양한 유형의 변수들을 <strong>mydata</strong>라는 객체에 데이터
프레임 형태로 한번에 저장할 수 있다.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mydata)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    100 obs. of  4 variables:
##  $ A  : Factor w/ 2 levels &quot;a1&quot;,&quot;a2&quot;: 2 1 2 2 2 2 2 1 1 2 ...
##  $ B  : Factor w/ 2 levels &quot;b1&quot;,&quot;b2&quot;: 1 1 1 2 1 1 1 1 2 1 ...
##  $ sex: Factor w/ 2 levels &quot;F&quot;,&quot;M&quot;: 1 2 1 2 2 2 2 1 2 2 ...
##  $ age: num  22 33 31 26 29 29 38 28 30 27 ...</code></pre>
<p><code>str</code>함수를 통해 데이터 프레임의 각 변수에 대한 데이터
타입과 전반적인 데이터 프레임의 크기를 확인할 수 있다.<br />
위 데이터의 경우 100개의 관측값과 4개의 변수를 가지는 데이터 프레임인
것을 알 수 있다.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>mydata[<span class="dv">1</span>,<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] b1
## Levels: b1 b2</code></pre>
<p>데이터프레임에서 <code>저장한 객체명</code>과 <code>[]</code>을
활용하면 원하는 값을 쉽게 인덱싱 할 수 있다.<br />
위의 코드는 mydata에서 1행 2열에 위치한 값을 출력해달라는 의미이다.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>mydata[,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##   [1] a2 a1 a2 a2 a2 a2 a2 a1 a1 a2 a2 a2 a2 a1 a2 a1 a2 a2 a1 a2 a2 a1 a2 a2 a1
##  [26] a2 a2 a2 a2 a2 a1 a1 a2 a1 a2 a2 a2 a1 a2 a2 a2 a2 a2 a2 a1 a2 a1 a2 a1 a2
##  [51] a2 a1 a2 a1 a1 a1 a1 a1 a1 a1 a1 a2 a2 a1 a1 a1 a1 a1 a1 a2 a2 a1 a1 a2 a1
##  [76] a2 a2 a2 a1 a1 a2 a1 a1 a2 a1 a1 a1 a2 a1 a1 a1 a1 a2 a1 a2 a2 a2 a1 a2 a2
## Levels: a1 a2</code></pre>
<p><code>mydata[,1]</code>은 mydata의 1열에 있는 모든 값을 출력하라는
의미다. 즉 mydata에서 1열은 A라는 변수이므로 A변수의 데이터가 모두
출력되는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>mydata[<span class="dv">1</span>,]</span></code></pre></div>
<pre><code>##    A  B sex age
## 1 a2 b1   F  22</code></pre>
<p><code>mydata[1,]</code>는 mydata의 1행에 있는 모든 값을 출력하라는
의미로, 변수 A,B,sex,age의 각 첫번째 값이 출력된 것을 확인할 수
있다.<br />
이는 첫번째 관측치의 모든 데이터를 의미한다.</p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span>sex</span></code></pre></div>
<pre><code>##   [1] F M F M M M M F M M M M M M M M M F F M M M F F F M F M M M F M F F F F F
##  [38] M M M F F F M F M M M F F M F F M F M M F F F F F M F M M M M M F M M M M
##  [75] F M F F F M M F M F F F F F M M F M M M F F F F M F
## Levels: F M</code></pre>
<p>또한, R에서 <code>데이터 프레임 객체명$변수</code>를 하게 되면 지정한
변수의 값만 확인할 수 있다.</p>
<p><em>Example 2.1: Arthritis treatment</em></p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(Arthritis, <span class="at">file =</span> <span class="st">&quot;Arthritis.csv&quot;</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="st">&quot;Arthritis.csv&quot;</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>Arthritis <span class="ot">&lt;-</span> <span class="fu">read.table</span>(path, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span></code></pre></div>
<p><code>read.table</code>을 이용하여 table format으로 돼있는 데이터를
읽어올 수 있다. - <code>read.table(file, header, sep)</code></p>
<ul>
<li>file: 읽어오고자 하는 파일의 위치</li>
<li>header: 데이터의 첫 번째 행을 포함시킬지 유무</li>
<li>sep: 데이터를 어떠한 형식에 따라 분리할 것인지</li>
</ul>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Arthritis)</span></code></pre></div>
<pre><code>##   ID Treatment  Sex Age Improved
## 1 57   Treated Male  27     Some
## 2 46   Treated Male  29     None
## 3 77   Treated Male  30     None
## 4 17   Treated Male  32   Marked
## 5 36   Treated Male  46   Marked
## 6 23   Treated Male  58   Marked</code></pre>
<div class="sourceCode" id="cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Arthritis)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    84 obs. of  5 variables:
##  $ ID       : int  57 46 77 17 36 23 75 39 33 55 ...
##  $ Treatment: chr  &quot;Treated&quot; &quot;Treated&quot; &quot;Treated&quot; &quot;Treated&quot; ...
##  $ Sex      : chr  &quot;Male&quot; &quot;Male&quot; &quot;Male&quot; &quot;Male&quot; ...
##  $ Age      : int  27 29 30 32 46 58 59 59 63 63 ...
##  $ Improved : chr  &quot;Some&quot; &quot;None&quot; &quot;None&quot; &quot;Marked&quot; ...</code></pre>
<div class="sourceCode" id="cb109"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>Arthritis<span class="sc">$</span>Improved <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Arthritis<span class="sc">$</span>Improved)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Arthritis<span class="sc">$</span>Improved)</span></code></pre></div>
<pre><code>## [1] &quot;Marked&quot; &quot;None&quot;   &quot;Some&quot;</code></pre>
<p>R에서 <strong>factor</strong>데이터는 범주형 데이터를 일컫는다.<br />
<code>levels(수준)</code>를 통해 <strong>facotr</strong>데이터가 갖고
있는 범주형 데이터의 수준을 확인할 수 있다.</p>
<p><code>Arthritis</code>의 <code>Imrpoved</code>변수의 경우,
<strong>(약의 효과가) 뚜렷함, 없음, 약간</strong>의 순서대로 수준을
갖고있는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb111"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>Arthritis<span class="sc">$</span>Improved <span class="ot">&lt;-</span> <span class="fu">ordered</span>(Arthritis<span class="sc">$</span>Improved,</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span>,<span class="st">&quot;Some&quot;</span>,<span class="st">&quot;Marked&quot;</span>))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Arthritis<span class="sc">$</span>Improved)</span></code></pre></div>
<pre><code>## [1] &quot;None&quot;   &quot;Some&quot;   &quot;Marked&quot;</code></pre>
<p><strong>factor</strong>데이터의 순서를 의미있게 지정해주고 싶다면,
<code>ordered</code>함수를 이용하여 범주형 데이터의 순서를 지정해줄 수
있다.<br />
- <code>ordered(data, levels)</code></p>
<ul>
<li>data: 수준의 순서를 바꾸고자 하는 데이터</li>
<li>levles: 수준의 순서를 재지정하고 싶은대로 수준을 재지정한다.</li>
</ul>
<p>위의 코드는 약의 효과에 대한 수준의 순서를 <strong>없음, 약간,
뚜렷함</strong>의 순서로 수준의 순서를 재지정하는 코드이다.</p>
<hr />
</div>
</div>
<div
id="forms-of-categorical-data-case-form-frequency-form-and-table-form"
class="section level2">
<h2>2.2 Forms of categorical data: case form, frequency form, and table
form</h2>
<div id="case-form" class="section level3">
<h3>2.2.1 Case form</h3>
<p>범주형 데이터는 단순히 데이터 프레임으로, 하나 이상의 이산형 분류변수
또는 반응변수가 있으며, 편리하게 요인 또는 순서요인으로 표현된다.<br />
<strong>Case form</strong>은 데이터를 케이스 형태로 표현한 것을
말한다.<br />
예를 들어, 각 환자에 대한 고유 ID, 그 환자의 정보, 약 효과 등 사례를
중심으로 나타낸 데이터는 <strong>Case form</strong>데이터 라고 할 수
있다.</p>
<p><em>Example 2.2: Arthritis treatment</em></p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Arthritis,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   ID Treatment  Sex Age Improved
## 1 57   Treated Male  27     Some
## 2 46   Treated Male  29     None
## 3 77   Treated Male  30     None
## 4 17   Treated Male  32   Marked
## 5 36   Treated Male  46   Marked</code></pre>
<p><code>Arthritis</code>데이터의 경우 각 환자의 ID, 치료 방법, 성별,
나이, 결과 등 실험에 대한 사례가 나와있다.<br />
따라서, 데이터를 케이스의 형태로 표현했기 때문에 <strong>Case
form</strong>에 속한다고 할 수 있다.</p>
</div>
<div id="frequency-form" class="section level3">
<h3>2.2.2 Frequency form</h3>
<p><strong>빈도 형식(Frequency form)</strong>은 하나 이상의 이산 요인
변수와 해당 셀의 기본 관측치 수를 나타내는 빈도 변수를 포함하는
형태이다.</p>
<p><em>Example 2.3: General social survey</em></p>
<div class="sourceCode" id="cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">sex =</span> <span class="fu">c</span>(<span class="st">&quot;female&quot;</span>,<span class="st">&quot;male&quot;</span>),</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">party =</span> <span class="fu">c</span>(<span class="st">&quot;dem&quot;</span>, <span class="st">&quot;indep&quot;</span>,<span class="st">&quot;rep&quot;</span>))</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre><code>##      sex party
## 1 female   dem
## 2   male   dem
## 3 female indep
## 4   male indep
## 5 female   rep
## 6   male   rep</code></pre>
<p><code>expand.grid</code>는 제공되는 범주형 변수의 모든 조합을
사용하여 데이터를 만들 수 있는 함수이다.<br />
- <code>expand.grid(data)</code></p>
<ul>
<li>data: 조합하고자 하는 범주형 변수</li>
</ul>
<p>위의 코드의 경우, 2개의 범주형 변수가 각각 2,3개의 수준을 가지므로 총
6개의 범주형 조합이 만들어지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb117"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>GSS <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tmp, <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">279</span>, <span class="dv">165</span>, <span class="dv">73</span>, <span class="dv">47</span>, <span class="dv">227</span>, <span class="dv">191</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>GSS</span></code></pre></div>
<pre><code>##      sex party count
## 1 female   dem   279
## 2   male   dem   165
## 3 female indep    73
## 4   male indep    47
## 5 female   rep   227
## 6   male   rep   191</code></pre>
<p><code>expand.grid</code>를 통해 만들어진 모든 범주형 조합에 빈도를
추가한 후, <code>data.frame</code>함수를 통해 데이터 프레임의 형태로
만들어주었다.</p>
<div class="sourceCode" id="cb119"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(GSS)</span></code></pre></div>
<pre><code>## [1] &quot;sex&quot;   &quot;party&quot; &quot;count&quot;</code></pre>
<div class="sourceCode" id="cb121"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(GSS)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    6 obs. of  3 variables:
##  $ sex  : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 1 2 1 2 1 2
##  $ party: Factor w/ 3 levels &quot;dem&quot;,&quot;indep&quot;,..: 1 1 2 2 3 3
##  $ count: num  279 165 73 47 227 191</code></pre>
<p>이처럼 변수들과 그에 대한 기본 관측치를 갖고 있는 형식을 <strong>빈도
형식</strong>이라고 한다.</p>
<div class="sourceCode" id="cb123"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(GSS<span class="sc">$</span>count)</span></code></pre></div>
<pre><code>## [1] 982</code></pre>
<p>빈도 형태를 가지는 데이터의 경우, <code>sum</code>을 통해 전체 빈도를
계산할 수 있다.</p>
<div class="sourceCode" id="cb125"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(GSS,<span class="dv">2</span>,<span class="cf">function</span>(x) <span class="fu">max</span>(x))</span></code></pre></div>
<pre><code>##    sex  party  count 
## &quot;male&quot;  &quot;rep&quot;  &quot;279&quot;</code></pre>
<p><code>apply</code>함수의 경우 데이터프레임에 함수을 적용함에 있어
상당히 유용하게 적용할 수 있게 해주는 함수이다.<br />
- <code>apply(data,margin,fun)</code></p>
<ul>
<li>data: 분석자가 분석을 하고자하는 데이터</li>
<li>margin: 행을 기준으로 할 것인지 열을 기준으로 할 것인지(1 = 행, 2 =
열)</li>
<li>fun: margin을 통해 나눠진 데이터에 적용할 함수(일반적으로
function(x) 원하는 함수(x)의 형태로 사용한다. 여기서, x = 나눠진
데이터)</li>
</ul>
<p><code>apply</code>함수를 통해 데이터의 가장 높은 빈도는 279이며,
이때의 변수는 <strong>sex == male, party == rep</strong>인 것을 쉽게
확인할 수 있다.</p>
</div>
<div id="table-form" class="section level3">
<h3>2.2.3 Table form</h3>
<p><strong>테이블 형태(Table form)</strong>의 데이터는 매트릭스, 배열
혹은 테이블 객체로 표현된다.<br />
표의 차원은 테이블의 길이, 표의 크기는 속성들의 길이를 나타낸다.</p>
<p><em>Example 2.4: Hair color and eye color</em></p>
<div class="sourceCode" id="cb127"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HairEyeColor&quot;</span>, <span class="at">package =</span> <span class="st">&quot;datasets&quot;</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>HairEyeColor</span></code></pre></div>
<pre><code>## , , Sex = Male
## 
##        Eye
## Hair    Brown Blue Hazel Green
##   Black    32   11    10     3
##   Brown    53   50    25    15
##   Red      10   10     7     7
##   Blond     3   30     5     8
## 
## , , Sex = Female
## 
##        Eye
## Hair    Brown Blue Hazel Green
##   Black    36    9     5     2
##   Brown    66   34    29    14
##   Red      16    7     7     7
##   Blond     4   64     5     8</code></pre>
<p><strong>HairEyeColor</strong>는 위와 같이 테이블 객체로 표현되기
때문에 <strong>Table form</strong>에 속하는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb129"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(HairEyeColor)</span></code></pre></div>
<pre><code>## [1] 4 4 2</code></pre>
<div class="sourceCode" id="cb131"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(HairEyeColor)</span></code></pre></div>
<pre><code>## $Hair
## [1] &quot;Black&quot; &quot;Brown&quot; &quot;Red&quot;   &quot;Blond&quot;
## 
## $Eye
## [1] &quot;Brown&quot; &quot;Blue&quot;  &quot;Hazel&quot; &quot;Green&quot;
## 
## $Sex
## [1] &quot;Male&quot;   &quot;Female&quot;</code></pre>
<div class="sourceCode" id="cb133"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(HairEyeColor)</span></code></pre></div>
<pre><code>## [1] 592</code></pre>
<p><code>dim</code>함수를 통해 데이터의 크기를 본 결과, 각 속성들은 4행
4열의 길이를 가지고 2개의 테이블을 가지고 있는 데이터임을 확인할 수
있다.<br />
또한, <code>dimnames</code>함수를 통해 속성들의 요인을 확인할 수 있으며,
<code>sum</code>을 통해 셀의 전체 빈도의 합을 구할 수 있다.</p>
<p><em>Example 2.5: Job satisfaction</em></p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>JobSat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">1</span>,</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">14</span>,<span class="dv">9</span>,</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>                   <span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">11</span>),</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(JobSat)</span></code></pre></div>
<pre><code>##  num [1:4, 1:4] 1 2 1 0 3 3 6 1 10 10 ...</code></pre>
<div class="sourceCode" id="cb137"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(JobSat) <span class="ot">&lt;-</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">income =</span> <span class="fu">c</span>(<span class="st">&quot;&lt; 15k&quot;</span>, <span class="st">&quot;15-25k&quot;</span>, <span class="st">&quot;25-40k&quot;</span>, <span class="st">&quot;&gt; 40k&quot;</span>),</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">satisfaction =</span> <span class="fu">c</span>(<span class="st">&quot;VeryD&quot;</span>, <span class="st">&quot;LittleD&quot;</span>, <span class="st">&quot;ModerateS&quot;</span>, <span class="st">&quot;VeryS&quot;</span>))</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>JobSat <span class="ot">&lt;-</span> <span class="fu">as.table</span>(JobSat)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>JobSat</span></code></pre></div>
<pre><code>##         satisfaction
## income   VeryD LittleD ModerateS VeryS
##   &lt; 15k      1       3        10     6
##   15-25k     2       3        10     7
##   25-40k     1       6        14    12
##   &gt; 40k      0       1         9    11</code></pre>
<div class="sourceCode" id="cb139"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(JobSat)</span></code></pre></div>
<pre><code>##  &#39;table&#39; num [1:4, 1:4] 1 2 1 0 3 3 6 1 10 10 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ income      : chr [1:4] &quot;&lt; 15k&quot; &quot;15-25k&quot; &quot;25-40k&quot; &quot;&gt; 40k&quot;
##   ..$ satisfaction: chr [1:4] &quot;VeryD&quot; &quot;LittleD&quot; &quot;ModerateS&quot; &quot;VeryS&quot;</code></pre>
<p><code>as.table</code>의 경우 원하는 데이터를 테이블의 형태로 바꿔주는
함수이다.<br />
- <code>as.table(data)</code></p>
<ul>
<li>data: table의 형태로 바꾸고자 하는 데이터</li>
</ul>
<p><code>as.table</code>을 통해 매트릭스의 형태인 데이터를 테이블의
형태로 쉽게 바꿀 수 있는 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="ordered-factors-and-reordered-tables" class="section level2">
<h2>2.3 Ordered factors and reordered tables</h2>
<div class="sourceCode" id="cb141"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(JobSat)<span class="sc">$</span>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">7.5</span>, <span class="dv">20</span>, <span class="fl">32.5</span>, <span class="dv">60</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(JobSat)<span class="sc">$</span>satisfaction <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>JobSat</span></code></pre></div>
<pre><code>##       satisfaction
## income  1  2  3  4
##   7.5   1  3 10  6
##   20    2  3 10  7
##   32.5  1  6 14 12
##   60    0  1  9 11</code></pre>
<p>만들어진 데이터의 범주형 변수의 수준을 <code>$</code>를 통해 재지정할
수 있다.</p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(JobSat)<span class="sc">$</span>income <span class="ot">&lt;-</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">dimnames</span>(JobSat)<span class="sc">$</span>income, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(JobSat)<span class="sc">$</span>satisfaction <span class="ot">&lt;-</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">dimnames</span>(JobSat)<span class="sc">$</span>satisfaction, <span class="at">sep =</span> <span class="st">&quot;:&quot;</span>)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>JobSat</span></code></pre></div>
<pre><code>##         satisfaction
## income   1:1 2:2 3:3 4:4
##   1:7.5    1   3  10   6
##   2:20     2   3  10   7
##   3:32.5   1   6  14  12
##   4:60     0   1   9  11</code></pre>
<p>범주형 변수의 순서를 확인하기 위해 기존에 존재하던 범주형 변수 이름
앞에 순서를 부여하여 순서를 쉽게 확인할 수도 있다.</p>
<div class="sourceCode" id="cb145"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HairEyeColor&quot;</span>, <span class="at">package =</span> <span class="st">&quot;datasets&quot;</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>HEC <span class="ot">&lt;-</span> HairEyeColor[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>),]</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(HEC)</span></code></pre></div>
<pre><code>##  &#39;table&#39; num [1:4, 1:4, 1:2] 32 53 10 3 10 25 7 5 3 15 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ Hair: chr [1:4] &quot;Black&quot; &quot;Brown&quot; &quot;Red&quot; &quot;Blond&quot;
##   ..$ Eye : chr [1:4] &quot;Brown&quot; &quot;Hazel&quot; &quot;Green&quot; &quot;Blue&quot;
##   ..$ Sex : chr [1:2] &quot;Male&quot; &quot;Female&quot;</code></pre>
<div class="sourceCode" id="cb147"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>HEC</span></code></pre></div>
<pre><code>## , , Sex = Male
## 
##        Eye
## Hair    Brown Hazel Green Blue
##   Black    32    10     3   11
##   Brown    53    25    15   50
##   Red      10     7     7   10
##   Blond     3     5     8   30
## 
## , , Sex = Female
## 
##        Eye
## Hair    Brown Hazel Green Blue
##   Black    36     5     2    9
##   Brown    66    29    14   34
##   Red      16     7     7    7
##   Blond     4     5     8   64</code></pre>
<p>기존에 존재하던 범주형 변수의 순서를 다르게 하고 싶다면
<code>[]</code>을 통해 인덱싱을 활용하여 바꿀수도 있다.<br />
Eye변수의 수준의 순서를 <strong>Brown,Blue,Hazel,Green</strong>에서
인덱싱을 통해 <strong>Brown,Hazel,Green,Blue</strong>로 바꿔주었다.</p>
<div class="sourceCode" id="cb149"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(UCBAdmissions)</span></code></pre></div>
<pre><code>##  &#39;table&#39; num [1:2, 1:2, 1:6] 512 313 89 19 353 207 17 8 120 205 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ Admit : chr [1:2] &quot;Admitted&quot; &quot;Rejected&quot;
##   ..$ Gender: chr [1:2] &quot;Male&quot; &quot;Female&quot;
##   ..$ Dept  : chr [1:6] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; ...</code></pre>
<p><strong>UCBAdmissions</strong> 데이터는 UC Berkeley의 학생 입학
정보를 나타내고 있는 데이터이다.</p>
<p><code>str</code>함수를 이용하여 <em>UCBAdmissions</em> 데이터의
정보를 파악하였다. 3개의 변수를 갖고있는 테이블 형식의 변수임을 확인할
수 있다.</p>
<ul>
<li>Admit: 입학 승인 여부 (Factor variable - Admitted, Rejected)</li>
<li>Gender: 성별 (Factor variable - Male, Female)</li>
<li>Dept: 지원 부서 (Factor variable - A,B,C,D,E,F)</li>
</ul>
<div class="sourceCode" id="cb151"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>UCB <span class="ot">&lt;-</span> <span class="fu">aperm</span>(UCBAdmissions, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(UCB)<span class="sc">$</span>Admit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;YES&quot;</span>, <span class="st">&quot;NO&quot;</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(UCB)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Admitted&quot;</span>, <span class="st">&quot;Department&quot;</span>)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(UCB)</span></code></pre></div>
<pre><code>##  &#39;table&#39; num [1:2, 1:2, 1:6] 512 89 313 19 353 17 207 8 120 202 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ Sex       : chr [1:2] &quot;Male&quot; &quot;Female&quot;
##   ..$ Admitted  : chr [1:2] &quot;YES&quot; &quot;NO&quot;
##   ..$ Department: chr [1:6] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;D&quot; ...</code></pre>
<div class="sourceCode" id="cb153"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>UCB</span></code></pre></div>
<pre><code>## , , Department = A
## 
##         Admitted
## Sex      YES  NO
##   Male   512 313
##   Female  89  19
## 
## , , Department = B
## 
##         Admitted
## Sex      YES  NO
##   Male   353 207
##   Female  17   8
## 
## , , Department = C
## 
##         Admitted
## Sex      YES  NO
##   Male   120 205
##   Female 202 391
## 
## , , Department = D
## 
##         Admitted
## Sex      YES  NO
##   Male   138 279
##   Female 131 244
## 
## , , Department = E
## 
##         Admitted
## Sex      YES  NO
##   Male    53 138
##   Female  94 299
## 
## , , Department = F
## 
##         Admitted
## Sex      YES  NO
##   Male    22 351
##   Female  24 317</code></pre>
<p><code>aperm</code>함수는 차원을 재배열해주는 함수이다.<br />
- <code>aperm(data, order)</code></p>
<ul>
<li>data: 차원을 재배열하고자 하는 데이터</li>
<li>order: 차원을 재배열하고자 하는 순서</li>
</ul>
<p>테이블에 <code>aperm</code>함수를 지정해주게 되면 테이블을 구성하는
셀 변수의 위치를 바꿀 수 있다.<br />
<code>dimnames, names</code>를 통해 셀을 구성하는 변수의 범주 이름도
변경이 가능하다.</p>
<p>위의 코드를 통해 성별이 행, 합격여부가 열의 위치로 올수 있게
재지정하였고 합격여부의 수준의 이름을 Yes,No로 바꿨으며, 성별과 부서의
이름을 각각 Gender, Department로 변환해주었다.</p>
<hr />
</div>
<div id="generating-tables-with-table-and-xtabs" class="section level2">
<h2>2.4 Generating tables with table() and xtabs()</h2>
<div class="sourceCode" id="cb155"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>,<span class="st">&quot;a2&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;b2&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>sex<span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(A, B, sex, age)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mydata,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##    A  B sex age
## 1 a2 b2   F  28
## 2 a2 b1   M  30
## 3 a2 b1   F  38
## 4 a2 b1   M  26
## 5 a1 b1   M  31</code></pre>
<p>앞서 만든 <code>mydata</code>를 난수고정을 변경하여 다시 한 번
만들어주었다.</p>
<div id="table" class="section level3">
<h3>2.4.1 table()</h3>
<div class="sourceCode" id="cb157"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(mydata<span class="sc">$</span>A, mydata<span class="sc">$</span>B)</span></code></pre></div>
<pre><code>##     
##      b1 b2
##   a1 23 19
##   a2 25 33</code></pre>
<p>데이터 프레임 객체에 <code>table</code>함수를 지정하게 되면 지정한
변수간의 빈도로 테이블을 구성해준다.<br />
- <code>table(data1,data2...)</code></p>
<ul>
<li>data1,data2…: <code>table</code>로 구성하고자 하는 원하는 데이터를
넣어준다.</li>
</ul>
<div class="sourceCode" id="cb159"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>(mytab <span class="ot">&lt;-</span> <span class="fu">table</span>(mydata[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]))</span></code></pre></div>
<pre><code>##     B
## A    b1 b2
##   a1 23 19
##   a2 25 33</code></pre>
<p><code>$</code>가 아닌 인덱싱을 통해서도 <code>table</code>함수를
적용할 수 있으며, 인덱싱을 이용하여 적용하면 범주형 변수의 이름까지
출력되는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb161"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margin.table</span>(mytab)</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb163"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margin.table</span>(mytab, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## A
## a1 a2 
## 42 58</code></pre>
<div class="sourceCode" id="cb165"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">margin.table</span>(mytab, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## B
## b1 b2 
## 48 52</code></pre>
<p><code>margin.table</code>함수를 이용하면 테이블 내에서의 합을 쉽게
구할 수 있다.<br />
- <code>margin.table(data,margin)</code></p>
<ul>
<li>data: 테이블 내에 합을 구할 데이터</li>
<li>margin: 연산의 기준 (1 = 행, 2 = 열, NULL = 전체)</li>
</ul>
<div class="sourceCode" id="cb167"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(mytab)</span></code></pre></div>
<pre><code>##      B
## A      b1  b2 Sum
##   a1   23  19  42
##   a2   25  33  58
##   Sum  48  52 100</code></pre>
<p><code>addmargins</code>함수를 이용하면 셀의 행, 열에 따른 합 뿐만
아니라 테이블 전체 합을 한번에 확인할 수 있다.<br />
- <code>addmargins(data)</code></p>
<ul>
<li>data: 함수를 적용할 데이터</li>
</ul>
<div class="sourceCode" id="cb169"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(mytab)</span></code></pre></div>
<pre><code>##     B
## A      b1   b2
##   a1 0.23 0.19
##   a2 0.25 0.33</code></pre>
<div class="sourceCode" id="cb171"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(mytab,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##     B
## A           b1        b2
##   a1 0.5476190 0.4523810
##   a2 0.4310345 0.5689655</code></pre>
<div class="sourceCode" id="cb173"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(mytab,<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     B
## A           b1        b2
##   a1 0.4791667 0.3653846
##   a2 0.5208333 0.6346154</code></pre>
<p><code>prop.table</code>함수를 이용하면 테이블 내에서의 비율을 구할 수
있다.<br />
- <code>prop.table(data,margin)</code></p>
<ul>
<li>data: 테이블 내에 비율을 구할 데이터</li>
<li>margin: 연산의 기준 (1 = 행, 2 = 열, NULL = 전체)</li>
</ul>
<div class="sourceCode" id="cb175"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>mytab <span class="ot">&lt;-</span> <span class="fu">table</span>(mydata[,<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;sex&quot;</span>)])</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>mytab</span></code></pre></div>
<pre><code>## , , sex = F
## 
##     B
## A    b1 b2
##   a1 10 10
##   a2  9 16
## 
## , , sex = M
## 
##     B
## A    b1 b2
##   a1 13  9
##   a2 16 17</code></pre>
<div class="sourceCode" id="cb177"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(mytab)</span></code></pre></div>
<pre><code>##       sex  F  M
## A  B           
## a1 b1     10 13
##    b2     10  9
## a2 b1      9 16
##    b2     16 17</code></pre>
<p>3차원의 테이블을 <code>table</code>함수를 이용해서 살펴보면 한 눈에
보기가 쉽지 않다.<br />
이때, <code>ftable</code>함수를 이용하면 <code>table</code>함수를 이용한
것 보다 3차원의 테이블을 한 눈에 쉽게 살펴볼 수 있다.<br />
- <code>ftable(data)</code></p>
<ul>
<li>data: 다차원의 분할표를 쉽게 보고자하는 데이터</li>
</ul>
</div>
<div id="xtabs" class="section level3">
<h3>2.4.2 xtabs()</h3>
<div class="sourceCode" id="cb179"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>mytable <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> A <span class="sc">+</span> B <span class="sc">+</span> sex, <span class="at">data =</span> mydata)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(mytable)</span></code></pre></div>
<pre><code>##       sex  F  M
## A  B           
## a1 b1     10 13
##    b2     10  9
## a2 b1      9 16
##    b2     16 17</code></pre>
<p><code>xtabs</code>함수는 데이터에 저장된 변수를
<strong>Formula</strong>를 사용하여 테이블을 구성할 수 있게 만들어주는
함수이다.<br />
- <code>xtabs(formula, data)</code></p>
<ul>
<li>formula: 분석가가 원하고자 하는 테이블의 형태로 구성할 수 있게
해주는 식</li>
<li>data: formula를 적용할 데이터</li>
</ul>
<p>위의 코드의 경우, ~ A + B + sex의 형태의 Formula이기 때문에 A가 행,
B가 열, Sex가 계층을 이루는 <code>table</code>을 구성해준다.</p>
<div class="sourceCode" id="cb181"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mytable)</span></code></pre></div>
<pre><code>## Call: xtabs(formula = ~A + B + sex, data = mydata)
## Number of cases in table: 100 
## Number of factors: 3 
## Test for independence of all factors:
##  Chisq = 2.6519, df = 4, p-value = 0.6177</code></pre>
<p>만들어진 테이블 데이터에 <code>summary()</code>를 하게되면,
<strong>table의 총 빈도, factor의 수, Chisq-test</strong>까지 진행해준
결과를 보여준다.<br />
모든 factor에 대한 독립성 검정결과, 유의확률이 0.6177로 유의수준
0.05보다 크므로 귀무가설을 기각하지 못한다.<br />
따라서, 모든 요인들은 서로 독립인 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>(GSStab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(count <span class="sc">~</span> sex <span class="sc">+</span> party, <span class="at">data =</span> GSS))</span></code></pre></div>
<pre><code>##         party
## sex      dem indep rep
##   female 279    73 227
##   male   165    47 191</code></pre>
<div class="sourceCode" id="cb185"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GSStab)</span></code></pre></div>
<pre><code>## Call: xtabs(formula = count ~ sex + party, data = GSS)
## Number of cases in table: 982 
## Number of factors: 2 
## Test for independence of all factors:
##  Chisq = 6.675, df = 2, p-value = 0.03553</code></pre>
<p><code>빈도 ~ 변수 + 변수</code>형태의 Formula로 지정하여 table을
구성할수도 있다.<br />
위의 코드의 경우, <code>count ~ sex + party</code>의 형태이므로, count에
따른 행(sex), 열(party)의 테이블이 구성된다.<br />
<strong>chisq-test</strong>결과, 유의확률이 0.03553으로 유의수준
0.05보다 작으므로 party와 sex 변수는 서로 연관성이 있으며 독립이 아닌
것을 알 수 있다.</p>
<hr />
</div>
</div>
<div id="printing-tables-with-structable-and-ftable"
class="section level2">
<h2>2.5 Printing tables with structable() and ftable()</h2>
<div id="text-output" class="section level3">
<h3>2.5.1 Text output</h3>
<div class="sourceCode" id="cb187"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(UCB)</span></code></pre></div>
<pre><code>##                 Department   A   B   C   D   E   F
## Sex    Admitted                                   
## Male   YES                 512 353 120 138  53  22
##        NO                  313 207 205 279 138 351
## Female YES                  89  17 202 131  94  24
##        NO                   19   8 391 244 299 317</code></pre>
<p><strong>UCBAdmissions</strong> 데이터의 경우 차원이 꽤 크게 구성
돼있는 데이터이다.<br />
이때, <code>ftable</code>을 적용하면 여러 차원에 있는 데이터를 한번에
쉽게 살펴볼 수 있다.</p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(Admitted <span class="sc">+</span> Sex <span class="sc">~</span> Department, <span class="at">data =</span> UCB)</span></code></pre></div>
<pre><code>##            Admitted  YES          NO       
##            Sex      Male Female Male Female
## Department                                 
## A                    512     89  313     19
## B                    353     17  207      8
## C                    120    202  205    391
## D                    138    131  279    244
## E                     53     94  138    299
## F                     22     24  351    317</code></pre>
<p><code>ftable</code>또한 Formula를 이용하여 테이블을 연구자 본인이
원하는대로 구성할 수 있다.<br />
<code>Admitted + Sex ~ Department</code>는 합격유무와 성별 변수를 부서에
따라서 테이블을 구성하라는 Formula이다.</p>
<div class="sourceCode" id="cb191"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(HairEyeColor)</span></code></pre></div>
<pre><code>##              Eye Brown Blue Hazel Green
## Hair  Sex                              
## Black Male          32   11    10     3
##       Female        36    9     5     2
## Brown Male          53   50    25    15
##       Female        66   34    29    14
## Red   Male          10   10     7     7
##       Female        16    7     7     7
## Blond Male           3   30     5     8
##       Female         4   64     5     8</code></pre>
<p><code>structable</code>또한 R에서 제공하는 다차원의 분할표를 한
테이블안에 생성할 수 있게 만들어주는 함수이다.<br />
- <code>structable(formula, data)</code></p>
<ul>
<li>formula: 분석가가 원하고자 하는 테이블의 형태로 구성할 수 있게
해주는 식</li>
<li>data: 테이블로 변환할 데이터 (formula가 없을 경우 기존 변수의
순서대로 테이블을 구성)</li>
</ul>
<div class="sourceCode" id="cb193"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(Hair <span class="sc">+</span> Sex <span class="sc">~</span> Eye, HairEyeColor)</span></code></pre></div>
<pre><code>##       Hair Black        Brown         Red        Blond       
##       Sex   Male Female  Male Female Male Female  Male Female
## Eye                                                          
## Brown         32     36    53     66   10     16     3      4
## Blue          11      9    50     34   10      7    30     64
## Hazel         10      5    25     29    7      7     5      5
## Green          3      2    15     14    7      7     8      8</code></pre>
<p>위의 코드는 Formula를 이용한 것으로, 머리색깔과 성별을 눈의 색깔에
따라 테이블을 구성하라는 의미이다.</p>
<hr />
</div>
</div>
<div id="subsetting-data" class="section level2">
<h2>2.6 Subsetting data</h2>
<div id="subsetting-tables" class="section level3">
<h3>2.6.1 Subsetting tables</h3>
<div class="sourceCode" id="cb195"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>HairEyeColor[,,<span class="st">&quot;Female&quot;</span>]</span></code></pre></div>
<pre><code>##        Eye
## Hair    Brown Blue Hazel Green
##   Black    36    9     5     2
##   Brown    66   34    29    14
##   Red      16    7     7     7
##   Blond     4   64     5     8</code></pre>
<p>다차원의 분할표로 구성된 테이블에서
<code>[,,"차원의 변수 중 원하는 범주]</code>로 지정하게 되면 차원을
구성하는 변수 중 원하는 범주만의 데이터를 볼 수 있다.</p>
<p>위의 코드는 <code>HairEyeColor</code>에서 <code>Female</code>의
Hair,Eye를 출력해달라는 코드이다.</p>
<div class="sourceCode" id="cb197"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>HairEyeColor[<span class="fu">c</span>(<span class="st">&quot;Black&quot;</span>,<span class="st">&quot;Brown&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;Hazel&quot;</span>, <span class="st">&quot;Green&quot;</span>),]</span></code></pre></div>
<pre><code>## , , Sex = Male
## 
##        Eye
## Hair    Hazel Green
##   Black    10     3
##   Brown    25    15
## 
## , , Sex = Female
## 
##        Eye
## Hair    Hazel Green
##   Black     5     2
##   Brown    29    14</code></pre>
<p>또는 위와같이 원하는 셀의 속성 중 원하는 범주형 변수만의 데이터만을
살펴볼수도 있다.<br />
위의 코드는 Hair는 <code>Black, Brown</code>, Eye는
<code>Hazel, Green</code>만을 출력하게 만드는 인덱싱이다.</p>
<div class="sourceCode" id="cb199"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(HairEyeColor, <span class="dv">3</span>, sum)</span></code></pre></div>
<pre><code>##   Male Female 
##    279    313</code></pre>
<p><code>apply</code>함수를 이용하여 테이블을 구성하는 차원 변수에 따른
sum을 구하였다.<br />
앞에서 설명한 <code>apply</code>의 경우 margin이 1 또는 2만을 가졌지만,
테이블의 경우 특이하게 <code>margin = 3</code>까지 지정할 수 있다.<br />
<code>margin = 3</code>은 계층에 따라서 함수를 적용하라는 의미이다. 즉,
<code>HairEyeColor</code>에서는 계층이 성별이므로 성별에 따른 합이
출력되는 것을 확인할 수 있다.</p>
</div>
<div id="subsetting-structables" class="section level3">
<h3>2.6.2 Subsetting structables</h3>
<div class="sourceCode" id="cb201"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>hec <span class="ot">&lt;-</span> <span class="fu">structable</span>(Eye <span class="sc">~</span> Sex <span class="sc">+</span> Hair, <span class="at">data =</span> HairEyeColor)</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>hec</span></code></pre></div>
<pre><code>##              Eye Brown Blue Hazel Green
## Sex    Hair                            
## Male   Black        32   11    10     3
##        Brown        53   50    25    15
##        Red          10   10     7     7
##        Blond         3   30     5     8
## Female Black        36    9     5     2
##        Brown        66   34    29    14
##        Red          16    7     7     7
##        Blond         4   64     5     8</code></pre>
<p><strong>hec</strong>이라는 객체안에
<strong>HairEyeColor</strong>변수에 <code>structable</code>을
적용한(눈에 따른 성별과 머리의 빈도) 하나의 분할표로 이루어진 데이터를
저장하였다.</p>
<div class="sourceCode" id="cb203"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>hec[<span class="st">&quot;Male&quot;</span>,]</span></code></pre></div>
<pre><code>##            Eye Brown Blue Hazel Green
## Sex  Hair                            
## Male Black        32   11    10     3
##      Brown        53   50    25    15
##      Red          10   10     7     7
##      Blond         3   30     5     8</code></pre>
<p>위의 코드는 <code>[]</code>을 사용하여 남성의 Eye와 Hair만을 출력할
수 있게 인덱싱을 적용한 코드이다.</p>
<div class="sourceCode" id="cb205"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>hec[[<span class="st">&quot;Male&quot;</span>,]]</span></code></pre></div>
<pre><code>##       Eye Brown Blue Hazel Green
## Hair                            
## Black        32   11    10     3
## Brown        53   50    25    15
## Red          10   10     7     7
## Blond         3   30     5     8</code></pre>
<p><code>[[]]</code>을 적용하여 인덱싱을 적욯하면 3차원인 성별에 대한
계층은 출력되지 않는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb207"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>hec[[<span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Brown&quot;</span>),]]</span></code></pre></div>
<pre><code>## Eye Brown Blue Hazel Green
##                           
##        53   50    25    15</code></pre>
<p><code>[[]]와 c()</code>를 결합시켜 남성 중 갈색 머리를 가진 사람들의
눈색깔만 출력할 수 있게 인덱싱을 적용한 결과이다.</p>
</div>
<div id="subsetting-data-frames" class="section level3">
<h3>2.6.3 Subsetting data frames</h3>
<div class="sourceCode" id="cb209"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">&lt;-</span> Arthritis<span class="sc">$</span>Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span> <span class="sc">&amp;</span> Arthritis<span class="sc">$</span>Age <span class="sc">&gt;</span> <span class="dv">68</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Treatment&quot;</span>, <span class="st">&quot;Improved&quot;</span>)</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>Arthritis[rows, cols]</span></code></pre></div>
<pre><code>##    Treatment Improved
## 39   Treated     None
## 40   Treated     Some
## 41   Treated     Some
## 84   Placebo   Marked</code></pre>
<p>데이터를 탐색함에 있어 특정한 조건을 만족하는 데이터를 탐색하고 싶은
경우가 있다.<br />
이러한 경우, 특정 조건을 저장한 후, 인덱싱을 통해 지정한 조건을 만족하는
데이터만을 추출하여 확인할 수 있다.<br />
위의 코드는 성별은 여성이며, 나이는 68세 이상인 환자의 치료방법과
치료결과를 출력하라는 코드이다.<br />
전체 데이터 중, 4명의 환자만이 위의 조건을 만족하는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb211"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(Arthritis, Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span> <span class="sc">&amp;</span> Age <span class="sc">&gt;</span> <span class="dv">68</span>,</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">select =</span> <span class="fu">c</span>(Treatment, Improved))</span></code></pre></div>
<pre><code>##    Treatment Improved
## 39   Treated     None
## 40   Treated     Some
## 41   Treated     Some
## 84   Placebo   Marked</code></pre>
<p>또는 R에서 제공하는 <code>subset</code>함수를 이용하여 보다 쉽게
데이터 필터링을 진행할 수 있다.<br />
<code>subset</code>함수는 분석가가 지정한 조건에 따라 필터링을 진행한
후, 원하는 변수들만을 출력해줄 수 있게 만들어주는 함수이다.<br />
- <code>subset(data, subset, select)</code></p>
<ul>
<li>data: 조건을 적용하고자 하는 데이터</li>
<li>subset: 적용하고자 하는 조건</li>
<li>select: 조건을 적용한 데이터 중, 출력하고자 하는 변수</li>
</ul>
<div class="sourceCode" id="cb213"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(Arthritis, Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span> <span class="sc">&amp;</span> Age <span class="sc">&gt;</span> <span class="dv">68</span>, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Age, ID))</span></code></pre></div>
<pre><code>##    Treatment    Sex Improved
## 39   Treated Female     None
## 40   Treated Female     Some
## 41   Treated Female     Some
## 84   Placebo Female   Marked</code></pre>
<p><strong>select</strong>옵션에서 <code>-select(제외할 변수)</code>으로
지정해 주게 되면 설정한 변수는 제외한 변수들만을 이용하여 결과를
보여준다.</p>
<div class="sourceCode" id="cb215"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(iris,<span class="at">mean_Length =</span> (Sepal.Length <span class="sc">+</span> Petal.Length) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species mean_Length
## 1          5.1         3.5          1.4         0.2  setosa        3.25
## 2          4.9         3.0          1.4         0.2  setosa        3.15
## 3          4.7         3.2          1.3         0.2  setosa        3.00
## 4          4.6         3.1          1.5         0.2  setosa        3.05
## 5          5.0         3.6          1.4         0.2  setosa        3.20</code></pre>
<p><code>mutate</code>함수는 <code>dplr</code>패키지에 포함된 함수로
데이터 프레임 형태의 데이터를 사용함에 있어 새로운 데이터 변수를
만들고자 할 때, 유용하게 사용할 수 있는 함수이다.<br />
- <code>mutate(data,new_variable = formula)</code></p>
<ul>
<li>data: <code>mutate</code>함수를 활용하고자하는 데이터</li>
<li>new_variable: 새로운 변수의 이름</li>
<li>formula: 만들고자 하는 새로운 변수를 구할 수 있는 식</li>
</ul>
<p><code>mutate</code>를 이용하여 꽃잎과 꽃받침 길이의 평균에 대한
정보를 갖고있는 <strong>mean_Length</strong>변수를 만들었다.</p>
<div class="sourceCode" id="cb217"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(iris,<span class="at">mean_width =</span> (Sepal.Width <span class="sc">+</span> Petal.Width) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sum_flower =</span> (Sepal.Length <span class="sc">+</span> Petal.Length <span class="sc">+</span> Sepal.Width <span class="sc">+</span> Petal.Width))</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species mean_Length
## 1          5.1         3.5          1.4         0.2  setosa        3.25
## 2          4.9         3.0          1.4         0.2  setosa        3.15
## 3          4.7         3.2          1.3         0.2  setosa        3.00
## 4          4.6         3.1          1.5         0.2  setosa        3.05
## 5          5.0         3.6          1.4         0.2  setosa        3.20
##   mean_width sum_flower
## 1       1.85       10.2
## 2       1.60        9.5
## 3       1.70        9.4
## 4       1.65        9.4
## 5       1.90       10.2</code></pre>
<p>한 개의 변수가 아닌 여러개의 변수를 추가하고 싶다면 <code>,</code>를
이용해서 만들고자 하는 변수 이름을 지정한 후 새로운 변수에 대한 식을
계속 정의하면 여러 개의 식을 한 번에 추가할 수 있다.</p>
<hr />
</div>
</div>
<div id="collapsing-tables" class="section level2">
<h2>2.7 Collapsing tables</h2>
<div id="collapsing-over-table-factors-aggregate-margin.table-and-apply"
class="section level3">
<h3>2.7.1 Collapsing over table factors: aggregate(), margin.table(),
and apply()</h3>
<div class="sourceCode" id="cb219"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;DaytonSurvey&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(DaytonSurvey)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    32 obs. of  6 variables:
##  $ cigarette: Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ alcohol  : Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 1 2 2 1 1 2 2 1 1 ...
##  $ marijuana: Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 1 1 1 2 2 2 2 1 1 ...
##  $ sex      : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 1 1 1 1 1 1 1 1 2 2 ...
##  $ race     : Factor w/ 2 levels &quot;white&quot;,&quot;other&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Freq     : num  405 13 1 1 268 218 17 117 453 28 ...</code></pre>
<div class="sourceCode" id="cb221"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(DaytonSurvey)</span></code></pre></div>
<pre><code>##   cigarette alcohol marijuana    sex  race Freq
## 1       Yes     Yes       Yes female white  405
## 2        No     Yes       Yes female white   13
## 3       Yes      No       Yes female white    1
## 4        No      No       Yes female white    1
## 5       Yes     Yes        No female white  268
## 6        No     Yes        No female white  218</code></pre>
<p><strong>DaytonSurvey</strong>는 미국 오하이오 데이톤 고등학교에서
학생들을 대상으로 설문조사를 한 결과를 보여주는 데이터이다.<br />
32개의 관측값과 6개의 변수로 구성돼있다.</p>
<ul>
<li>cigarette: 담배 유무 (Factor Variable - Yes, No)</li>
<li>alcohol: 술 유무 (Factor Variable - Yes, No)</li>
<li>marijuana: 마리화나 유무 (Factor Variable - Yes, No)</li>
<li>sex: 성별 (Factor Variable - female, male)</li>
<li>race: 인종 (Factor Variable - white, other)</li>
<li>Freq: 빈도 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb223"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>Dayton_ACM_df <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(Freq <span class="sc">~</span> cigarette <span class="sc">+</span> alcohol <span class="sc">+</span> marijuana, <span class="at">data =</span> DaytonSurvey, <span class="at">FUN =</span> sum)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>Dayton_ACM_df</span></code></pre></div>
<pre><code>##   cigarette alcohol marijuana Freq
## 1       Yes     Yes       Yes  911
## 2        No     Yes       Yes   44
## 3       Yes      No       Yes    3
## 4        No      No       Yes    2
## 5       Yes     Yes        No  538
## 6        No     Yes        No  456
## 7       Yes      No        No   43
## 8        No      No        No  279</code></pre>
<p><code>aggregate</code>함수는 <code>apply</code>함수와 유사하게 지정한
조건에 따른 변수들의 함수 적용결과를 도출할 수 있다.<br />
- <code>aggregate(Formula, data, FUN)</code></p>
<ul>
<li>Formula: 분석가가 원하고자 하는 조건</li>
<li>data: 조건을 적용할 데이터</li>
<li>FUN: 조건에 따라 나눠진 데이터에 적용할 함수</li>
</ul>
<p>위의 코드에서는 <strong>cigarette + alcohol + marijuana</strong>에
따른 <strong>Freq</strong>의 합을 구하는 코드이다.<br />
3개의 범주형 변수의 수준이 2개 이므로 총 2^3 = 8개의 결과가 나오는 것을
확인할 수 있다.</p>
<p><em>Example 2.7: Dayton survey</em></p>
<div class="sourceCode" id="cb225"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>Dayton_tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> cigarette <span class="sc">+</span> alcohol <span class="sc">+</span> marijuana <span class="sc">+</span> sex <span class="sc">+</span> race,</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> DaytonSurvey)</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(cigarette <span class="sc">+</span> alcohol <span class="sc">+</span> marijuana <span class="sc">~</span> sex <span class="sc">+</span> race,</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> Dayton_tab)</span></code></pre></div>
<pre><code>##              cigarette Yes              No            
##              alcohol   Yes      No     Yes      No    
##              marijuana Yes  No Yes  No Yes  No Yes  No
## sex    race                                           
## female white           405 268   1  17  13 218   1 117
##        other            23  23   0   1   2  19   0  12
## male   white           453 228   1  17  28 201   1 133
##        other            30  19   1   8   1  18   0  17</code></pre>
<p>데이터 프레임으로 저장된 <em>DaytonSurvey</em>를
<code>xtabs</code>함수를 이용하여 테이블로 바꿔주었다.<br />
또한, <code>strutable</code> 함수를 이용하여 변환된 다차원의 테이블을
하나의 테이블로 쉽게 탐색할 수 있다.</p>
<div class="sourceCode" id="cb227"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>(Dayton_ACM_tab <span class="ot">&lt;-</span> <span class="fu">apply</span>(Dayton_tab, <span class="at">MARGIN =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">FUN =</span> sum))</span></code></pre></div>
<pre><code>## , , marijuana = Yes
## 
##          alcohol
## cigarette Yes No
##       Yes 911  3
##       No   44  2
## 
## , , marijuana = No
## 
##          alcohol
## cigarette Yes  No
##       Yes 538  43
##       No  456 279</code></pre>
<p><code>apply</code>함수를 이용하여 테이블의 빈도 합을 구하였다.<br />
<code>margin = 1:3</code>으로 지정하게 되면 제일 첫 번째 차원인
<strong>marijuana</strong> 여부에 따른 테이블의 행과 셀의 합을
정리해준다.</p>
<div class="sourceCode" id="cb229"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">apply</span>(Dayton_tab, <span class="at">MARGIN =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">FUN =</span> sum))</span></code></pre></div>
<pre><code>## , , marijuana = Yes, sex = female
## 
##          alcohol
## cigarette Yes No
##       Yes 428  1
##       No   15  1
## 
## , , marijuana = No, sex = female
## 
##          alcohol
## cigarette Yes  No
##       Yes 291  18
##       No  237 129
## 
## , , marijuana = Yes, sex = male
## 
##          alcohol
## cigarette Yes No
##       Yes 483  2
##       No   29  1
## 
## , , marijuana = No, sex = male
## 
##          alcohol
## cigarette Yes  No
##       Yes 247  25
##       No  219 150</code></pre>
<p><code>margin = 1:4</code>으로 지정하게 되면 첫 번째 차원인
<strong>marijuana</strong>, 두 번째 차원인 <strong>sex</strong>까지
고려한 후, 행과 셀의 합을 정리해준다.</p>
<div class="sourceCode" id="cb231"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>Dayton_ACM_tab <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(Dayton_tab, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(cigarette <span class="sc">+</span> alcohol <span class="sc">~</span> marijuana, <span class="at">data =</span> Dayton_ACM_tab)</span></code></pre></div>
<pre><code>##           cigarette Yes      No    
##           alcohol   Yes  No Yes  No
## marijuana                          
## Yes                 911   3  44   2
## No                  538  43 456 279</code></pre>
<p>또는, <code>margin.table</code>함수를 이용하여 <code>apply</code>를
적용한 결과와 같은 결과를 얻을 수도 있다.</p>
<div class="sourceCode" id="cb233"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span></code></pre></div>
<pre><code>## ------------------------------------------------------------------------------</code></pre>
<pre><code>## You have loaded plyr after dplyr - this is likely to cause problems.
## If you need functions from both plyr and dplyr, please load plyr first, then dplyr:
## library(plyr); library(dplyr)</code></pre>
<pre><code>## ------------------------------------------------------------------------------</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;plyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     arrange, count, desc, failwith, id, mutate, rename, summarise,
##     summarize</code></pre>
<p><code>plyr</code>패키지는 다양한 형태의 데이터를 분석가가 다루기 조금
더 쉽게 만들어주는 함수들을 갖고 있는 패키지이다. 흔히 우리가 알고 있는
<code>dplyr</code>패키지와 유사하다고 생각하면 된다.<br />
조금 다른점은, 함수를 적용한 결과에 대해서 테이블, 리스트등의 형태로
변환하여 결과를 출력하고 싶은경우 유용하게 사용할 수 있다는 점이다.</p>
<div class="sourceCode" id="cb239"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>Dayton_ACM_df <span class="ot">&lt;-</span> <span class="fu">ddply</span>(DaytonSurvey, .(cigarette, alcohol, marijuana),summarise, <span class="at">Freq =</span> <span class="fu">sum</span>(Freq))</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>Dayton_ACM_df</span></code></pre></div>
<pre><code>##   cigarette alcohol marijuana Freq
## 1       Yes     Yes       Yes  911
## 2       Yes     Yes        No  538
## 3       Yes      No       Yes    3
## 4       Yes      No        No   43
## 5        No     Yes       Yes   44
## 6        No     Yes        No  456
## 7        No      No       Yes    2
## 8        No      No        No  279</code></pre>
<p><code>ddply</code>는 데이터에서 연구자가 원하는 변수를 선택한 후
원하는 연산(sum.mean 등)을 진행한 후 데이터 프레임 형태로 결과를 주는
함수이다.<br />
-
<code>ddply(data, .variables, summarise, create = fun(create))</code></p>
<ul>
<li>data: 분석가가 사용하는 데이터</li>
<li>variable: 분석에 사용하고자 하는 변수</li>
<li>summarise: 지정한 변수들만을 사용할 수 있게 만들어주는 함수</li>
<li>create: 만들고자하는 새로운 변수명</li>
<li>fun: 지정하고 나눠진 변수들에 대해서 적용할 함수</li>
</ul>
</div>
<div id="collapsing-table-levels-collapse.table" class="section level3">
<h3>2.7.2 Collapsing table levels: collapse.table()</h3>
<p><em>Example 2.8: Collapsing categories</em></p>
<div class="sourceCode" id="cb241"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;10-19&quot;</span>,<span class="st">&quot;20-29&quot;</span>,<span class="st">&quot;30-39&quot;</span>,<span class="st">&quot;40-49&quot;</span>,<span class="st">&quot;50-59&quot;</span>,<span class="st">&quot;60-69&quot;</span>)</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;low&quot;</span>,<span class="st">&quot;mid&quot;</span>,<span class="st">&quot;high&quot;</span>)</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">sex =</span> sex, <span class="at">age =</span> age, <span class="at">education =</span> education)</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">36</span>, <span class="dv">100</span>)</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dat, counts)</span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##      sex   age education counts
## 1   Male 10-19       low    105
## 2 Female 10-19       low    107
## 3   Male 20-29       low     98
## 4 Female 20-29       low     95
## 5   Male 30-39       low    123</code></pre>
<div class="sourceCode" id="cb243"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    36 obs. of  4 variables:
##  $ sex      : Factor w/ 2 levels &quot;Male&quot;,&quot;Female&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ age      : Factor w/ 6 levels &quot;10-19&quot;,&quot;20-29&quot;,..: 1 1 2 2 3 3 4 4 5 5 ...
##  $ education: Factor w/ 3 levels &quot;low&quot;,&quot;mid&quot;,&quot;high&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ counts   : int  105 107 98 95 123 105 97 116 95 103 ...</code></pre>
<p><code>expand.grid</code>함수를 활용하여 성별, 연령대, 교육수준,
빈도에 대한 데이터를 생성하였다.</p>
<ul>
<li>sex: 성별 (Facotr variable - Male, Female)</li>
<li>age: 연령대 (Facotr variable - 10-19, 20-29, 30-39, 40-49, 50-59,
60-69)</li>
<li>education: 교육 수준 (Facotr variable - low, mid, high)</li>
<li>counts: 빈도 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb245"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(counts <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> education, <span class="at">data =</span> dat)</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(tab1)</span></code></pre></div>
<pre><code>##                  age 10-19 20-29 30-39 40-49 50-59 60-69
## sex    education                                        
## Male   low             105    98   123    97    95   105
##        mid              74   113   114    82    95    85
##        high            121   116   104   103    89   100
## Female low             107    95   105   116   103    92
##        mid              96    88    93   118    99   108
##        high            120   102    96   103   127    84</code></pre>
<p><code>xtabs</code>의 formula를 이용하여 성별,나이대,교육수준을 빈도에
따른 테이블의 형태로 재구성하였다.</p>
<div class="sourceCode" id="cb247"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span></code></pre></div>
<pre><code>## 필요한 패키지를 로딩중입니다: gnm</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;vcdExtra&#39;</code></pre>
<pre><code>## The following objects are masked _by_ &#39;.GlobalEnv&#39;:
## 
##     GSS, JobSat</code></pre>
<pre><code>## The following object is masked from &#39;package:plyr&#39;:
## 
##     summarise</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     summarise</code></pre>
<div class="sourceCode" id="cb253"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">collapse.table</span>(tab1,</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">age =</span> <span class="fu">c</span>(<span class="st">&quot;10-29&quot;</span>,<span class="st">&quot;10-29&quot;</span>,<span class="st">&quot;30-49&quot;</span>,<span class="st">&quot;30-49&quot;</span>,<span class="st">&quot;50-69&quot;</span>,<span class="st">&quot;50-69&quot;</span>),</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">education =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;high&quot;</span>, <span class="st">&quot;&lt;high&quot;</span>, <span class="st">&quot;high&quot;</span>))</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(tab2)</span></code></pre></div>
<pre><code>##                  age 10-29 30-49 50-69
## sex    education                      
## Male   &lt;high           390   416   380
##        high            237   207   189
## Female &lt;high           386   432   402
##        high            222   199   211</code></pre>
<p><code>vcdExtra</code>패키지는 기존에 있던 범주형 데이터에 대한
시각화, 데이터 전처리의 함수와 더불어 추가적으로 범주형 데이터를
사용함에 있어 더욱 편리하고 유용한 함수들을 제공하기 위해 만들어진
패키지이다.</p>
<p><code>collapse.table</code>함수를 통해 같은 수준을 가지는 데이터들을
합쳐 테이블을 구성할 수 있다.<br />
- <code>collapse.table(data, levels)</code></p>
<ul>
<li>data: 구성을 바꾸고자 하는 테이블</li>
<li>levels: 특정 범주 변수의 재구성할 수준</li>
</ul>
<p>위 코드의 경우 <strong>age, education</strong>변수에서 같은 범주형
levels(수준) 가지는 값들이 자동으로 하나의 데이터로 합쳐져 테이블이
구성된 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="converting-among-frequency-tables-and-data-frames"
class="section level2">
<h2>2.8 Converting among frequency tables and data frames</h2>
<div id="table-form-to-frequency-form" class="section level3">
<h3>2.8.1 Table form to frequency form</h3>
<p><em>Example 2.9: General social survey</em></p>
<div class="sourceCode" id="cb255"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(GSStab)</span></code></pre></div>
<pre><code>##      sex party Freq
## 1 female   dem  279
## 2   male   dem  165
## 3 female indep   73
## 4   male indep   47
## 5 female   rep  227
## 6   male   rep  191</code></pre>
<p><code>as.data.frame</code>은 데이터의 형태를 데이터 프레임으로
바꿔주는 함수이다.<br />
- <code>as.data.frame(data)</code></p>
<ul>
<li>data: 데이터의 프레임 형태로 바꿔줄 데이터</li>
</ul>
<p><strong>GSStab</strong>의 경우 원래는 테이블의 형태를 갖지만,
<code>as.data.frame</code>적용 후 데이터 프레임 형태로 바뀐것을 확인할
수 있다.</p>
<p><em>Example 2.10: Death by horse kick</em></p>
<div class="sourceCode" id="cb257"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">as.data.frame</span>(HorseKicks))</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  2 variables:
##  $ nDeaths: Factor w/ 5 levels &quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,..: 1 2 3 4 5
##  $ Freq   : int  109 65 22 3 1</code></pre>
<p><code>HorseKicks</code>데이터는 과거 프로이센군의 10개 군단이 20년
동안 말의 발차기에 의해 얼마나 죽었는지를 나타내는 데이터이다.<br />
<code>str</code>을 통해 데이터를 살펴본 결과,
<code>HorseKicks</code>데이터는 5개의 관측값과 2개의 변수로 이뤄진 것을
확인할 수 있다.</p>
<ul>
<li>nDeaths: 죽은 사람의 수 (Factor variable - 0,1,2,3,4)</li>
<li>Freq: 빈도 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb259"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>horse.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">nDeaths =</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(HorseKicks)),</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Freq =</span> <span class="fu">as.vector</span>(HorseKicks))</span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(horse.df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  2 variables:
##  $ nDeaths: num  0 1 2 3 4
##  $ Freq   : int  109 65 22 3 1</code></pre>
<div class="sourceCode" id="cb261"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>horse.df</span></code></pre></div>
<pre><code>##   nDeaths Freq
## 1       0  109
## 2       1   65
## 3       2   22
## 4       3    3
## 5       4    1</code></pre>
<p><code>as.data.frame</code>을 이용하지 않고 <code>data.frame</code>을
통해서 데이터의 형태를 데이터 프레임으로 변경할 수 있다.<br />
유의할 점은 <code>data.frame</code>의 경우 데이터 프레임에 들어갈 각
변수를 <strong>칼럼이름 = 원하는 변수</strong> 형태로 지정을 해줘야
한다.</p>
</div>
<div id="case-form-to-table-form" class="section level3">
<h3>2.8.2 Case form to table form</h3>
<p><em>Example 2.11: Arthritis treatment</em></p>
<div class="sourceCode" id="cb263"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>Art.tab <span class="ot">&lt;-</span> <span class="fu">table</span>(Arthritis[,<span class="fu">c</span>(<span class="st">&quot;Treatment&quot;</span>, <span class="st">&quot;Sex&quot;</span>, <span class="st">&quot;Improved&quot;</span>)])</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Art.tab)</span></code></pre></div>
<pre><code>##  &#39;table&#39; int [1:2, 1:2, 1:3] 19 6 10 7 7 5 0 2 6 16 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ Treatment: chr [1:2] &quot;Placebo&quot; &quot;Treated&quot;
##   ..$ Sex      : chr [1:2] &quot;Female&quot; &quot;Male&quot;
##   ..$ Improved : chr [1:3] &quot;None&quot; &quot;Some&quot; &quot;Marked&quot;</code></pre>
<div class="sourceCode" id="cb265"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(Art.tab)</span></code></pre></div>
<pre><code>##                  Improved None Some Marked
## Treatment Sex                             
## Placebo   Female            19    7      6
##           Male              10    0      1
## Treated   Female             6    5     16
##           Male               7    2      5</code></pre>
<p>case form으로 돼있는 <code>Arthritis</code>데이터를
<code>table</code>함수를 이용하여 빈도수가 있는 테이블의 형태로
바꿔주었다.<br />
이는 <strong>case form</strong>을 <strong>table form</strong>으로 바꾼
예시라고 할 수 있다.</p>
</div>
<div id="table-form-to-case-form" class="section level3">
<h3>2.8.3 Table form to case form</h3>
<p><em>Example 2.12: Arthritis treatment</em></p>
<div class="sourceCode" id="cb267"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>Art.df <span class="ot">&lt;-</span> <span class="fu">expand.dft</span>(Art.tab)</span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Art.df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    84 obs. of  3 variables:
##  $ Treatment: chr  &quot;Placebo&quot; &quot;Placebo&quot; &quot;Placebo&quot; &quot;Placebo&quot; ...
##  $ Sex      : chr  &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ Improved : chr  &quot;None&quot; &quot;None&quot; &quot;None&quot; &quot;None&quot; ...</code></pre>
<div class="sourceCode" id="cb269"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Art.df)</span></code></pre></div>
<pre><code>##   Treatment    Sex Improved
## 1   Placebo Female     None
## 2   Placebo Female     None
## 3   Placebo Female     None
## 4   Placebo Female     None
## 5   Placebo Female     None
## 6   Placebo Female     None</code></pre>
<p><code>expand.dft</code> 함수를 통해 <strong>table</strong> 형태로
변환된 데이터를 다시 <strong>case form</strong>의 형태로 바꿀 수
있다.<br />
- <code>expand.dft(x)</code></p>
<ul>
<li>x: case form으로 바꾸고자 하는 table의 형태로 저장된 데이터</li>
</ul>
</div>
<div id="publising-tables-to-latex-or-html" class="section level3">
<h3>2.8.4 publising tables to LATEX or HTML</h3>
<div class="sourceCode" id="cb271"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HorseKicks&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xtable)</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xtable</span>(HorseKicks)</span></code></pre></div>
<pre><code>## % latex table generated in R 4.2.1 by xtable 1.8-4 package
## % Thu Sep 29 20:49:26 2022
## \begin{table}[ht]
## \centering
## \begin{tabular}{rr}
##   \hline
##  &amp; nDeaths \\ 
##   \hline
## 0 &amp; 109 \\ 
##   1 &amp;  65 \\ 
##   2 &amp;  22 \\ 
##   3 &amp;   3 \\ 
##   4 &amp;   1 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
<div class="sourceCode" id="cb273"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(HorseKicks)</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;nDeaths&quot;</span>, <span class="st">&quot;Freq&quot;</span>)</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">xtable</span>(tab), <span class="at">include.rownames =</span> <span class="cn">FALSE</span>, <span class="at">include.colnames =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## % latex table generated in R 4.2.1 by xtable 1.8-4 package
## % Thu Sep 29 20:49:27 2022
## \begin{table}[ht]
## \centering
## \begin{tabular}{lr}
##   \hline
## nDeaths &amp; Freq \\ 
##   \hline
## 0 &amp; 109 \\ 
##   1 &amp;  65 \\ 
##   2 &amp;  22 \\ 
##   3 &amp;   3 \\ 
##   4 &amp;   1 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
<p>R에서 분석을 진행한 후에, HTML 형식의 웹 페이지에 일부 테이블을
삽입하려고하면 오류가 발생하기 쉽다.<br />
이때, R의 <code>xtable</code>을 이용하면 쉽게 해결할 수 있다.<br />
특히, <strong>Latex</strong> 문서에 삽입을 하려고 할 때, 상당히 유용하게
사용할 수 있다.</p>
<div class="sourceCode" id="cb275"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>horsetab <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.data.frame</span>(<span class="fu">addmargins</span>(HorseKicks)))</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(horsetab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Number of deaths&quot;</span>, <span class="st">&quot;Frequency&quot;</span>)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>horsetab <span class="ot">&lt;-</span> <span class="fu">xtable</span>(horsetab, <span class="at">digits =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">&quot;tab:xtable5&quot;</span>,</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">caption =</span> <span class="st">&quot;von Bortkiewicz&#39;s data on deaths by horse kikcs&quot;</span>,</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">align =</span> <span class="fu">paste0</span>(<span class="st">&quot;1|&quot;</span>, <span class="fu">paste</span>(<span class="fu">rep</span>(<span class="st">&quot;r&quot;</span>, <span class="fu">ncol</span>(horsetab) <span class="sc">+</span> <span class="dv">1</span>), <span class="at">collpase =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-8"><a href="#cb275-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(horsetab, <span class="at">include.colnames =</span> <span class="cn">FALSE</span>, <span class="at">caption.placement =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<pre><code>## % latex table generated in R 4.2.1 by xtable 1.8-4 package
## % Thu Sep 29 20:49:27 2022
## \begin{table}[ht]
## \centering
## \caption{von Bortkiewicz&#39;s data on deaths by horse kikcs} 
## \label{tab:xtable5}
## \begin{tabular}{1|r 1|r 1|r 1|r 1|r 1|r 1|r }
##   \hline
##   \hline
## Number of deaths &amp; 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; Sum \\ 
##   Frequency &amp; 109 &amp;  65 &amp;  22 &amp;   3 &amp;   1 &amp; 200 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
<div class="sourceCode" id="cb277"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(horsetab, <span class="at">include.colnames =</span> <span class="cn">FALSE</span>, <span class="at">caption.placement =</span> <span class="st">&quot;top&quot;</span>,<span class="at">type=</span><span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<pre><code>## &lt;!-- html table generated in R 4.2.1 by xtable 1.8-4 package --&gt;
## &lt;!-- Thu Sep 29 20:49:27 2022 --&gt;
## &lt;table border=1&gt;
## &lt;caption align=&quot;top&quot;&gt; von Bortkiewicz&#39;s data on deaths by horse kikcs &lt;/caption&gt;
##   &lt;tr&gt; &lt;td align=&quot;1|r &quot;&gt; Number of deaths &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 0 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 1 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 2 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 3 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 4 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; Sum &lt;/td&gt; &lt;/tr&gt;
##   &lt;tr&gt; &lt;td align=&quot;1|r &quot;&gt; Frequency &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 109 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt;  65 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt;  22 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt;   3 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt;   1 &lt;/td&gt; &lt;td align=&quot;1|r &quot;&gt; 200 &lt;/td&gt; &lt;/tr&gt;
##    &lt;/table&gt;</code></pre>
<p><code>xtable</code>의 다양한 옵션을 통해 테이블을 사용자가 원하는
대로 구성할 수 있다.<br />
또한, print를 한 후, <code>type = html</code>을 하게 되면
<em>html</em>형태로 출력하는 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="a-complex-example-tv-viewing-data" class="section level2">
<h2>2.9 A complex example: TV viewing data</h2>
<div id="creating-dataframes-and-arrays" class="section level3">
<h3>2.9.1 Creating dataframes and arrays</h3>
<div class="sourceCode" id="cb279"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>tv_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:/Program Files/R/R-4.2.1/library/vcdExtra/extdata/tv.dat&quot;</span>)</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tv_data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    825 obs. of  5 variables:
##  $ V1: int  1 2 3 4 5 1 2 3 4 5 ...
##  $ V2: int  1 1 1 1 1 2 2 2 2 2 ...
##  $ V3: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ V4: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ V5: int  6 18 6 2 11 6 29 25 17 29 ...</code></pre>
<div class="sourceCode" id="cb281"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tv_data,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   V1 V2 V3 V4 V5
## 1  1  1  1  1  6
## 2  2  1  1  1 18
## 3  3  1  1  1  6
## 4  4  1  1  1  2
## 5  5  1  1  1 11</code></pre>
<p><code>read.table</code>함수를 이용하여 경로에 저장 돼있는
<strong>tv.dat</strong>함수를 불러온 후 <strong>tv_data</strong>에
저장한 후, 데이터를 탐색하였다.</p>
<div class="sourceCode" id="cb283"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a>TV_df <span class="ot">&lt;-</span> tv_data</span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TV_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Day&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Network&quot;</span>, <span class="st">&quot;State&quot;</span>, <span class="st">&quot;Freq&quot;</span>)</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>TV_df <span class="ot">&lt;-</span> <span class="fu">within</span> (TV_df, {</span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  Day <span class="ot">&lt;-</span> <span class="fu">factor</span>(Day, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>))</span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  Time <span class="ot">&lt;-</span> <span class="fu">factor</span>(Time)</span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>  Network <span class="ot">&lt;-</span> <span class="fu">factor</span>(Network)</span>
<span id="cb283-7"><a href="#cb283-7" aria-hidden="true" tabindex="-1"></a>  State <span class="ot">&lt;-</span> <span class="fu">factor</span>(State)</span>
<span id="cb283-8"><a href="#cb283-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb283-9"><a href="#cb283-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TV_df,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   Day Time Network State Freq
## 1 Mon    1       1     1    6
## 2 Tue    1       1     1   18
## 3 Wed    1       1     1    6
## 4 Thu    1       1     1    2
## 5 Fri    1       1     1   11</code></pre>
<p>불러온 데이터에 대하여 변수 이름을 지정해주고 각 변수가 가지고 있는
데이터들을 <code>as.factor</code>함수를 이용하여 범주형 변수로
바꿔주었다.</p>
<div class="sourceCode" id="cb285"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(V5 <span class="sc">~</span>., <span class="at">data =</span> tv_data)</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(TV) <span class="ot">&lt;-</span></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>),</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;8:00&quot;</span>, <span class="st">&quot;8:15&quot;</span>, <span class="st">&quot;8:30&quot;</span>, <span class="st">&quot;8:45&quot;</span>, <span class="st">&quot;9:00&quot;</span>, <span class="st">&quot;9:15&quot;</span>,</span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;9:30&quot;</span>, <span class="st">&quot;9:45&quot;</span>, <span class="st">&quot;10:00&quot;</span>, <span class="st">&quot;10:15&quot;</span>, <span class="st">&quot;10:30&quot;</span>),</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;ABC&quot;</span>, <span class="st">&quot;CBS&quot;</span>, <span class="st">&quot;NBC&quot;</span>, <span class="st">&quot;Fox&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Off&quot;</span>, <span class="st">&quot;Switch&quot;</span>, <span class="st">&quot;Persist&quot;</span>))</span></code></pre></div>
<p>일반적으로, <code>xtabs</code>함수를 이용하며, V5를 빈도 변수로
사용하여 교차 테이블을 쉽게 만들 수 있다.</p>
<div class="sourceCode" id="cb286"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> <span class="fu">array</span>(tv_data[,<span class="dv">5</span>], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(TV) <span class="ot">&lt;-</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>),</span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;8:00&quot;</span>, <span class="st">&quot;8:15&quot;</span>, <span class="st">&quot;8:30&quot;</span>, <span class="st">&quot;8:45&quot;</span>, <span class="st">&quot;9:00&quot;</span>, <span class="st">&quot;9:15&quot;</span>,</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;9:30&quot;</span>, <span class="st">&quot;9:45&quot;</span>, <span class="st">&quot;10:00&quot;</span>, <span class="st">&quot;10:15&quot;</span>, <span class="st">&quot;10:30&quot;</span>),</span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;ABC&quot;</span>, <span class="st">&quot;CBS&quot;</span>, <span class="st">&quot;NBC&quot;</span>, <span class="st">&quot;Fox&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Off&quot;</span>, <span class="st">&quot;Switch&quot;</span>, <span class="st">&quot;Persist&quot;</span>))</span>
<span id="cb286-8"><a href="#cb286-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(TV)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Day&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Network&quot;</span>, <span class="st">&quot;State&quot;</span>)</span></code></pre></div>
<p>인덱싱을 이용하여 V5(빈도 데이터)에 대한 4차원 배열로
변경하였다.<br />
<em>V1,V2(Time, Day)</em> 변수가 행과 열을 구성하며, <em>Network,
State</em>변수를 기준으로 차원을 나눠준다.</p>
</div>
<div id="subsetting-and-collapsing" class="section level3">
<h3>2.9.2 Subsetting and collapsing</h3>
<div class="sourceCode" id="cb287"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> TV[,,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,] <span class="co"># 네트워크 변수 중에서 ABC, CBS, NBC만을 사용한다.</span></span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> TV[,,,<span class="dv">3</span>] <span class="co"># state = Persist인 경우만 사용한다.  </span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(TV)</span></code></pre></div>
<pre><code>##             Time 8:00 8:15 8:30 8:45 9:00 9:15 9:30 9:45 10:00 10:15 10:30
## Day Network                                                               
## Mon ABC           146  151  156   83  325  350  386  340   352   280   278
##     CBS           337  293  304  233  311  251  241  164   252   265   272
##     NBC           263  219  236  140  226  235  239  246   279   263   283
## Tue ABC           244  181  231  205  385  283  345  192   329   351   364
##     CBS           173  180  184  109  218  235  256  250   274   263   261
##     NBC           315  254  280  241  370  214  195  111   188   190   210
## Wed ABC           233  161  194  156  339  264  279  140   237   228   203
##     CBS           158  126  207   59   98  103  122   86   109   105   110
##     NBC           134  146  166   66  194  230  264  143   274   289   306
## Thu ABC           174  183  197  181  187  198  211   86   110   122   117
##     CBS           196  185  195  104  106  116  116   47   102    84    84
##     NBC           515  463  472  477  590  473  446  349   649   705   747
## Fri ABC           294  281  305  239  278  246  245  138   246   232   233
##     CBS           130  144  154   81  129  153  136  126   138   136   152
##     NBC           195  220  248  160  172  164  169   85   183   198   204</code></pre>
<p>테이블을 구성하는 행과 열 (n-way)가 커질수록 데이터 탐색 및
분석하기가 상당히 불편하다.<br />
따라서, 가능하면 적절한 인덱싱을 통해 <strong>차원(n-way)</strong>를
줄이는 것이 좋다.</p>
<div class="sourceCode" id="cb289"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>TV2 <span class="ot">&lt;-</span> <span class="fu">collapse.table</span>(TV,</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;8:00-8:59&quot;</span>, <span class="dv">4</span>),</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">&quot;9:00-9:59&quot;</span>, <span class="dv">4</span>),</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">&quot;10:00-10:44&quot;</span>,<span class="dv">3</span>)))</span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(Day <span class="sc">~</span> Time <span class="sc">+</span> Network, TV2)</span></code></pre></div>
<pre><code>##                     Day  Mon  Tue  Wed  Thu  Fri
## Time        Network                             
## 8:00-8:59   ABC          536  861  744  735 1119
##             CBS         1167  646  550  680  509
##             NBC          858 1090  512 1927  823
## 9:00-9:59   ABC         1401 1205 1022  682  907
##             CBS          967  959  409  385  544
##             NBC          946  890  831 1858  590
## 10:00-10:44 ABC          910 1044  668  349  711
##             CBS          789  798  324  270  426
##             NBC          825  588  869 2101  585</code></pre>
<p>마지막으로, 우리는 특정 목적을 위해 많은 수준을 가지고 있는 요인
변수의 수준을 줄이고 싶을수도 있다.<br />
여기서는 <code>collapse.table</code>함수를 이용하여 time에 대한 수준을
줄임으로써 테이블을 축소시켰다.</p>
</div>
<div id="creating-dataframes-and-arrays-1" class="section level3">
<h3>2.9.1 Creating dataframes and arrays</h3>
<div class="sourceCode" id="cb291"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>tv_data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;C:/Program Files/R/R-4.2.1/library/vcdExtra/extdata/tv.dat&quot;</span>)</span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tv_data)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    825 obs. of  5 variables:
##  $ V1: int  1 2 3 4 5 1 2 3 4 5 ...
##  $ V2: int  1 1 1 1 1 2 2 2 2 2 ...
##  $ V3: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ V4: int  1 1 1 1 1 1 1 1 1 1 ...
##  $ V5: int  6 18 6 2 11 6 29 25 17 29 ...</code></pre>
<div class="sourceCode" id="cb293"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tv_data,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   V1 V2 V3 V4 V5
## 1  1  1  1  1  6
## 2  2  1  1  1 18
## 3  3  1  1  1  6
## 4  4  1  1  1  2
## 5  5  1  1  1 11</code></pre>
<p><code>read.table</code>함수를 이용하여 경로에 저장 돼있는
<strong>tv.dat</strong>함수를 불러온 후 <strong>tv_data</strong>에
저장한 후, 데이터를 탐색하였다.</p>
<div class="sourceCode" id="cb295"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>TV_df <span class="ot">&lt;-</span> tv_data</span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TV_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Day&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Network&quot;</span>, <span class="st">&quot;State&quot;</span>, <span class="st">&quot;Freq&quot;</span>)</span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>TV_df <span class="ot">&lt;-</span> <span class="fu">within</span> (TV_df, {</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>  Day <span class="ot">&lt;-</span> <span class="fu">factor</span>(Day, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>,<span class="st">&quot;Tue&quot;</span>,<span class="st">&quot;Wed&quot;</span>,<span class="st">&quot;Thu&quot;</span>,<span class="st">&quot;Fri&quot;</span>))</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>  Time <span class="ot">&lt;-</span> <span class="fu">factor</span>(Time)</span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>  Network <span class="ot">&lt;-</span> <span class="fu">factor</span>(Network)</span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>  State <span class="ot">&lt;-</span> <span class="fu">factor</span>(State)</span>
<span id="cb295-8"><a href="#cb295-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb295-9"><a href="#cb295-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TV_df,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   Day Time Network State Freq
## 1 Mon    1       1     1    6
## 2 Tue    1       1     1   18
## 3 Wed    1       1     1    6
## 4 Thu    1       1     1    2
## 5 Fri    1       1     1   11</code></pre>
<p>불러온 데이터에 대하여 변수 이름을 지정해주고 각 변수가 가지고 있는
데이터들을 <code>as.factor</code>함수를 이용하여 범주형 변수로
바꿔주었다.</p>
<div class="sourceCode" id="cb297"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(V5 <span class="sc">~</span>., <span class="at">data =</span> tv_data)</span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(TV) <span class="ot">&lt;-</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>),</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;8:00&quot;</span>, <span class="st">&quot;8:15&quot;</span>, <span class="st">&quot;8:30&quot;</span>, <span class="st">&quot;8:45&quot;</span>, <span class="st">&quot;9:00&quot;</span>, <span class="st">&quot;9:15&quot;</span>,</span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;9:30&quot;</span>, <span class="st">&quot;9:45&quot;</span>, <span class="st">&quot;10:00&quot;</span>, <span class="st">&quot;10:15&quot;</span>, <span class="st">&quot;10:30&quot;</span>),</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;ABC&quot;</span>, <span class="st">&quot;CBS&quot;</span>, <span class="st">&quot;NBC&quot;</span>, <span class="st">&quot;Fox&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Off&quot;</span>, <span class="st">&quot;Switch&quot;</span>, <span class="st">&quot;Persist&quot;</span>))</span></code></pre></div>
<p>일반적으로, <code>xtabs</code>함수를 이용하며, V5를 빈도 변수로
사용하여 교차 테이블을 쉽게 만들 수 있다.</p>
<div class="sourceCode" id="cb298"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> <span class="fu">array</span>(tv_data[,<span class="dv">5</span>], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(TV) <span class="ot">&lt;-</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;Mon&quot;</span>, <span class="st">&quot;Tue&quot;</span>, <span class="st">&quot;Wed&quot;</span>, <span class="st">&quot;Thu&quot;</span>, <span class="st">&quot;Fri&quot;</span>),</span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;8:00&quot;</span>, <span class="st">&quot;8:15&quot;</span>, <span class="st">&quot;8:30&quot;</span>, <span class="st">&quot;8:45&quot;</span>, <span class="st">&quot;9:00&quot;</span>, <span class="st">&quot;9:15&quot;</span>,</span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;9:30&quot;</span>, <span class="st">&quot;9:45&quot;</span>, <span class="st">&quot;10:00&quot;</span>, <span class="st">&quot;10:15&quot;</span>, <span class="st">&quot;10:30&quot;</span>),</span>
<span id="cb298-6"><a href="#cb298-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;ABC&quot;</span>, <span class="st">&quot;CBS&quot;</span>, <span class="st">&quot;NBC&quot;</span>, <span class="st">&quot;Fox&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb298-7"><a href="#cb298-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;Off&quot;</span>, <span class="st">&quot;Switch&quot;</span>, <span class="st">&quot;Persist&quot;</span>))</span>
<span id="cb298-8"><a href="#cb298-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(TV)) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Day&quot;</span>, <span class="st">&quot;Time&quot;</span>, <span class="st">&quot;Network&quot;</span>, <span class="st">&quot;State&quot;</span>)</span></code></pre></div>
<p>인덱싱을 이용하여 V5(빈도 데이터)에 대한 4차원 배열로
변경하였다.<br />
<strong>V1,V2(Time, Day)</strong>변수가 행과 열을 구성하며,
<strong>Network, State</strong>변수를 기준으로 차원을 나눠준다.</p>
</div>
<div id="subsetting-and-collapsing-1" class="section level3">
<h3>2.9.2 Subsetting and collapsing</h3>
<div class="sourceCode" id="cb299"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> TV[,,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,] <span class="co"># 네트워크 변수 중에서 ABC, CBS, NBC만을 사용한다.</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>TV <span class="ot">&lt;-</span> TV[,,,<span class="dv">3</span>] <span class="co"># state = Persist인 경우만 사용한다.  </span></span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(TV)</span></code></pre></div>
<pre><code>##             Time 8:00 8:15 8:30 8:45 9:00 9:15 9:30 9:45 10:00 10:15 10:30
## Day Network                                                               
## Mon ABC           146  151  156   83  325  350  386  340   352   280   278
##     CBS           337  293  304  233  311  251  241  164   252   265   272
##     NBC           263  219  236  140  226  235  239  246   279   263   283
## Tue ABC           244  181  231  205  385  283  345  192   329   351   364
##     CBS           173  180  184  109  218  235  256  250   274   263   261
##     NBC           315  254  280  241  370  214  195  111   188   190   210
## Wed ABC           233  161  194  156  339  264  279  140   237   228   203
##     CBS           158  126  207   59   98  103  122   86   109   105   110
##     NBC           134  146  166   66  194  230  264  143   274   289   306
## Thu ABC           174  183  197  181  187  198  211   86   110   122   117
##     CBS           196  185  195  104  106  116  116   47   102    84    84
##     NBC           515  463  472  477  590  473  446  349   649   705   747
## Fri ABC           294  281  305  239  278  246  245  138   246   232   233
##     CBS           130  144  154   81  129  153  136  126   138   136   152
##     NBC           195  220  248  160  172  164  169   85   183   198   204</code></pre>
<p>테이블을 구성하는 행과 열 (n-way)가 커질수록 데이터 탐색 및
분석하기가 상당히 불편하다.<br />
따라서, 가능하면 적절한 인덱싱을 통해 차원(n-way)를 줄이는 것이
좋다.</p>
<div class="sourceCode" id="cb301"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>TV2 <span class="ot">&lt;-</span> <span class="fu">collapse.table</span>(TV,</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;8:00-8:59&quot;</span>, <span class="dv">4</span>),</span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">&quot;9:00-9:59&quot;</span>, <span class="dv">4</span>),</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">rep</span>(<span class="st">&quot;10:00-10:44&quot;</span>,<span class="dv">3</span>)))</span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(Day <span class="sc">~</span> Time <span class="sc">+</span> Network, TV2)</span></code></pre></div>
<pre><code>##                     Day  Mon  Tue  Wed  Thu  Fri
## Time        Network                             
## 8:00-8:59   ABC          536  861  744  735 1119
##             CBS         1167  646  550  680  509
##             NBC          858 1090  512 1927  823
## 9:00-9:59   ABC         1401 1205 1022  682  907
##             CBS          967  959  409  385  544
##             NBC          946  890  831 1858  590
## 10:00-10:44 ABC          910 1044  668  349  711
##             CBS          789  798  324  270  426
##             NBC          825  588  869 2101  585</code></pre>
<p>마지막으로, 우리는 특정 목적을 위해 많은 수준을 가지고 있는 요인
변수의 수준을 줄이고 싶을수도 있다.<br />
여기서는 <code>collapse.table</code>함수를 이용하여 time에 대한 수준을
줄임으로써 테이블을 축소시켰다.</p>
</div>
</div>
<div id="summary-of-chapter2" class="section level2">
<h2>Summary of Chapter2</h2>
<ul>
<li>범주형 변수의 <strong>수준(levels)</strong>을 고려하는 경우,
분석가가 원하는 순서대로 수준의 순서가 이뤄졌는지 확인하는 것이
중요하며, 그렇지 않은 경우, 재코딩을 통해 순서를 재지정해야한다.<br />
</li>
<li>R에서는 <strong>벡터, 행렬, 데이터프레임, 테이블</strong>과 같이
분석하고자 하는 데이터들을 다양한 형태로 저장할 수 있다.</li>
<li>우리가 범주형 변수를 이용하여 데이터 분석을 진행할때,
<strong>테이블, 데이터프레임</strong>과 같은 형태를 가장 흔하게
사용한다.<br />
</li>
<li>범주형 변수의 경우에는 각 관측치의 고유 특성을 가지는 <strong>Case
form</strong>, 관측치의 특성을 범주형 변수를 통해 빈도료 표현하는
<strong>Frequency form</strong>, 테이블의 형태로 나타내는 <strong>table
form</strong>이 있다.<br />
</li>
<li>앞에서 살펴본 3개의 form, 테이블과 데이터프레임의 형태를 자유자재로
전환할 수 있는 능력을 키우는 것은 매우 중요하다.<br />
</li>
<li>다차원의 분할표를 한 눈에 살펴보고 싶다면,
<code>structable(), ftabe()</code>과 같은 함수를 이용할 수 있다.<br />
</li>
<li>갖고있는 데이터의 형태가 데이터프레임 일때,
<code>apply()</code>함수를 사용하면 적용하고자 하는 함수를 행이나
열에따라 편리하게 사용할 수 있다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap3-fitting-and-graphing-discrete-distributions"
class="section level1">
<h1>Chap3 Fitting and Graphing Discrete Distributions</h1>
<p>이산형 데이터는 종종 다양한 이론적인 포아송,음이항,기하 등의
<strong>확률분포</strong>를 따른다.<br />
우리가 데이터를 가지고 분석하는데에 있어 데이터가 어떠한 확률분포를
따르는지를 알아내고 가정하는 것은 매우 중요하다. 확률분포를 따르지
않으면 기본적인 통계가정을 만족하지 않으므로 분석을 진행함에 있어 상당한
어려움이 따를 수 있다. 따라서, 데이터에 대한 확률분포를 가정하고
이해하는 것 또한 분석에 있어 중요한 요소 중 하나라고 할 수 있다.</p>
<p><strong>시각화</strong>는 모델의 진단, 적합도 확인, 추정된 모수에
대한 관측치를 살펴보는데에 사용된다.</p>
<p><strong>이산형 빈도 분포</strong>는 사고 사망자, 어떤 특성을 가진
혈액 세포와 같은 사건의 발생 횟수를 포함한다.</p>
<p>Chapter3에서는 이항 분포, 포아송 분포, 음이항 분포, 기하분포 등 특정
확률 분포를 살펴보며, 주어진 분포의 데이터를 적합시키는 방법과 그에 대한
시각화, 모델 진단 같은 방법론에 대해서도 알아본다.</p>
<hr />
<div id="introduction-to-discrete-distributions" class="section level2">
<h2>3.1 Introduction to discrete distributions</h2>
<p>이산형 데이터 분석은 하나 이상의 사건 유형에 대한 표 작성 연구와
관련이 있으며, 동전 던지기, 성별, 수술 후 환자의 생존 등과 같은 결과
범주를 예시로 생각할 수 있다.</p>
<p>더 많은 사건에는 더 많은 범주가 나올 수 있으며, 순서를 지정할수도
있다.</p>
<p>Chapter3에서 우리는 숫자 변수로 이루어진 one-way 빈도표에
집중한다.</p>
<div id="binomial-data" class="section level3">
<h3>3.1.1 Binomial data</h3>
<p><strong>이항(Binomial)</strong> 데이터는 “성공” 사건의 수에 대한 이산
분포로 발생되며, 각각은 일정한 성공 확률 p로 구성된다.<br />
일반적으로 <strong>총 시행횟수 n, 성공 확률 p</strong>라는 2개의 모수를
가지고 있으며, 베르누이 분포의 일반화 분포로 이해할 수 있다.</p>
<p>EX)</p>
<ul>
<li>동전 던지기</li>
<li>불량품 선별</li>
</ul>
<p><em>Example 3.1: Arbuthnot data</em></p>
<div class="sourceCode" id="cb303"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arbuthnot&quot;</span>, <span class="at">package =</span> <span class="st">&quot;HistData&quot;</span>)</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Arbuthnot,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   Year Males Females Plague Mortality    Ratio Total
## 1 1629  5218    4683      0      8771 1.114243 9.901
## 2 1630  4858    4457   1317     10554 1.089971 9.315
## 3 1631  4422    4102    274      8562 1.078011 8.524
## 4 1632  4994    4590      8      9535 1.088017 9.584
## 5 1633  5158    4839      0      8393 1.065923 9.997</code></pre>
<p><code>Arbuthnot</code>데이터는 1629년부터 1710년까지 남성과 여성의
생존비율을 나타낸 데이터로, <code>HistData</code>패키지에 포함된
데이터이다.</p>
<ul>
<li>Year: 출생년도 (Discrete variable)</li>
<li>Males: 남성 수 (Discrete variable)</li>
<li>Females: 여성 수 (Discrete variable)</li>
<li>plague: 역병으로인한 사망자 수 (Discrete variable)</li>
<li>Morality: 총 사망자 수 (Discrete variable)</li>
<li>Ratio: 남성/여성의 비율 (Continuous variable)</li>
<li>Total: 런던에서의 총 세례식 횟수 (Continuous variable)</li>
</ul>
<div class="sourceCode" id="cb305"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Arbuthnot, {</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">=</span> Males <span class="sc">/</span> (Males <span class="sc">+</span> Females)</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">x =</span> Year, <span class="at">y =</span> prob, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.54</span>), <span class="at">ylab =</span> <span class="st">&quot;Pr (Male)&quot;</span>)</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(prob), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">loess.smooth</span>(Year, prob), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x =</span> <span class="dv">1640</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="fu">expression</span>(H[<span class="dv">0</span>]<span class="sc">:</span> <span class="st">&quot;Pr (Male) = 0.5&quot;</span>),</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">pos =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-107-1.png" width="960" /></p>
<p><code>Arbuthnot</code> 데이터를 이용하여 출생년도에 따른 남성의
출생비율을 시각화해보았다.</p>
<p><code>with</code>함수는 데이터에 대해서 여러가지의 작업들을 한 번의
코드 안에서 진행하고 깔끔한 코드 정리를 하고싶을 때 사용한다.<br />
- <code>with(data,task)</code></p>
<ul>
<li>data: 함수를 적용할 데이터</li>
<li>task: 데이터를 이용하여 진행할 작업들(여러 개의 작업을 진행할 수
있다.)</li>
</ul>
<p>H0: 남성의 출생 비율은 0.5이다. H1: 남성의 출생 비율은 0.5가
아니다.</p>
<p>위와같은 귀무가설과 대립가설을 이용하여 가설검정을 진행해 보았을 때,
실제 남성의 출생 비율은 0.517로 우리가 가정한 귀무가설과 큰 차이가 없는
것을 확인할 수 있다.</p>
<p><em>Example 3.2: Families in Saxony</em></p>
<div class="sourceCode" id="cb306"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Saxony&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>Saxony</code>데이터는 Saxony주의 남자 아이들의 숫자에 대한
데이터로 <code>vcd</code>패키지안에 포함되어 있다.</p>
<ul>
<li>nMales: 남성 아이들의 수 (Factor variable - 0 ~ 12)</li>
</ul>
<div class="sourceCode" id="cb307"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(Saxony, <span class="at">xlab =</span> <span class="st">&quot;Number of males&quot;</span>,</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Number of families&quot;</span>, <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-109-1.png" width="960" /></p>
<p>Saxony데이터의 one-way 빈도표를 한 눈에 살펴보기 위해
<strong>barplot</strong>으로 시각화를 진행해 보았다.<br />
남자 아이들의 숫자가 6명일 빈도가 가장 많고 그 다음으로는 5명,7명인 것을
확인할 수 있다.<br />
또한, 데이터의 분포 형태가 <strong>종모양(bell shape)</strong>을 가지는
것을 확인할 수 있다.</p>
<p><em>Example 3.3: Weldon’s dice</em></p>
<div class="sourceCode" id="cb308"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WeldonDice&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>weldonDice</code>데이터는 12개의 주사위를 던졌을 때, 5 또는 6이
나왔을 빈도에 대한 데이터로, <code>vcd</code>패키지안에 포함 돼
있다.</p>
<ul>
<li>n56: 주사위가 5 또는 6이 나온 수 (Factor variable - 0 ~ 10)</li>
</ul>
<div class="sourceCode" id="cb309"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(WeldonDice)<span class="sc">$</span>n56[<span class="dv">11</span>] <span class="ot">&lt;-</span> <span class="st">&quot;10+&quot;</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(WeldonDice, <span class="at">xlab =</span> <span class="st">&quot;Number of 5s and 6s&quot;</span>,</span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">col =</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-111-1.png" width="960" /></p>
<p><code>WeldonDice</code>데이터에서 11번,12번의 빈도가 0므로 10의
수준을 10+로 바꾸어 10,11,12의 경우가 포함되도록 한다.</p>
<p>WeldonDice 데이터의 one-way 빈도표를 <strong>barplot</strong>으로
나타낸 결과, 4번일 빈도가 가장 많고 그 다음으로 3번,5번인 것을 확인할 수
있다.<br />
WeldonDice 데이터 또한 어느 정도 <strong>종모양(bell shape)</strong>의
형태를 띄는 것을 확인할 수 있었다.</p>
</div>
<div id="poisson-data" class="section level3">
<h3>3.1.2 Poisson data</h3>
<p><strong>포아송 데이터(Poisson data)</strong>는 고정된 시간 또는 공간
사이에서 사건 k의 수를 관찰하고 이러한 빈도를 표현하는데 사용된다.<br />
특히, 포아송 분포는 평균과 분산이 같기 때문에
<strong>과대산포</strong>가 발생할 수 있으므로, 포아송 분포 사용시
과대산포를 반드시 유의해야 한다.</p>
<p>EX)</p>
<ul>
<li>k시간 동안 콜센터로 걸려오는 전화의 건수</li>
<li>책 1페이지당 오탈자가 발생하는 건수</li>
<li>k주 동안 고속도로에서 교통사고가 발생하는 건수</li>
</ul>
<p><em>Example 3.4: Death by horse kick</em></p>
<div class="sourceCode" id="cb310"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HorseKicks&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(HorseKicks, <span class="at">xlab =</span> <span class="st">&quot;Number of deaths&quot;</span>,</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">col =</span> <span class="st">&quot;lightblue&quot;</span>,</span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-112-1.png" width="960" /></p>
<p><strong>HorseKicks</strong>데이터를 <strong>barplot</strong>을 통해
시각화를 진행한 결과 분포는 위와 같다.<br />
말에게 1명도 사망하지 않는 경우의 빈도가 제일 많고 그 다음으로
1명,2명,3명,4명 순서대로 빈도가 작아지는 것을 확인할 수 있다.</p>
<p><em>Example3.5 : Federalist Papers</em></p>
<div class="sourceCode" id="cb311"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Federalist&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>Federalist</code>데이터는 ‘연방주의자 논문’의 저자를 식별하기
위해 특정 키워드(여기서는 ’may’)의 사용을 조사하기 위한 데이터로
<code>vcd</code>패키지 안에 포함돼 있다.</p>
<ul>
<li>nMay: <code>may</code>라는 키워드의 발생 횟수 (Factor variable - 0 ~
6)</li>
</ul>
<div class="sourceCode" id="cb312"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(Federalist,</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Occurrences of &#39;may&#39;&quot;</span>,</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Number of blocks of text&quot;</span>,</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-114-1.png" width="960" /></p>
<p><strong>Federalist</strong>데이터를 <strong>barplot</strong>을 통해
시각화를 진행한 결과 분포는 위와 같다.<br />
<code>may</code>라는 키워드를 한 번도 사용하지 않은 경우가 가장 많았고
그 다음으로 1번,2번,3번,4번의 순서대로 빈도가 작아지는 것을 확인할 수
있다.</p>
<p><em>Example 3.6: London cycling deaths</em></p>
<div class="sourceCode" id="cb313"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;CyclingDeaths&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span></code></pre></div>
<p><code>CyclingDeaths</code>은 2005년부터 2012년까지 런던 사이클링
선수들의 사망빈도를 나타낸 시계열 데이터로 <code>vcdExtra</code>패키지
안에 포함돼 있다.</p>
<ul>
<li>date: 연도 (time)</li>
<li>deaths: 사망자 수 (Discrete Variable)</li>
</ul>
<div class="sourceCode" id="cb314"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>CyclingDeaths.tab <span class="ot">&lt;-</span> <span class="fu">table</span>(CyclingDeaths<span class="sc">$</span>deaths)</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>CyclingDeaths.tab</span></code></pre></div>
<pre><code>## 
##   0   1   2   3 
## 114  75  14   5</code></pre>
<div class="sourceCode" id="cb316"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(CyclingDeaths.tab,</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of deaths&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Number of fortnighs&quot;</span>, <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-116-1.png" width="960" /></p>
<p><code>table</code>함수를 통해 one-way 표로 정리한 후,
<strong>barplot</strong>을 통해 사망자 수의 분포를 살펴보았다.<br />
앞선 <code>Horsekicks, Federalist</code>의 결과와 거의 유사한 형태이며,
사망자 수가 없을 빈도가 가장 많고 1명,2명,3명 순서대로 빈도가 작아지는
것을 확인할 수 있다.</p>
</div>
<div id="type-token-distributions" class="section level3">
<h3>3.1.3 Type-token distributions</h3>
<p><em>Example 3.7: Butterfly species in Malaya</em></p>
<div class="sourceCode" id="cb317"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Butterfly&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>Butterfly</code>는 501개의 나비 종에 대한 각각의 토큰을 나타낸
데이터로, <code>vcd</code>패키지 안에 포함돼 있다.</p>
<ul>
<li>nTokens: 나비종의 토큰 수 (Factor variable - 1 ~ 24)</li>
</ul>
<div class="sourceCode" id="cb318"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(Butterfly, <span class="at">xlab =</span> <span class="st">&quot;Number of individuals&quot;</span>,</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">&quot;Number of species&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-118-1.png" width="960" /></p>
<p><code>Butterfly</code>데이터의 분포를 살펴보기 위해
<strong>barplot</strong>을 활용하여 시각화를 진행한 결과, 토큰의 수가
커질수록 빈도가 점점 작아지는 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="characteristics-of-discrete-distributions"
class="section level2">
<h2>3.2 Characteristics of discrete distributions</h2>
<div id="the-binomial-distribution" class="section level3">
<h3>3.2.1 The binomial distribution</h3>
<div class="sourceCode" id="cb319"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a>pk <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(k, <span class="dv">12</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">barplot</span>(pk, <span class="at">names.arg =</span> k,</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">xlab =</span> <span class="st">&quot;Number of successes&quot;</span>,</span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">ylab =</span> <span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> b, <span class="at">y =</span> pk, <span class="at">col =</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-119-1.png" width="960" /></p>
<p>R에서 이항분포의 총 시행횟수, 성공확률을 알 때, 발생확률을 계산하고
싶다면 <code>dbinom</code>함수를 통해 간단하게 계산할 수 있다.<br />
- <code>dbinom(x,size,prob)</code></p>
<ul>
<li>x: 성공횟수</li>
<li>size: 시행횟수</li>
<li>prob: 성공확률</li>
</ul>
<div id="calculation-and-visualization" class="section level4">
<h4>3.2.1.1 calculation and visualization</h4>
<p><em>Example 3.8: Weldon’s dice</em></p>
<div class="sourceCode" id="cb320"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>Weldon_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(WeldonDice)</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>pk <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(k, <span class="dv">12</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>pk <span class="ot">&lt;-</span> <span class="fu">c</span>(pk[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="fu">sum</span>(pk[<span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>]))</span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>Exp <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">26306</span> <span class="sc">*</span> pk, <span class="dv">5</span>)</span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>Diff <span class="ot">&lt;-</span> Weldon_df<span class="sc">$</span>Freq <span class="sc">-</span> Exp</span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>Chisq <span class="ot">&lt;-</span> Diff<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> Exp</span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(Weldon_df, <span class="at">Prob =</span> <span class="fu">round</span>(pk,<span class="dv">5</span>),</span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a>           Exp, Diff, Chisq)</span></code></pre></div>
<pre><code>##    n56 Freq    Prob        Exp       Diff     Chisq
## 1    0  185 0.00771  202.74946  -17.74946 1.5538553
## 2    1 1149 0.04624 1216.49676  -67.49676 3.7450265
## 3    2 3265 0.12717 3345.36610  -80.36610 1.9306437
## 4    3 5475 0.21195 5575.61016 -100.61016 1.8154792
## 5    4 6114 0.23845 6272.56143 -158.56143 4.0082074
## 6    5 5194 0.19076 5018.04915  175.95085 6.1694696
## 7    6 3067 0.11127 2927.19533  139.80467 6.6771580
## 8    7 1331 0.04769 1254.51229   76.48771 4.6634615
## 9    8  403 0.01490  392.03509   10.96491 0.3066798
## 10   9  105 0.00331   87.11891   17.88109 3.6700801
## 11 10+   18 0.00054   14.30532    3.69468 0.9542366</code></pre>
<p><code>WeldonDice</code>의 데이터에 대해서 이항분포를 가정하고 기댓값,
실제값과 기댓값의 차이, chisq값을 계산하였다.<br />
기댓값의 경우 0~4까지 음수의 값을 가지지만 5이상부터는 양수의 값을
가지는 것을 확인할 수 있다. 즉, 관측빈도가 기대빈도보다 높게 나온 것을
알 수 있다.</p>
<div class="sourceCode" id="cb322"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>(Prob <span class="ot">&lt;-</span> <span class="fu">outer</span>(k, p, <span class="cf">function</span>(k,p) <span class="fu">dbinom</span>(k,<span class="dv">12</span>,p)))</span></code></pre></div>
<pre><code>##               [,1]         [,2]         [,3]         [,4]
##  [1,] 1.121567e-01 7.707347e-03 0.0002441406 1.881676e-06
##  [2,] 2.691760e-01 4.624408e-02 0.0029296875 4.516023e-05
##  [3,] 2.960936e-01 1.271712e-01 0.0161132813 4.967626e-04
##  [4,] 1.973957e-01 2.119520e-01 0.0537109375 3.311751e-03
##  [5,] 8.882807e-02 2.384460e-01 0.1208496094 1.490288e-02
##  [6,] 2.842498e-02 1.907568e-01 0.1933593750 4.768921e-02
##  [7,] 6.632496e-03 1.112748e-01 0.2255859375 1.112748e-01
##  [8,] 1.136999e-03 4.768921e-02 0.1933593750 1.907568e-01
##  [9,] 1.421249e-04 1.490288e-02 0.1208496094 2.384460e-01
## [10,] 1.263333e-05 3.311751e-03 0.0537109375 2.119520e-01
## [11,] 7.579995e-07 4.967626e-04 0.0161132813 1.271712e-01
## [12,] 2.756362e-08 4.516023e-05 0.0029296875 4.624408e-02
## [13,] 4.593937e-10 1.881676e-06 0.0002441406 7.707347e-03</code></pre>
<div class="sourceCode" id="cb324"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Prob)</span></code></pre></div>
<pre><code>##  num [1:13, 1:4] 0.1122 0.2692 0.2961 0.1974 0.0888 ...</code></pre>
<p><code>outer</code>함수는 계산할 함수와 데이터가 여러개 있을 때, 조금
더 편리하게 계산할 수 있도록 돕는 함수이다.<br />
- <code>outer(x,y,fun)</code></p>
<ul>
<li>x: 계산할 벡터 또는 행렬</li>
<li>y: 계산할 벡터 또는 행렬</li>
<li>fun: 계산에 사용할 함수</li>
</ul>
<p>성공확률 변화에 따른 이항분포의 확률계산 값을 Prob변수에
저장하였다.<br />
성공확률(p)의 값을 4개로 넣어줬기 때문에 <code>str</code>함수를 사용했을
때 13x4형태로 값이 구성되있는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb326"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(k, Prob)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-122-1.png" width="960" /></p>
<p>성공확률의 변화에 따른 이항분포의 변화를 <code>matplot</code>을 통해
시각화를 하였다.</p>
<p><code>matplot</code>은 matrix의 열을 그래프 위에 표시하도록 도와주는
함수이다.<br />
- <code>matplot(x,y)</code></p>
<ul>
<li>x: 그래프의 x축에 표시할 데이터</li>
<li>y: 그래프의 y축에 표시할 데이터</li>
</ul>
<p><code>matplot</code>에 추가적인 옵션을 지정하지 않으면 위와 같이 해당
값의 열 번호가 출력된다.</p>
<div class="sourceCode" id="cb327"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">palette</span>()[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(k, Prob,</span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span><span class="sc">:</span> <span class="dv">17</span>, <span class="at">col =</span> col, <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of Successes&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;1/6&quot;</span>,<span class="st">&quot;1/3&quot;</span>,<span class="st">&quot;1/2&quot;</span>,<span class="st">&quot;2/3&quot;</span>),</span>
<span id="cb327-6"><a href="#cb327-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> col,</span>
<span id="cb327-7"><a href="#cb327-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Pr(Success&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-123-1.png" width="960" /></p>
<p>여러가지 옵션을 추가하여 변화의 추이를 조금 더 쉽게 살펴볼 수 있도록
하였다.</p>
<p>성공확률이 커짐에 따라, 가장 큰 확률값을 가지는 성공횟수가 점차
큰쪽으로 변하는 것을 확인할 수 있다.</p>
</div>
</div>
<div id="the-poisson-distribution" class="section level3">
<h3>3.2.2 The Poisson distribution</h3>
<p><em>Example 3.9: UK soccer scores</em></p>
<div class="sourceCode" id="cb328"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;UKSoccer&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>UKSoccer</code>데이터는 1995/1996 영국 프로축구 리그의 스코어를
홈과 어웨이에 따라서 구분한 데이터로, <code>vcd</code>패키지 안에 포함돼
있다.</p>
<ul>
<li>Home: 홈에서의 득점 (Factor variable - 0,1,2,3,4)</li>
<li>Away: 원정에서의 득점 (Factor variable - 0,1,2,3,4)</li>
</ul>
<div class="sourceCode" id="cb329"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>soccer.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(UKSoccer, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a>soccer.df <span class="ot">&lt;-</span> <span class="fu">within</span>(soccer.df, {</span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>  Home <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Home)</span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a>  Away <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Away)</span>
<span id="cb329-5"><a href="#cb329-5" aria-hidden="true" tabindex="-1"></a>  Total <span class="ot">&lt;-</span> Home <span class="sc">+</span> Away</span>
<span id="cb329-6"><a href="#cb329-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb329-7"><a href="#cb329-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(soccer.df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    25 obs. of  4 variables:
##  $ Home : num  0 1 2 3 4 0 1 2 3 4 ...
##  $ Away : num  0 0 0 0 0 1 1 1 1 1 ...
##  $ Freq : num  27 59 28 19 7 29 53 32 14 8 ...
##  $ Total: num  0 1 2 3 4 1 2 3 4 5 ...</code></pre>
<p>테이블로 구성된 데이터를 데이터 프레임의 형태로 바꾸고 홈득점과
원정득점을 합친 <code>Total</code>변수를 추가해 주었다.</p>
<div class="sourceCode" id="cb331"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a>soccer.df <span class="ot">&lt;-</span> <span class="fu">expand.dft</span>(soccer.df)</span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(soccer.df)</span></code></pre></div>
<pre><code>##   Home Away Total
## 1    0    0     0
## 2    0    0     0
## 3    0    0     0
## 4    0    0     0
## 5    0    0     0
## 6    0    0     0</code></pre>
<p><code>expand.dft</code>함수를 이용하여 빈도변수를 제외하고 빈도의 수
만큼 변수들의 관측값이 만들어지도록 하였다.</p>
<p>즉, <strong>Home = 2, Away = 0, Total = 2, Freq = 28</strong> 이라면
Freq 변수는 제외하고 데이터의 행에 <strong>Home = 2, Away = 0, Total =
2</strong>라는 관측값이 28개 만들어지도록 하는 것이다.</p>
<div class="sourceCode" id="cb333"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(soccer.df,<span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">c</span>(<span class="at">mean =</span><span class="fu">mean</span>(x), <span class="at">var =</span> <span class="fu">var</span>(x)))</span></code></pre></div>
<pre><code>##          Home     Away    Total
## mean 1.486842 1.063158 2.550000
## var  1.316449 1.172782 2.617546</code></pre>
<p><code>apply</code>함수를 통해 Home, Away에 따른 스코어의 평균,
분산값을 쉽게 구하는것을 확인할 수 있다.</p>
<p>홈의 경우 평균 1.48득점, 원정의 경우 평균 1.06득점이 발생하는 것을
확인할 수 있다.</p>
<p><em>Example 3.10: London cycling deaths</em></p>
<div class="sourceCode" id="cb335"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(CyclingDeaths, <span class="fu">c</span>(<span class="at">mean =</span> <span class="fu">mean</span>(deaths),</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">var =</span> <span class="fu">var</span>(deaths),</span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ratio =</span> <span class="fu">mean</span>(deaths) <span class="sc">/</span> <span class="fu">var</span>(deaths)))</span></code></pre></div>
<pre><code>##      mean       var     ratio 
## 0.5673077 0.5268488 1.0767942</code></pre>
<p>런던 사이클리스트의 사망자 수가 포아송분포를 따르는지
확인해본다.<br />
평균 값으로 보아 경주당 평균 0.57명 또는 한 달에 1명 이상 사망한 것을 알
수 있다.</p>
<div class="sourceCode" id="cb337"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>mean.deaths <span class="ot">&lt;-</span> <span class="fu">mean</span>(CyclingDeaths<span class="sc">$</span>deaths)</span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ppois</span>(<span class="dv">5</span>, mean.deaths, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 2.854305e-05</code></pre>
<p><code>ppois</code>함수는 포아송분포의 범위확률을 계산할 수 있도록
도와주는 함수 중 하나이다.<br />
- <code>ppois(q,lambda,lower.tail)</code></p>
<ul>
<li>q: 분석가가 계산하고자 하는 발생횟수 범위의 기준</li>
<li>labmda: 포아송 분포의 단위시간당 평균 발생 횟수</li>
<li>lower.tail: 확률 계산 방법 (TRUE = P(X&lt;x), FALSE =
P(X&gt;x))</li>
</ul>
<p><code>ppois</code>를 통해 5명 이상의 사망한 확률을 계산하였다.
계산결과, 확률이 매우 작은 것으로 보아 5명 이상의 사망발생 확률은 매우
작다는 것을 확인할 수 있다.</p>
<div id="calculation-and-visualization-1" class="section level4">
<h4>3.2.2.1 Calculation and visualization</h4>
<p><em>Example 3.11: Plotting styles for discrete distributions</em></p>
<div class="sourceCode" id="cb339"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>KL <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">lambda =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">10</span>))</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a>pois_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(KL, <span class="at">prob =</span> <span class="fu">dpois</span>(KL<span class="sc">$</span>k, KL<span class="sc">$</span>lambda))</span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>pois_df<span class="sc">$</span>lambda <span class="ot">&lt;-</span> <span class="fu">factor</span>(pois_df<span class="sc">$</span>lambda)</span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pois_df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    63 obs. of  3 variables:
##  $ k     : int  0 1 2 3 4 5 6 7 8 9 ...
##  $ lambda: Factor w/ 3 levels &quot;1&quot;,&quot;4&quot;,&quot;10&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ prob  : num  0.3679 0.3679 0.1839 0.0613 0.0153 ...</code></pre>
<div class="sourceCode" id="cb341"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pois_df)</span></code></pre></div>
<pre><code>##   k lambda        prob
## 1 0      1 0.367879441
## 2 1      1 0.367879441
## 3 2      1 0.183939721
## 4 3      1 0.061313240
## 5 4      1 0.015328310
## 6 5      1 0.003065662</code></pre>
<p><code>exapnd.grid</code>함수를 통해 주어진
<strong>k,lambda</strong>에 대한 모든 가능한 조합을 구성하고 그에대한
포아송 확률을 갖고있는 <strong>pois_df</strong>데이터를 생성하였다.</p>
<p><code>dpois</code>는 포아송분포의 특정 발생횟수에 대한 확률을
계산하고자 할때 사용하는 함수이다.<br />
- <code>dpois(x,lambda)</code></p>
<ul>
<li>x: 분석가가 계산하고자하는 발생횟수</li>
<li>lambda: 포아송 분포의 단위시간당 평균 발생 횟수</li>
</ul>
<div class="sourceCode" id="cb343"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span></code></pre></div>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;lattice&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:gnm&#39;:
## 
##     barley</code></pre>
<div class="sourceCode" id="cb346"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(prob <span class="sc">~</span> k <span class="sc">|</span> lambda, <span class="at">data =</span> pois_df,</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;h&quot;</span>,<span class="st">&quot;p&quot;</span>), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">1.25</span>, <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>),</span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="fu">list</span>(<span class="st">&quot;Number of events (k)&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">list</span>(<span class="st">&quot;Probability&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-131-1.png" width="960" /></p>
<p><code>lattice</code>패키지는 다변량 데이터의 시각화를 돕기위해
설계되었으며, 특정 데이터에 대해서 그룹을 나눠 시각화를 진행하고자 할때
유용하게 사용할 수 있는 패키지이다.</p>
<p>생성된 데이터 pois_df를 <code>xyplot</code>을 이용하여 시각화를
하였다.<br />
<code>xyplot</code>은 plot을 그림에 있어 특정 그룹을 통해 layout을 나눌
수 있게 도와주는 시각화 함수이며, 이를 통해 lambda에 따른 포아송 분포를
더 쉽게 비교 할 수 있다. - <code>xyplot(formula,data)</code></p>
<ul>
<li>formula: 그래프에 변수를 표현하는 방법 (y ~ x | group)은 y변수를
y축, x변수를 x축으로하고 group에 따라 layout을 나눠달라는
의미이다.<br />
</li>
<li>data: 시각화에 사용할 데이터</li>
</ul>
<p>lambda가 커짐에 따라 포아송 분포의 형태가 정규분포와 같은
<strong>종모양(bell-shape)</strong>의 형태를 가지는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb347"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>mycol <span class="ot">&lt;-</span> <span class="fu">palette</span>() [<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb347-2"><a href="#cb347-2" aria-hidden="true" tabindex="-1"></a>plt <span class="ot">&lt;-</span> <span class="fu">xyplot</span>(prob <span class="sc">~</span> k, <span class="at">data =</span> pois_df, <span class="at">groups =</span> lambda,</span>
<span id="cb347-3"><a href="#cb347-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">type =</span> <span class="st">&quot;b&quot;</span>, <span class="at">pch =</span> <span class="dv">15</span> <span class="sc">:</span> <span class="dv">17</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">1.25</span>, <span class="at">col =</span> mycol,</span>
<span id="cb347-4"><a href="#cb347-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlab =</span> <span class="fu">list</span>(<span class="st">&quot;Number of events (k)&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb347-5"><a href="#cb347-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylab =</span> <span class="fu">list</span>(<span class="st">&quot;Probability&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb347-6"><a href="#cb347-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.4</span>))</span>
<span id="cb347-7"><a href="#cb347-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb347-8"><a href="#cb347-8" aria-hidden="true" tabindex="-1"></a><span class="fu">direct.label</span>(plt,<span class="fu">list</span>(<span class="st">&quot;top.points&quot;</span>, <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="fu">dl.trans</span>(<span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.1</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-132-1.png" width="960" /></p>
<p><code>directlabels</code>패키지는 <code>lattice, ggplot2</code>를
활용하여 시각화를 진행하였을 때, 레이블을 직접 그림에 자동적으로 배치할
수 있도록 도와주는 함수들이 구성돼있는 패키지이다.</p>
<p><code>direct.label</code>함수를 이용하여 패널을 나누지 않고 하나의
grid안에 모든 포아송 분포를 겹쳐서 나타낼수도 있다.<br />
- <code>direct.label(graph, option)</code></p>
<ul>
<li>graph: plot이 저장돼있는 객체</li>
<li>option: 추가적으로 지정할 옵션 (위의 코드의경우, 레이블의 위치,
포인터 크기, 축의 범위를 조정하였다.)</li>
</ul>
<div class="sourceCode" id="cb348"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>gplt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pois_df,</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> prob, <span class="at">colour =</span> lambda, <span class="at">shape =</span> lambda)) <span class="sc">+</span></span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of events (k)&quot;</span>)<span class="sc">+</span></span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a>gplt <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb348-9"><a href="#cb348-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-133-1.png" width="960" /></p>
<p><code>ggplot2</code>패키지의 <code>ggplot</code>을 이용하여 그리는
방법도 고려해볼 수 있다.</p>
<p><code>ggplot2 | ggplot</code>은 R의 가장 강력한 그래픽 기는 중
하나로, 현대 R을 사용하는 대부분의 데이터 사이언티스트들이 시각화를 위해
사용하는 패키지이다. 시각화를 위한 다양한 함수 및 세부적인 조정을 위한
다양한 옵션을 제공한다.<br />
- <code>ggplot(data, aes(x,y,colour)) + option</code></p>
<ul>
<li>data: 시각화에 쓰일 데이터</li>
<li>aes: 축 설정</li>
<li>x: x축에 쓰일 데이터</li>
<li>y: y축에 쓰일 데이터</li>
<li>colour: 그래프에서의 그룹지정</li>
<li>option: 추가적인 옵션(+를 이용하여 세부적인 옵션을 여러개 추가
가능)</li>
</ul>
</div>
</div>
<div id="the-negative-binomial-distribution" class="section level3">
<h3>3.2.3 The negative binomial distribution</h3>
<p><strong>음이항 분포(Negative binomial distribution)</strong>은 대기
시간 분포의 한 유형이지만 포아송 분포의 일반화로서 과대산포(분산 &gt;
평균)가 가능하다.<br />
<strong>음이항 분포</strong>는 어떤 사건의 일정한 확률 p로 관찰되며,
성공적인 사건을 관찰하는데 얼마나 많은 실패가 필요한지 궁금할 때
사용된다.</p>
<p>EX)</p>
<ul>
<li>동전을 10번 던질 때, 5번째 시행에서 3번째 앞면이 나올 확률 (성공확률
= p)</li>
<li>100개의 불량품 검사를 할 때, 50번째 시행에서 5번째 불량품이 나올
확률 (불량품이 나올 확률 = p)</li>
</ul>
<div id="calculation-and-visualization-2" class="section level4">
<h4>3.2.3.1 Calculation and visualization</h4>
<div class="sourceCode" id="cb349"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span></span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dbinom</span>(k,n,p)</span></code></pre></div>
<pre><code>## [1] 0.0400 0.0960 0.1536</code></pre>
<div class="sourceCode" id="cb351"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>(mu <span class="ot">&lt;-</span> n <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p) <span class="sc">/</span> p)</span></code></pre></div>
<pre><code>## [1]  8 12 16</code></pre>
<div class="sourceCode" id="cb353"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnbinom</span>(k,n,<span class="at">mu =</span> mu)</span></code></pre></div>
<pre><code>## [1] 0.07680 0.03072 0.01024</code></pre>
<div class="sourceCode" id="cb355"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnbinom</span>(k,n,p)</span></code></pre></div>
<pre><code>## [1] 0.07680 0.03072 0.01024</code></pre>
<p><code>dnbinom</code>함수는 음이항분포의 확률값을 계산하는데
사용된다.<br />
- <code>dnbinom(k,n,p,mu)</code></p>
<ul>
<li>k: 실패횟수</li>
<li>n: 성공횟수</li>
<li>p: 성공확률</li>
<li>mu: 음이항분포의 평균</li>
</ul>
<p><code>dnbinom</code>을 사용할때, 음이항분포의 평균을 사용해서
계산하거나 성공확률을 사용해서 계산하거나 같은 확률값이 출력되는 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb357"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>XN <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>), <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>))</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>nbin_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(XN, <span class="at">prob =</span> <span class="fu">dnbinom</span>(XN<span class="sc">$</span>k, XN<span class="sc">$</span>n, XN<span class="sc">$</span>p))</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>nbin_df<span class="sc">$</span>n <span class="ot">&lt;-</span> <span class="fu">factor</span>(nbin_df<span class="sc">$</span>n)</span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a>nbin_df<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="fu">factor</span>(nbin_df<span class="sc">$</span>p)</span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(nbin_df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    189 obs. of  4 variables:
##  $ k   : int  0 1 2 3 4 5 6 7 8 9 ...
##  $ n   : Factor w/ 3 levels &quot;2&quot;,&quot;4&quot;,&quot;6&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ p   : Factor w/ 3 levels &quot;0.2&quot;,&quot;0.3&quot;,&quot;0.4&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ prob: num  0.04 0.064 0.0768 0.0819 0.0819 ...</code></pre>
<div class="sourceCode" id="cb359"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(nbin_df,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   k n   p    prob
## 1 0 2 0.2 0.04000
## 2 1 2 0.2 0.06400
## 3 2 2 0.2 0.07680
## 4 3 2 0.2 0.08192
## 5 4 2 0.2 0.08192</code></pre>
<p>만들어진 k,n,p에 대하여 <code>expand.grid</code>를 통해 모든 가능한
조합을 생성하고 각각의 확률값을 구한 후, 데이터 프레임 형태로
<strong>nbin_df</strong>객체에 저장하였다.</p>
<div class="sourceCode" id="cb361"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(prob <span class="sc">~</span> k <span class="sc">|</span> n <span class="sc">+</span> p, <span class="at">data =</span> nbin_df,</span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="fu">list</span>(<span class="st">&quot;Number of failures (k)&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylab =</span> <span class="fu">list</span>(<span class="st">&quot;Probability&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;h&quot;</span>, <span class="st">&quot;p&quot;</span>), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">strip =</span> <span class="fu">strip.custom</span>(<span class="at">strip.names =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-136-1.png" width="960" /></p>
<p>k,n,p 변화에 따른 음이항 분포의 변화를 <code>xyplot</code>을 통해
시각화 하였다.<br />
n과 p가 작은경우, 확률값의 분포는 크게 차이가 없어보이고 n과 p가
커질수록 음이항분포의 분포가 정규분포의
<strong>종모양(bell-shape)</strong>와 비슷해지는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb362"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)</span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>)</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>NP <span class="ot">&lt;-</span> <span class="fu">outer</span>(n,p, <span class="cf">function</span>(n, p) n <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>p) <span class="sc">/</span> p)</span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(NP) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n =</span> n, <span class="at">p =</span> p)</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>NP</span></code></pre></div>
<pre><code>##    p
## n   0.2       0.3 0.4
##   2   8  4.666667   3
##   4  16  9.333333   6
##   6  24 14.000000   9</code></pre>
<p>각각의 조합에 대한 음이항 분포의 평균을 table로 나타내었다.</p>
</div>
</div>
<div id="the-geometric-distribution" class="section level3">
<h3>3.2.4 The geometric distribution</h3>
<p><strong>기하분포(geometric distribution)</strong>의 경우, 음이항
분포의 특수한 형태로, 첫번째로 성공할 사건 이전까지의 실패의 사건을
살펴본다.</p>
<p>EX)</p>
<ul>
<li>동전을 던질때, 3번째 시행에서 앞면이 나올 확률</li>
<li>주사위를 던질때, 6번째 시행에서 5가 나올 확률</li>
</ul>
<hr />
</div>
</div>
<div id="fitting-discrete-distributions" class="section level2">
<h2>3.3 Fitting discrete distributions</h2>
<p><em>Example 3.12: Death by horsekick</em></p>
<div class="sourceCode" id="cb364"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(HorseKicks, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;nDeaths&quot;</span>, <span class="st">&quot;Freq&quot;</span>)</span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(tab)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5 obs. of  2 variables:
##  $ nDeaths: chr  &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; ...
##  $ Freq   : int  109 65 22 3 1</code></pre>
<div class="sourceCode" id="cb366"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>(lambda <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(<span class="fu">as.numeric</span>(tab<span class="sc">$</span>nDeaths), <span class="at">w =</span> tab<span class="sc">$</span>Freq))</span></code></pre></div>
<pre><code>## [1] 0.61</code></pre>
<p><code>HorseKicks</code>데이터를 통해 모수가 <span
class="math inline">\(\lambda\)</span> = 평균 사망자 수를 갖는 포아송
분포를 예상한다.</p>
<p><code>weighted.mean</code>은 빈도를 가중치로 하는 가중평균을 계산할
수 있게 도와주는 함수이다.<br />
- <code>weihted.mean(data,w)</code></p>
<ul>
<li>data: 가중평균을 계산할 데이터</li>
<li>w: 가중평균을 계산할 때 사용할 가중치</li>
</ul>
<p>빈도를 가중치로 하여, 가중평균을 계산한 결과, (예상한) 평균 사망자 수
<span class="math inline">\(\lambda\)</span> = 0.61이 계산된다.</p>
<div class="sourceCode" id="cb368"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>phat <span class="ot">&lt;-</span> <span class="fu">dpois</span>(<span class="dv">0</span> <span class="sc">:</span> <span class="dv">4</span>, <span class="at">lambda =</span> lambda)</span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a>exp <span class="ot">&lt;-</span> <span class="fu">sum</span>(tab<span class="sc">$</span>Freq) <span class="sc">*</span> phat</span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>chisq <span class="ot">&lt;-</span> (tab<span class="sc">$</span>Freq <span class="sc">-</span> exp)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> exp</span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>GOF <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(tab, phat, exp, chisq)</span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a>GOF</span></code></pre></div>
<pre><code>##   nDeaths Freq        phat         exp      chisq
## 1       0  109 0.543350869 108.6701738 0.00100106
## 2       1   65 0.331444030  66.2888060 0.02505734
## 3       2   22 0.101090429  20.2180858 0.15704840
## 4       3    3 0.020555054   4.1110108 0.30025340
## 5       4    1 0.003134646   0.6269291 0.22200573</code></pre>
<p>계산된 <span class="math inline">\(\lambda\)</span>를 통해 우리는
데이터의 예상 사망자 수를 계산할수 있다.<br />
실제 관측된 사망자수와 예측된 사망자 수는 큰 차이가 없는 것처럼
보인다.</p>
<div class="sourceCode" id="cb370"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(chisq))</span></code></pre></div>
<pre><code>## [1] 0.7053659</code></pre>
<div class="sourceCode" id="cb372"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">pchisq</span>(<span class="fu">sum</span>(chisq), <span class="at">df =</span> <span class="fu">nrow</span>(tab) <span class="sc">-</span> <span class="dv">2</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>## [1] 0.8719411</code></pre>
<p>적합도 검정의 귀무가설과 대립가설은 다음과 같다.</p>
<ul>
<li>H0: 주어진 데이터가 (우리가 가정한)분포를 따른다.<br />
</li>
<li>H1: 주어진 데이터가 (우리가 가정한)분포를 따르지 않는다.</li>
</ul>
<p>적합도 검정을 진행한 결과, 유의확률이 0.8719411로 유의수준 0.05보다
큰 것을 확인할 수 있다. 따라서, 귀무가설을 기각하므로 주어진 데이터는
<strong>포아송 분포를 따르는 데이터</strong>라고 할 수 있다.</p>
<div id="r-tools-for-discrete-distributions" class="section level3">
<h3>3.3.1 R tools for discrete distributions</h3>
<p><em>Example 3.13: Families in Saxony</em></p>
<div class="sourceCode" id="cb374"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Saxony&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>Sax_fit <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(Saxony, <span class="at">type =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in goodfit(Saxony, type = &quot;binomial&quot;): size was not given, taken as
## maximum count</code></pre>
<div class="sourceCode" id="cb376"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(Sax_fit<span class="sc">$</span>par)</span></code></pre></div>
<pre><code>##      prob      size 
##  0.519215 12.000000</code></pre>
<p>R에서는 <code>goodfit</code>함수를 통해 분포에 대한 적합도 검정을
간단하게 진행할 수 있다.<br />
- <code>goodfit(data, type )</code></p>
<ul>
<li>data: 적합도 검정을 진행할 데이터</li>
<li>type: 가정하는 분포(“binomial”, “poisson” 등)</li>
</ul>
<p><code>unlist</code>는 list로 구성된 데이터에 대해서 list의 형태를
지우고 싶을때 사용하는 함수이다.<br />
- <code>unlist(data)</code></p>
<ul>
<li>data: list의 형태를 지우고 싶은 데이터</li>
</ul>
<p><code>Saxony</code>데이터를 이항분포로 가정했을 때, 주어진 데이터의
성공확률 (가족들 중 남성이 있을 확률)은 0.519로 추정된다.</p>
<div class="sourceCode" id="cb378"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(Sax_fit)</span></code></pre></div>
<pre><code>## [1] &quot;observed&quot; &quot;count&quot;    &quot;fitted&quot;   &quot;type&quot;     &quot;method&quot;   &quot;df&quot;       &quot;par&quot;</code></pre>
<div class="sourceCode" id="cb380"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>Sax_fit</span></code></pre></div>
<pre><code>## 
## Observed and fitted values for binomial distribution
## with parameters estimated by `ML&#39; 
## 
##  count observed       fitted pearson residual
##      0        3    0.9328394        2.1402809
##      1       24   12.0888374        3.4257991
##      2      104   71.8031709        3.7996298
##      3      286  258.4751335        1.7120476
##      4      670  628.0550119        1.6737139
##      5     1033 1085.2107008       -1.5849023
##      6     1343 1367.2793552       -0.6566116
##      7     1112 1265.6303069       -4.3184059
##      8      829  854.2466464       -0.8637977
##      9      478  410.0125627        3.3576088
##     10      181  132.8357027        4.1789562
##     11       45   26.0824586        3.7041659
##     12        7    2.3472734        3.0368664</code></pre>
<p><code>goodfit</code>결과를 저장한 객체는 관측빈도의 수준(level),
관측값, 가정분포로 계산했을 때의 관측값, 관측값과 가정분포를 통해 계산한
관측값의 피어슨 잔차 등의 속성을 포함하고 있는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb382"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Sax_fit)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for binomial distribution
## 
##                      X^2 df     P(&gt; X^2)
## Likelihood Ratio 97.0065 11 6.978187e-16</code></pre>
<p>summary를 통해 지정한 분포에 대한 적합도 결과를 쉽게 살펴볼 수 있다.
적합도 검정은 ML방법에 의해 계산된 것을 확인할 수 있다.<br />
유의확률 p는 유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, 주어진 데이터는 <strong>이항분포를 따르지 않는
데이터</strong>라고 할 수 있다.</p>
<p><em>Example 3.14: Weldon’s dice</em></p>
<div class="sourceCode" id="cb384"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WeldonDice&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>dice_fit <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(WeldonDice, <span class="at">type =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">par =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb384-4"><a href="#cb384-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(dice_fit<span class="sc">$</span>par)</span></code></pre></div>
<pre><code>##      prob      size 
##  0.337686 12.000000</code></pre>
<p><code>WeldonDice</code>데이터를 이항분포로 가정했을 때, 추정된 phat(5
또는 6이 나올 확률) = 0.3377임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb386"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dice_fit)</span></code></pre></div>
<pre><code>## 
## Observed and fitted values for binomial distribution
## with parameters estimated by `ML&#39; 
## 
##  count observed       fitted pearson residual
##      0      185 1.874228e+02      -0.17697245
##      1     1149 1.146708e+03       0.06769647
##      2     3265 3.215618e+03       0.87084224
##      3     5475 5.465025e+03       0.13492827
##      4     6114 6.269367e+03      -1.96222214
##      5     5194 5.114377e+03       1.11337726
##      6     3067 3.042206e+03       0.44953168
##      7     1331 1.329508e+03       0.04093252
##      8      403 4.236623e+02      -1.00385068
##      9      105 9.600334e+01       0.91820167
##     10       18 1.468441e+01       0.86523073
##     11        0 1.361266e+00      -1.16673301
##     12        0 5.783767e-02      -0.24049463</code></pre>
<div class="sourceCode" id="cb388"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dice_fit)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for binomial distribution
## 
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 11.50623  9 0.2425973</code></pre>
<p>적합도 검정 결과, 유의확률 p는 유의수준 0.05보다 크므로 귀무가설을
기각할 수 없다.<br />
따라서, 주어진 데이터에 대해서 <strong>이항분포를 따른다고 가정하는 것은
적합함</strong>을 알 수 있다.</p>
<p><em>Example 3.15: Death by horsekick</em></p>
<div class="sourceCode" id="cb390"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HorseKicks&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a>HK_fit <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(HorseKicks, <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a>HK_fit<span class="sc">$</span>par</span></code></pre></div>
<pre><code>## $lambda
## [1] 0.61</code></pre>
<p><code>HorseKicks</code>데이터를 포아송 분포로 가정했을 때, 추정된
<span class="math inline">\(\lambda\)</span>값(평균 사망 횟수)은
0.61임을 알 수 있다.</p>
<div class="sourceCode" id="cb392"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>HK_fit</span></code></pre></div>
<pre><code>## 
## Observed and fitted values for poisson distribution
## with parameters estimated by `ML&#39; 
## 
##  count observed      fitted pearson residual
##      0      109 108.6701738       0.03163952
##      1       65  66.2888060      -0.15829510
##      2       22  20.2180858       0.39629333
##      3        3   4.1110108      -0.54795383
##      4        1   0.6269291       0.34142169</code></pre>
<div class="sourceCode" id="cb394"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(HK_fit)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for poisson distribution
## 
##                        X^2 df  P(&gt; X^2)
## Likelihood Ratio 0.8682214  3 0.8330891</code></pre>
<p>적합도 검정 결과, 유의확률 p는 유의수준 0.05보다 크므로 귀무가설을
기각할 수 없다.<br />
따라서, 주어진 데이터에 대해서 <strong>포아송 분포를 따른다고 가정하는
것은 적합함</strong>을 알 수 있다.</p>
<p><em>Example 3.16: Federalist Papers</em></p>
<div class="sourceCode" id="cb396"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Federalist&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a>Fed_fit0 <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(Federalist, <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(Fed_fit0<span class="sc">$</span>par)</span></code></pre></div>
<pre><code>##    lambda 
## 0.6564885</code></pre>
<p><code>Federalist</code>데이터를 포아송 분포로 가정했을 때, 추정된
<span class="math inline">\(\lambda\)</span>값(may의 평균 발생 횟수)은
0.6564885이다.</p>
<div class="sourceCode" id="cb398"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>Fed_fit0</span></code></pre></div>
<pre><code>## 
## Observed and fitted values for poisson distribution
## with parameters estimated by `ML&#39; 
## 
##  count observed       fitted pearson residual
##      0      156 135.89138870       1.72498813
##      1       63  89.21114067      -2.77508554
##      2       29  29.28304617      -0.05230572
##      3        8   6.40799484       0.62890261
##      4        4   1.05169381       2.87493431
##      5        1   0.13808499       2.31948309
##      6        1   0.01510854       7.62061255</code></pre>
<div class="sourceCode" id="cb400"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Fed_fit0)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for poisson distribution
## 
##                       X^2 df     P(&gt; X^2)
## Likelihood Ratio 25.24312  5 0.0001250511</code></pre>
<p>적합도 검정 결과, 유의확률 p는 유의수준 0.05보다 작으므로 귀무가설을
기각한다.<br />
따라서, 주어진 데이터에 대해서 <strong>포아송 분포를 따른다고 가정하는
것은 적합하지 않음</strong>을 알 수 있다.</p>
<div class="sourceCode" id="cb402"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>Fed_fit1 <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(Federalist, <span class="at">type =</span> <span class="st">&quot;nbinomial&quot;</span>)</span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(Fed_fit1<span class="sc">$</span>par)</span></code></pre></div>
<pre><code>##      size      prob 
## 1.1863297 0.6437582</code></pre>
<div class="sourceCode" id="cb404"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Fed_fit1)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for nbinomial distribution
## 
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 1.964028  4 0.7423751</code></pre>
<p><code>Federalist</code>데이터를 음이항 분포로 가정한 후, 적합도
검정을 다시 진행해 보았다.</p>
<p>유의확률 p는 유의수준 0.05보다 크므로 귀무가설을 기각하지
못한다.<br />
따라서, 주어진 데이터에 대해서 <strong>음이항 분포를 따른다고 가정하는
것은 적합함</strong>을 알 수 있다.</p>
</div>
<div id="plots-of-observed-and-fitted-frequencies"
class="section level3">
<h3>3.3.2 Plots of observed and fitted frequencies</h3>
<p>관측빈도와 적합빈도의 그림은 적합된 이론적 분포의 형태와 데이터와
이론 사이의 편차의 패턴을 모두 보여주는데 도움이 된다.</p>
<div class="sourceCode" id="cb406"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fed_fit0, <span class="at">scale =</span> <span class="st">&quot;raw&quot;</span>, <span class="at">type =</span> <span class="st">&quot;standing&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-151-1.png" width="960" /></p>
<div class="sourceCode" id="cb407"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fed_fit0, <span class="at">type =</span> <span class="st">&quot;standing&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-151-2.png" width="960" /></p>
<p>첫번째 그래프의 경우, 실제 데이터에 대한 분포이며, 두번쨰 그래프의
경우 더 작은 빈도를 더 잘보이게 하기위해 Tukey가 제안한
<strong>rootogram</strong> 그래프이다.<br />
두번째 그래프의 경우, y축은 기존 빈도에 <strong>root</strong>를 씌운
값임을 확인할 수 있다.</p>
<p>회색으로 그려진 막대는 실제 데이터의 관측값, 빨간색으로 표시된 점은
특정 분포를 가정했을 때의 관측값(기대값)임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb408"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fed_fit0, <span class="at">type =</span> <span class="st">&quot;hanging&quot;</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-152-1.png" width="960" /></p>
<div class="sourceCode" id="cb409"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fed_fit0, <span class="at">type =</span> <span class="st">&quot;deviation&quot;</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-152-2.png" width="960" /></p>
<p>두 그래프 모두 루토그램을 사용한 그래프이다.<br />
첫번째 그래프의 경우, 막대를 이동하여 위쪽이 예상 빈도에 맞도록 한다.
두번째 그래프의 경우, 관측 빈도와 적합 빈도간의 차이를 강조한다.<br />
또한, 두 그래프 모두 <code>shade = TRUE</code>옵션을 추가하여 피어슨
잔차에 대한 정보 및 적합도 검정같은 추가적인 정보를 얻을 수 있게
하였다.</p>
<div class="sourceCode" id="cb410"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fed_fit0, <span class="at">main =</span> <span class="st">&quot;Poisson&quot;</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-153-1.png" width="960" /></p>
<div class="sourceCode" id="cb411"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fed_fit1, <span class="at">main =</span> <span class="st">&quot;Negative binomial&quot;</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-153-2.png" width="960" /></p>
<p>첫번째 그래프의 경우, 데이터에 적합하지 않은
<code>포아송분포</code>를 가정하여 사용했으므로, 관측 빈도와 적합 빈도
사이의 이탈이 많다.<br />
이에 반해, <code>음이항분포</code>를 가정한 두번쨰 그래프는 이탈된
부분이 없는것을 볼 수 있다. 따라서, 주어진
<code>Federalist</code>데이터는 <strong>음이항분포로 가정하는 것이
적합함</strong>을 그래프를 통해서도 쉽게 살펴볼 수 있다.</p>
<div class="sourceCode" id="cb412"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Butterfly&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a>But_fit1 <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(Butterfly, <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>But_fit2 <span class="ot">&lt;-</span> <span class="fu">goodfit</span>(Butterfly, <span class="at">type =</span> <span class="st">&quot;nbinomial&quot;</span>)</span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(But_fit1, <span class="at">main =</span> <span class="st">&quot;Poisson&quot;</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-154-1.png" width="960" /></p>
<div class="sourceCode" id="cb413"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(But_fit2, <span class="at">main =</span> <span class="st">&quot;Negative binomial&quot;</span>, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-154-2.png" width="960" /></p>
<p>첫번째 포아송 가정의 그래프의 경우, 과대, 과소 평가하는 부분이
대부분인 것을 볼 수 있고 두번째 그래프 또한 어느정도 존재하는 것을 알 수
있다.</p>
<div class="sourceCode" id="cb414"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(But_fit1)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for poisson distribution
## 
##                       X^2 df P(&gt; X^2)
## Likelihood Ratio 1656.023 22        0</code></pre>
<div class="sourceCode" id="cb416"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(But_fit2)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for nbinomial distribution
## 
##                       X^2 df     P(&gt; X^2)
## Likelihood Ratio 239.4982 21 5.229179e-39</code></pre>
<p>또한, 적합도 검정의 유의확률 모두 유의수준 0.05보다 작은 것을 확인할
수 있다.<br />
이를통해, <code>Butterfly</code> 데이터는 <strong>포아송, 음이항 모두
적절한 분포 가정이 아닌것</strong>을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="diagnosing-discrete-distributions-ord-plots"
class="section level2">
<h2>3.4 Diagnosing discrete distributions: Ord plots</h2>
<p>이상적으로 이산 분포를 위해 선택된 일반적인 형식은 데이터 생성을 위한
그럴듯한 메커니즘의 실직적인 지식에 의해 지시되어야 한다.<br />
그러나 이러한 지식이 부족한 경우, 특정 데이터셋의 적합한 분포를 알기
쉽지 않다.</p>
<p>이러한 경우, 한 가지 간단한 대안으로 <strong>Ord</strong>를 고려해볼
수 있다.</p>
<p><code>Ord plot</code>은 <code>vcd</code>패키지에 포함된 함수로,
데이터가 이산형 분포 중 어떠한 분포를 따르는지에 대한 진단을 해주고
분포를 가정한 뒤, 가정한 분포를 통해 얻어진 추정직선을 제시한다.<br />
- <code>Ord_plot(data)</code></p>
<ul>
<li>data: Ord를 통해 분포를 진단할 데이터</li>
</ul>
<div class="sourceCode" id="cb418"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a>(ord <span class="ot">&lt;-</span> <span class="fu">Ord_plot</span>(Butterfly,</span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Butterfly species collected in Malaya&quot;</span>,</span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">cex =</span> <span class="dv">1</span>), <span class="at">pch =</span> <span class="dv">16</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-156-1.png" width="960" /></p>
<pre><code>##  Intercept      Slope 
## -0.7089609  1.0608209</code></pre>
<div class="sourceCode" id="cb420"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a>ord</span></code></pre></div>
<pre><code>##  Intercept      Slope 
## -0.7089609  1.0608209</code></pre>
<p>검은색 석은 발생횟수 빈도에 대한 일반적인 최소 제곱 회귀적합을
나타내며, 빨간색 선은 가중치를 적용한 최소 제곱 적합을 나타낸다.</p>
<p>위의 그래프의 경우, 두 선의 절편과 기울기는 상당히 가까운 것처럼
보인다.<br />
<code>Ord_plot</code>을 통해 <code>Butterfly</code>데이터에 대한 이산
분포 진단 결과, <span class="math inline">\(\theta\)</span> = 1.061의
값을 가지는 로그 시리즈 분포로 진단한 것을 알 수 있다.</p>
<div id="ord-plot-examples" class="section level4">
<h4>3.4.0.1 Ord plot examples</h4>
<p><em>Example 3.17: Death by horse kick</em></p>
<div class="sourceCode" id="cb422"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HorseKicks&quot;</span>, <span class="at">pacakge =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in data(&quot;HorseKicks&quot;, pacakge = &quot;vcd&quot;): 데이터셋 &#39;vcd&#39;을 찾을 수 없습니
## 다</code></pre>
<div class="sourceCode" id="cb424"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>nk <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(HorseKicks)</span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(HorseKicks))</span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a>nk1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, nk[<span class="sc">-</span><span class="fu">length</span>(nk)])</span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> k <span class="sc">*</span> nk <span class="sc">/</span> nk1</span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">pmax</span>(nk, <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a>(ord_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(k, nk, nk1, y, weight))</span></code></pre></div>
<pre><code>##   k  nk nk1         y    weight
## 1 0 109  NA        NA 10.392305
## 2 1  65 109 0.5963303  8.000000
## 3 2  22  65 0.6769231  4.582576
## 4 3   3  22 0.4090909  1.414214
## 5 4   1   3 1.3333333  0.000000</code></pre>
<p><code>Ord_plot</code>진단을 위한 필요한 값들을 생성하고 객체 Ord_df에
넣어준다.</p>
<div class="sourceCode" id="cb426"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> k, <span class="at">weights =</span> weight, <span class="at">data =</span> ord_df))</span></code></pre></div>
<pre><code>## (Intercept)           k 
##  0.65601572 -0.03414076</code></pre>
<p>가중치를 적용한 최소 제곱 회귀선의 결과를 통한 회귀 계수는 위와
같으며, 이 경우 식은 <strong>y = -0.034k + 0.656</strong> 이다.</p>
<div class="sourceCode" id="cb428"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Ord_plot</span>(HorseKicks,</span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Death by horse kicks&quot;</span>,</span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">cex =</span> <span class="dv">1</span>),</span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-159-1.png" width="960" /></p>
<p><code>HorseKicks</code>데이터의 <code>Ord_plot</code>을 통한 이산
분포 진단결과, <span class="math inline">\(\lambda\)</span> = 0.656을
가지는 포아송 분포로 진단한 것을 확인할 수 있다.</p>
<p><em>Example 3.18: Federalist Papers</em></p>
<div class="sourceCode" id="cb429"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Ord_plot</span>(Federalist, <span class="at">main =</span> <span class="st">&quot;Instances of &#39;may&#39; in Federalist Papers&quot;</span>,</span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">cex =</span> <span class="dv">1</span>),</span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-160-1.png" width="960" /></p>
<p><code>Federalist</code>데이터의 <code>Ord_plot</code>을 통한 이산
분포 진단결과, <span class="math inline">\(p\)</span> = 0.576을 가지는
음이항 분포로 진단한 것을 확인할 수 있다.</p>
<p><em>Example 3.19: Women in queues</em></p>
<div class="sourceCode" id="cb430"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;WomenQueue&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a>WomenQueue</span></code></pre></div>
<pre><code>## nWomen
##  0  1  2  3  4  5  6  7  8  9 10 
##  1  3  4 23 25 19 18  5  1  1  0</code></pre>
<p><code>WomenQueue</code>데이터는 <code>vcd</code>패키지에 포함된
데이터로, 런던 지하철역의 100개의 대기열 중, 길이가 10인 대기열에서의
여성의 대기 숫자를 나타낸다.</p>
<ul>
<li>nWomen: 여성의 수(Factor Variable - 1 ~ 10)</li>
</ul>
<div class="sourceCode" id="cb432"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Ord_plot</span>(WomenQueue, <span class="at">main =</span> <span class="st">&quot;Women in queues of length 10&quot;</span>,</span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">cex =</span> <span class="dv">1</span>), <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-162-1.png" width="960" /></p>
<p><code>WomenQueue</code>데이터의 <code>Ord_plot</code>을 통한 이산
분포 진단결과, <span class="math inline">\(p\)</span> = 0.529을 가지는
이항 분포로 진단한 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="poissonness-plots-and-generalized-distribution-plots"
class="section level2">
<h2>3.5 Poissonness plots and generalized distribution plots</h2>
<p>포아송 분포는 one-way표가 포아송 분포를 얼마나 잘따르는지 볼 수 있는
<strong>robust plot</strong>이다.<br />
데이터가 포아송에서 벗어날 때, 점들은 곡선이 된다.</p>
<div id="the-distplot-function" class="section level3">
<h3>3.5.1 The distplot() function</h3>
<p>포아송 그림은 <code>vcd</code>패키지의 <code>distplot</code>을 통해
그릴 수 있다(<code>type = poisson</code>적용).<br />
<code>distplot</code>은 포아송 그림 뿐만 아니라 다른 분포에 대해서도
<code>Ord_plot</code>과 비슷하게 이산분포에 대한 진단을 해주고 적합된
점에 대한 신뢰구간을 제공한다.<br />
- <code>distplot(data,type)</code></p>
<ul>
<li>data: distplot 함수를 적용할 데이터</li>
<li>type: 분석가가 진단하고자 하는 이산 분포(“poisson”, “binomial”,
“nbinomial”등)</li>
</ul>
<p><em>Example 3.20: Death by horse kick</em></p>
<div class="sourceCode" id="cb433"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HorseKicks&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>dp <span class="ot">&lt;-</span> <span class="fu">distplot</span>(HorseKicks, <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>,</span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">xlab =</span> <span class="st">&quot;Number of deaths&quot;</span>,</span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">main =</span> <span class="st">&quot;Poissonness plot: HorseKicks data&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-163-1.png" width="960" /></p>
<p>그래프에서 <strong>열린 원</strong>은 계산된 관측값을 보여준다.<br />
검은색으로 채워져있는 <strong>작은 점</strong>은 신뢰구간의 중심을
나타내며, <strong>점선</strong>은 신뢰구간의 범위를 나타낸다.<br />
<strong>포아송 분포를</strong> 가정할 때, 추정되는 모수 <span
class="math inline">\(\lambda\)</span> = 0.61인 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb434"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dp, <span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##   Counts Freq Metameter CI.center CI.width CI.lower CI.upper
## 1      0  109    -0.607   -0.6131   0.1305  -0.7436  -0.4827
## 2      1   65    -1.124   -1.1343   0.2069  -1.3412  -0.9274
## 3      2   22    -1.514   -1.5451   0.4169  -1.9620  -1.1281
## 4      3    3    -2.408   -2.6607   1.3176  -3.9783  -1.3431
## 5      4    1    -2.120   -3.1203   2.6887  -5.8089  -0.4316</code></pre>
<p><code>displot</code>을 저장한 객체의 정보를 살펴보면, 추정값,
신뢰구간의 중심 값, 신뢰밴드의 너비, 신뢰구간의 하한과 신뢰구간의 상한
값을 알 수 있다.</p>
<div class="sourceCode" id="cb436"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distplot</span>(HorseKicks, <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">lambda =</span> <span class="fl">0.61</span>,</span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;Number of deaths&quot;</span>,</span>
<span id="cb436-3"><a href="#cb436-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">&quot;Leveled Poissonness plot&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-165-1.png" width="960" /></p>
<p>앞서 <code>distplot</code>을 통해 추정된 <span
class="math inline">\(\lambda\)</span> = 0.61을 적용하고 다시 한 번
포아송 그림을 그린 결과는 위와 같다.<br />
첫 번째 그림과 달리, 기울기가 양수로 바뀌고 추정선이 약간 완만해진 것을
확인할 수 있다.</p>
<p>두 그림 모두 적합된 선이 신뢰구간 내에 있는 것으로 보아,
<strong>포아송 분포로 가정한 후 데이터를 적합하는 것은 올바른 분포
가정</strong>임을 알 수 있다.</p>
</div>
<div id="plots-for-other-distributions" class="section level3">
<h3>3.5.2 Plots for other distributions</h3>
<p><em>Example 3.21: Families in Saxony</em></p>
<div class="sourceCode" id="cb437"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">goodfit</span>(Saxony, <span class="at">type =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">par =</span> <span class="fu">list</span> (<span class="at">size =</span> <span class="dv">12</span>)),</span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Number of males&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-166-1.png" width="960" /></p>
<p><code>Saxony</code>데이터에 <strong>이항분포</strong>를 가정한 후,
<strong>goodfit plot</strong>을 그린 결과, 과대,과소 추정된 부분이
보이는 것을 확인할 수 있으며, 이를 통해 <code>Saxony</code>데이터는
<strong>이항분포로 가정하는 것이 적합하지 않은 것</strong>임을 알 수
있다.</p>
<div class="sourceCode" id="cb438"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distplot</span>(Saxony, <span class="at">type =</span> <span class="st">&quot;binomial&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Number of males&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-167-1.png" width="960" /></p>
<p><code>displot</code>을 사용하여 <strong>이항분포</strong>를 가정한
후, 이산분포를 진단해 보았다.<br />
추정된 <span class="math inline">\(p\)</span> = 0.519이지만, 적합된 선이
대부분의 점에서 신뢰구간을 벗어나는 것을 확인할 수 있다.<br />
따라서, <code>Saxony</code>데이터가 <strong>이항분포로 가정하기에
적절하지 않음</strong>을 다시 한 번 살펴볼 수 있다.</p>
<p><em>Example 3.22: Federalist Papers</em></p>
<div class="sourceCode" id="cb439"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distplot</span>(Federalist, <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Occurrences of &#39;may&#39;&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-168-1.png" width="960" /></p>
<p><code>Federalist</code>데이터를 <strong>포아송 분포</strong>로
가정하고, <code>displot</code>을 통해 이산분포 진단을 해본 결과, 추정된
모수 값 <span class="math inline">\(\lambda\)</span> = 0.656이다.<br />
하지만, 적합된 선이 몇몇의 점에서 신뢰구간을 벗어나는 것을 확인할 수
있다.<br />
따라서, <code>Federalist</code>데이터를 <strong>포아송 분포로 가정하는
것은 적절하지 않은 것</strong>을 알 수 있다.</p>
<div class="sourceCode" id="cb440"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distplot</span>(Federalist, <span class="at">type =</span> <span class="st">&quot;nbinomial&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Occurrences of &#39;may&#39;&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-169-1.png" width="960" /></p>
<p><code>Federalist</code>데이터를 <strong>음이항 분포</strong>로
가정하고, <code>distplot</code>을 통해 이산분포 진단을 해본 결과, 추정된
모수 <span class="math inline">\(p\)</span> = 0.644이며, 적합된 선이
하나의 점에서 약간의 신뢰구간을 벗어나지만 나머지 점들은 모두 신뢰구간
안에 속하는 것을 살펴볼 수 있다.<br />
따라서, <code>Federalist</code>데이터는 포아송 분포가 아닌
<strong>음이항 분포로 가정하는 것이 적합한 것</strong>임을 알 수
있다.</p>
<hr />
</div>
</div>
<div id="fitting-discrete-distributions-as-generalized-linear-models"
class="section level2">
<h2>3.6 Fitting discrete distributions as generalized linear models</h2>
<p><em>Example 3.23: Families in Saxony</em></p>
<div class="sourceCode" id="cb441"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Saxony&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a>Males <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(Saxony))</span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a>Families <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(Saxony)</span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a>Sax.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Males, Families)</span></code></pre></div>
<p><code>Saxony</code>데이터를 <code>glm</code>함수에 적합시키기 위해
데이터 프레임의 형태로 전환하였다.<br />
<code>glm</code>함수는 일반화된 선형 모델을 적합하기 위해 사용되는
함수이며, 여러가지 옵션을 활용하여 다양한 일반화된 선형 모델을 적합시킬
수 있다.<br />
- <code>glm(formula, family(link),data)</code></p>
<ul>
<li>formula: 적합시키고자 하는 변수들의 형태</li>
<li>family: 적합시키고자 하는 분포</li>
<li>link: 분포에 적용할 link function</li>
<li>data: glm 함수를 적용할 데이터</li>
</ul>
<div class="sourceCode" id="cb442"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a>Sax.bin <span class="ot">&lt;-</span> <span class="fu">glm</span>(Families <span class="sc">~</span> Males, <span class="at">offset =</span> <span class="fu">lchoose</span>(<span class="dv">12</span>,<span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>, <span class="at">data =</span>Sax.df)</span>
<span id="cb442-3"><a href="#cb442-3" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(Sax.bin)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##            AIC    BIC LR Chisq Df Pr(&gt;Chisq)    
## Sax.bin 191.07 192.21   97.007 11  6.978e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>offset</code>옵션을 활용하여 <code>Sax.df</code>데이터가 갖고
있는 빈도의 사전 정보를 모델이 활용할 수 있게 만들어 주었다.</p>
<p><code>LRstats</code>는 <code>vcdExtra</code>패키지에 포함된 함수로,
<code>glm</code>또는 <code>loglm</code>모델의 적합도에 대한 간략한
정보만을 활용하고자 할 때 사용하거나 두 모델간의 적합도 비교를 할 때
사용되기도 한다.<br />
- <code>LRstats(object)</code></p>
<ul>
<li>object: 적합도를 살펴볼 모델 (2개 이상이 들어가는 경우, 모델 간
비교를 진행한다.)</li>
</ul>
<p><code>LRstats</code>를 통해 모델의 적합도 검정을 진행한 결과,
유의확률이 유의수준 0.05보다 매우 작다.<br />
모델의 적합도 검정을 진행하는 경우, 귀무가설과 대립가설은 아래와
같다.</p>
<p>H0: 주어진 모델은 적합하다. H1: 주어진 모델은 적합하지 않다.</p>
<p>따라서, 귀무가설을 기각하게 되므로, <code>Saxony</code>데이터를
포아송 분포로 가정한 후 <code>glm</code>을 통해 모델에 적합하는 것은
적절하지 않은 것임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb444"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(Sax.bin)</span></code></pre></div>
<pre><code>## (Intercept)       Males 
## -0.06952221  0.07689805</code></pre>
<p>추정된 선은 <code>y = -0.0695 + 0.076 Males</code>이다.</p>
<div class="sourceCode" id="cb446"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a>Sax.df<span class="sc">$</span>YlogitY <span class="ot">&lt;-</span></span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a>  Males <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">ifelse</span>(Males <span class="sc">==</span><span class="dv">0</span>,<span class="dv">1</span>,Males)) <span class="sc">+</span></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">12</span> <span class="sc">-</span> Males) <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">ifelse</span>(<span class="dv">12</span><span class="sc">-</span>Males <span class="sc">==</span> <span class="dv">0</span>,  <span class="dv">1</span>, <span class="dv">12</span><span class="sc">-</span>Males))</span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a>Sax.dbin <span class="ot">&lt;-</span> <span class="fu">glm</span>(Families <span class="sc">~</span> Males <span class="sc">+</span> YlogitY, <span class="at">offset =</span> <span class="fu">lchoose</span>(<span class="dv">12</span>,<span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>),</span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> poisson, <span class="at">data =</span> Sax.df)</span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(Sax.dbin)</span></code></pre></div>
<pre><code>## (Intercept)       Males     YlogitY 
## -3.09691848  0.06597732  0.14020530</code></pre>
<p>기존에 있던 데이터에 로그를 사용하여 하나의 모수를 더 추가한 후, 이중
이항분포의 형태로 만들어 준 후, <code>glm</code>에 다시 한 번 적합시켜
보았다.<br />
추정된 선은
<code>y = -3.096 + 0.066 Males + 0.140 YlogitY</code>이다.</p>
<div class="sourceCode" id="cb448"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(Sax.bin, Sax.dbin)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##             AIC    BIC LR Chisq Df Pr(&gt;Chisq)    
## Sax.bin  191.07 192.21   97.007 11  6.978e-16 ***
## Sax.dbin 109.13 110.83   13.061 10     0.2203    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>LRstats</code>를 사용하여 포아송 분포를 가정하고 적합시킨
모델과 이중 이항분포 모델을 비교한 결과이다.<br />
이중 이항 분포 모델을 적합시킨 모델의 유의확률은 유의수준 0.05보다 큰
값을 가지는 것을 확인할 수 있다.<br />
따라서, 귀무가설을 기각하지 못하므로 <strong>주어진 모델(이중
이항분포)은 적합한 모델</strong>임을 알 수 있다.</p>
<div class="sourceCode" id="cb450"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Sax.df,</span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fit.bin =</span> <span class="fu">fitted</span>(Sax.bin),</span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">res.bin =</span> <span class="fu">rstandard</span>(Sax.bin),</span>
<span id="cb450-4"><a href="#cb450-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fit.dbin =</span> <span class="fu">fitted</span>(Sax.dbin),</span>
<span id="cb450-5"><a href="#cb450-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">res.dbin =</span> <span class="fu">rstandard</span>(Sax.dbin))</span>
<span id="cb450-6"><a href="#cb450-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##    Males Families YlogitY fit.bin res.bin fit.dbin res.dbin
## 1      0        3      30    0.93    1.70      3.0    0.026
## 2      1       24      26   12.09    3.05     23.4    0.136
## 3      2      104      24   71.80    3.71    104.3   -0.036
## 4      3      286      23  258.48    1.87    307.8   -1.492
## 5      4      670      22  628.06    1.94    652.9    0.778
## 6      5     1033      22 1085.21   -1.87   1038.5   -0.202
## 7      6     1343      22 1367.28   -0.75   1264.2    2.635
## 8      7     1112      22 1265.63   -5.09   1185.0   -2.550
## 9      8      829      22  854.25   -1.03    850.1   -0.846
## 10     9      478      23  410.01    3.75    457.2    1.144
## 11    10      181      24  132.84    4.23    176.8    0.371
## 12    11       45      26   26.08    3.42     45.2   -0.039
## 13    12        7      30    2.35    2.45      6.5    0.192</code></pre>
<p>포아송 분포로 적합시킨 모델과 이중 이항분포를 적합시킨 모델의 잔차와
추정값을 확인해 보았다.<br />
위에 결과에서 볼 수 있듯이, 이중 이항분포를 적합시킨 모델의 추정값이
실제 관찰값과 가깝고 이를 통해 잔차가 더 작은 것을 알 수 있다.</p>
<div class="sourceCode" id="cb452"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(results, vcd<span class="sc">::</span><span class="fu">rootogram</span>(Families, fit.dbin, Males,</span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">xlab =</span> <span class="st">&quot;Number of males&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-176-1.png" width="960" /></p>
<p><code>rootogram</code>을 통해서도 이중 이항분포를 가정했을 때,
과대,과소 추정된 부분이 보이지 않으므로 <strong>이중 이항분포를 가정하는
것은 적절한 이산 분포 가정</strong>임을 확인할 수 있다.</p>
<div id="covariates-overdispersion-and-excess-zeros"
class="section level3">
<h3>3.6.1 covariates, overdispersion, and excess zeros</h3>
<div class="sourceCode" id="cb453"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;PhdPubs&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PhdPubs)</span></code></pre></div>
<pre><code>##   articles female married kid5 phdprestige mentor
## 1        0      0       1    0           3      7
## 2        0      1       0    0           2      6
## 3        0      1       0    0           4      6
## 4        0      0       1    1           1      3
## 5        0      1       0    0           4     26
## 6        0      1       1    2           4      2</code></pre>
<p><code>PhdPubs</code>는 <code>vcd</code>패키지에 포함된 데이터로,
박사학위 연구의 마지막 3년 동안 915명의 박사 후보자들의 출판물 수에 대한
데이터를 제공한다.</p>
<ul>
<li>articles: 출판물 수 (Discrete variable)</li>
<li>female: 성별 (Factor variable - 0 = Male, 1 = Female)</li>
<li>married: 결혼여부 (Factor variable - = 0 married, 1 =
unmarried)</li>
<li>Kid5: 5살 이하의 어린 자녀의 수 (Discrete variable)</li>
<li>phdprestige: 박사학위의 명성 수치 (Discrete variable)</li>
<li>mentor: 3년간 멘토에 의한 출판물 수 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb455"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(PhdPubs<span class="sc">$</span>articles)</span></code></pre></div>
<pre><code>## 
##   0   1   2   3   4   5   6   7   8   9  10  11  12  16  19 
## 275 246 178  84  67  27  17  12   1   2   1   1   2   1   1</code></pre>
<p>출판물 수는 0개부터 19개까지 있으며, 출판물을 하나도 내지 못한
박사들이 275명으로 가장 많다.</p>
<div class="sourceCode" id="cb457"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">goodfit</span>(PhdPubs<span class="sc">$</span>articles), <span class="at">xlab =</span> <span class="st">&quot;Number of Articles&quot;</span>,</span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Poisson&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-179-1.png" width="960" /></p>
<div class="sourceCode" id="cb458"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">goodfit</span>(PhdPubs<span class="sc">$</span>articles, <span class="at">type =</span> <span class="st">&quot;nbinomial&quot;</span>),</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Number of Articles&quot;</span>,</span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Negative binomial&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-180-1.png" width="960" /></p>
<div class="sourceCode" id="cb459"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">goodfit</span>(PhdPubs<span class="sc">$</span>articles), <span class="at">type =</span> <span class="st">&quot;nbinomial&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for poisson distribution
## 
##                       X^2 df     P(&gt; X^2)
## Likelihood Ratio 296.3715 13 1.381259e-55</code></pre>
<div class="sourceCode" id="cb461"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">goodfit</span>(PhdPubs<span class="sc">$</span>articles), <span class="at">type =</span> <span class="st">&quot;poisson&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   Goodness-of-fit test for poisson distribution
## 
##                       X^2 df     P(&gt; X^2)
## Likelihood Ratio 296.3715 13 1.381259e-55</code></pre>
<p><code>PhdPubs</code>데이터를 포아송분포를 가정한 후,
<code>rootogram</code>그림을 살펴봤을 때, 약간의 과소적합되는 부분이
있는 것으로 보아 적절한 분포가정이 아님을 알 수 있다.<br />
음이항 분포를 가정했을때의 그림은 포아송 분포를 가정했을 때보다 조금
나아 보이지만 여전히 적합한 분포라고 하기는 어렵다.</p>
<p><code>PhdPubs</code>데이터에 포아송, 음이항 분포를 가정하는 것이
적절한 가정인지에 대해서 적합도 검정을 이용하여 다시 한 번 확인해
보았다. 적합도 검정 결과, 음이항, 포아송을 가정했을 때의 유의확률이
유의수준 0.05보다 작다.<br />
따라서, 귀무가설을 기각하므로 두 분포 모두 <code>PhdPubs</code>데이터에
적합한 분포 가정이 아닌 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="sumamry-of-chapter3" class="section level2">
<h2>Sumamry of Chapter3</h2>
<ul>
<li>이산형 데이터를 다룸에 있어서 다양한 이산분포를 이해하고 데이터에
적합한 후, 적합시킨 분포가 데이터에 적합한지에 대한 판단을 하는 것은
중요한 과정이다.<br />
</li>
<li><strong>이항분포</strong>는 성공에 대한 이산분포로 구성되며, 총
시행횟수와 성공확률 p가 주어졌을 때 각 성공시행에 대한 확률을 추정할 수
있다.<br />
</li>
<li><strong>포아송분포</strong>는 평균 단위시간당 발생 횟수를 알 때,
특정 단위시간에 대한 발생 확률을 추정하고자 할 때 사용한다.<br />
</li>
<li><strong>음이항분포</strong>는 분석자가 정한 성공횟수까지 얼마만큼의
실패가 필요하며, 그에 대한 확률을 추정하고자 할 때 사용한다.<br />
</li>
<li><strong>기하분포</strong>는 첫 성공까지 이전까지에 대한 실패확률을
추정할 때 사용한다.<br />
</li>
<li>이산분포가 적합한지에 대해 진단을 하는 방법은 <strong>적합도
검정</strong>이라는 방법을 사용한다. 이는 특정 분포를 가정 했을 때,
데이터가 가정한 분포를 따르는 것이 적합한지에 대한 검정이며, R에서는
<code>goodfit()</code>함수를 통해 쉽게 확인할 수 있다.<br />
</li>
<li>이산분포 적합가정은 시각화를 통해서도 살펴볼 수 있는데, R에서는
<code>rootogram</code>, <code>distplot</code>,<code>Ord_plot</code>을
사용하여 진단을 할 수 있다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap4-two-way-contigency-tables" class="section level1">
<h1>Chap4 Two-Way Contigency Tables</h1>
<p>우리는 앞선 챕터까지 대부분 일차원의 빈도표를 이용하여 분석을
진행하였다.<br />
하지만, 실생활에서 일차원 빈도표처럼 간단한 빈도표를 보는 경우보다 이원
혹은 그 이상의 다차원 분할표를 보는 경우가 많다.<br />
다차원은 일차원에 비해 변수가 많으므로, 분석을 진행함에 있어 더 까다롭기
때문에 조금은 다른 분석방법과 데이터 처리 과정을 연습하는 것이
필요하다.</p>
<p><strong>이원 빈도표 분석(two-way frequency tables)</strong>은 두 변수
간의 연관성에 대해 알아보는 분석이다.<br />
다양한 시각화 기법들은 연관성의 패턴을 시각화 하는데 도움이 되며, 몇몇
지역을 셀의 빈도를 나타내기 위해 사용하기도 한다.</p>
<p>이러한 방법들 중 오즈비 또는 일반적인 연관 패턴에 더 집중하여
알아보도록 한다.</p>
<hr />
<div id="introduction" class="section level2">
<h2>4.1 Introduction</h2>
<p>대부분의 통계 분석 방법은 변수 간의 관계를 이해하는 것과 관련이
있으며, 범주형 변수는 이러한 관계를 종종 분할표에 의해 연구되기도
한다.</p>
<p><strong>Thomas Carlyle</strong>은 숫자표로 전달된 메시지를 이해하는
것은 어렵다고 말했다.<br />
수많은 정보가 내포된 숫자표를 바로 이해하는 것보다는 데이터의 일부분만을
먼저 살펴본다던지, <strong>EDA</strong>를 활용하는 등 전반적인 데이터의
구조를 보는 것이 좋다.<br />
Chapter4에서는 두 범주형 변수 간의 연관성을 이해하기 위한 그래픽
방법들에 대해 알아본다.</p>
<ul>
<li>몇몇의 예시에서는 세 번째 변수를 이용하여 두 주요 변수 간의 관계를
파악하기도 한다.<br />
</li>
<li>두 변수 사이에 연관성이 존재하는지 시험하기 위한 몇몇의 수치 및
통계적 방법과 연관성의 강도의 측정에 대해서 알아본다.<br />
</li>
<li>변수 간의 연관 패턴을 설명하는 데 도움이 되는 그래픽 방법이 가장
중요하다.<br />
</li>
<li><strong>fourfold</strong>, <strong>association plot</strong>,
<strong>agreement plot</strong>, <strong>trilinear plot</strong>에
대해서 알아본다.</li>
</ul>
<p><em>Example 4.2: Hair color and eye color</em></p>
<div class="sourceCode" id="cb463"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>(hec <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(HairEyeColor,<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>##        Hair
## Eye     Black Brown Red Blond
##   Brown    68   119  26     7
##   Blue     20    84  17    94
##   Hazel    15    54  14    10
##   Green     5    29  14    16</code></pre>
<div class="sourceCode" id="cb465"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(hec, <span class="at">beside =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-182-1.png" width="960" /></p>
<p><code>HairEyeColr</code>데이터를 <code>barplot</code>을 통해 머리색과
눈색 사이의 관계를 시각화 하였다.<br />
빈도표를 통해 데이터를 탐색하는 것보다는 <code>barplot</code>을 통해
시각화하여 살펴본 결과가 더 한 눈에 들어오는 것을 알 수 있다.<br />
전체적으로 머리색, 눈색이 둘 다 <strong>Brown</strong>인 학생의 빈도가
높아 보인다.</p>
<p><code>plot</code>에서 <code>beside</code>옵션은 데이터의 그룹에 대한
분포를 표현하고자 할 때, 한 막대안에 넣을지 아니면 그룹에 따라 막대를
표현할지를 결정해주는 옵션이다.</p>
<div class="sourceCode" id="cb466"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(hec, <span class="at">beside =</span> <span class="cn">FALSE</span>, <span class="at">legend =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-183-1.png" width="960" /></p>
<p><code>beside</code>를 <code>FALSE</code>로 지정할 경우, 앞선 결과와
달리 한 막대안에 모든 정보가 들어가는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb467"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb467-2"><a href="#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tile</span>(hec)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-184-1.png" width="960" /></p>
<p><code>tile</code> 함수는 분할표가 갖고있는 데이터의 빈도를 매트릭스
형태로 시각화를 진행하여 변수간 관계를 조금 더 파악하기 쉽게 시각화
해주는 함수로, <code>vcd</code>패키지안에 포함돼있다.<br />
- <code>tile(data)</code></p>
<ul>
<li>data: tile을 통해 빈도를 시각화하고자 하는 데이터</li>
</ul>
<p><em>Example 4.3: Mental impairment and parents’SES</em></p>
<div class="sourceCode" id="cb468"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Mental&quot;</span>,<span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb468-2"><a href="#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Mental)</span></code></pre></div>
<pre><code>##   ses   mental Freq
## 1   1     Well   64
## 2   1     Mild   94
## 3   1 Moderate   58
## 4   1 Impaired   46
## 5   2     Well   57
## 6   2     Mild   94</code></pre>
<p><code>Mental</code>데이터는 6x4의 분할표 형태로, 1660명의 젊은 뉴욕
거주자의 정신건강 상태를 부모의 사회 경제적 상태에 따른 빈도를 나타낸
데이터로, <code>vcdExtra</code>패키지 안에 포함돼있다.</p>
<ul>
<li>ses: 부모의 사회 경제적상태 (Factor variable -
1&lt;2&lt;3&lt;4&lt;5&lt;6)</li>
<li>mental: 정신건강 상태 (Factor variable -
Well&lt;Mild&lt;Moderate&lt;Impaired)</li>
<li>freq: 빈도 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb470"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="#cb470-1" aria-hidden="true" tabindex="-1"></a>mental <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> ses <span class="sc">+</span>mental, <span class="at">data =</span> Mental)</span>
<span id="cb470-2"><a href="#cb470-2" aria-hidden="true" tabindex="-1"></a><span class="fu">spineplot</span>(mental)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-186-1.png" width="960" /></p>
<p><code>spineplot</code>은 누적된 막대 그림의 일반화로 볼 수 있으며,
위의 코드에서는 <strong>ses와 mental</strong>에 따른 빈도를 시각화하기
위해 사용하였다.<br />
- <code>spineplot(data)</code></p>
<ul>
<li>data: 누적된 막대 그림을 그리고자 하는 데이터 (일반적으로 교차표의
형태)</li>
</ul>
<p><code>spineplot</code>을 통해 <code>Mental</code>데이터의 누적
barchart를 확인할 수 있으며, 각 막대의 너비는 <code>SES</code>변수의
백분율에 비례한다.<br />
위의 그림을 통해 사회적 지위가 변함에 따라 <strong>mental ==
Well</strong>인 상태는 점점 감소하며, <strong>mental ==
Impaired</strong>인 상태는 점점 증가하는 것을 확인할 수 있다.</p>
<hr />
</div>
<div id="tests-of-association-for-two-way-tables"
class="section level2">
<h2>4.2 Tests of association for two-way tables</h2>
<div id="notation-and-terminology" class="section level3">
<h3>4.2.1 Notation and terminology</h3>
<p>각 관측값이 일부 모집단에서 랜덤하게 추출되어 두 범주형 변수 A와 B로
나눠지는 경우, 이 변수들의 <strong>joint distribution</strong>을
참조하고 i번째 행, j번째 행으로 분류될 확률을 나타낸다.</p>
<p><strong>marginal distribution</strong>은 joint distribution의 행과
열의 합으로 정의된다.</p>
<div class="sourceCode" id="cb471"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="#cb471-1" aria-hidden="true" tabindex="-1"></a>Berkeley <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(UCBAdmissions,<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb471-2"><a href="#cb471-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb471-3"><a href="#cb471-3" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(Berkeley, <span class="at">prop.chisq =</span> <span class="cn">FALSE</span>, <span class="at">prop.c =</span> <span class="cn">FALSE</span>,</span>
<span id="cb471-4"><a href="#cb471-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">format =</span> <span class="st">&quot;SPSS&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    Cell Contents
## |-------------------------|
## |                   Count |
## |             Row Percent |
## |           Total Percent |
## |-------------------------|
## 
## Total Observations in Table:  4526 
## 
##              | Admit 
##       Gender | Admitted  | Rejected  | Row Total | 
## -------------|-----------|-----------|-----------|
##         Male |     1198  |     1493  |     2691  | 
##              |   44.519% |   55.481% |   59.456% | 
##              |   26.469% |   32.987% |           | 
## -------------|-----------|-----------|-----------|
##       Female |      557  |     1278  |     1835  | 
##              |   30.354% |   69.646% |   40.544% | 
##              |   12.307% |   28.237% |           | 
## -------------|-----------|-----------|-----------|
## Column Total |     1755  |     2771  |     4526  | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
<p><code>gmodels</code>패키지는 모델 적합 혹은 모델 적합 전 데이터를
살펴보기 위해 필요한 다양한 함수를 제공하는 패키지이다.</p>
<p><code>Crosstable</code>은 SAS Proc 형태의 유사한 출력을 가진 교차
테이블 함수로 각 열과 행, Row &amp; column, Total에 대한 Frequency와
proportion을 구할 수 있다. -
<code>Crosstable(data,prop.chisq,prop.c,format)</code></p>
<ul>
<li>data: 교차 테이블 함수를 적용할 데이터</li>
<li>prop.chisq: 교차표에 카이제곱 검점 통계량 출력여부 (TRUE = 출력,
FALSE = 출력 X)</li>
<li>prop.c: 교차표에 열의 속성 추가여부 (TRUE = 출력, FALSE = 출력
X)</li>
<li>format: 출력형식의 포맷 (“SPSS”, “SAS”)</li>
</ul>
<p><code>Crosstable</code>을 <code>Berkeley</code>데이터에 적용한 결과,
남성의 경우 여성에 비해 합격비율이 2배 정도 높은 것을 쉽게 확인할 수
있다.</p>
</div>
<div id="by-2-tables-odds-and-odds-ratios" class="section level3">
<h3>4.2.2 2 by 2 tables: Odds and odds ratios</h3>
<p><strong>연관성 측도</strong>는 변수 간의 연관 정도를 나타내는 데
사용된다.<br />
특히 <strong>odds ratio</strong>는 2x2 표에서 특히 유용하며, 후에
설명되는 몇몇의 그래픽과 모델에서의 기본적인 매개변수이다.</p>
<p>이항 변수에서, 성공확률을 <span
class="math inline">\(\pi\)</span>라고 할 때, 성공의
<strong>odds</strong>는 다음과 같이 정의 된다.</p>
<p><span class="math display">\[
odds = { \pi \over  (1-\pi)}
\]</span></p>
<p>따라서, odds가 1이라는 것은 <span
class="math inline">\(\pi\)</span>가 0.5이거나 성공과 실패 확률이
같다.</p>
<p>예를들어, <span class="math inline">\(\pi\)</span> = 0.75일 때,
odds는 3(0.75 / 0.25)이므로 성공 확률은 실패의 3배라는 것을 알 수
있다.</p>
<p>성공의 오즈는 1을 중심으로 곱셈적으로 변하며, 로그를 취하면
<strong>log odds</strong> 또는 <strong>logit</strong>으로 불리는
측정값을 얻을 수 있다.</p>
<p><span class="math display">\[
logit(\pi) = log(odds) = log { \pi \over  (1-\pi)}
\]</span></p>
<div class="sourceCode" id="cb473"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="#cb473-1" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>)</span>
<span id="cb473-2"><a href="#cb473-2" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">&lt;-</span> P <span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>P)</span>
<span id="cb473-3"><a href="#cb473-3" aria-hidden="true" tabindex="-1"></a>logodds <span class="ot">&lt;-</span> <span class="fu">log</span>(odds)</span>
<span id="cb473-4"><a href="#cb473-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(P, odds, logodds)</span></code></pre></div>
<pre><code>##      P        odds   logodds
## 1 0.05  0.05263158 -2.944439
## 2 0.10  0.11111111 -2.197225
## 3 0.25  0.33333333 -1.098612
## 4 0.50  1.00000000  0.000000
## 5 0.75  3.00000000  1.098612
## 6 0.90  9.00000000  2.197225
## 7 0.95 19.00000000  2.944439</code></pre>
<p>여러 성공확률들을 가정하고 각 확률을 이용해 <strong>odds와
logodds</strong>를 구해보았다.<br />
성공확률이 높아질수록 오즈와 로그오즈 모두 점점 증가하는 형태를
보인다.</p>
<p>두 그룹에 대한 이항반응은 그룹 변수를 행으로 사용하여 2x2 테이블로
제공한다.<br />
<span class="math inline">\(\pi\)</span>, <span
class="math inline">\(\pi2\)</span>를 각각 그룹1과 그룹2의 성공확률
이라고하자.<br />
두 그룹에 대한 오즈의 비율 즉 <strong>odds ratio</strong>는 다음과 같이
정의된다.</p>
<p><span class="math display">\[
odds ratio = \theta = {odds1 \over odds2} = {\pi1/(1-\pi1) \over
\pi2/(1-\pi2)
}
\]</span></p>
<p>odds와 마찬가지로 odds ratio 또한 항상 0과 무한대의 범위 사이에
존재한다.<br />
<span class="math inline">\(\theta\)</span> = 1인 경우 성공과 실패의
분포는 두 그룹 모두에서 동일하며 반응변수는 그룹과 독립적이다.<br />
<span class="math inline">\(\theta\)</span> &gt; 1인 경우, 그룹 1의 성공
확률이 더 높고 <span class="math inline">\(\theta\)</span> &lt; 1인
경우, 그룹 2의 성공 확률이 더 높다고 해석할 수 있다.</p>
<p><em>Example 4.5: Berkeley admissions</em></p>
<div class="sourceCode" id="cb475"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb475-2"><a href="#cb475-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;UCBAdmissions&quot;</span>)</span>
<span id="cb475-3"><a href="#cb475-3" aria-hidden="true" tabindex="-1"></a>UCB <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(UCBAdmissions,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb475-4"><a href="#cb475-4" aria-hidden="true" tabindex="-1"></a>(LOR <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(UCB))</span></code></pre></div>
<pre><code>## log odds ratios for Admit and Gender 
## 
## [1] 0.6103524</code></pre>
<p><code>vcd</code>패키지의 <code>loddsratio</code>함수를 이용하여
(로그)오즈비를 간단하게 구할 수 있다.<br />
- <code>loodsratio(data,log)</code></p>
<ul>
<li>data: (로그)오즈비를 구할 데이터 (단, 데이터는 2차원의 분할표의
형태로 구성되어야 한다.)</li>
<li>log: 로그오즈비 적용 여부 (TRUE = 로그오즈비, FALSE = 오즈비)</li>
</ul>
<div class="sourceCode" id="cb477"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="#cb477-1" aria-hidden="true" tabindex="-1"></a>(OR <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(UCB,<span class="at">log=</span><span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>##  odds ratios for Admit and Gender 
## 
## [1] 1.84108</code></pre>
<p><code>log = FALSE</code>를 지정함으로써 로그오즈비가 아닌
<strong>오즈비</strong>를 구한 것을 확인할 수 있다.<br />
위의 결과의 경우, 남성이 여성에 비해 합격할 오즈가 약 1.84배 정도 높은
것을 알 수 있다.</p>
<div class="sourceCode" id="cb479"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(LOR)</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##                               Estimate Std. Error z value  Pr(&gt;|z|)    
## Admitted:Rejected/Male:Female 0.610352   0.063893  9.5527 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>summary</code>함수를 통해 단순히 오즈비의 결과뿐만 아니라
표준오차, 유의확률 등의 추가적인 정보를 얻을 수 있다.<br />
유의확률이 유의수준 0.05보다 작으므로 주어진 변수를 이용해 오즈비를
구하는 것은 유의한 분석임을 알 수 있다.</p>
<div class="sourceCode" id="cb481"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="#cb481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(OR)</span></code></pre></div>
<pre><code>##                                  2.5 %   97.5 %
## Admitted:Rejected/Male:Female 1.624377 2.086693</code></pre>
<div class="sourceCode" id="cb483"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(LOR)</span></code></pre></div>
<pre><code>##                                   2.5 %    97.5 %
## Admitted:Rejected/Male:Female 0.4851243 0.7355805</code></pre>
<p><code>confint</code>함수를 이용하여 오즈비 혹은 로그오즈비의 95%
신뢰구간의 추정값 또한 구할 수 있다.</p>
<div class="sourceCode" id="cb485"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(UCB)</span></code></pre></div>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  UCB
## p-value &lt; 2.2e-16
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##  1.621356 2.091246
## sample estimates:
## odds ratio 
##   1.840856</code></pre>
<p><code>fisher.test</code>를 통해 오즈비에 대한 가설검정을 진행할수도
있다.</p>
<ul>
<li>H0: 오즈비는 1이다.</li>
<li>H1: 오즈비는 1이 아니다.</li>
</ul>
<p>주어진 결과의 유의확률이 유의수준 0.05보다 작으므로 귀무가설을
기각한다.<br />
따라서, 주어진 데이터의 오즈비는 1이 아닌 것을 확인할 수 있다.</p>
</div>
<div id="larger-tables-overall-analysis" class="section level3">
<h3>4.2.3 Larger tables: Overall analysis</h3>
<p>two-way table에서는 <code>assocstats</code>함수를 이용하여 전반적인
연관성 테스트를 진행할 수 있다.</p>
<p>만약, 데이터셋이 2개의 요인보다 많은 경우 표 생성시 포함되지 않은
다른 요인은 무시된다.</p>
<p>하지만, 제외된 요인이 사용된 요인과 상호작용이 존재할수도 있으므로
확인하는 작업이 필요하다.</p>
<p><em>Example 4.6: Arthritis treatment</em></p>
<div class="sourceCode" id="cb487"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>,<span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb487-2"><a href="#cb487-2" aria-hidden="true" tabindex="-1"></a>Art <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span>Treatment <span class="sc">+</span> Improved, <span class="at">data =</span> Arthritis)</span>
<span id="cb487-3"><a href="#cb487-3" aria-hidden="true" tabindex="-1"></a>Art</span></code></pre></div>
<pre><code>##          Improved
## Treatment None Some Marked
##   Placebo   29    7      7
##   Treated   13    7     21</code></pre>
<p><code>Arthritis</code>데이터의 <strong>Improved,
Treatment</strong>변수를 이용하여 교차표를 생성하였다.</p>
<div class="sourceCode" id="cb489"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">prop.table</span>(Art, <span class="at">margin =</span> <span class="dv">1</span>), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##          Improved
## Treatment  None  Some Marked
##   Placebo 67.44 16.28  16.28
##   Treated 31.71 17.07  51.22</code></pre>
<p><code>prop.table</code>함수를 이용하여 행을 기준으로 확률표를
생성하였다.</p>
<div class="sourceCode" id="cb491"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assocstats</span>(Art)</span></code></pre></div>
<pre><code>##                     X^2 df  P(&gt; X^2)
## Likelihood Ratio 13.530  2 0.0011536
## Pearson          13.055  2 0.0014626
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.367 
## Cramer&#39;s V        : 0.394</code></pre>
<p><code>vcd</code>패키지의 <code>assocstats</code>함수를 이용하여
연관성 분석을 진행한다.</p>
<p><strong>Cramer’s V</strong>, <strong>Contigency coeff</strong>는 각각
0.367, 0.394로 변수간 어느정도의 연관성이 있음을 파악할 수 있다.</p>
<p>또한, LR방법, 피어슨검정 방법의 유의확률이 유의수준 0.05보다 모두
작으므로 귀무가설을 기각한다.<br />
따라서, <strong>Improved, Treatment</strong> 변수는 독립이 아니므로 서로
연관이 있다고 볼 수 있다.</p>
</div>
<div id="tests-for-ordinal-variables" class="section level3">
<h3>4.2.4 Tests for ordinal variables</h3>
<p>행 변수와 열 변수 중 하나 또는 둘 다 순서형인 경우 일반적인 카이제곱
검정을 사용하게 되면 다른 결과가 출력될수도 있는데, 이는 카이제곱 검정은
변수가 순서형 변수여도 명목형 변수로 가정하기 때문이다.<br />
따라서, 일반 연관성에 대한 검정보다 더 민감한 검정을 사용할 수 있다.</p>
<p>변수의 순서적 특성을 고려하는 경우 <code>vcdExtra</code>패키지의
<code>CMHtest</code>를 고려해볼 수 있다.<br />
<code>CMHtest</code>는 분할표에 순서형 요인이 있는 경우의 연관성에 대한
검정을 진행할 때 사용한다. 이 검정은 기본적으로 순서형 요인에 숫자
점수를 할당하여 검정을 진행하게 된다. 또는 층을 사용하여 각 변수 수준에
대해 검정을 계산하고 층을 제어하는 전체 검정을 제공하기도 한다.<br />
- <code>CMHtest(data)</code></p>
<ul>
<li>data: 순서형 요인이 포함된 분할표</li>
</ul>
<p><em>Example 4.7: Mental impairment and parents’SES</em></p>
<div class="sourceCode" id="cb493"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Mental&quot;</span>,<span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb493-2"><a href="#cb493-2" aria-hidden="true" tabindex="-1"></a>mental <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> ses <span class="sc">+</span> mental, <span class="at">data =</span> Mental)</span>
<span id="cb493-3"><a href="#cb493-3" aria-hidden="true" tabindex="-1"></a><span class="fu">assocstats</span>(mental)</span></code></pre></div>
<pre><code>##                     X^2 df   P(&gt; X^2)
## Likelihood Ratio 47.418 15 3.1554e-05
## Pearson          45.985 15 5.3458e-05
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.164 
## Cramer&#39;s V        : 0.096</code></pre>
<p>두 요인을 명목형 변수로 가정하고 <code>assocstats</code>함수를 통해
독립성 검정을 진행한 결과, 유의확률이 유의수준 0.05보다 작으므로
귀무가설을 기각한다.<br />
따라서, 두 요인은 서로 독립이 아니며 연관성이 있는 변수임을 알 수
있다.</p>
<div class="sourceCode" id="cb495"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb495-2"><a href="#cb495-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CMHtest</span>(mental)</span></code></pre></div>
<pre><code>## Cochran-Mantel-Haenszel Statistics for ses by mental 
## 
##                  AltHypothesis  Chisq Df       Prob
## cor        Nonzero correlation 37.156  1 1.0907e-09
## rmeans  Row mean scores differ 40.297  5 1.3012e-07
## cmeans  Col mean scores differ 40.666  3 7.6971e-09
## general    General association 45.958 15 5.4003e-05</code></pre>
<p><strong>Nonzero correlation</strong>: 행 변수와 열변수가 모두
순서형일 경우, 두 변수에 점수를 할당하고 상관계수를 계산하여 Spearman의
순위 상관계수를 얻을 수 있다. 이 검정은 행 평균 점수가 행에 걸쳐
선형적으로 변화하는 패턴에 가장 민감하다.</p>
<p><strong>Row mean scores differ</strong>: 만일 열 변수가 순서형인 경우
열 변수에 점수를 할당하면 각 행에 대한 평균이 생성된다. 행 변수와 열
변수의 연관성은 표의 행에 대해 평균이 다른지 여부를 검정하는 것으로
나타낼 수 있다. 이는 Kruskal-Wallis 비모수 검정과 유사하다.</p>
<p><strong>Col mean scores differ</strong>: Row mean scores differ과
유사하며 행 변수에 점수를 할당하는 것만 차이가 있다.</p>
<p><strong>General association</strong>: 행 변수와 열 변수가 모두
순서형이 아닌 경우 유일한 대립 가설은 행 변수와 열 변수 사이에 연관성이
있다는 것이다. CMH 검정 통계량은 카이-제곱 및 우도비 카이-제곱과
유사하다.</p>
<p><code>mental</code>데이터는 두 요인 모두 순서형 데이터이므로
<strong>Nonzero correlation</strong>을 통해 결과해석을 해야한다.<br />
자유도가 1, 카이제곱 검정통계량의 값은 37.1558, 유의확률은 0.05보다 매우
작은 값을 가지는 것을 확인할 수 있다. 이때, 유의확률은 명목형을 가정하고
독립성 검정을 진행한 유의확률보다 매우 작으므로 더 유의한 결과가 나오는
것을 알 수 있다.<br />
따라서, 두 요인을 순서형으로 고려하여 독립성 검정을 진행했을 때에도 두
변수는 서로 독립이아니며, 서로 연관성이 있는 것을 확인할 수 있다.</p>
</div>
<div id="sample-cmh-profiles" class="section level3">
<h3>4.2.5 Sample CMH profiles</h3>
<div id="general-association" class="section level4">
<h4>4.2.5.1 General association</h4>
<div class="sourceCode" id="cb497"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="#cb497-1" aria-hidden="true" tabindex="-1"></a>row1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">25</span>,<span class="dv">15</span>,<span class="dv">0</span>)</span>
<span id="cb497-2"><a href="#cb497-2" aria-hidden="true" tabindex="-1"></a>row2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">20</span>,<span class="dv">5</span>)</span>
<span id="cb497-3"><a href="#cb497-3" aria-hidden="true" tabindex="-1"></a>row3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">20</span>)</span>
<span id="cb497-4"><a href="#cb497-4" aria-hidden="true" tabindex="-1"></a>cmhdemo1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(row1,row2,row3)</span>
<span id="cb497-5"><a href="#cb497-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cmhdemo1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>,<span class="st">&quot;a2&quot;</span>,<span class="st">&quot;a3&quot;</span>)</span>
<span id="cb497-6"><a href="#cb497-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cmhdemo1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;b2&quot;</span>,<span class="st">&quot;b3&quot;</span>,<span class="st">&quot;b4&quot;</span>,<span class="st">&quot;b5&quot;</span>)</span>
<span id="cb497-7"><a href="#cb497-7" aria-hidden="true" tabindex="-1"></a>cmhdemo1</span></code></pre></div>
<pre><code>##    b1 b2 b3 b4 b5
## a1  0 15 25 15  0
## a2  5 20  5 20  5
## a3 20  5  5  5 20</code></pre>
<div class="sourceCode" id="cb499"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CMHtest</span>(cmhdemo1)</span></code></pre></div>
<pre><code>## Cochran-Mantel-Haenszel Statistics 
## 
##                  AltHypothesis  Chisq Df       Prob
## cor        Nonzero correlation  0.000  1 1.0000e+00
## rmeans  Row mean scores differ  0.000  2 1.0000e+00
## cmeans  Col mean scores differ 72.203  4 7.7767e-15
## general    General association 91.797  8 2.0062e-16</code></pre>
<p>임의로 생성한 <code>cmhdemo1</code>에 대해서 <code>CMHtest</code>를
한 결과는 위와같다.<br />
이때, <strong>Non-zero correlation</strong>, <strong>row mean scores
differ</strong>모두 카이제곱 값이 정확히 0인 것을 볼 수 있는데, 이는 행
평균이 모두 같기 때문이다.</p>
<div class="sourceCode" id="cb501"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="#cb501-1" aria-hidden="true" tabindex="-1"></a>row_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>)</span>
<span id="cb501-2"><a href="#cb501-2" aria-hidden="true" tabindex="-1"></a>row_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">5</span>)</span>
<span id="cb501-3"><a href="#cb501-3" aria-hidden="true" tabindex="-1"></a>row_3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">2</span>)</span>
<span id="cb501-4"><a href="#cb501-4" aria-hidden="true" tabindex="-1"></a>row_4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">2</span>)</span>
<span id="cb501-5"><a href="#cb501-5" aria-hidden="true" tabindex="-1"></a>cmhdemo2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(row_1,row_2,row_3,row_4)</span>
<span id="cb501-6"><a href="#cb501-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cmhdemo2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>,<span class="st">&quot;a2&quot;</span>,<span class="st">&quot;a3&quot;</span>,<span class="st">&quot;a4&quot;</span>)</span>
<span id="cb501-7"><a href="#cb501-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cmhdemo2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;b2&quot;</span>,<span class="st">&quot;b3&quot;</span>,<span class="st">&quot;b4&quot;</span>,<span class="st">&quot;b5&quot;</span>)</span>
<span id="cb501-8"><a href="#cb501-8" aria-hidden="true" tabindex="-1"></a>cmhdemo2</span></code></pre></div>
<pre><code>##    b1 b2 b3 b4 b5
## a1  2  5  8  8  8
## a2  2  8  8  8  5
## a3  5  8  8  8  2
## a4  8  8  8  5  2</code></pre>
<div class="sourceCode" id="cb503"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="#cb503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CMHtest</span>(cmhdemo2)</span></code></pre></div>
<pre><code>## Cochran-Mantel-Haenszel Statistics 
## 
##                  AltHypothesis  Chisq Df      Prob
## cor        Nonzero correlation 10.639  1 0.0011071
## rmeans  Row mean scores differ 10.676  3 0.0136127
## cmeans  Col mean scores differ 11.401  4 0.0224082
## general    General association 13.400 12 0.3406368</code></pre>
<p>다시 한 번 임의로 생성한 <code>cmhdemo2</code>에 대해서
<code>CMHtest</code>를 진행해 보았다.</p>
<p><code>cmhdemo2</code> 분할표는 약하고 유의하지 않은 일반 연관성이
포함되어 있지만 행과 열의 평균은 모두 유의하다.<br />
<strong>General association</strong> 결과에서는 유의확률이 유의수준
0.05보다 크므로 연관성이 존재하지 않는다는 결론으로 이어지지만, 순서형
요인을 고려한 검정(<strong>Nonzero correlation</strong>)에서는
유의확률이 유의수준 0.05보다 작으므로 연관성이 존재한다는 결론으로
이어진다.</p>
<p>이를 통해 변수간의 독립성 검정이 요인 수준의 순서 특성에 따라
달라진다고 생각 될 때는 순서형 요인에대한 보다 집중적인 검정을 진행하며,
순서형 요인의 수준을 숫자 점수값으로 재코딩 하는 것도 하나의 방법이 될
수 있다.</p>
<div class="sourceCode" id="cb505"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(cmhdemo1,<span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">&quot;General association&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-203-1.png" width="960" /></p>
<div class="sourceCode" id="cb506"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="#cb506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(cmhdemo2,<span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">&quot;Linear association&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-203-2.png" width="960" /></p>
<p><code>sieve</code>함수는 이원 분할표의 관찰빈도와 기대빈도를 서로
비교할 수 있게 하는 <strong>sieve diagram</strong>을 시각화 할 수 있도록
도와주는 함수로, <code>vcd</code>패키지에 포함돼있다.<br />
- <code>sieve(data,labeling,shade)</code></p>
<ul>
<li>data: sieve diagram을 그리고자 하는 데이터 (이원 분할표의 형태여야
한다.)</li>
<li>labeling: 교차표위에 출력하고자 하는 값</li>
<li>shade: 양의 잔차와 음의 잔차를 음영으로 구분할지에 대한 여부 (TRUE =
구분, FALSE = 구분 X)</li>
</ul>
<p><code>cmhdemo1</code>을 이용하여 <strong>sieve diagram</strong>을
시각화한 결과, 음영의 색깔을 통해 a1과 B의 수준들은 대부분 연관이
없거나(잔차 = 거의 0) 음의 잔차를 가지는 것을 볼 수 있고 a3의 경우,
b2,b3,b4에 대해서 양의 잔차를 가지는 것을 확인할 수 있다.</p>
<p><code>cmhdemo2</code>를 이용하여 <strong>sieve diagram</strong>을
시각화한 결과, b3와 A는 서로 연관이 없다는 것을 제외하고는 특별한 패턴이
보이지 않는다.</p>
<p><strong>sieve diagram</strong>을 통해 시각적으로 연관성을 살펴볼수도
있다.</p>
<hr />
</div>
</div>
</div>
<div id="stratified-analysis" class="section level2">
<h2>4.3 Stratified analysis</h2>
<div id="computing-strata-wise-statistics" class="section level3">
<h3>4.3.1 Computing strata-wise statistics</h3>
<p><strong>Stratified analysis(계층화 분석)</strong>은 하나 이상의 배경
변수의 효과를 제어하여 분석하는 방법을 말한다.<br />
이는 분산 분석 설계에 블럭화 변수를 사용하는 것과 유사하다.</p>
<p><em>Example 4.8: Arthritis treatment</em></p>
<div class="sourceCode" id="cb507"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="#cb507-1" aria-hidden="true" tabindex="-1"></a>Art2 <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span>Treatment <span class="sc">+</span> Improved <span class="sc">+</span> Sex, <span class="at">data =</span> Arthritis)</span>
<span id="cb507-2"><a href="#cb507-2" aria-hidden="true" tabindex="-1"></a>Art2</span></code></pre></div>
<pre><code>## , , Sex = Female
## 
##          Improved
## Treatment None Some Marked
##   Placebo   19    7      6
##   Treated    6    5     16
## 
## , , Sex = Male
## 
##          Improved
## Treatment None Some Marked
##   Placebo   10    0      1
##   Treated    7    2      5</code></pre>
<p><strong>계층화 분석</strong>을 <code>Arthritis</code>데이터에
적용하기 위해 <code>xtabs</code>함수를 사용하여 <strong>Improved,
Treatment</strong>변수에 대한 분할표를 성별에 따라 나눠주었다.</p>
<div class="sourceCode" id="cb509"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assocstats</span>(Art2)</span></code></pre></div>
<pre><code>## $`Sex:Female`
##                     X^2 df  P(&gt; X^2)
## Likelihood Ratio 11.731  2 0.0028362
## Pearson          11.296  2 0.0035242
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.401 
## Cramer&#39;s V        : 0.438 
## 
## $`Sex:Male`
##                     X^2 df P(&gt; X^2)
## Likelihood Ratio 5.8549  2 0.053532
## Pearson          4.9067  2 0.086003
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.405 
## Cramer&#39;s V        : 0.443</code></pre>
<p><strong>Contingency Coeff,Cramer’s V</strong>는 남성, 여성 그룹에서
약 0.4의 값을 가지며, 어느정도 연관성이 있는 것 처럼 보인다.<br />
하지만, <strong>여성의 유의확률은 유의수준 0.05보다 작아</strong> 변수간
연관이 있다라는 결론을 얻을 수 있는 반면, <strong>남성의 유의확률은
유의수준 0.05보다 크므로</strong> 변수간 연관이 없다라는 결론을 얻을 수
있다.</p>
<div class="sourceCode" id="cb511"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CMHtest</span>(Art2)</span></code></pre></div>
<pre><code>## $`Sex:Female`
## Cochran-Mantel-Haenszel Statistics for Treatment by Improved 
##  in stratum Sex:Female 
## 
##                  AltHypothesis  Chisq Df       Prob
## cor        Nonzero correlation 10.935  1 0.00094361
## rmeans  Row mean scores differ 10.935  1 0.00094361
## cmeans  Col mean scores differ 11.105  2 0.00387828
## general    General association 11.105  2 0.00387828
## 
## 
## $`Sex:Male`
## Cochran-Mantel-Haenszel Statistics for Treatment by Improved 
##  in stratum Sex:Male 
## 
##                  AltHypothesis  Chisq Df     Prob
## cor        Nonzero correlation 3.7128  1 0.053997
## rmeans  Row mean scores differ 3.7128  1 0.053997
## cmeans  Col mean scores differ 4.7105  2 0.094871
## general    General association 4.7105  2 0.094871</code></pre>
<p><code>CMHtest</code>를 사용한 결과, <strong>여성의 경우</strong>
4가지 방법을 적용했을 때, 모든 유의확률이 유의수준 0.05보다 작아 변수 간
연관성이 있는 것을 확인할 수 있지만, <strong>남성의 경우</strong> 4가지
방법을 적용했을 때, 모든 유의확률이 유의수준 0.05보다 크므로 변수간
연관성이 없다. 앞선 결과와 동일한 결과가 나오는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb513"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="#cb513-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(Art2, <span class="dv">3</span>, sum)</span></code></pre></div>
<pre><code>## Female   Male 
##     59     25</code></pre>
<p>이러한 결과는 표본의 영향을 받을수도 있으므로 표본을 확인해본 결과,
여성이 남성보다 두 배 이상 표본이 많은 것을 확인할 수 있었다.<br />
따라서, 남성의 경우 표본을 늘린 후 연관성 검정을 다시 진행해보면 결과가
바뀔수도 있다는 추측을 해볼 수 있다.</p>
</div>
<div id="assessing-homogeneity-of-association" class="section level3">
<h3>4.3.2 Assessing homogeneity of association</h3>
<p>계층화 분석에서 주 테이블 변수 간의 연관성이 모든 계층에서 동일한지
확인하는 것은 중요하다.<br />
2 x 2표의 경우 모든 계층에서 승산비가 동일한지 여부를 통해 확인할 수
있다.</p>
<ul>
<li>H0: 모든 계층에서 승산비가 동일하다.<br />
</li>
<li>H1: 모든 계층에서 승산비가 동일하지 않다.</li>
</ul>
<p><code>woolf_test</code>는 모든 계층에 대한 동질성 검정을 진행하는
함수로, <code>vcd</code>패키지에 포함돼있다.<br />
- <code>woolf_test(table)</code></p>
<ul>
<li>table: 동질성 검정을 진행할 데이터 (계층의 갯수는 상관없지만 2x2의
분할표 형태를 가져야 한다.)</li>
</ul>
<p><em>Example 4.9: Berkeley admissions</em></p>
<div class="sourceCode" id="cb515"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">woolf_test</span>(UCBAdmissions)</span></code></pre></div>
<pre><code>## 
##  Woolf-test on Homogeneity of Odds Ratios (no 3-Way assoc.)
## 
## data:  UCBAdmissions
## X-squared = 17.902, df = 5, p-value = 0.003072</code></pre>
<p><code>UCBAdmissions</code>데이터에 대한 동질성 검정 결과, 유의확률은
유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, 승산비가 계층에 따라 동일하지 않은 것을 확인할 수 있다.</p>
<p><em>Example 4.10: Arthritis treatment</em></p>
<div class="sourceCode" id="cb517"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">woolf_test</span>(Art2)</span></code></pre></div>
<pre><code>## 
##  Woolf-test on Homogeneity of Odds Ratios (no 3-Way assoc.)
## 
## data:  Art2
## X-squared = 0.31808, df = 1, p-value = 0.5728</code></pre>
<p><code>Art2</code>데이터에 대한 동질성 검정 결과, 유의확률은 유의수준
0.05보다 크므로 귀무가설을 기각하지 못한다.<br />
따라서, 승산비가 계층에 따라 동일한 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb519"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb519-2"><a href="#cb519-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(<span class="sc">~</span> (Treatment <span class="sc">+</span> Improved <span class="sc">+</span>Sex)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span>Art2)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~(Treatment + Improved + Sex)^2, data = Art2)
## 
## Statistics:
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 1.703663  2 0.4266329
## Pearson          1.133571  2 0.5673463</code></pre>
<p>세 변수 A,B,C 사이의 연관성의 동질성 가설을 로그선형 모델로 정의할 수
있다. <code>loglm</code>은 <code>Chapter5</code>에서 더 자세히 다루게
되므로 자세한 설명은 뒤에서 하도록 한다.<br />
유의확률이 유의수준 0.05보다 크므로 귀무가설을 기각한다.<br />
따라서, <strong>Treatment + Improved + Sex</strong>의 2차항을 고려했을
때, 변수들은 서로 독립인 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="fourfold-display-for-2-x-2-tables" class="section level2">
<h2>4.4 Fourfold display for 2 x 2 tables</h2>
<p><strong>Fourfold display</strong>는 2x2 표의 표시를 위해 만들어진
방사형 다이어그램이다.<br />
각각의 셀의 빈도는 <span class="math inline">\(\sqrt{n_{ij}}\)</span>에
비례하는 1/4 circle로 표시되며, 면적은 셀의 빈도에 비례한다.<br />
이 그림의 목적은 샘플 odds ratio를 표시하는 것이다. 변수 사이의 연관성이
있다면, 한 방향의 대각선 반대쪽 셀과 크기가 다른 셀 크기가 다른 경향으로
나타나며 색깔 또는 음영을 통해 방향을 표시한다.</p>
<p>R에서 <code>Fourfold</code>함수는 <code>vcd</code>패키지안에
포함돼있다.<br />
- <code>Fourfold(data)</code></p>
<ul>
<li>data: Fourfold 함수를 적용할 데아터 (분할표의 계층은 상관없지만
반드시 2x2형태의 분할표이어야 한다.)</li>
</ul>
<p><em>Example 4.11: Berkeley admissions</em></p>
<div class="sourceCode" id="cb521"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fourfold</span>(Berkeley, <span class="at">std =</span> <span class="st">&quot;ind.max&quot;</span>) <span class="co"># unstandardized</span></span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-211-1.png" width="960" /></p>
<p>위 그림은 표준화 되지않은 fourfold display를 보여준다. 여기서, 각
사분면의 점은 각 모서리에 숫자로 표시된 셀 빈도에 비례한다.<br />
승산비는 어두운 음영 영역의 곱에 비례하며, 밝은 음영 영역의 곱으로
나눈다.<br />
위의 그림을 통해 남성이 합격할 오즈가 여성에 비해 <strong>약 2배 정도
높다</strong>는 것을 쉽게 확인할 수 있다.</p>
<div class="sourceCode" id="cb522"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fourfold</span>(Berkeley, <span class="at">margin =</span> <span class="dv">1</span>) <span class="co"># equating gender</span></span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-212-1.png" width="960" /></p>
<p>첫번째 그림을 보면 남성과 여성의 표본 차이가 크기 때문에 면적 차이가
큰 것을 볼 수 있다.<br />
이 문제를 해결하기 위해 위의 그림은 행 백분율에 비례하도록 하여 fourfold
display 그렸다.<br />
앞선 그림과 같이 남성이 합격할 오즈가 여성보다 2배정도 높은 것을 알 수
있다.<br />
불합격할 오즈는 남성과 여성 모두 큰 차이가 없을을 확인할 수 있다.</p>
<div class="sourceCode" id="cb523"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fourfold</span>(Berkeley)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-213-1.png" width="960" /></p>
<p>표준화를 통해, 신뢰 고리는 승산비가 1과 다르지 않을 경우 각 상단의
사분면에 대한 신뢰 고리와 그 아래의 신뢰 고리가 겹치는 특성을
갖는다.<br />
일반적으로 가장 유용한 형태인 <strong>완전히 표준화된 fourfold
display</strong>는 위 그림과 같다.</p>
<div id="confidence-rings-for-oods-ratio" class="section level3">
<h3>4.4.1 Confidence rings for oods ratio</h3>
<div class="sourceCode" id="cb524"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">loddsratio</span>(Berkeley))</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##                               Estimate Std. Error z value  Pr(&gt;|z|)    
## Male:Female/Admitted:Rejected 0.610352   0.063893  9.5527 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>Berkeley</code>데이터의 로그 오즈비를 구한 결과 약 0.6103이
나온 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb526"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="#cb526-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(.<span class="dv">6103</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fl">0.06398</span>)</span></code></pre></div>
<pre><code>## [1] 1.624015 2.086939</code></pre>
<p>로그 오즈비를 구했기 때문에 <code>exp</code>함수를 통해 로그를
제거하고 오즈비에 대한 신뢰구간을 구한다.<br />
<code>Berkeley</code>데아터의 95%오즈비 신뢰구간은 (1.624,2.087)인 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb528"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(<span class="fu">loddsratio</span>(Berkeley, <span class="at">log =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<pre><code>##                                  2.5 %   97.5 %
## Male:Female/Admitted:Rejected 1.624377 2.086693</code></pre>
<p>직접 계산하지 않고 <code>confint</code>함수를 사용하여 오즈비의
신뢰구간을 간편하게 얻을수도 있다.</p>
</div>
<div id="stratified-analysis-for-2x2xk-tables" class="section level3">
<h3>4.4.2 Stratified analysis for 2x2xk tables</h3>
<p>2x2xk 테이블에서 마지막 차원은 종종 <strong>계층</strong>에 해당되며,
일반적으로 첫 번째 두 번째 변수 사이의 연관성이 계층 간에 동일한지
확인하는 것은 중요한 문제 중 하나이다.</p>
<div id="stratified-display" class="section level4">
<h4>4.4.2.1 Stratified display</h4>
<div class="sourceCode" id="cb530"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="#cb530-1" aria-hidden="true" tabindex="-1"></a>UCB <span class="ot">&lt;-</span> <span class="fu">aperm</span>(UCBAdmissions, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb530-2"><a href="#cb530-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fourfold</span>(UCB, <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-217-1.png" width="960" /></p>
<p><code>UCBAdmissions</code>의 6개의 학과를 고려하여
<code>Fourfold</code>그림을 그려보았다. A학과를 제외하고 나머지 학과들의
<code>Fourfold</code>면적은 거의 동일해 보이므로, 성별에 따른 입학
오즈비는 동일한 것을 알 수 있다.</p>
<div class="sourceCode" id="cb531"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>((<span class="fu">loddsratio</span>(UCB))<span class="sc">$</span>coefficients[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##        A 
## 0.349212</code></pre>
<p>부서 A는 다른 부서와 달리 남성이 입학할 오즈가 여성에 비해 약
0.34배인 것을 확인할 수 있다.<br />
즉, 여성이 남성에 비해 A부서에 입학할 오즈가 약 2.86배 정도 높은 것을 알
수 있다.</p>
</div>
<div id="visualization-principles-for-complex-data"
class="section level4">
<h4>4.4.2.2 Visualization principles for complex data</h4>
<p>크고 복잡한 데이터에서 중요한 원칙은 통제된 비교이다.
<code>fourfold</code>는 세그먼트의 각도를 일정하게 유지하고 반지름을
변화 시킨다는 점에서 파이 차트와 다르다.<br />
중요한 결과는 표의 해당 셀이 항상 동일한 위치에 있기 때문에 서로 다른
층에 대한 <code>fourfold</code>를 쉽게 비교할 수 있다.</p>
<p><em>Example 4.12: Breathlessness and wheeze in coal miners</em></p>
<div class="sourceCode" id="cb533"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;CoalMiners&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb533-2"><a href="#cb533-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(CoalMiners)</span></code></pre></div>
<pre><code>## , , Age = 20-24
## 
##               Wheeze
## Breathlessness    W  NoW
##            B      9    7
##            NoB   95 1841
## 
## , , Age = 25-29
## 
##               Wheeze
## Breathlessness    W  NoW
##            B     23    9
##            NoB  105 1654
## 
## , , Age = 30-34
## 
##               Wheeze
## Breathlessness    W  NoW
##            B     54   19
##            NoB  177 1863
## 
## , , Age = 35-39
## 
##               Wheeze
## Breathlessness    W  NoW
##            B    121   48
##            NoB  257 2357
## 
## , , Age = 40-44
## 
##               Wheeze
## Breathlessness    W  NoW
##            B    169   54
##            NoB  273 1778
## 
## , , Age = 45-49
## 
##               Wheeze
## Breathlessness    W  NoW
##            B    269   88
##            NoB  324 1712
## 
## , , Age = 50-54
## 
##               Wheeze
## Breathlessness    W  NoW
##            B    404  117
##            NoB  245 1324
## 
## , , Age = 55-59
## 
##               Wheeze
## Breathlessness    W  NoW
##            B    406  152
##            NoB  225  967
## 
## , , Age = 60-64
## 
##               Wheeze
## Breathlessness    W  NoW
##            B    372  106
##            NoB  132  526</code></pre>
<p><code>CoalMiners</code>데이터는 방사선 증거가 없는 20~64세의 흡연자인
석탄 광부들의 두 폐 질환 즉, 호흡과 휘즈 사이의 연관성에 대한 정보를
제공하는 데이터로 <code>vcd</code>패키지안에 포함돼있다.</p>
<ul>
<li>Breathlessness: 호흡 (Factor variable - B, NoB)</li>
<li>wheeze: 휘즈 (Factor variable - W, NoW)</li>
<li>Age: 나이 (Factor variable - 20<sub>24,25</sub>29,…,60~64)</li>
</ul>
<div class="sourceCode" id="cb535"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="#cb535-1" aria-hidden="true" tabindex="-1"></a>CM <span class="ot">&lt;-</span> CoalMiners[, , <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb535-2"><a href="#cb535-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(.<span class="sc">~</span>Age, <span class="at">data =</span> CM)</span></code></pre></div>
<pre><code>##       Breathlessness    B       NoB     
##       Wheeze            W  NoW    W  NoW
## Age                                     
## 25-29                  23    9  105 1654
## 30-34                  54   19  177 1863
## 35-39                 121   48  257 2357
## 40-44                 169   54  273 1778
## 45-49                 269   88  324 1712
## 50-54                 404  117  245 1324
## 55-59                 406  152  225  967
## 60-64                 372  106  132  526</code></pre>
<p>인덱싱을 통해 <code>CoalMiners</code>데이터의 필요한 부분만을
불러오고 <code>Structable</code>을 통해 여러개의 계층으로 구성돼있는
분할표를 한 눈에 살펴볼 수 있게 하였다.</p>
<div class="sourceCode" id="cb537"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fourfold</span>(CM, <span class="at">mfcol =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-221-1.png" width="960" /></p>
<p><code>fourfold</code>를 통해 대략적인 오즈비를 살펴본 결과, 거의 모든
변수의 수준에서 유의한 오즈비 차이가 있는 것을 확인할 수 있었다.</p>
<div class="sourceCode" id="cb538"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loddsratio</span>(CM)</span></code></pre></div>
<pre><code>## log odds ratios for Breathlessness and Wheeze by Age 
## 
##    25-29    30-34    35-39    40-44    45-49    50-54    55-59    60-64 
## 3.695261 3.398339 3.140658 3.014687 2.782049 2.926395 2.440571 2.637954</code></pre>
<p><code>CoalMiners</code>데이터의 로그 오즈비를 구한 결과는 위와같다.
나이가 증가할수록 로그오즈비가 점차 감소하는 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb540"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loddsratio</span>(CM,<span class="at">log =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##  odds ratios for Breathlessness and Wheeze by Age 
## 
##    25-29    30-34    35-39    40-44    45-49    50-54    55-59    60-64 
## 40.25608 29.91436 23.11908 20.38272 16.15208 18.66025 11.47959 13.98456</code></pre>
<p>나이에 따른 호흡 곤란 한계와 동일한 휘즈에 대한 오즈비를
구해보았다(<code>log = FALSE</code>옵션 지정).<br />
<code>fourfold</code>와 위의 결과를 통해 나이가 증가할수록 호흡 곤란
한계와 휘즈에 대한 오즈비가 점차 낮아지는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb542"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="#cb542-1" aria-hidden="true" tabindex="-1"></a>lor_CM <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(CM)</span>
<span id="cb542-2"><a href="#cb542-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lor_CM, <span class="at">bars =</span> <span class="cn">FALSE</span>, <span class="at">baseline =</span> <span class="cn">FALSE</span>, </span>
<span id="cb542-3"><a href="#cb542-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">whiskers =</span> .<span class="dv">2</span>)</span>
<span id="cb542-4"><a href="#cb542-4" aria-hidden="true" tabindex="-1"></a>lor_CM_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lor_CM)</span>
<span id="cb542-5"><a href="#cb542-5" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">60</span>,<span class="at">by=</span><span class="dv">5</span>) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb542-6"><a href="#cb542-6" aria-hidden="true" tabindex="-1"></a>lmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(LOR <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">2</span>),<span class="at">weights =</span> <span class="dv">1</span> <span class="sc">/</span> ASE<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb542-7"><a href="#cb542-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> lor_CM_df)</span>
<span id="cb542-8"><a href="#cb542-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.lines</span>(<span class="fu">seq_along</span>(age),<span class="fu">fitted</span>(lmod),</span>
<span id="cb542-9"><a href="#cb542-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">col=</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>),</span>
<span id="cb542-10"><a href="#cb542-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">default.units =</span> <span class="st">&quot;native&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-224-1.png" width="960" /></p>
<p>분석 목적이 승산비가 계층화 요인에 따라 어떻게 변하는지 이해하는
것이라면 승산비를 직접 표시하는 것이 좋다.<br />
나이에 따른 호흡 곤란 한계와 휘즈의 로그오즈비 변화를 그림으로
살펴보았다.<br />
분석 결과를 통해 확인하는 것 보다 로그오즈비의 감소추세를 더 쉽게 파악할
수 있다.</p>
<div class="sourceCode" id="cb543"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = LOR ~ poly(age, 2), data = lor_CM_df, weights = 1/ASE^2)
## 
## Weighted Residuals:
##        1        2        3        4        5        6        7        8 
##  0.16169  0.01619 -0.24431  0.06266 -0.49715  1.61148 -1.52279  0.58509 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    2.99531    0.07826  38.276 2.29e-07 ***
## poly(age, 2)1 -0.99773    0.25127  -3.971   0.0106 *  
## poly(age, 2)2  0.17682    0.21712   0.814   0.4525    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.058 on 5 degrees of freedom
## Multiple R-squared:  0.7816, Adjusted R-squared:  0.6942 
## F-statistic: 8.944 on 2 and 5 DF,  p-value: 0.0223</code></pre>
<p>로그오즈와 나이에 관련된 선형 모델에 대한 추세가 비선형인지 확인하기
위해 2차 모형을 사용한다.<br />
2차 모형의 유의확률은 0.4525로 유의수준 0.05보다 작으므로 귀무가설을
기각한다.<br />
따라서, 선형 모델의 추세는 비선형이 아닌 선형직선임을 확인할 수
있다.</p>
<hr />
</div>
</div>
</div>
<div id="sieve-diagrams" class="section level2">
<h2>4.5 Sieve diagrams</h2>
<p>two-way table 혹은 더 높은 분할표에서는 합리적인 귀무가설을 하에서
<strong>예상되는 빈도와 관찰된 빈도를 비교</strong>해서 보여줘야 한다고
제안한다.<br />
이를 위해 분할표를 그래픽으로 표현하는 몇 가지 방법은 행과 열 변수가
독립적일 때, 측정된 기대 빈도 <span
class="math inline">\(m_{ij}\)</span>가 행과 열 합계의 곲(총합으로
나눠진다.)이라는 사실에 기초한다.</p>
<p><span class="math display">\[
m_ij = { n_{i+}n_{+j} \over n_{++}}
\]</span></p>
<p>그런 다음 각 셀은 관찰된 빈도, 예상 빈도 또는 편차를 직사각형으로
나타낼 수 있다.<br />
직사각형의 시각적 속성을 사용하여 연관 패턴을 강조할 수 있다.</p>
<div id="two-way-tables" class="section level3">
<h3>4.5.1 Two-way tables</h3>
<div class="sourceCode" id="cb545"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="#cb545-1" aria-hidden="true" tabindex="-1"></a>haireye <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(HairEyeColor, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb545-2"><a href="#cb545-2" aria-hidden="true" tabindex="-1"></a>expected <span class="ot">=</span> <span class="fu">independence_table</span>(haireye)</span>
<span id="cb545-3"><a href="#cb545-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(expected,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##        Eye
## Hair    Brown  Blue Hazel Green
##   Black  40.1  39.2  17.0  11.7
##   Brown 106.3 103.9  44.9  30.9
##   Red    26.4  25.8  11.2   7.7
##   Blond  47.2  46.1  20.0  13.7</code></pre>
<p><code>independence_table</code>은 분할표의 각 셀에 대한 기대빈도를
쉽게 구할 수 있게 만들어주는 함수로, <code>vcd</code>패키지안에 포함돼
있다.<br />
- <code>independence_table(table)</code></p>
<ul>
<li>table: 기대빈도를 계산하고자 하는 분할표</li>
</ul>
<div class="sourceCode" id="cb547"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(expected,<span class="at">labeling=</span>labeling_values,  </span>
<span id="cb547-2"><a href="#cb547-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">gp_text =</span> <span class="fu">gpar</span>(<span class="at">fontface =</span> <span class="dv">2</span>),</span>
<span id="cb547-3"><a href="#cb547-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb547-4"><a href="#cb547-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Expected frequencies&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-227-1.png" width="960" /></p>
<p>위의 그림은 만약 머리 색과 눈의 색이 독립적인 경우의 빈도를 나타낸다.
즉, 기대빈도를 출력한다고 이해할 수 있다.<br />
관찰된 빈도를 표시하기 위해 셀을 교차 해석하면 아래와 같이 관찰빈도와
기대빈도를 암묵적으로 비교하는 데이터 표시를 할 수 있다.<br />
이 원리를 바탕으로 위와 같은 그림을 <strong>sieve diagram</strong>이라고
한다.<br />
각 직사각형의 면적은 항상 기대 빈도에 비례하지만 관찰 빈도는 각
직사각형의 정사각형의 수로 표시된다.</p>
<p><strong>Eye = Brown, Hair = Brown</strong>일때의 기대빈도가 106.3으로
가장 크고 <strong>Eye = Green, Hair = Red</strong>일때의 기대빈도가
7.7로 가장 작은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb548"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(haireye,<span class="at">labeling =</span> labeling_values,</span>
<span id="cb548-2"><a href="#cb548-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">gp_text =</span> <span class="fu">gpar</span>(<span class="at">fontface =</span> <span class="dv">2</span>),</span>
<span id="cb548-3"><a href="#cb548-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb548-4"><a href="#cb548-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Observed frequencies&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-228-1.png" width="960" /></p>
<p>관찰 빈도와 기대 빈도의 차이는 음영 밀도의 변화로 나타난다.
독립성으로부터 양수 및 음수 편차의 패턴은 음수 편차인 경우 빨간색,
양수인 경우 파란색을 사용하여 더 쉽게 확인할 수 있다.<br />
색상과 음영을 통해 위의 그림은 <strong>Hair = Blond, Eye =
Blue</strong>, <strong>Hair = Brown, Eye = Brown</strong>인 사람들의
셀은 파란색을 가지므로 관찰빈도가 기대빈도보다 높은 것을 확인할 수
있다.<br />
<strong>Hair = Brown, Eye = Blue</strong>, <strong>Hair = Brown, Eye =
Green</strong>인 사람들의 셀은 빨간색을 가지므로 관찰빈도가 기대빈도보다
낮은 것임을 확인할 수 있다.</p>
<p><em>Example 4.14: Visual acuity</em></p>
<div class="sourceCode" id="cb549"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;VisualAcuity&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>VisualAcuity</code>데이터는 30-39세인 남성 3,242명과 여성
7,477명의 좌측 우측 시력을 나타낸 데이터로 <code>vcd</code>패키지 안에
포함돼 있다.</p>
<ul>
<li>Freq: 빈도 (Discrete variable)</li>
<li>right: 우측시력 (Factor variable - 1,2,3,4)</li>
<li>left: 좌측시력 (Factor variable - 1,2,3,4)</li>
<li>gender: 성별 (Factor variable - female, male)</li>
</ul>
<div class="sourceCode" id="cb550"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="#cb550-1" aria-hidden="true" tabindex="-1"></a>VA <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> right <span class="sc">+</span> left <span class="sc">+</span> gender, <span class="at">data =</span> VisualAcuity)</span>
<span id="cb550-2"><a href="#cb550-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(VA)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;high&quot;</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="st">&quot;low&quot;</span>))</span>
<span id="cb550-3"><a href="#cb550-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(VA))[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;Right&quot;</span>,<span class="st">&quot;Left&quot;</span>),<span class="st">&quot;eye grade&quot;</span>)</span>
<span id="cb550-4"><a href="#cb550-4" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(<span class="fu">aperm</span>(VA))</span></code></pre></div>
<pre><code>##                        Left eye grade high    2    3  low
## gender Right eye grade                                   
## male   high                            821  112   85   35
##        2                               116  494  145   27
##        3                                72  151  583   87
##        low                              43   34  106  331
## female high                           1520  266  124   66
##        2                               234 1512  432   78
##        3                               117  362 1772  205
##        low                              36   82  179  492</code></pre>
<p><code>VisualAcuity</code>데이터를 <code>xtabs</code>함수를 이용하여
성별을 계층으로하며, 빈도에따른 좌측시력,우측시력에 대한 교차표형태로
만들어 주었다.<br />
또한, 시력이 1인경우를 <strong>high</strong>, 시력이 4인 경우를
<strong>low</strong>로 재코딩하였고 <code>structable</code>를 사용하여
교차표를 쉽게 탐색할 수 있도록 하였다.</p>
<div class="sourceCode" id="cb552"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="#cb552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(VA[, , <span class="st">&quot;female&quot;</span>], <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-231-1.png" width="960" /></p>
<p><code>VisualAcuity</code>데이터 중, 성별이 여성인 경우의
<code>sieve diagram</code>을 그려보았다.<br />
대각선셀은 잔차의 색깔이 파란색이므로 양의 잔차에 해당되는데, 이는
여성의 경우 <strong>왼쪽눈과 오른쪽눈의 시력이 같은 경향이
많다</strong>는 것을 보여주며, 독립성이 강하게 결여된다는 증거이기도
하다.<br />
직사각형의 면적은 빈도에 비례하므로, <strong>left = 3, right =
3</strong>인 여성들의 면적이 가장 크므로 가장 많은 빈도를 갖고있음을 알
수 있다.</p>
</div>
<div id="larger-tables-the-strucplot-framework" class="section level3">
<h3>4.5.2 Larger tables: The strucplot framework</h3>
<div class="sourceCode" id="cb553"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(Freq <span class="sc">~</span> right <span class="sc">+</span> left, <span class="at">data =</span> VisualAcuity, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-232-1.png" width="960" /></p>
<p><code>sieve</code>함수는 다른 시각화 함수들과 같이 <strong>formula
method</strong>를 통해서 원하는 변수들로 시각화를 진행할 수 있다.<br />
위의 예시는 빈도에 따른 왼쪽 및 오른쪽 눈의 시력을 통해 얻어진 교차표에
대한 <code>sieve diagram</code>이다.<br />
왼쪽 눈의 시력과 오른쪽 눈의 시력이 같은 사람들의 셀이 파란색이므로
관찰빈도가 기대빈도 보다 높음을 확인할 수 있고 이를 통해 한쪽 눈의
시력이 같으면 다른 쪽 눈의 시력이 같은 경향이 있음을 확인할 수 있다.</p>
<div class="sourceCode" id="cb554"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(Freq <span class="sc">~</span> right <span class="sc">+</span> left <span class="sc">|</span> gender, <span class="at">data =</span> VisualAcuity,</span>
<span id="cb554-2"><a href="#cb554-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">set_varnames =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="st">&quot;Right eye grade&quot;</span>, <span class="at">left =</span> <span class="st">&quot;Left eye grade&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-233-1.png" width="960" /></p>
<p><code>| 표현</code>을 이용하여 원하는 변수를 계층으로 하는
<code>sieve diagram</code>그림을 볼 수도 있다. 위의 그림은 성별에 따라
구분한 <code>sieve diagram</code>이다.<br />
남성과 여성에 상관없이 양쪽눈의 시력이 같은 사람들이 기대빈도 보다 많이
관찰된 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb555"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cotabplot</span>(VA, <span class="at">cond =</span> <span class="st">&quot;gender&quot;</span>, <span class="at">panel =</span> cotab_sieve,</span>
<span id="cb555-2"><a href="#cb555-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-234-1.png" width="960" /></p>
<p><code>cotabplot</code>은 분할표가 주어졌을 때, 분할표의
<strong>conditional plot</strong>을 시각화하기 위한 함수로
<code>vcd</code>패키지안에 포함 돼 있다.<br />
- <code>cotabplot(table,cond,panel,shade)</code></p>
<ul>
<li>table: <strong>conditional plot</strong>을 그리고자 하는 분할표</li>
<li>cond: 계층변수</li>
<li>panel: <strong>conditional plot</strong>의 유형</li>
<li>shade: 잔차에 따른 음영 표시 여부</li>
</ul>
<p>위의 그림은 <code>cotabplot</code>을 사용하여 성별에 따른
<code>sieve diagram</code>을 그린 결과이다.<br />
<code>cotabplot</code>은 <code>sieve</code>함수와 달리 계층에 따라
panel을 구분해주기 때문에 분할된 시각화 결과를 보고자 할때, 유용하게
사용할 수 있다.</p>
<p><em>Example 4.15: Berkeley admissions</em></p>
<div class="sourceCode" id="cb556"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="#cb556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(UCBAdmissions, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">condvar =</span> <span class="st">&#39;Gender&#39;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-235-1.png" width="960" /></p>
<p>위의 그림은 성별에 의해 조건화된 부서와 부서의 합격여부 관계에 대한
<code>sieve diagram</code>을 보여준다.<br />
전체적으로 여성보다 남성 지원자가 더 많았으며, 남성과 여성에 대해
파랑색(관찰빈도 &gt; 기대빈도) 패턴이 비슷한 것을 알 수 있다.<br />
남성과 여성 모두 A,B부서에 대한 합격 관찰빈도는 기대빈도 보다 높고,
E,F부서에 대한 불합격 관찰빈도가 기대빈도보다 높은 것을 확인할 수
있다.<br />
이를 통해, A,B부서는 전반적으로 합격률이 높지만 E,F부서는 합격률이 낮은
것을 알 수 있다.</p>
<div class="sourceCode" id="cb557"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="#cb557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(<span class="sc">~</span>Dept <span class="sc">+</span> Admit <span class="sc">+</span> Gender, <span class="at">data =</span> UCBAdmissions,</span>
<span id="cb557-2"><a href="#cb557-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">labeling =</span> labeling_values,</span>
<span id="cb557-3"><a href="#cb557-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">gp_text =</span> <span class="fu">gpar</span>(<span class="at">fontface =</span> <span class="dv">2</span>),</span>
<span id="cb557-4"><a href="#cb557-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">abbreviate_labs =</span> <span class="fu">c</span>(<span class="at">Gender =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-236-1.png" width="960" /></p>
<p>위의 그림은 <code>Dept</code>를 첫 번째 분할 변수로 만 든 후, 성별에
따른 합격여부를 <code>sieve diagram</code>그림으로 나타내었다.<br />
위의 formula는 세 변수를 모두 상호 독립을 가정하는데, 이럴 경우 여성의
A,B부서에 대한 합격요인이 음의 잔차가 되는 것을 확인할 수 있다. 이를
통해, 세 변수에 대해서 상호독립을 가정하는 것은 적절하지 않음을 확인할
수 있다.<br />
<code>labeling</code> 인수는 각 사각형의 셀 빈도를 표현하는데 사용되고,
<code>gp_text</code>는 굵은 글꼴로 만들어주며,
<code>abbreviate_labs</code>는 오버플롯을 피하기 위해 사용한다.</p>
<div class="sourceCode" id="cb558"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cotabplot</span>(UCBAdmissions, <span class="at">cond =</span> <span class="st">&quot;Gender&quot;</span>,</span>
<span id="cb558-2"><a href="#cb558-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel =</span> cotab_sieve,</span>
<span id="cb558-3"><a href="#cb558-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-237-1.png" width="960" /></p>
<div class="sourceCode" id="cb559"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cotabplot</span>(UCBAdmissions, <span class="at">cond =</span> <span class="st">&quot;Dept&quot;</span>,</span>
<span id="cb559-2"><a href="#cb559-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel =</span> cotab_sieve,</span>
<span id="cb559-3"><a href="#cb559-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">labeling =</span> labeling_values,</span>
<span id="cb559-4"><a href="#cb559-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">gp_text =</span> <span class="fu">gpar</span>(<span class="at">fontface=</span>  <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-237-2.png" width="960" /></p>
<p><code>UCBAdmissions</code>의 데이터를 <code>cotabplot</code>을 통해
원하는 계층 변수에 따라 패널을 나누고 그에 따른
<code>sieve diagram</code>을 살펴볼 수 있다.</p>
<div class="sourceCode" id="cb560"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="#cb560-1" aria-hidden="true" tabindex="-1"></a>UCB2 <span class="ot">&lt;-</span> <span class="fu">aperm</span>(UCBAdmissions, <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb560-2"><a href="#cb560-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sieve</span>(UCB2, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">expected =</span> <span class="sc">~</span> Admit <span class="sc">*</span> Gender <span class="sc">+</span> Dept, <span class="at">split_vertical =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-238-1.png" width="960" /></p>
<p>2차원 이상의 표의 경우, 독립성에 대한 다양한 모델이 있다.<br />
<code>sieve</code>함수의 <code>expected</code>옵션을 이용하여 원하는
형태의 모형을 적합시킬 수 있다.<br />
위의 코드는 <code>~Admit * Gender + dept</code>모형을 적합시켜 부서가
성별과 합격여부에 대해서 공동적으로 독립이라고 가정한다.</p>
<p>위의 결과 또한 여성의 A,B 부서에대한 합격 빈도가 음의 잔차를 가지므로
기존의 진행했던 분석 결과와 달라지게 된다. 따라서, 부서가 성별과
합격여부에 대해서 공동적으로 독립이 아닌것을 알 수 있다.</p>
<hr />
</div>
</div>
<div id="association-plots" class="section level2">
<h2>4.6 Association plots</h2>
<p><strong>sieve diagram</strong>에서 사각형은 기대 빈도를 나타내며
독립성의 편차는 색상과 음영 밀도로 표시된다.</p>
<p><strong>association plot</strong>은 고차원 분할표에 지정된 독립성
모형으로부터 편차를 나타내는데, <strong>sieve diagram</strong>과 달리
편차를 사각형에 제시한다. 각 상자의 면적은 (관측 - 기대)빈도에 비례, 즉
잔차에 비례한다.<br />
셀 <span class="math inline">\(i,j\)</span>에서 <span
class="math inline">\(Personx X^2\)</span>에 대한 signed contribution은
다음과 같다.</p>
<p><span class="math display">\[
r_{ij} ={ n_{ij} - m_{ij} \over \sqrt{(m_{ij})}}
\]</span></p>
<p>R에서 <code>association plot</code>은 <code>assoc</code>를 통해
시각화 할 수 있으며, <code>vcd</code>패키지 안에 포함돼있다.<br />
- <code>assoc(table)</code></p>
<ul>
<li>table: 편차를 살펴볼 분할표 (상황에 따라 Formula도 가능하다. )</li>
</ul>
<div class="sourceCode" id="cb561"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(<span class="sc">~</span> Hair <span class="sc">+</span> Eye, <span class="at">data =</span> HairEyeColor, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-239-1.png" width="960" /></p>
<p>위의 그림은 머리카락 색상과 눈에 대한 데이터의 연관도를 보여준다.
<code>sieve diagrm</code>과 다르게 직사각형의 면적이 편차에 따라
결정되는 것을 확인할 수 있다.<br />
이 그래프를 구성하는 각 직사각형은 피어슨의 잔차 값에 따라 음영
처리된다.<br />
<strong>Hair = Brown, Eye = Brown</strong>, <strong>Hair = Blond, Eye =
Blue</strong>일 때, 면적이 큰 파랑색 사각형으로 양의 잔차를 가지고
<strong>Hair = Blond, Eye = Brown</strong>일 때, 면적이 큰 음의 잔차
사각형을 갖고 있는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb562"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assoc</span>(HairEyeColor, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-240-1.png" width="960" /></p>
<p>위의 그림은 기존의 머리색깔과 눈색깔의 연관성에 더해 성별을
계층변수로 추가한 <code>association plot</code>이다.<br />
성별에 관계없이, <strong>Hair = Black, Eye = Brown</strong>일 때,
공통적으로 양의 잔차를 가지고 <strong>Hair = Blond, Eye =
Brown</strong>일 때, 공통적으로 음의 잔차를 가지는 것을 확인할 수
있다.</p>
<hr />
</div>
<div id="observer-agreement" class="section level2">
<h2>4.7 Observer agreement</h2>
<p>행 변수와 열 변수가 서로 다른 관찰자의 동일한 주체 또는 개체 등급을
나타내는 경우 관심은 단순한 연관성 보다 <strong>observer
agreement(관찰자의 동의)</strong>가 중요하다.<br />
이 경우, 합의의 측정 및 시험은 주관적인 분류 또는 평가 절차의 신뢰성을
평가하는 방법을 제공한다.</p>
<p>예를 들어, 두 명 이상의 심리학자는 (a)정상, (b)경미한 손상,
(c)심각하게 손상된 범주의 규모로 환자를 분류할 수 있다. 이러한 예시에서
알 수 있듯이 등급 범주는 종종 정렬되지만, 항상 정렬되는 것은
아니다.<br />
대부분의 경우, 동일한 범주가 두 평가자에 의해 사용 되므르 분할표는
정사각형이며, 대각 셀의 항목은 평가자가 동일하는 경우이다.</p>
<p><em>Example 4.16: Sex is fun</em></p>
<div class="sourceCode" id="cb563"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;SexualFun&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb563-2"><a href="#cb563-2" aria-hidden="true" tabindex="-1"></a>SexualFun</span></code></pre></div>
<pre><code>##               Wife
## Husband        Never Fun Fairly Often Very Often Always fun
##   Never Fun            7            7          2          3
##   Fairly Often         2            8          3          7
##   Very Often           1            5          4          9
##   Always fun           2            8          9         14</code></pre>
<p><code>SexualFun</code>데이터는 설문지 항목에 대한 부부의 반응을
요약한 것으로 서로의 성관계에 대한 만족도를 제공하는 데이터이며,
<code>vcd</code>패키지 안에 포함돼있다.</p>
<ul>
<li>Husband: 남편의 만족도 (Factor variable - Never, Fairly often, very
often, Always)</li>
<li>Wife: 부인의 만족도 (Factor variable - Never, Fairly often, very
often, Always)</li>
</ul>
<p>각 행에서 대각선 항목이 항상 큰 것은 아니지만, 파트너 중 하나가
<strong>거의 항상</strong>이라고 응답할 때 더 자주 동의하는 경향이 있는
것처럼 보인다.</p>
<p><em>Example 4.17: Diagnosis of MS patients</em></p>
<p><code>MSPatients</code>데이터는 다발성 경화증 환자 진단에 대한
위니펙과 뉴올리언스의 두 명의 신경학자가 평가한 데이터로
<code>vcd</code>패키지 안에 포함돼있다.</p>
<ul>
<li>New Orleans Neurologist: 뉴올리언스 신경학자가 평가한 환자의 상태
(Factor variable Certain, Probable, Possible, Doubtful)</li>
<li>Winnipeg Neurologist: 위니펙 신경학자가 평가한 환자의 상태 (Factor
variable - Certain, Probable, Possible, Doubtful)</li>
<li>patients: 환자의 소속 주 (Factor variable - Winnipeg, New
Orleans)</li>
</ul>
<div class="sourceCode" id="cb565"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="#cb565-1" aria-hidden="true" tabindex="-1"></a>MSPatients[, , <span class="st">&quot;Winnipeg&quot;</span>]</span></code></pre></div>
<pre><code>##                        Winnipeg Neurologist
## New Orleans Neurologist Certain Probable Possible Doubtful
##                Certain       38        5        0        1
##                Probable      33       11        3        0
##                Possible      10       14        5        6
##                Doubtful       3        7        3       10</code></pre>
<div class="sourceCode" id="cb567"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="#cb567-1" aria-hidden="true" tabindex="-1"></a>MSPatients[, , <span class="st">&quot;New Orleans&quot;</span>]</span></code></pre></div>
<pre><code>##                        Winnipeg Neurologist
## New Orleans Neurologist Certain Probable Possible Doubtful
##                Certain        5        3        0        0
##                Probable       3       11        4        0
##                Possible       2       13        3        4
##                Doubtful       1        2        4       14</code></pre>
<div class="sourceCode" id="cb569"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(MSPatients, <span class="dv">3</span>, sum)</span></code></pre></div>
<pre><code>##    Winnipeg New Orleans 
##         149          69</code></pre>
<p><code>MSPatients</code>데이터는 4x4x2표로 구성돼 있으며, 환자가
소속된 주를 계층으로 사용했다.<br />
winnipeg의 환자의 수는 149명, New Orleans의 환자의 수는 69명인 것을
확인할 수 있다.</p>
<div id="measuring-agreement" class="section level3">
<h3>4.7.1 Measuring agreement</h3>
<p>동의의 강도를 평가할 때 우리는 일반적으로 연관성의 강도를 측정할 때
보다 더 엄격한 기준을 가지고 있다. 이는 관찰자 등급은 강한 합의 없이
강하게 연관될 수 있기 때문이다. 예를 들어, 한 평가자가 더 엄격한 기준을
사용할 수 있으므로 다른 평가자보다 등급이 낮을 수 있다.<br />
따라서, 여러명의 평가자를 고려할 때에는 특정 평가자의 평가를 통해 기준이
한 쪽으로 쏠리지 않도록 공평한 평가가 이루어지게 하는 것이 중요하다.</p>
<div id="computing-kappa" class="section level4">
<h4>4.7.1.4 Computing Kappa</h4>
<p>코헨의 <strong>Kappa</strong>는 두 관찰자의 등급이 독립적일 경우
관측된 합의와 우연히 예상되는 합의를 비교하는 일반적으로 사용되는 합의
척도이다.<br />
<span class="math inline">\(p_{ij}\)</span>가 무작위로 선택된 피실험자가
i에서 첫 번째 등급으로 평가될 확률일 경우 관찰자와 다른 범주 j에서
관찰된 합은 대각선 엔트리의 합이다. <span class="math inline">\(P_0 =
\sum_i(p_{ii})\)</span> 등급이 독립적이라면, 합의 확률은 <span
class="math inline">\(P_C = \sum_i(p_i+p+i)\)</span>이다.<br />
코헨의 k는 실제 합치도와 우연 합치도의 차이 <span
class="math inline">\(P_0 - P_C\)</span>를 이 차이가 얻을 수 있는
최대값에 대한 비율이다.</p>
<p><span class="math display">\[
k = {{P_0 - P_c} \over {1 - P_c}}
\]</span></p>
<p>R에서 <code>Kappa</code>는 <code>vcd</code>패키지를 통해 사용할 수
있다.<br />
- <code>Kappa(table)</code></p>
<ul>
<li>table: Kappa 함수를 적용할 교차표</li>
</ul>
<p>또한, Kappa의 <strong>가설검정</strong>은 다음과 같이 진행할 수
있다.</p>
<ul>
<li>H0: 평가자의 등급은 우연에 기인한다.</li>
<li>H1: 평가자의 등급은 우연에 기인하지 않는다.</li>
</ul>
<div class="sourceCode" id="cb571"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Kappa</span>(SexualFun)</span></code></pre></div>
<pre><code>##             value     ASE     z Pr(&gt;|z|)
## Unweighted 0.1293 0.06860 1.885 0.059387
## Weighted   0.2374 0.07832 3.031 0.002437</code></pre>
<p><code>SexualFun</code>변수에 <code>Kappa</code>함수를 사용하여 코헨의
<strong>Kappa</strong>를 구해보았다.<br />
가중치를 주지않는 경우에는 <strong>Kappa = 0.1293</strong>, 가중치를
주는 경우에는 <strong>Kappa = 0.2374</strong>로 가중치를 주었을 때, 더
큰 유사성을 보이는 것을 확인하였다.</p>
<p>또한, 가중치를 주지않는 경우의 유의확률은 유의수준 0.05보다 크므로
귀무가설을 기각하지 못한다. 따라서, 평가자의 등급평가는 우연이라고 할 수
있다.<br />
가중치를 주는 경우의 유의확률은 유의수준 0.05보다 작으므로 귀무가설을
기각한다. 따라서, 평가자의 등급은 우연에 기인하지 않는다고 할 수
있다.</p>
<div class="sourceCode" id="cb573"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(<span class="fu">Kappa</span>(SexualFun))</span></code></pre></div>
<pre><code>##             
## Kappa                 lwr       upr
##   Unweighted -0.005120399 0.2637809
##   Weighted    0.083883432 0.3908778</code></pre>
<div class="sourceCode" id="cb575"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">Kappa</span>(SexualFun))</span></code></pre></div>
<pre><code>##             value     ASE     z Pr(&gt;|z|)
## Unweighted 0.1293 0.06860 1.885 0.059387
## Weighted   0.2374 0.07832 3.031 0.002437
## 
## Weights:
##           [,1]      [,2]      [,3]      [,4]
## [1,] 1.0000000 0.6666667 0.3333333 0.0000000
## [2,] 0.6666667 1.0000000 0.6666667 0.3333333
## [3,] 0.3333333 0.6666667 1.0000000 0.6666667
## [4,] 0.0000000 0.3333333 0.6666667 1.0000000</code></pre>
<p><code>confint</code>함수를 통해 kappa의 신뢰구간을 얻을 수
있다.<br />
가중치를 주지 않을 경우의 <strong>Kappa</strong> 95% 신뢰구간은
(-0.005,0.263) 이며, 가중치를 주는 경우의 95% 신뢰구간은 (0.084,
0.391)이다.</p>
<p><code>summary</code>함수를 통해 kappa의 통계량 및 가설검정 뿐만아니라
가중치 정보 또한 확인할 수 있다.</p>
</div>
</div>
<div id="observer-agreement-chart" class="section level3">
<h3>4.7.2 Observer agreement chart</h3>
<p>Bangdiwala가 제안한 <strong>agreement chart</strong>는 분할표에서
합의 강도와 간단한 그래픽 표현과 직관적인 해석을 통해 합의 강도의 대체
척도를 제공한다.<br />
더욱 중요한 것은, 합의가 완벽하지 않을 때 합의 불일치의 패턴을
보여준다.</p>
<div id="construction-of-the-baisc-plot" class="section level4">
<h4>4.7.2.1 Construction of the baisc plot</h4>
<p>k x k 분할표가 주어졌을 때, <strong>agreement chart</strong>는 n x n
정사각형으로 생성되며, 여기서 <span class="math inline">\(n =
n_{++}\)</span>는 총 표본 크기이다.<br />
각각의 크기가 <span class="math inline">\(n_{ii}\)</span>x<span
class="math inline">\(n_{ii}\)</span> 검은색 사각형은 관찰된 합의를
보여준다.<br />
완전한 합의일 경우, 주변 총합에 의해 결정된 k개의 직사각형은 모든
정사각형이며, 음영 정사각형으로 완전히 채워지면서 B=1이다.</p>
<p>R에서 <code>agreement chart</code>는 <code>vcd</code>패키지의
<code>agreementplot</code>을 사용하여 시각화할 수 있다.<br />
- <code>agreementplot(table, weights)</code></p>
<ul>
<li>table: agreement chart를 그릴 교차표</li>
<li>weights: 가중치 설정 (default는 자동으로 가중치를 만들어주고 weights
= 1로 설정하면 가중치가 없는 것이다.)</li>
</ul>
<div class="sourceCode" id="cb577"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">agreementplot</span>(SexualFun, <span class="at">main =</span> <span class="st">&quot;Unweighted&quot;</span>, <span class="at">weights =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-247-1.png" width="960" /></p>
<div class="sourceCode" id="cb578"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="#cb578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">agreementplot</span>(SexualFun, <span class="at">main =</span> <span class="st">&quot;Weighted&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-247-2.png" width="960" /></p>
<p>위의 그림은 가중치를 고려하지 않는 경우의
<code>agreementplot</code>이며, 아래 그림의 경우 가중치를 고려하는
경우의 <code>agreementplot</code>이다.<br />
검은색 사각형의 경우, 가중치를 고려하지 않는 경우의 일치도를 보여주며
회색 사각형의 경우 가중치를 고려하는 경우의 일치도를 보여준다.</p>
<p>가중치를 고려한 경우의 면적이 가중치를 고려하지 않은 경우보다 크며,
각 셀의 빈도 사각형을 고려했을 때에도 더 일치하는 것을 보여준다.<br />
따라서, 가중치를 고려한 경우의 평가자간 등급의 합의가 조금 더 일치하는
것을 확인할 수 있다.</p>
</div>
<div id="partial-agreement" class="section level4">
<h4>4.7.2.2 Partial agreement</h4>
<div class="sourceCode" id="cb579"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="#cb579-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">agreementplot</span>(SexualFun)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-248-1.png" width="960" /></p>
<div class="sourceCode" id="cb580"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(B)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##          Bangdiwala Bangdiwala_Weighted 
##           0.1464624           0.4981723</code></pre>
<p>일치도 추정값인 <code>B</code>또한 가중치를 적용하지 않았을 때에는
0.146이지만, 가중치를 적용했을 때에는 0.498로 훨씬 더 일치도가 높은 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb582"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="#cb582-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Mammograms&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span></code></pre></div>
<p><code>Mammograms</code>는 두 명의 독자가 평가한 110개의 유방조영술에
대한 데이터로 테이블의 형태이며, <code>vcdExtra</code>패키지 안에
포함돼있다.</p>
<ul>
<li>Reader: 평가자인 독자 (Factor variable - Reader1, Reader2)</li>
<li>Grade: 평가점수 (Factor variable -
Absent,Minimal,Moderate,Severe)</li>
</ul>
<div class="sourceCode" id="cb583"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="#cb583-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">agreementplot</span>(Mammograms, <span class="at">main =</span> <span class="st">&quot;Mammogram ratings&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-250-1.png" width="960" /></p>
<p><code>Mammograms</code> 데이터에 대한 <code>agreement plot</code>을
그려보았다. 검은색 사각형과 회색 사각형의 면적을 볼때, 앞서 살펴본
데이터보다 평가자간의 등급 일치도가 높은 것을 알 수 있다.<br />
또한, 두 평가자는 <strong>Absent, Severe</strong>와 같은 극단적인 범주에
더 자주 동의하는 것처럼 보인다.</p>
<div class="sourceCode" id="cb584"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="#cb584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(B) [<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##          Bangdiwala Bangdiwala_Weighted 
##           0.4272076           0.8366481</code></pre>
<p>일치도값인 B를 확인해본 결과, 가중치를 주지 않을경우에는 0.422이지만
가중치를 적용한 경우에는 0.836으로 매우 높은 값을 가지고 있는 것을
확인할 수 있다.<br />
따라서, <code>Mammograms</code>데이터는 평가자간 일치도가 상당히 높은
데이터임을 알 수 있다.</p>
</div>
</div>
<div id="observer-bias-in-agreement" class="section level3">
<h3>4.7.3 Observer bias in agreement</h3>
<p>순서 척도를 사용하면 인접한 범주 사이의 경계에 대해 더 엄격한
임계값을 사용하기 때문에 한 관찰자가 다른 관찰자보다 더 높거나 낮은
범주로 개체를 일관되게 할당하는 위험이 발생할 수 있다.<br />
<strong>관찰자 합도표는</strong> 어두운 사각형과 대각선의 관계를 통해
이를 직접 보여준다. 주변 총량이 동일하면 사각형은 대각선을 따라
나간다.</p>
<p><em>Example 4.19: Diagnosis of MS patients</em></p>
<div class="sourceCode" id="cb586"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cotabplot</span>(MSPatients, <span class="at">cond =</span> <span class="st">&quot;Patients&quot;</span>,</span>
<span id="cb586-2"><a href="#cb586-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel =</span> cotab_agreementplot,</span>
<span id="cb586-3"><a href="#cb586-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">text_gp =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">18</span>), <span class="at">xlab_rot =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-252-1.png" width="960" /></p>
<div class="sourceCode" id="cb587"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="#cb587-1" aria-hidden="true" tabindex="-1"></a>agr1 <span class="ot">&lt;-</span> <span class="fu">agreementplot</span>(MSPatients[, , <span class="st">&quot;Winnipeg&quot;</span>])</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-253-1.png" width="960" /></p>
<div class="sourceCode" id="cb588"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="#cb588-1" aria-hidden="true" tabindex="-1"></a>agr2 <span class="ot">&lt;-</span> <span class="fu">agreementplot</span>(MSPatients[, , <span class="st">&quot;New Orleans&quot;</span>])</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-253-2.png" width="960" /></p>
<div class="sourceCode" id="cb589"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="at">Winning =</span> <span class="fu">unlist</span>(agr1),</span>
<span id="cb589-2"><a href="#cb589-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">NewOrleans =</span> <span class="fu">unlist</span>(agr2))[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>##            Bangdiwala Bangdiwala_Weighted
## Winning     0.2720979           0.7380812
## NewOrleans  0.2853659           0.8223126</code></pre>
<p>두 환자 그룹의 경우, 두 중간 범주의 직사각형은 대각선 아래에 있음을
알 수 있다. 이것은 <strong>New Orleans 신경학자, Winnipeg
신경학자</strong>가 환자들을 더 심각한 진단 범주로 분류하는 경향이
있다는 것을 보여준다.<br />
대각선에서의 이탈은 <strong>Winnipeg 환자들에게 더 크게</strong>
나타나는 것을 볼 수 있으며, <strong>New Orleans 환자에게는 Winnipeg
환자에 비해 더 심각한 범주를 적게 사용하여 대각선 이탈이 더 낮은
것</strong>을 확인할 수 있다.</p>
<p><strong>Winnipeg, New Orleans</strong>환자 모두 가중치를 적욯하지
않았을 때 보다, 가중치를 적용한 경우의 일치도가 훨씬 높게 나타나는 것을
알 수 있다.</p>
</div>
</div>
<div id="trilinear-plost" class="section level2">
<h2>4.8 Trilinear plost</h2>
<p><strong>삼선형 그림(Trilinear plot)</strong>은 3열 분할표 또는 상대
비율을 표시할 때, 세 변수에 대해 특수화된 방법이다.<br />
예를 들어, 개인은 세 개의 범주 중 하나에 배정되거나, 국회의원 선거에서
세 정당 간의 투표 분열을 볼 수 있다. 즉, 이 표시는 빈도와 비율에 모두
유용하다.</p>
<p><strong>Trilinear plot</strong>은 관측치를 각 열의 상대 비율에
해당하는 좌표를 정삼각형 안에 있는 점으로 표시한다.<br />
세 개의 꼭짓점은 세 개의 열 중 하나에 100%가 발생할 때 세 개의 극단을
나타낸다.<br />
정확한 중심에 있는 한 점은 모든 3개의 열에서 1/3의 동일한 비율을
나타낸다. 실제로 각 점은 삼각형의 무게 중심을 나타내며 좌표는 해당
정점에 배치된 가중치를 나타낸다.</p>
<div class="sourceCode" id="cb591"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="#cb591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtern)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;ggtern&#39;:
##   method           from   
##   grid.draw.ggplot ggplot2
##   plot.ggplot      ggplot2
##   print.ggplot     ggplot2</code></pre>
<pre><code>## --
## Remember to cite, run citation(package = &#39;ggtern&#39;) for further info.
## --</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;ggtern&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:ggplot2&#39;:
## 
##     aes, annotate, ggplot, ggplot_build, ggplot_gtable, ggplotGrob,
##     ggsave, layer_data, theme_bw, theme_classic, theme_dark,
##     theme_gray, theme_light, theme_linedraw, theme_minimal, theme_void</code></pre>
<p><code>ggtern</code>패키지는 <code>ggplot2</code>의 기능을 확장하여
<code>ggplot2</code>에서는 사용할 수 없는 몇 가지의 새로운 플랏 형태를
제공하며, 특히, <strong>삼항식 다이어그램</strong>을 시각화할 수 있는
기능을 제공한다.</p>
<p>또한, <strong>Trilinear plot</strong>은 R에서
<code>ggtern</code>패키지에 포함된 <code>ggtern</code>함수를 통해 그릴
수 있다.<br />
- <code>ggtern(data, aes(x,y,z,colour))</code></p>
<ul>
<li>data: Trilinear plot을 시각화함에 있어 사용되는 데이터</li>
<li>x: x축에 사용되는 변수</li>
<li>y: y축에 사용되는 변수</li>
<li>z: z축에 사용되는 변수</li>
<li>colour: 그룹을 구분하는데 사용되는 변수</li>
</ul>
<div class="sourceCode" id="cb596"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="#cb596-1" aria-hidden="true" tabindex="-1"></a>DATA <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb596-2"><a href="#cb596-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">20</span>,<span class="dv">10</span>),</span>
<span id="cb596-3"><a href="#cb596-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">60</span>,<span class="dv">10</span>),</span>
<span id="cb596-4"><a href="#cb596-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">20</span>,<span class="dv">80</span>),</span>
<span id="cb596-5"><a href="#cb596-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>))</span>
<span id="cb596-6"><a href="#cb596-6" aria-hidden="true" tabindex="-1"></a>aesthetic_mapping <span class="ot">&lt;-</span> <span class="fu">aes</span>(<span class="at">x =</span> C, <span class="at">y =</span> A, <span class="at">z=</span> B, <span class="at">colour =</span> id)</span>
<span id="cb596-7"><a href="#cb596-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtern</span>(<span class="at">data =</span> DATA, <span class="at">mapping =</span> aesthetic_mapping) <span class="sc">+</span></span>
<span id="cb596-8"><a href="#cb596-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb596-9"><a href="#cb596-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_rgbw</span>()</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-255-1.png" width="960" /></p>
<p>위의 그림은 단순성을 위해 필요한 몇몇의 모수를 추가하지 않았다.<br />
각 꼭짓점 레이블이 지정된 변수의 100%에 해당하며 이 변수의 백분율은
중간점까지 선형적으로 감소한다.<br />
그리드 선은 각 축을 따라 백분율을 나타낸다.</p>
<p>빨간색 점은 <strong>A data(40,30,30)</strong>의 점을 나타내며, 초록색
점은 <strong>B data(30,60,10)</strong>, 파란색 점은 <strong>C
data(10,10,80)</strong>의 좌표를 나타낸다.</p>
<p><em>Example 4.20: Lifeboats on the Titanic</em></p>
<div class="sourceCode" id="cb597"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Lifeboats&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb597-2"><a href="#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Lifeboats)</span></code></pre></div>
<pre><code>##                launch side boat crew men women total cap
## 1 1912-04-15 00:45:00 Port    7    3   4    20    27  65
## 2 1912-04-15 00:55:00 Port    5    5   6    30    41  65
## 3 1912-04-15 01:00:00 Port    3   15  10    25    50  65
## 4 1912-04-15 01:10:00 Port    1    7   3     2    12  40
## 5 1912-04-15 01:20:00 Port    9    8   6    42    56  65
## 6 1912-04-15 01:25:00 Port   11    9   1    60    70  65</code></pre>
<p><code>Lifeboats</code>데이터는 타이나틱호 침몰 전에 진수된 구명보트
20척 중 18척에 대한 데이터로, <code>vcd</code>패키지 안에 포함돼
있다.</p>
<ul>
<li>launch: 탈출 시간 (POSIXt)</li>
<li>side: 봍트의 사이드 (Factor variable - Port, Startboard)</li>
<li>boat 보트의 고유 번호 (Factor variable - 1 ~ 16, A ~ D)</li>
<li>crew: 탈출한 남자 승무원의 수 (Discrete variable)</li>
<li>men: 탈출한 남자 승객의 수 (Discrete variable)</li>
<li>women: 탈출한 여성 승객 + 탈출한 여자 승무원의 수 ((Discrete
variable))</li>
<li>total: 총 탈출한 승객의 수 (Discrete variable)</li>
<li>cap: 보트의 수용인원 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb599"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="#cb599-1" aria-hidden="true" tabindex="-1"></a>Lifeboats<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Lifeboats<span class="sc">$</span>men <span class="sc">/</span> Lifeboats<span class="sc">$</span>total <span class="sc">&gt;</span> .<span class="dv">1</span>, <span class="fu">as.character</span>(Lifeboats<span class="sc">$</span>boat), <span class="st">&quot;&quot;</span>)</span>
<span id="cb599-2"><a href="#cb599-2" aria-hidden="true" tabindex="-1"></a>AES <span class="ot">&lt;-</span> <span class="fu">aes</span>(<span class="at">x =</span> women, <span class="at">y =</span> men, <span class="at">z =</span> crew,</span>
<span id="cb599-3"><a href="#cb599-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">colour =</span> side, <span class="at">shape =</span> side, <span class="at">label =</span> id)</span>
<span id="cb599-4"><a href="#cb599-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtern</span>(<span class="at">data =</span> Lifeboats, <span class="at">mapping =</span> AES) <span class="sc">+</span></span>
<span id="cb599-5"><a href="#cb599-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size=</span><span class="dv">6</span>)<span class="sc">+</span></span>
<span id="cb599-6"><a href="#cb599-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb599-7"><a href="#cb599-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth_tern</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb599-8"><a href="#cb599-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_rgbw</span>()</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-257-1.png" width="960" /></p>
<p><code>Lifeboats</code>의 <code>id</code>변수의 경우 탈출한 남성
승객의 수 / 총 승객의 탈출 인원 수가 0.1보다 큰 경우
<code>Lifeboats</code>데이터의 <code>boat id</code>를 가지도록 하였고 그
외에는 공백으로 남겨두도록 코딩을 진행하였다.</p>
<p>위의 그림을 보면 point가 좌측 하단 부근에 몰려있는 것을 확인할 수
있으며, 이는 보트를 통해 탈출을함에 있어 여성의 비율이 높은 것을 알 수
있다.<br />
또한, 우현에서 진수된 보트들은 대부분 여성 생존자가 많은 것에 비해,
좌현에서 진수된 보트들은 남성, 남성 승무원, 여성의 비율이 우현에서
진수된 보트보다는 더 높은 것을 확인할 수 있다.</p>
<p>우리는 2개의 side에서 발사된 보트의 구성의 차이를 살펴보기 위해 선형
회귀선을 추가하였다.<br />
보트1은 여성의 20%에 불과한 반면, 보트3은 50%, 보트 7,5,9는 약 75%의
비율을 가지고 있는 것을 확인할 수 있다.</p>
<hr />
</div>
<div id="summary-of-chapter4" class="section level2">
<h2>Summary of Chapter4</h2>
<ul>
<li>이원 교차표의 경우, 일차 빈도표에 비해 적용될 수 있는 분석기법이
많고 전처리 방법 또한 다양하므로 다양한 분석 기법을 익히는 것이
중요하다.<br />
</li>
<li><strong>오즈비(Odds ratio)</strong>의 경우 사건이 발생할 확률이
발생하지 않을 확률에 비해 몇 배 더 높은가의 의미를 가지고 있으며,
2차원의 분할표에서 많이 사용되는 개념 중 하나이다.<br />
</li>
<li>특정 변수에 대하여 평가자를 통해 변수를 측정하는 경우, 평가자의
평가가 어느 한 곳으로 치우치치않게 하는 것은 중요하다. 이러한 경우,
<strong>Kappa</strong> 또는 <strong>agreement plot</strong>을 통해
평가자의 평가가 적합하게 이뤄젔는지에 대한 검정을 진행할 수 있다.<br />
</li>
<li><strong>sieve diagram</strong>은 분할표의 관찰빈도와 독립성을
가정했을 때의 기대빈도를 시각화를 통해 비교하고자 할때, 유용하게 사용할
수 있다.<br />
</li>
<li><strong>association plot</strong>은 <strong>sieve diagram</strong>과
달리, 직사각형의 면적이 편차를 나타내며 관찰빈도를 비교하기 보다는
편차에 대한 비교를 진행할 때 사용하는 방법이다.<br />
</li>
<li><strong>CMHtest</strong>는 분할표 변수 중, 순서형 수준이 포함되는
경우에 독립성 검정을 순서형 수준을 고려하여 진행할 수 있도록 도와주는
방법이다.<br />
</li>
<li>이차원 분할표를 넘어 삼차원, 사차원을 가는 경우 분할표의 변수
뿐만아니라, 분할표를 구분하는 <strong>계층 변수</strong>에 대한 관심을
가져야 하며, 이러한 계층 변수를 어떻게 처리할지에 대한 고민도 하는 것이
중요하다.<br />
</li>
<li><strong>Fourfold display</strong>는 여러개 혹은 단일 계층을 가지는
2x2 분할표에 대해 <strong>오즈비</strong>를 비교하고자 할 때, 유용하게
사용할 수 있는 방법이다.<br />
</li>
<li><strong>Trilinear plot</strong>은 3열 분할표에 대한 상대비율을
시각화를 통해 나타내고자 할 때, 유용하게 사용할 수 있는 방법이다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap5-mosaic-displays-for-n-way-tables" class="section level1">
<h1>Chap5 Mosaic Displays for n-Way Tables</h1>
<p><strong>모자이크 그림</strong>은 변수 간의 연관 패턴을 시각화 하는데
도움이 많이 된다.<br />
이 기술을 확장하면 부분 연관성, 주변 연관성 등의 구조를 드러낼 수
있다.<br />
또한, 모자이크 그림은 <strong>Marimekko chart,
Eikosogram</strong>이라고도 불리기도 하며, 특히 범주형 데이터에 대해
시각화하는데 아주 유용하다.</p>
<hr />
<div id="introduction-1" class="section level2">
<h2>5.1 Introduction</h2>
<p>Chpater4에서 <strong>fourfold display</strong>, <strong>tile
plot</strong>, <strong>sieve diagram</strong>, <strong>agreement
charts</strong>, <strong>trilinaer plot</strong> 같은 분할표의 연관
패턴을 시각화하기 위한 기술들을 배웠다.</p>
<p>Chapter5에서는 n-way 빈도표를 시각화하기 위한 <strong>mosaic
plot</strong>에 대해서 알아본다. 이 방법은 면적이 셀의 빈도에 비례하며,
이런 점에서 <strong>sieve diagram</strong>과 유사하다.<br />
또한, 3개 이상의 변수를 가지는 고차원 분할표에 대하여 여러 독립성을
가정하여 다양한 모델을 만들어낼 수 있는 <strong>로그 선형
모델</strong>에 대해서도 살펴본다.</p>
<p><strong>mosaic plot</strong>과 관련된 장점은 아래와 같다.</p>
<ul>
<li>n-way 빈도표에 대해서 더 일반화할 수 있다.<br />
</li>
<li>빈도 데이터에 대한 로그선형 모델, 일반화된 선형 모델 및 일반화된
비선형 모델에 밀접하게 연결한다.<br />
</li>
<li>순서적인 모델을 n-way 테이블의 다양한 주변 총합에 연결시키기 위한
방법을 제공한다.<br />
</li>
<li>다양한 로그 선형 모델에 적합된 변수들 사이의 관계를 설명하는데
사용될 수 있다.</li>
</ul>
<p>R에서는 <code>vcd</code>패키지의 <code>mosaic</code>함수를 통해
<strong>모자이크 플랏</strong>을 그릴 수 있다.<br />
- <code>mosaic(table,suppress,labeling,shade)</code></p>
<ul>
<li>table: 모자이크 플랏을 그릴 분할표</li>
<li>suppress: 지정한 값의 절대값을 기준으로 셀에 값을 표시한다.<br />
</li>
<li>labeling: 셀의 라벨링 방법</li>
<li>shade: 잔차에 대한 음영 처리 여부</li>
</ul>
<hr />
</div>
<div id="two-way-tables-1" class="section level2">
<h2>5.2 Two-way tables</h2>
<p><em>Example 5.1: Hair color and eye color</em></p>
<div class="sourceCode" id="cb600"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb600-2"><a href="#cb600-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;HairEyeColor&quot;</span>, <span class="at">package =</span> <span class="st">&quot;datasets&quot;</span>)</span>
<span id="cb600-3"><a href="#cb600-3" aria-hidden="true" tabindex="-1"></a>haireye <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(HairEyeColor, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb600-4"><a href="#cb600-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-258-1.png" width="960" /></p>
<p>성별 계층을 통일하여 눈의 색깔과 머리 색깔의 분할표를 가지는
<code>haireye</code> 데이터를 이용하여 <code>mosaic plot</code>을
그려보았다.<br />
모자이크 플롯의 직사각형 너비는 빈도에 비례하는 것을 볼 수 있으며,
<strong>Hair</strong>의 경우, <strong>Hair == Brown</strong>일 경우의
면적이 제일 크므로 갈색 머리를 가진 사람이 가장 많다는 것을 쉽게 알 수
있다.</p>
<div class="sourceCode" id="cb601"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye,</span>
<span id="cb601-2"><a href="#cb601-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_cells)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-259-1.png" width="960" /></p>
<p><code>labelling = labelling_cells</code>옵션을 통해 직사각형의 각
셀이 의미하는 변수들의 조합이 무엇인지 살펴볼 수 있다.</p>
<div class="sourceCode" id="cb602"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye,</span>
<span id="cb602-2"><a href="#cb602-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_values)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-260-1.png" width="960" /></p>
<p><code>labeling = labeling_values</code>옵션을 통해 직사각형위에
빈도를 나타내도록 하였다.<br />
<code>haireye</code> 데이터에서 <strong>Eye = Brown, Hair =
Brown</strong>인 사람이 119명으로 가장 많으며, <strong>Eye = Blue, Hair
= Blond</strong> 사람이 94명으로 두 번째로 많은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb603"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye,</span>
<span id="cb603-2"><a href="#cb603-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-261-1.png" width="960" /></p>
<p><code>labeling = labeling_residuals</code>옵션을 지정하게 되면 각
셀이가지고 있는 피어슨 잔차의 값을 출력해준다.<br />
이 경우, 잔차가 표시되지 않는 셀이 발생하는데 이러한 문제는
<code>suppress</code>옵션을 통해 해결할 수 있다.</p>
<div class="sourceCode" id="cb604"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye,</span>
<span id="cb604-2"><a href="#cb604-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">suppress =</span> <span class="dv">0</span>,</span>
<span id="cb604-3"><a href="#cb604-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-262-1.png" width="960" /></p>
<p><code>suppress</code>옵션은 위의 <code>mosaic</code>함수 설명에서도
살펴볼 수 있듯이, 분석가가 지정한 절댓값을 기준으로 잔차를
출력해준다.<br />
<code>suppress = 0</code>을 지정하게 되면 절대값 0을 기준으로 잔차를
출력해달라는 의미로 모든 잔차가 출력되는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb605"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="#cb605-1" aria-hidden="true" tabindex="-1"></a>(hair <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(haireye,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Hair
## Black Brown   Red Blond 
##   108   286    71   127</code></pre>
<p><code>margin.talbe</code>함수를 이용하여 Eye의 색깔에 상관없이 Hair
색깔의 빈도를 구해 보았다.<br />
Hair 색깔이 <strong>Brown, Blond, Black, Red</strong>의 순서로 많은 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb607"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="#cb607-1" aria-hidden="true" tabindex="-1"></a>expected <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">sum</span>(hair) <span class="sc">/</span> <span class="dv">4</span>,<span class="dv">4</span>)</span>
<span id="cb607-2"><a href="#cb607-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(expected) <span class="ot">&lt;-</span> <span class="fu">names</span>(hair)</span>
<span id="cb607-3"><a href="#cb607-3" aria-hidden="true" tabindex="-1"></a>expected</span></code></pre></div>
<pre><code>## Black Brown   Red Blond 
##   148   148   148   148</code></pre>
<p>marginal표의 기대 빈도는 모든 요소들의 빈도를 더한 후 범주의 갯수로
나누기 때문에 동일한 기댓값을 갖게 된다. 여기서는 hair 색깔들의 기대
빈도가 148로 모두 동일한 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb609"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="#cb609-1" aria-hidden="true" tabindex="-1"></a>(residuals <span class="ot">&lt;-</span> (hair <span class="sc">-</span> expected) <span class="sc">/</span> <span class="fu">sqrt</span>(expected))</span></code></pre></div>
<pre><code>## Hair
##     Black     Brown       Red     Blond 
## -3.287980 11.343530 -6.329361 -1.726189</code></pre>
<p>피어슨 잔차공식(<span class="math inline">\(r_i = (n_i-m_i)/
\sqrt{(m_i)}\)</span>)을 이용하여 잔차를 구한 결과는 위와 같다.</p>
<p>Brown을 제외한 나머지 3개의 컬러는 음의 값을 갖는 것을 알 수
있다.<br />
잔차가 음의 값을 갖는다는 것은 기대빈도가 관찰빈도보다 높다는 의미이고
잔차가 양의 값을 갖는다는 것은 관찰빈도가 기대빈도보다 높다는
의미이다.</p>
<p>즉, <strong>Hair = Brown</strong>인 경우에는 관찰빈도가 기대빈도보다
높고 나머지 나머지 3개의 컬러의 경우, 기대빈도가 관찰빈도보다 높다는
것을 알 수 있다.</p>
<div class="sourceCode" id="cb611"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">addmargins</span>(<span class="fu">prop.table</span>(haireye,<span class="dv">1</span>),<span class="dv">2</span>),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        Eye
## Hair    Brown  Blue Hazel Green   Sum
##   Black 0.630 0.185 0.139 0.046 1.000
##   Brown 0.416 0.294 0.189 0.101 1.000
##   Red   0.366 0.239 0.197 0.197 1.000
##   Blond 0.055 0.740 0.079 0.126 1.000</code></pre>
<p><code>addmargins</code>함수와 <code>prop.table</code>함수를 이용하여
Hair의 색깔에 따른 Eye의 확률표를 구해보았다.<br />
<strong>Hair = Black</strong> 일 때, <strong>Eye = brown</strong>,<br />
<strong>Hair = Brown</strong> 일 때, <strong>Eye = brown</strong>,<br />
<strong>Hair = Red</strong>일 때, <strong>Eye = Brown</strong>,<br />
<strong>Hair = Blond</strong>일 때, <strong>Eye = Blue</strong>의 비율이
각각의 <strong>Hair</strong>에서 가장 높은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb613"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="#cb613-1" aria-hidden="true" tabindex="-1"></a>exp <span class="ot">&lt;-</span> <span class="fu">independence_table</span>(haireye)</span>
<span id="cb613-2"><a href="#cb613-2" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> (haireye <span class="sc">-</span> exp) <span class="sc">/</span> <span class="fu">sqrt</span>(exp)</span>
<span id="cb613-3"><a href="#cb613-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(resids, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##        Eye
## Hair    Brown  Blue Hazel Green
##   Black  4.40 -3.07 -0.48 -1.95
##   Brown  1.23 -1.95  1.35 -0.35
##   Red   -0.07 -1.73  0.85  2.28
##   Blond -5.85  7.05 -2.23  0.61</code></pre>
<p>marginal 표가 아닌 2-way표의 경우 기대빈도를 계산할 때, 조금 다른
식을 이용해서 계산해야 한다.(<span class="math inline">\(m_{ij} = n_{++}
* \pi_{i+} * \pi_{+j}\)</span>)</p>
<p>앞선 Chapter에서 살펴본 것처럼 분할표의 기대빈도는
<code>independence_table</code>함수를 이용하여 쉽게 계산할 수
있다.<br />
위의 결과는 <code>independence_table</code>함수를 통해 기대빈도를 구하고
관찰빈도를 이용하여 잔차를 구한 값이다.</p>
<div class="sourceCode" id="cb615"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye,<span class="at">shade=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-268-1.png" width="960" /></p>
<p>모자이크 플랏을 통해 잔차진단을 진행할수도 있다.
<code>mosaic</code>함수에서 <code>shade = True</code>를 주게되면 피어슨
잔차에 값의 따라 직사각형의 셀의 색깔을 바꿔준다.<br />
파란색의 경우 양의 잔차를 가지며, 해당셀의 관찰빈도가 기대빈도보다 높고,
빨간색의 경우 음의 잔차를 가지며, 해당셀의 관찰빈도가 기대빈도보다
낮다는 의미이다.</p>
<p>여기서는, <strong>Eye = Brown, Hair = Black</strong>, <strong>Eye =
Green, Hair = Red</strong>, <strong>Eye = Blue, Hair = Blond</strong>가
관찰빈도가 기대빈도보다 높아 파란색으로 표시된다.</p>
<p><strong>Eye = Blue, Hair = Black</strong>, <strong>Eye = Brown, Hair
= Blond</strong>, <strong>Eye = Hazel, Hair = Blond</strong>의 경우
관찰빈도가 기대빈도보다 낮으므로 빨간색으로 표시되는 것을 확인할 수
있다.</p>
<p>우측 하단 아래에 있는 P-value는 피어슨 카이제곱 검정통계량을 통해
독립성 검정을 진행한 결과이다.</p>
<p>귀무가설<span class="math inline">\(H_0\)</span>: 주어진 두 변수는
독립이며, 연관성이 없다.<br />
대립가설<span class="math inline">\(H_1\)</span>: 주어진 두 변수는
독립이 아니며, 연관성이 있다.</p>
<p>유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서,
<strong>Hair Color</strong>, <strong>Eye Color</strong>는 서로 독립이
아니며 연관성이 있다고 볼 수 있다.</p>
<div class="sourceCode" id="cb616"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye,<span class="at">shade=</span><span class="cn">TRUE</span>,</span>
<span id="cb616-2"><a href="#cb616-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">suppress =</span> <span class="dv">0</span>,</span>
<span id="cb616-3"><a href="#cb616-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-269-1.png" width="960" /></p>
<p><code>suppress</code>와 <code>labeling</code>옵션을 활용하여 잔차에
따른 음영 처리와 더불어 잔차값을 출력할 수 있다.</p>
<div class="sourceCode" id="cb617"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="#cb617-1" aria-hidden="true" tabindex="-1"></a>(chisq <span class="ot">&lt;-</span> <span class="fu">sum</span>(resids <span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 138.2898</code></pre>
<div class="sourceCode" id="cb619"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="#cb619-1" aria-hidden="true" tabindex="-1"></a>(df <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="fu">dim</span>(haireye) <span class="sc">-</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb621"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="#cb621-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(chisq, df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 2.325287e-25</code></pre>
<p>피어슨 잔차값을 이용하여 피어슨 검정통계량을 구한 후, 검정통계량 값을
통해 가설검정을 진행해 보았다.<br />
모자이크 플랏에서 살펴본 결과와 동일하게 유의확률이 유의수준 0.05보다
작아 <strong>Hair Color</strong>, <strong>Eye Color</strong>는 서로
독립이 아닌 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb623"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(haireye)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s Chi-squared test
## 
## data:  haireye
## X-squared = 138.29, df = 9, p-value &lt; 2.2e-16</code></pre>
<p><code>chisq.test</code>함수를 사용하여 독립성 검정을 진행한 결과,
동일한 결과를 얻을 수 있는 것 또한 확인할 수 있다.</p>
<div id="interpretation-and-reordering" class="section level3">
<h3>5.2.1 Interpretation and reordering</h3>
<div class="sourceCode" id="cb625"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="#cb625-1" aria-hidden="true" tabindex="-1"></a>haireye2 <span class="ot">&lt;-</span> <span class="fu">as.table</span>(haireye[, <span class="fu">c</span>(<span class="st">&quot;Brown&quot;</span>,<span class="st">&quot;Hazel&quot;</span>,<span class="st">&quot;Green&quot;</span>,<span class="st">&quot;Blue&quot;</span>)])</span>
<span id="cb625-2"><a href="#cb625-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-272-1.png" width="960" /></p>
<p>해석의 용이함을위해 주어진 데이터의 범주를 재구성한 후,
<strong>모자이크 플롯</strong>을 그릴 수 있다.<br />
<code>haireye</code>데이터에서 눈 색깔의 범주 순서를 어두운색에서 밝은
색으로 정렬한 후 다시 한 번 <strong>모자이크 플롯</strong>을
그려보았다.</p>
<p>상대적으로 어두운 눈색깔인 <strong>Brown, Hazel</strong>을 가질 때,
<strong>Blond</strong>머리를 가지는 사람은 적은 것을 알 수 있다.<br />
이처럼 범주의 수준에 대해서 순서를 재구성하게 되면 상대적으로 해석과
변수들의 패턴을 찾는데있어 편리한 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
<div id="the-strucplot-framework" class="section level2">
<h2>5.3 The strucplot framework</h2>
<p>모자이크 그림은 앞서 4장에서 살펴본 <strong>sieve plot, association
plot</strong>, 후에 뒤에서 살펴볼 <strong>doubledecker plot</strong>과
많은 공통점이 있다.<br />
이 방법들의 주요한 공통점은 분할표의 빈도를 tile로써 시각화 한다는데에
있다.</p>
<p>데이터를 단순히 시각화 하는 것도 중요하지만, 시각화된 결과를 보고함에
있어 적절한 색조화 혹은 간격배치를 통해 결과를 쉽게 살펴볼 수 있게 하는
것 또한 중요한 요소이다.<br />
<strong>strucplot framework</strong>는 이렇게 시각화를 세밀하게
조절하는데 사용될 수 있는 다양한 함수를 제공한다. 이 프레임워크는
그래픽의 측면을 세심하게 컨트롤 할 수 있는 conditional 그림의 클래스를
제공한다.</p>
<p><code>strucplot</code>은 이처럼 고차원 분할표의 특정 측면을 계층적
방식으로 시각화하며, 기존에 가지는 분할표 시각화 기법과 더불어 더 다양한
조절 옵션을 가지고 있다.<br />
<code>strucplot</code>은 <code>vcd</code>패키지 안에 포함돼있다.<br />
- <code>strucplot(table, core, gp, spacing)</code></p>
<ul>
<li>table: strucplot을 적용할 분할표</li>
<li>core: 표현하고자하는 시각화 형태(default는 모자이크 플랏)</li>
<li>spacing: 간격 조정</li>
<li>gp: 색깔 조정 및 그래프의 시각적 요소 조정</li>
</ul>
<p>Ex)</p>
<ul>
<li>타일의 라벨링</li>
<li>타일 사이의 간격</li>
<li>타일의 시각적 요소</li>
<li>타일의 내용</li>
</ul>
<div class="sourceCode" id="cb626"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strucplot</span>(haireye, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-273-1.png" width="960" /></p>
<p><code>strucplot</code>함수를 이용하여 <code>haireye</code>의 모자이크
플롯을 그린 후, <code>gp</code>옵션을 통해 타일의 색깔을 바꿔주었다.</p>
<div class="sourceCode" id="cb627"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strucplot</span>(haireye,<span class="at">core =</span> struc_assoc,<span class="at">spacing =</span> spacing_increase, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fill =</span><span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-274-1.png" width="960" /></p>
<p><code>core</code>함수를 통해 시각화의 형태를
<code>association plot</code>으로 지정한 후, <code>gp</code>옵션을 통해
타일의 색깔을 빨간색으로 바꿔주었다.</p>
<div class="sourceCode" id="cb628"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strucplot</span>(haireye,<span class="at">core =</span> struc_assoc,<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-275-1.png" width="960" /></p>
<p><code>strucplot</code>또한 잔차에 따른 음영처리 여부인
<code>shade</code>옵션을 제공한다.</p>
<div id="shading-schemes" class="section level3">
<h3>5.3.1 Shading schemes</h3>
<div id="specifying-graphical-parameters-for-strucplot-displays"
class="section level4">
<h4>5.3.2.1 Specifying graphical parameters for strucplot displays</h4>
<div class="sourceCode" id="cb629"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="#cb629-1" aria-hidden="true" tabindex="-1"></a>fill_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;brown4&quot;</span>,<span class="st">&quot;#acba72&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;lightblue&quot;</span>)</span>
<span id="cb629-2"><a href="#cb629-2" aria-hidden="true" tabindex="-1"></a>(fill_colors_mat <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">rep</span>(fill_colors,<span class="dv">4</span>),<span class="at">ncol=</span><span class="dv">4</span>)))</span></code></pre></div>
<pre><code>##      [,1]     [,2]      [,3]    [,4]       
## [1,] &quot;brown4&quot; &quot;#acba72&quot; &quot;green&quot; &quot;lightblue&quot;
## [2,] &quot;brown4&quot; &quot;#acba72&quot; &quot;green&quot; &quot;lightblue&quot;
## [3,] &quot;brown4&quot; &quot;#acba72&quot; &quot;green&quot; &quot;lightblue&quot;
## [4,] &quot;brown4&quot; &quot;#acba72&quot; &quot;green&quot; &quot;lightblue&quot;</code></pre>
<div class="sourceCode" id="cb631"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fill =</span> fill_colors_mat, <span class="at">col =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-277-1.png" width="960" /></p>
<p>기본적인 color가 아닌 특정 color를 정의하여 모자이크 플롯을 구성할 수
있다. 위의 코드에서는 원하는 color를 정의한 후,
<code>gp = gpar(fill)</code> 옵션을 통해 정의한 color를 넣어주었다.</p>
<div class="sourceCode" id="cb632"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">gp =</span> <span class="fu">shading_Marimekko</span>(haireye2))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-278-1.png" width="960" /></p>
<p><code>gp=shading_Marimekko(객체)</code>를 통해 미리 정의돼있는 색깔을
불러올 수 있다.</p>
<div class="sourceCode" id="cb633"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb633-2"><a href="#cb633-2" aria-hidden="true" tabindex="-1"></a><span class="fu">toeplitz</span>(<span class="dv">1</span> <span class="sc">:</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    2    1    2    3
## [3,]    3    2    1    2
## [4,]    4    3    2    1</code></pre>
<p><code>colorspace</code>패키지는 다양한 컬러를 매핑할 수 있도록 수많은
파레트 옵션을 가지고 있는 패키지이다.</p>
<p><code>toeplitz</code>함수는 대칭행렬을 만들어주는 함수이다.<br />
- <code>toeplitz(x)</code></p>
<ul>
<li>x: 대칭행렬을 만들 숫자들</li>
</ul>
<div class="sourceCode" id="cb635"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="#cb635-1" aria-hidden="true" tabindex="-1"></a>fill_colors <span class="ot">&lt;-</span> <span class="fu">rainbow_hcl</span>(<span class="dv">8</span>)[ <span class="dv">1</span> <span class="sc">+</span> <span class="fu">toeplitz</span>(<span class="dv">1</span> <span class="sc">:</span> <span class="dv">4</span>)]</span>
<span id="cb635-2"><a href="#cb635-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">gp =</span> <span class="fu">gpar</span>(<span class="at">fill =</span> fill_colors, <span class="at">col =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-280-1.png" width="960" /></p>
<p><code>rainbow_hcl</code>함수는 HCL 색상 팔레트를 제공하는 함수로
<code>colorspace</code>패키지에 포함돼 있다.<br />
- <code>rainbow_hcl(n)</code></p>
<ul>
<li>n: 생성하고자 하는 파레트의 수</li>
</ul>
<p>시각화를 진행함에 있어 특정 위치를 색깔을 통해 강조하고 싶은 경우가
있을 수 있다.<br />
위의 그림의 경우 <code>toeplitz</code>함수를 이용하여 대각선상에 있는
셀의 색깔을 동일하게 해주며, 나머지 셀 또한 대칭에 따라 동일한 색을
가지는 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb636"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">gp =</span> <span class="fu">shading_diagonal</span>(haireye2))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-281-1.png" width="960" /></p>
<p><code>gp = shading_diagonal(객체명)</code>을 통해 대각상의 셀에 대해
동일한 색깔을 할수도 있다.</p>
<div class="sourceCode" id="cb637"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">highlighting =</span> <span class="st">&quot;Eye&quot;</span>,</span>
<span id="cb637-2"><a href="#cb637-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">highlighting_fill =</span> fill_colors)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-282-1.png" width="960" /></p>
<div class="sourceCode" id="cb638"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">highlighting =</span> <span class="st">&quot;Hair&quot;</span>,</span>
<span id="cb638-2"><a href="#cb638-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">highlighting_fill =</span> fill_colors)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-283-1.png" width="960" /></p>
<p>한 변수의 수준에 따라 모자이크를 음영처리 할수도 있다.<br />
R에서는 <code>mosaic</code>함수에서 <code>highlighting</code>,
<code>highlighting_fill</code> 옵션을 통해 쉽게 진행할 수 있다. 위의
그림은 <code>highlighting</code>옵션을 <code>Eye</code>로 지정했기
때문에, <code>Eye</code>의 수준을 쉽게 살펴보고자
<code>Hair</code>변수의 수준마다 간격이 띄어져 있는것을 확인할 수
있다.<br />
아래의 그림은 <code>highliting</code>옵션을 <code>Hair</code>로
지정했기때문에, <code>Hair</code>의 수준을 쉽게 살펴보고자
<code>Eye</code>변수의 수준마다 간격이 띄어져 있는것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb639"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(Eye <span class="sc">~</span> Hair, <span class="at">data =</span> haireye2, <span class="at">highlighting_fill =</span> fill_colors)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-284-1.png" width="960" /></p>
<p><code>highlighting</code>옵션을 이용하기 번거롭다면, formula의 형태
(단, 반응변수 ~ 독립변수)로 구성한 후,
<code>highlighting_fill</code>옵션만 이용하여 진행할수도 있다.</p>
</div>
<div id="residual-based-shading" class="section level4">
<h4>5.3.2.2 Residual-based shading</h4>
<p><em>Example 5.2: Interpolation options</em></p>
<div class="sourceCode" id="cb640"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="#cb640-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-285-1.png" width="960" /></p>
<p>모자이크 플롯에서 잔차를 표시함에 있어 색의 농도를 고려하는 것도
중요하다.<br />
<code>gp_args = list(interpolate)</code>옵션은 지정한 범위만큼의 잔차를
나눈 후, 나눠진 값에 따라 음영을 조절해준다.<br />
위의 코드에서는 <code>interpolate = 1:4</code>로 지정하였기 때문에 양의
잔차와 음의 잔차의 최대값을 제외하고 절댓값 (1,4)의 범위로 음영을 나눠준
것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb641"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="#cb641-1" aria-hidden="true" tabindex="-1"></a>interp <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">pmin</span>(x <span class="sc">/</span> <span class="dv">6</span>, <span class="dv">1</span>)</span>
<span id="cb641-2"><a href="#cb641-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> interp))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-286-1.png" width="960" /></p>
<p>데이터에 맞는 함수를 만든 후, 분석가가 원하는 간격만큼으로 설정하여
잔차의 음영을 조절할수도 있다.</p>
<p><em>Example 5.3: Shading functions</em></p>
<div class="sourceCode" id="cb642"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye2, <span class="at">gp =</span> shading_Friendly, <span class="at">legend =</span> legend_fixed)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-287-1.png" width="960" /></p>
<p>색의 농도 뿐만 아니라 잔차의 범위에 따라 직사각형의 형태를 바꿔주는
것도 가능하다.<br />
위의 예시에서는 <code>gp = shading_Friendly</code> 옵션을 통해 기존의
빨간색, 파란색으로 양의 잔차, 음의 잔차를 구분하고 잔차의 범위에 따라
직사각형의 선을 점선, 실선의 형태로 바꿔주었다.</p>
<div class="sourceCode" id="cb643"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="#cb643-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb643-2"><a href="#cb643-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(haireye, <span class="at">gp =</span> shading_max)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-288-1.png" width="960" /></p>
<p><code>gp = shading_max</code>옵션을 사용하게 되면, 순열기반 검정을
바탕으로 잔차의 유의성을 확인한 후, 유의한 차이가 있다고 판단되는 잔차를
모자이크 플롯에 표시해주게 된다.</p>
<p><em>Example 5.4: Arthritis treatment</em></p>
<div class="sourceCode" id="cb644"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="#cb644-1" aria-hidden="true" tabindex="-1"></a>art <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> Treatment <span class="sc">+</span> Improved, <span class="at">data =</span> Arthritis, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>)</span>
<span id="cb644-2"><a href="#cb644-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">dimnames</span>(art))[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Improvement&quot;</span></span></code></pre></div>
<p><code>Arthritis</code>데이터를 처방된 약과 약의 효과에 대한 빈도를
가지는 분할표 형태로 만들어주었다.</p>
<div class="sourceCode" id="cb645"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="#cb645-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(art, <span class="at">gp =</span> shading_Friendly, <span class="at">margin =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="dv">1</span>), <span class="at">labeling =</span> labeling_residuals, <span class="at">suppress =</span> <span class="dv">0</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-290-1.png" width="960" /></p>
<p><code>Arthritis*</code> 데이터의 모자이크 플롯을 그려보았다.</p>
<p><code>gp = shading_Friendly</code>를 통해 잔차의 값에 따라 직사각형의
형태를 바꿔주고 <code>labeling = labeling_residuals</code>를 통해 잔차의
값을 직사각형 안에 표시해 주었다. <code>digits</code>옵션은 지정된
소수점까지 표시하여 출력해달라는 옵션이다.</p>
<div class="sourceCode" id="cb646"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb646-1"><a href="#cb646-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb646-2"><a href="#cb646-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(art, <span class="at">gp =</span> shading_max, <span class="at">margin =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-291-1.png" width="960" /></p>
<p><code>shading_max</code>옵션을 통해 유의한 잔차만을 나타내게
하였다.<br />
그 결과, <strong>Improvement = None, Treatment = Placebo</strong>,
<strong>Improvement = Marked, Treatment = Treated</strong>의 경우
파랑색으로 관찰빈도가 기대빈도보다 높은 것을 알 수 있다.<br />
반대로, <strong>Improvement = Marked, Treatment = Placebo</strong>,
*Improvement = None, Treatment = Treated**의 경우 빨간색으로 관찰빈도가
기대빈도보다 낮은 것을 알 수 있다.<br />
따라서, 약이 실제 약인 경우, 효과가 나타나지 않는 것 보다 효과가 뚜렷한
경우가 많았고 약이 위약일 경우 효과가 뚜렷한 것보다 나타나지 않는 경우가
더 많았다.</p>
<div class="sourceCode" id="cb647"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="#cb647-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(<span class="fu">chisq.test</span>(art))</span></code></pre></div>
<pre><code>##          Improvement
## Treatment       None       Some     Marked
##   Placebo  1.4775223  0.1926666 -1.7173377
##   Treated -1.6085225 -0.2097488  1.8696005</code></pre>
<p><code>residuals</code>함수를 통해 <code>chisq.test</code>의 결과에서
잔차값만 출력할 수 있다.<br />
잔차값을 살펴보면, 앞에서 모자이크 플롯을 통해 살펴본 결과와 동일한 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb649"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="#cb649-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb649-2"><a href="#cb649-2" aria-hidden="true" tabindex="-1"></a>art_max <span class="ot">&lt;-</span> <span class="fu">coindep_test</span>(art)</span>
<span id="cb649-3"><a href="#cb649-3" aria-hidden="true" tabindex="-1"></a>art_max</span></code></pre></div>
<pre><code>## 
##  Permutation test for conditional independence
## 
## data:  art
## f(x) = 1.8696, p-value = 0.01</code></pre>
<p><code>shading_max</code>를 사용할 때, p-value는
<code>coindep_test</code>를 통해 검정이 되고 <code>coindep_test</code>의
결과에 따라 유의성이 검정된다.<br />
<code>coindep_test</code>는 동일한 여백을 가진 n개의 랜덤 테이블을
생성하여 각각에 대한 최대 잔차 통계량을 계산한 후, conditional 독립성에
따른 분할표의 conditional 독립성 검정을 수행한다. 이때 얻어지는
P-value를 범례에 표시한다.<br />
<code>coindep_test</code>는 <code>vcd</code>패키지에 포함돼있다.<br />
- <code>coindep_test(table)</code></p>
<ul>
<li>table: conditional independence test를 시행할 분할표</li>
</ul>
<p><code>coindep_test</code>결과 유의확률은 유의수준 0.05보다 작으므로
귀무가설을 기각한다. 따라서, <strong>Treatment, Improvement</strong>두
변수는 서로 독립이 아니며 연관성이 있다고 해석할 수 있다.</p>
<div class="sourceCode" id="cb651"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="#cb651-1" aria-hidden="true" tabindex="-1"></a>art_max<span class="sc">$</span><span class="fu">qdist</span>(<span class="fu">c</span>(<span class="fl">0.90</span>, <span class="fl">0.99</span>))</span></code></pre></div>
<pre><code>##      90%      99% 
## 1.239278 1.646330</code></pre>
<p>마지막으로, 시뮬레이션 분포의 90% ~ 99% quantile을 음영의 수준으로
사용하게 된다.<br />
즉, <code>Arthritis</code>데이터의 음영의 수준은 앞선 그림에서
출력된대로 (1.2,1.6)의 범위를 사용한다.</p>
<p><em>Example 5.5: UK soccer scores</em></p>
<div class="sourceCode" id="cb653"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="#cb653-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb653-2"><a href="#cb653-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;UKSoccer&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb653-3"><a href="#cb653-3" aria-hidden="true" tabindex="-1"></a><span class="fu">CMHtest</span>(UKSoccer)</span></code></pre></div>
<pre><code>## Cochran-Mantel-Haenszel Statistics for Home by Away 
## 
##                  AltHypothesis   Chisq Df    Prob
## cor        Nonzero correlation  1.0105  1 0.31479
## rmeans  Row mean scores differ  5.6263  4 0.22885
## cmeans  Col mean scores differ  7.4161  4 0.11547
## general    General association 18.6501 16 0.28723</code></pre>
<p><code>CMHtest</code>를 통해 <code>UKSoccer</code>데이터에 대한 독립성
검정을 진행해 보았다.<br />
4가지의 방법을 모두 적용했을 때의 유의확률이 유의수준 0.05보다 크므로
귀무가설을 기각하지 못한다.<br />
즉, 홈경기의 득점과 원정경기의 득점은 서로 독립인 것을 알 수 있다.</p>
<div class="sourceCode" id="cb655"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb655-2"><a href="#cb655-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(UKSoccer, <span class="at">gp =</span> shading_max, <span class="at">labeling =</span> labeling_residuals, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-296-1.png" width="960" /></p>
<p><code>shading_max</code>를 사용한 모자이크 플롯의 결과, <strong>Away
= 2, Home = 4</strong>인 경우 관찰빈도가 기대빈도보다 높게 나온것을
확인할 수 있고 유일하게 유의한 잔차인 것을 알 수 있다.<br />
<code>coindep_test</code>의 결과는 유의확률이 유의수준 0.05보다 작으므로
귀무가설을 기각한다. 즉, 원정경기 득점과 홈경기 득점은 서로 연관이
있다라고 할 수 있다.<br />
하지만, 모자이크 플롯을 살펴보면 원정경기의 득점과 홈경기 득점간에는 큰
연관이 있는 것처럼 보이지 않는다.</p>
<hr />
</div>
</div>
</div>
<div id="three-way-and-larger-tables" class="section level2">
<h2>5.4 Three-way and larger tables</h2>
<p><em>Example 5.6: Hair color, eye color, and sex</em></p>
<div class="sourceCode" id="cb656"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="#cb656-1" aria-hidden="true" tabindex="-1"></a>HEC <span class="ot">&lt;-</span> HairEyeColor[, <span class="fu">c</span>(<span class="st">&quot;Brown&quot;</span>,<span class="st">&quot;Hazel&quot;</span>,<span class="st">&quot;Green&quot;</span>,<span class="st">&quot;Blue&quot;</span>),]</span></code></pre></div>
<p><code>HairEyeColor</code>에서 앞서 진행한 전처리 과정과 달리
계층변수인 성별 변수를 제외하지 않고 변수의 수준을 재지정한 후,
<code>HEC</code>객체에 저장하였다.</p>
<div class="sourceCode" id="cb657"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="#cb657-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HEC)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-298-1.png" width="960" /></p>
<p>성별을 계층변수로하는 3차원의 모자이크 플롯을 그려보았다.<br />
2차원과 달리 3차원부터는 셀에 출력되는 정보가 없으면 모자이크 플롯을
해석하기가 약간은 난해한 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb658"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HEC,</span>
<span id="cb658-2"><a href="#cb658-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">rot_labels =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="sc">-</span><span class="dv">45</span>), </span>
<span id="cb658-3"><a href="#cb658-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_values)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-299-1.png" width="960" /></p>
<p><code>labeling</code>옵션을 통해 직사각형의 각 셀에 빈도를 표시하도록
하였다.<br />
여성과 남성 모두 <strong>Hair = Brown, Eye = Brown</strong>인 사람이
가장 많은 것을 확인할 수 있다.</p>
<p>3-way 이상의 모자이크 플롯을 그리는 경우 변수들의 이름이 잘
보이지않는 경우가 발생할 수 있다.<br />
이때, <code>rot_labels</code>함수를 통해 이름의 위치를 약간 조정해주게
되면, 시각적으로 더 나은 결과를 제공할 수 있게 만들어줄 수 있다.</p>
<div class="sourceCode" id="cb659"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HEC,</span>
<span id="cb659-2"><a href="#cb659-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">rot_labels =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="sc">-</span><span class="dv">45</span>),</span>
<span id="cb659-3"><a href="#cb659-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals,</span>
<span id="cb659-4"><a href="#cb659-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-300-1.png" width="960" /></p>
<p><code>shade</code>옵션을 통해 잔차의 값에 따라 음영을 다르게 하도록
하였다.<br />
남성과 여성 모두 <strong>Hair = Black, Eye = Brown</strong>일때, 양의
잔차를 가지므로 관찰빈도가 기대빈도보다 큰 것을 알 수 있고 <strong>Hair
= Blond, Eye = Brown</strong>일때, 음의 잔차를 가지므로 관찰빈도가
기대빈도보다 낮은 것을 확인할 수 있다.</p>
<p>또한, 유의확률이 유의수준 0.05보다 작으므로 성별을 계층으로 하는
머리색과 눈색깔에 대한 분할표는 유의하다.<br />
즉, 성별을 계층으로 했을 때 머리색과 눈색깔은 서로 연관이 있는 것을 알
수 있다.</p>
<div id="a-primer-on-loglinear-models" class="section level3">
<h3>5.4.1 A primer on loglinear models</h3>
<p>로그선형 모델의 기본 개념은 <strong>독립성(sieve diagram, mosaic
plot)하에서 기대빈도 간의 곱셈관계가 로그 빈도에 대한 모댈로서
표현</strong>이 될 때 가법모델이 된다는 것이다.<br />
즉 우리가 알고있는 두 이산 변수의 기대빈도의 경우, 한 값이라도 0이되면
기대빈도가 0이되는 문제가 발생한다. 하지만, 여기에 로그를 취하게 되면
기대빈도가 0이 되는 문제를 방지할 수 있으므로,
<strong>로그선형모델</strong>은 상당히 유의하게 사용할 수 있다.</p>
<p><em>Example 5.7: Hair color, eye color, and sex</em></p>
<p><code>loglin</code>함수는 반복적인 비례 적합을 통해 다차원 분할표에
로그 선형 모델을 적합시키는 데 사용된다.<br />
- <code>loglin(table,margin)</code></p>
<ul>
<li>table: <code>loglin</code>함수를 적용할 분할표 데이터</li>
<li>margin: 모형을 적합시킴에 있어 사용할 행 또는 열</li>
</ul>
<p><code>loglm</code>함수는 로그 선형 모델을 glm과 같은 다른 피팅 함수의
모델과 유사한 방식으로 지정할 수 있도록한다.<br />
<code>loglm</code>함수는 <code>MASS</code>패키지 안에 포함돼 있다.<br />
- <code>loglm(formula,data)</code></p>
<ul>
<li>formula: 사용자가 적합하고자 하는 모델의 구성식</li>
<li>data: 변수에 사용된 데이터</li>
</ul>
<div class="sourceCode" id="cb660"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="#cb660-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb660-2"><a href="#cb660-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb660-3"><a href="#cb660-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>,<span class="st">&quot;a2&quot;</span>),n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb660-4"><a href="#cb660-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>,<span class="st">&quot;b2&quot;</span>),n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb660-5"><a href="#cb660-5" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>),n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb660-6"><a href="#cb660-6" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb660-7"><a href="#cb660-7" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(A, B, sex, age)</span>
<span id="cb660-8"><a href="#cb660-8" aria-hidden="true" tabindex="-1"></a>mytable <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> A <span class="sc">+</span> B <span class="sc">+</span> sex, <span class="at">data =</span> mydata)</span></code></pre></div>
<div class="sourceCode" id="cb661"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglin</span>(mytable, <span class="at">margin =</span> <span class="fu">list</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## 2 iterations: deviation 0</code></pre>
<pre><code>## $lrt
## [1] 6.891656
## 
## $pearson
## [1] 6.368757
## 
## $df
## [1] 5
## 
## $margin
## $margin[[1]]
## [1] &quot;A&quot;
## 
## $margin[[2]]
## [1] &quot;B&quot;</code></pre>
<div class="sourceCode" id="cb664"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglin</span>(mytable, <span class="at">margin =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## 2 iterations: deviation 0</code></pre>
<pre><code>## $lrt
## [1] 5.041023
## 
## $pearson
## [1] 4.959567
## 
## $df
## [1] 4
## 
## $margin
## $margin[[1]]
## [1] &quot;A&quot; &quot;B&quot;</code></pre>
<p><code>mytable</code>데이터를 <code>loglin</code>함수를 이용하여 로그
선형모델에 적합시켜 보았다.<br />
적합시킨 두 모델 모두 피어슨 카이제곱 통계량이 기각역보다 작게 나오므로
귀무가설을 기각하지 못한다.<br />
따라서, 성별을 계층 변수로 할 때, 두 변수 A,B는 서로 독립임을 알 수
있다.</p>
<div class="sourceCode" id="cb667"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="#cb667-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb667-2"><a href="#cb667-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(<span class="sc">~</span> Hair <span class="sc">+</span> Eye, <span class="at">data =</span> haireye)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~Hair + Eye, data = haireye)
## 
## Statistics:
##                       X^2 df P(&gt; X^2)
## Likelihood Ratio 146.4436  9        0
## Pearson          138.2898  9        0</code></pre>
<p><code>loglm</code>함수를 사용하여 로그선형모델에 적합시키게 되면
출력결과로 LR,피어슨 방법을 통해 계산된 검정통계량, 자유도, 유의확률을
제공한다.<br />
위의 결과를 살펴보면, 유의확률이 모두 유의수준 0.05보다 작으모로
귀무가설을 기각한다.<br />
따라서, <strong>Hair</strong>, <strong>Eye</strong>는 서로 독립이아니며,
연관성이 있다는 것을 쉽게 확인할 수 있다.</p>
<div class="sourceCode" id="cb669"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(<span class="sc">~</span>Hair<span class="sc">+</span>Eye, <span class="at">data =</span> haireye,<span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-304-1.png" width="960" /></p>
<p><strong>모자이크 플롯</strong>을 통해서도 두 변수는 서로 연관성이
있다는 같은 결과를 확인할 수 있다.</p>
<div class="sourceCode" id="cb670"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="#cb670-1" aria-hidden="true" tabindex="-1"></a>HE_S <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Hair <span class="sc">*</span> Eye <span class="sc">+</span> Sex, <span class="at">data =</span> HairEyeColor)</span>
<span id="cb670-2"><a href="#cb670-2" aria-hidden="true" tabindex="-1"></a>HE_S</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~Hair * Eye + Sex, data = HairEyeColor)
## 
## Statistics:
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 19.85656 15 0.1775045
## Pearson          19.56712 15 0.1891745</code></pre>
<p>위의 Formula는 <strong>Hair</strong>, <strong>Eye</strong>변수가
<strong>Sex</strong>변수에 대해서 공동적으로 독립인지 확인하는 Formula로
<strong>[HairEye][Sex]</strong>모형을 적합시킨다.<br />
앞에서 진행한 분석과 달리 <strong>Sex</strong>변수에 대해 공동적으로
독립임을 가정하면, 유의확률이 모두 유의하지 않으므로 귀무가설을 기각하지
못하는 것을 확인할 수 있다.<br />
따라서, <strong>Hair</strong>,<strong>Eye</strong>는
<strong>Sex</strong>변수에 대해서 공동적으로 독립이다. 즉, 연관성이
없다는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb672"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(HE_S, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<pre><code>## Re-fitting to get frequencies and fitted values</code></pre>
<pre><code>## , , Sex = Male
## 
##        Eye
## Hair           Brown         Blue        Hazel        Green
##   Black -0.008354888  0.512788125  1.102277378  0.419253811
##   Brown -0.411648401  1.654855326 -0.089068021  0.360508118
##   Red   -0.643733634  0.702407350  0.156512844  0.156512844
##   Blond -0.164611924 -2.148579275  0.132277496  0.167319269
## 
## , , Sex = Female
## 
##        Eye
## Hair           Brown         Blue        Hazel        Green
##   Black  0.007888066 -0.484136574 -1.040688673 -0.395828400
##   Brown  0.388647936 -1.562391850  0.084091429 -0.340365068
##   Red    0.607765626 -0.663161003 -0.147767837 -0.147767837
##   Blond  0.155414389  2.028529441 -0.124886616 -0.157970463</code></pre>
<p><strong>hair,eye,sex에 대한 3-way 분할표</strong>의 잔차를 살펴보면
위와같은 결과를 얻을 수 있다.<br />
남성과 여성 모두 <strong>Eye = Blue, Hair = Blond</strong>인 경우의
잔차가 상대적으로 높거나 낮은 것을 확인할 수 있다.<br />
남성의 경우에는 잔차가 음의 값이므로 관찰빈도가 기대빈도보다 낮고,
여성의 경우에는 잔차가 양의 값이므로 관찰빈도가 기대빈도보다 높은것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb675"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="#cb675-1" aria-hidden="true" tabindex="-1"></a>HEC <span class="ot">&lt;-</span> HairEyeColor[, <span class="fu">c</span>(<span class="st">&quot;Brown&quot;</span>,<span class="st">&quot;Hazel&quot;</span>,<span class="st">&quot;Green&quot;</span>,<span class="st">&quot;Blue&quot;</span>),]</span>
<span id="cb675-2"><a href="#cb675-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HEC, <span class="at">expected =</span> <span class="sc">~</span>Hair <span class="sc">*</span> Eye <span class="sc">+</span> Sex,</span>
<span id="cb675-3"><a href="#cb675-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals,</span>
<span id="cb675-4"><a href="#cb675-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">rot_labels =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="sc">-</span><span class="dv">45</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-307-1.png" width="960" /></p>
<p>3-way 분할표의 <strong>모자이크 플롯</strong>을 그린 결과는
위와같다.<br />
잔차를 통해 살펴본 결과와 동일한 셀에 각각 빨간색, 파란색으로 표시된
것을 확인할 수 있으며, 유의확률 또한 유의하지 않은 것을 확인할 수
있다.</p>
</div>
<div id="fitting-models" class="section level3">
<h3>5.4.2 Fitting models</h3>
<p>3개 이상의 변수를 분할표에 나타내는 경우, 변수의 차원이 넓어지게
된다.<br />
이때, 고려할 변수들이 많아지므로 변수들을 이용하여 모델에 적합시키는
경우, 다양한 독립성 유형의 모델이 나올 수 있고 각 모델의 잔차를 표시할
수 있다.</p>
<p>변수 A,B,C가 있는 3-way 분할표의 경우 적합될 수 있는 가설 모형 중
일부는 아래와 같다.</p>
<p><span class="math inline">\(H_1\)</span>: <strong>Complete
independence</strong>: 모델의 formula는 ~A + B + C로 표시되며, 이는
A,B,C가 상호독립이라고 가정한다.</p>
<p><span class="math inline">\(H_2\)</span>: <strong>Joint
independence</strong>: 모델의 formula는 ~A*B + C로 표시되며, 변수 C가
A,B에 대해서 공동독립인 모형을 적합시킨다. 변수 C가 변수 A와 B의 조합과
관련이 있지만 해당 연관성이 정확하게 적합되기 때문에 A, B 사이의
연관성을 나타내지는 않는다.</p>
<p><span class="math inline">\(H_3\)</span>: <strong>Conditional
independence</strong>: 모델의 formula는 ~ A * C + B * C (or ~ (A + B) *
C)으로 표시되며, 이는 C가 제어될 때 A와 B는 조건부 독립이라고 가정한다.
이 모형이 적합하면 모자이크 표시는 C에 대해 제어되는 변수 A와 B사이의
조건부 연관성을 표시하지만 A와C 또는 B와 C사이의 연관성을 표시하지는
않는다.</p>
<p><span class="math inline">\(H_4\)</span>: <strong>No three-way
interaction</strong>: 이 모형의 경우 marginally 혹은 conditionally적으로
어떠한 독립적인 쌍이 없다고 가정한다. 그러나 두 변수 간의 연관성은 세
번째 변수의 각 수준에서 동일하다.</p>
<p><em>Example 5.8: Hair color, eye color, and sex</em></p>
<div class="sourceCode" id="cb676"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="#cb676-1" aria-hidden="true" tabindex="-1"></a>abbrev <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">abbreviate =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="dv">1</span>))</span>
<span id="cb676-2"><a href="#cb676-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HEC, <span class="at">expected =</span> <span class="sc">~</span> Hair <span class="sc">+</span> Eye <span class="sc">+</span> Sex,</span>
<span id="cb676-3"><a href="#cb676-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeling_args =</span> abbrev,</span>
<span id="cb676-4"><a href="#cb676-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">&quot;Model: ~ Hair + Eye + Sex&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-308-1.png" width="960" /></p>
<p>위의 그림은 <strong>[Hair][Eye][Sex]</strong>에 대한 상호 독립 모델을
가정하고 적합시킨 모델의 잔차를 표시하는 <strong>모자이크
플롯</strong>이다.<br />
유의확률은 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서, 위의
세 변수들 중 독립이 아닌 변수들의 쌍이있다고 할 수 있다.</p>
<div class="sourceCode" id="cb677"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(HEC, <span class="at">expected =</span> <span class="sc">~</span> Hair <span class="sc">*</span> Sex <span class="sc">+</span> Eye <span class="sc">*</span> Sex,</span>
<span id="cb677-2"><a href="#cb677-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling_args =</span> abbrev, <span class="at">main =</span> <span class="st">&quot;Model: ~ Hair * Sex + Eye*Sex&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-309-1.png" width="960" /></p>
<p>위의 그림은 <strong>{HairSex}[EyeSex]</strong>에 대한 모델로
<strong>Sex</strong>변수가 주어졌을 때,
<strong>Hair</strong>,<strong>Eye</strong>변수의 독립성을 가정한
모델이다.<br />
유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서,
<strong>Sex</strong>변수가 제어될 때,
<strong>Hair</strong>,<strong>Eye</strong>변수는 서로 독립이 아닌것을 알
수 있다.</p>
<div class="sourceCode" id="cb678"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="#cb678-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Hair <span class="sc">+</span> Eye <span class="sc">+</span> Sex, <span class="at">data =</span> HEC) <span class="co"># [Hair][Eye][Sex]</span></span>
<span id="cb678-2"><a href="#cb678-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Hair <span class="sc">*</span> Sex <span class="sc">+</span> Eye <span class="sc">*</span> Sex, <span class="at">data =</span> HEC) <span class="co"># [HairSex][EyeSex]</span></span>
<span id="cb678-3"><a href="#cb678-3" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Hair <span class="sc">*</span> Eye <span class="sc">+</span> Sex, <span class="at">data =</span> HEC) <span class="co"># [HairEye][Sex]</span></span>
<span id="cb678-4"><a href="#cb678-4" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(mod1, mod2, mod3)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##         AIC    BIC LR Chisq Df Pr(&gt;Chisq)    
## mod1 321.18 332.90  166.300 24     &lt;2e-16 ***
## mod2 323.56 344.08  156.678 18     &lt;2e-16 ***
## mod3 192.74 217.65   19.857 15     0.1775    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>LRstats</code>함수를 이용하여 적합시킨 모델들을 서로 비교할 수
있다.<br />
AIC, BIC, 검정통계량의 경우, <strong>mod3</strong>가 가장 낮은 것을
확인할 수 있었다.<br />
<strong>mod1, mod2</strong>의 유의확률은 유의수준 0.05보다 작으므로
귀무가설을 기각하여 변수간 독립이 아닌것을 알 수 있고
<strong>mod3</strong>는 유의확률이 유의수준 0.05보다 크므로 귀무가설을
기각하지 못하여 <strong>Sex</strong>변수에 대해서 공동적으로 독립인 것을
알 수 있다.</p>
<div class="sourceCode" id="cb680"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~Hair + Eye + Sex, data = HEC)
## 
## Statistics:
##                       X^2 df P(&gt; X^2)
## Likelihood Ratio 166.3001 24        0
## Pearson          164.9247 24        0</code></pre>
<div class="sourceCode" id="cb682"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1, mod2, mod3, <span class="at">test =</span> <span class="st">&quot;chisq&quot;</span>)</span></code></pre></div>
<pre><code>## LR tests for hierarchical log-linear models
## 
## Model 1:
##  ~Hair + Eye + Sex 
## Model 2:
##  ~Hair * Sex + Eye * Sex 
## Model 3:
##  ~Hair * Eye + Sex 
## 
##            Deviance df Delta(Dev) Delta(df) P(&gt; Delta(Dev)
## Model 1   166.30014 24                                    
## Model 2   156.67789 18    9.62225         6        0.14149
## Model 3    19.85656 15  136.82133         3        0.00000
## Saturated   0.00000  0   19.85656        15        0.17750</code></pre>
<p><code>anova</code>함수를 이용하여 모형을 비교하며, 잔차의 차이를
비교할 수 있다.<br />
<code>Model1, Model2</code>는 변수간 연관성이 높아 잔차의 차이가 크게
나타나므로 기존 모형을 대체하여 사용하는 것이 좋다는 근거가 된다.<br />
하지만, <code>Model3</code>는 기준 모형과의 잔차의 차이가 크지 않으므로
변수를 추가하여 복잡한 모형을 사용할 필요가 없다는 근거가 된다.</p>
<hr />
</div>
</div>
<div id="model-and-plot-collections" class="section level2">
<h2>5.5 Model and plot collections</h2>
<div id="sequential-plots-and-models" class="section level3">
<h3>5.5.1 Sequential plots and models</h3>
<div class="sourceCode" id="cb684"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="#cb684-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(nf <span class="cf">in</span> <span class="dv">2</span> <span class="sc">:</span> <span class="dv">5</span>){</span>
<span id="cb684-2"><a href="#cb684-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">loglin2string</span>(<span class="fu">joint</span>(nf, <span class="at">factors =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])))</span>
<span id="cb684-3"><a href="#cb684-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;[A] [B]&quot;
## [1] &quot;[A,B] [C]&quot;
## [1] &quot;[A,B,C] [D]&quot;
## [1] &quot;[A,B,C,D] [E]&quot;</code></pre>
<div class="sourceCode" id="cb686"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="#cb686-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nf <span class="cf">in</span> <span class="dv">2</span> <span class="sc">:</span> <span class="dv">5</span>){</span>
<span id="cb686-2"><a href="#cb686-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">loglin2string</span>(<span class="fu">conditional</span>(nf, <span class="at">factors =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]),<span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb686-3"><a href="#cb686-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;[A] [B]&quot;
## [1] &quot;[AC] [BC]&quot;
## [1] &quot;[AD] [BD] [CD]&quot;
## [1] &quot;[AE] [BE] [CE] [DE]&quot;</code></pre>
<div class="sourceCode" id="cb688"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="#cb688-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nf <span class="cf">in</span> <span class="dv">2</span> <span class="sc">:</span> <span class="dv">5</span>){</span>
<span id="cb688-2"><a href="#cb688-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">loglin2formula</span>(<span class="fu">conditional</span>(nf, <span class="at">factors =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])))</span>
<span id="cb688-3"><a href="#cb688-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## ~A + B
## ~A:C + B:C
## ~A:D + B:D + C:D
## ~A:E + B:E + C:E + D:E</code></pre>
<div class="sourceCode" id="cb690"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="#cb690-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglin2formula</span>(<span class="fu">joint</span>(<span class="dv">3</span>, <span class="at">table =</span> HEC))</span></code></pre></div>
<pre><code>## ~Hair:Eye + Sex</code></pre>
<div class="sourceCode" id="cb692"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglin2string</span>(<span class="fu">joint</span>(<span class="dv">3</span>, <span class="at">table =</span> HEC))</span></code></pre></div>
<pre><code>## [1] &quot;[Hair,Eye] [Sex]&quot;</code></pre>
<p><code>loglin2string</code> 혹은 <code>loglin2formula</code>함수를
이용하여 모자이크 관련 함수에서 사용할 수 있도록 위의 몇 가지 예제들과
같이 분석하고자 하는 모델 공식 또는 문자열로 변환해준다.</p>
<div class="sourceCode" id="cb694"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="#cb694-1" aria-hidden="true" tabindex="-1"></a>HEC.mods <span class="ot">&lt;-</span> <span class="fu">seq_loglm</span>(HEC, <span class="at">type =</span> <span class="st">&quot;joint&quot;</span>)</span>
<span id="cb694-2"><a href="#cb694-2" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(HEC.mods)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##            AIC    BIC LR Chisq Df Pr(&gt;Chisq)    
## model.1 194.40 193.78  165.592  3     &lt;2e-16 ***
## model.2 241.04 246.45  146.444  9     &lt;2e-16 ***
## model.3 192.74 217.65   19.857 15     0.1775    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>그러나, 주어진 유형에 따른 순차적 모델을 직접 입력하는 것은 번거로운
작업일 것이다.<br />
따라서, 이러한 경우 R에서는 <code>seq_loglm</code>함수를 이용하여
간단하게 진행할 수 있다.<br />
<code>seq_loglm</code>함수는 지정한 독립성 유형의 타입에 대해서 가능한
모든 독립성 유형 모델을 순차적으로 적합시켜주는 함수로,
<code>vcdExtra</code>패키지에 포함돼있다.<br />
- <code>seq_loglm(table,type)</code></p>
<ul>
<li>table: 로그선형모델을 적합시킬 분할표</li>
<li>type: 분석가가 가정하고자 하는 독립성 유형(“joint”, “conditional”,
“mutual”, “markov”, “saturated”)</li>
</ul>
<p>분석 후, <code>LRstats</code>함수를 이용하여 순차적 모델의 결과를
비교할 수도 있다.</p>
<p><code>model.1, model.2</code>의 유의확률은 유의수준 0.05보다 작으므로
귀무가설을 기각하여 변수간 독립이 아닌 것을 확인할 수 있고
<code>model.3</code>의 유의확률은 유의수준 0.05보다 크므로 귀무가설을
기각하지 못하여 변수간 독립인 것을 확인할 수 있다.</p>
</div>
<div id="causal-models" class="section level3">
<h3>5.5.2 Causal models</h3>
<p><em>Example 5.9: Martial status and pre-and extramarital sex</em></p>
<div class="sourceCode" id="cb696"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="#cb696-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;PreSex&quot;</span>, <span class="at">package =</span>  <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb696-2"><a href="#cb696-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(Gender <span class="sc">+</span> PremaritalSex <span class="sc">+</span> ExtramaritalSex <span class="sc">~</span> MaritalStatus, <span class="at">data =</span> PreSex)</span></code></pre></div>
<pre><code>##               Gender          Women             Men            
##               PremaritalSex     Yes      No     Yes      No    
##               ExtramaritalSex   Yes  No Yes  No Yes  No Yes  No
## MaritalStatus                                                  
## Divorced                         17  54  36 214  28  60  17  68
## Married                           4  25   4 322  11  42   4 130</code></pre>
<p><code>PreSex</code>데이터는 혼전 및 혼외 성관계와 이혼에 대해
나타나는 데이터로 <code>vcd</code>패키지 안에 포함돼있다.</p>
<ul>
<li>MartialStatus: 결혼 여부 (Factor variable - Divorced, Married)</li>
<li>ExtramaritialSex: 혼외 성관계 여부 (Factor variable - Yes, No)</li>
<li>PremartialSex 혼전 성관계 여부 (Factor variable - Yes, No)</li>
<li>Gender: 성별 (Facotr variable - Women, Men)</li>
</ul>
<p><code>PreSex</code>데이터를 <code>structable</code>함수를 이용하여
복잡한 형테의 분할표를 한 눈에 볼 수 있게 변환하였다.<br />
남성과 여성 모두 혼전, 혼외 성관계 여부가 No인 빈도가 가장 높았다.</p>
<div class="sourceCode" id="cb698"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="#cb698-1" aria-hidden="true" tabindex="-1"></a>PreSex <span class="ot">&lt;-</span> <span class="fu">aperm</span>(PreSex, <span class="dv">4</span> <span class="sc">:</span> <span class="dv">1</span>)</span></code></pre></div>
<p><code>aperm</code>함수를 이용하여 주어진 <code>PreSex</code>데이터의
범주형 변수의 수준을 재지정하였다.</p>
<div class="sourceCode" id="cb699"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="#cb699-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(<span class="fu">margin.table</span>(PreSex, <span class="dv">1</span> <span class="sc">:</span> <span class="dv">2</span>), <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb699-2"><a href="#cb699-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Gender and Premarital Sex&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-321-1.png" width="960" /></p>
<p>PreSex의 1번째 2번째 데이터를 통해 모자이크 플롯을 그려보았다.<br />
<strong>Gender = Women, Premarital Sex = Yes</strong>, <strong>Gender =
Men, Premarital Sex = No</strong>인 경우 관찰빈도가 기대빈도 보다
낮았고,<br />
<strong>Gender = Women, Premarital Sex = No</strong>, <strong>Gender =
Men, Premarital Sex = Yes</strong>인 경우 관찰빈도가 기대빈도 보다
높았다.<br />
이를 통해, 성별이 여성인 경우 Premarital Sex 경험이 적은 것으로
보였으며, 성별이 남성인 경우 Premarital Sex 경험이 많은 것 처럼 보이는
것을 확인할 수 있었다.<br />
유의확률은 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서,
<strong>PremaritalSex</strong>와 <strong>Gender</strong>는 독립이
아니며, 서로 연관성이 있다고 할 수 있다.</p>
<div class="sourceCode" id="cb700"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="#cb700-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(<span class="fu">margin.table</span>(PreSex, <span class="dv">1</span> <span class="sc">:</span> <span class="dv">3</span>),</span>
<span id="cb700-2"><a href="#cb700-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">expected =</span> <span class="sc">~</span> Gender <span class="sc">*</span> PremaritalSex <span class="sc">+</span> ExtramaritalSex, <span class="at">main =</span> <span class="st">&quot;Gender*Pre + ExtramaritalSex&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-322-1.png" width="960" /></p>
<p><strong>ExtramaritalSex</strong>변수까지 고려하여 모자이크 플롯을
다시 한 번 나타내었다.<br />
위의 모델은 <strong>ExtramaritalSex</strong>변수가
<strong>Gender</strong>, <strong>PremartialSex</strong>에 대해
공동적으로 독립이라는 가정을 한 후, 적합시킨 모델이다.<br />
위의 모자이크 플롯을 살펴본 결과, <strong>PremartialSex = Yes인
남성</strong>이 <strong>PremartialSex =No인 남성</strong>에 비해
<strong>ExtramaritalSex 가능성이 더 높은 것</strong>을 확인할 수
있다.<br />
유의확률은 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서,
<strong>ExtramaritalSex</strong>가 <strong>Gender</strong>,
<strong>PremartialSex</strong>에 대해서 공동적으로 독립이 아니라는 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb701"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="#cb701-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loddsratio</span>(<span class="fu">margin.table</span>(PreSex, <span class="dv">1</span> <span class="sc">:</span> <span class="dv">3</span>), <span class="at">stratum =</span> <span class="dv">1</span>,</span>
<span id="cb701-2"><a href="#cb701-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">log =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##  odds ratios for Gender and PremaritalSex by ExtramaritalSex 
## 
##       Yes        No 
## 0.2826923 0.2861062</code></pre>
<p>또한, 오즈비를 고려해봤을때, <strong>ExtramaritalSex</strong>는
<strong>PremartialSex</strong>의 여부에 따라 달라지지만,
<strong>성별</strong>에 따라 달라지지 않는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb703"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(PreSex, <span class="at">expected =</span> <span class="sc">~</span> Gender <span class="sc">*</span> PremaritalSex <span class="sc">*</span> ExtramaritalSex <span class="sc">+</span> MaritalStatus, <span class="at">main =</span> <span class="st">&quot;Gender*Pre*Extra + MaritalStatus&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-324-1.png" width="960" /></p>
<p><strong>MaritalStatus</strong> 변수까지 고려한 모자이크 플롯을
그려보았다.<br />
위의 모델은 <strong>MaritalStatus</strong>변수가
<strong>ExtramaritalSex</strong>, <strong>PremaritalSex</strong>,
<strong>Gender</strong>에 대해서 공동적으로 독립이라는 가정을 한 후,
적합시킨 모형이다.</p>
<p><strong>MaritalStatus = Married</strong>일 때, 남성과 여성 모두
<strong>ExtramaritalSex</strong>가 Yes보다 No인 빈도가 더 많이 나타나는
것을 확인할 수 있었으며, <strong>MaritalStatus = Divorced</strong>일 때,
남성과 여성 모두, <strong>ExtramaritalSex</strong>가 Yes인 빈도가 더
많이 나타나는 것 또한 확인할 수 있었다.</p>
<p>유의확률은 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서,
<strong>MaritalStatus</strong>변수가 <strong>ExtramaritalSex</strong>,
<strong>PremaritalSex</strong>, <strong>Gender</strong>에 대해서
공동적으로 독립이라고 할 수 없다.</p>
<div class="sourceCode" id="cb704"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="#cb704-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(PreSex,</span>
<span id="cb704-2"><a href="#cb704-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">expected =</span> <span class="sc">~</span> Gender <span class="sc">*</span> PremaritalSex <span class="sc">*</span> ExtramaritalSex <span class="sc">+</span> MaritalStatus <span class="sc">*</span> PremaritalSex <span class="sc">*</span> ExtramaritalSex, <span class="at">main =</span> <span class="st">&quot;G*P*E + P*E*M&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-325-1.png" width="960" /></p>
<p>위의 모델은 <strong>PremaritalSex</strong>,
<strong>ExtramaritalSex</strong>가 제어될 때, <strong>Gender</strong>와
<strong>MaritalStatus</strong>는 조건부 독립이라고 가정한 후, 적합시킨
모델이다.<br />
모자이크 플롯을 통해 특별한 패턴은 찾을 수 없었고 주어진 모형의
유의확률이 0.05보다 크므로 귀무가설을 기각한다.<br />
따라서, <strong>PremaritalSex</strong>,
<strong>ExtramaritalSex</strong>가 제어될 때, <strong>Gender</strong>와
<strong>MaritalStatus</strong>는 조건부 독립이라고 할 수 있다.</p>
</div>
<div id="partial-association" class="section level3">
<h3>5.5.3 Partial association</h3>
<p><em>Example 5.10: Employment status data</em></p>
<div class="sourceCode" id="cb705"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="#cb705-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Employment&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb705-2"><a href="#cb705-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(Employment)</span></code></pre></div>
<pre><code>##                              EmploymentLength &lt;1Mo 1-3Mo 3-12Mo 1-2Yr 2-5Yr &gt;5Yr
## EmploymentStatus LayoffCause                                                    
## NewJob           Closure                         8    35     70    62    56   38
##                  Replaced                       40    85    181    85   118   56
## Unemployed       Closure                        10    42     86    80    67   35
##                  Replaced                       24    42     41    16    27   10</code></pre>
<p><code>Employment</code>데이터는 1974년 해고된 직원 1314명을 연구한
데이터로 <code>vcd</code>패키지안에 포함돼있다.</p>
<ul>
<li>EmploymentStatus: 고용상태 (Factor variable - NewJob,
Unemployed)</li>
<li>EmploymentLength: 해고 당시 고용기간 (Factor variable - &lt;1Mo,
1-3Mo, 3-12Mo, 1-2Yr, 2-5Yr, &gt;5Yr)</li>
<li>LayoffCause: 해고 원인 (Factor variable - Closure, Replaced)</li>
</ul>
<p><em>Employment</em>데이터를 로드한 후, <code>structable</code>함수를
통해 데이터 탐색을 진행하였다.</p>
<div class="sourceCode" id="cb707"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(<span class="sc">~</span> EmploymentStatus <span class="sc">+</span> EmploymentLength <span class="sc">*</span> LayoffCause, <span class="at">data =</span> Employment)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~EmploymentStatus + EmploymentLength * LayoffCause, 
##     data = Employment)
## 
## Statistics:
##                       X^2 df P(&gt; X^2)
## Likelihood Ratio 172.2764 11        0
## Pearson          165.7020 11        0</code></pre>
<p><code>loglm</code>을 통해 <strong>EmploymentStatus</strong>가
<strong>EmploymentLength,LayoffCause</strong>과 독립이라는 가정을 하는
<strong>[EmploymentStatus] [EmploymentLength LayoffCause]</strong>모형을
적합시켰다.<br />
적합시킨 모형의 유의확률이 유의수준 0.05보다 작으므로 귀무가설을
기각한다. 따라서, <strong>EmploymentStatus</strong>는
<strong>EmploymentLength,LayoffCause</strong>과 독립이 아니라고 할 수
있다.</p>
<div class="sourceCode" id="cb709"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(Employment, <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb709-2"><a href="#cb709-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">expected =</span> <span class="sc">~</span> EmploymentStatus <span class="sc">+</span> EmploymentLength <span class="sc">*</span> LayoffCause, <span class="at">main =</span> <span class="st">&quot;EmploymentStatus + Length * Cause&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-328-1.png" width="960" /></p>
<p>위 모형의 <strong>모자이크 플롯</strong>을 그린 결과는 위와
같다.<br />
<strong>LayoffCause = Closure</strong>로 인한 해고인 경우
<strong>EmploymentLength에 관계없이 EmploymentStatus = Unemployed 빈도가
더 높은 것</strong>을 확인할 수 있으며, <strong>LayoffCause =
Replaced이면서, 3개월 이상의 EmploymentLength인 경우, Newjob일 빈도가
높은 것</strong>을 확인할 수 있었다.</p>
<div class="sourceCode" id="cb710"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="#cb710-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(<span class="sc">~</span> EmploymentStatus <span class="sc">*</span> LayoffCause <span class="sc">+</span> EmploymentLength <span class="sc">*</span> LayoffCause, <span class="at">data =</span> Employment)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~EmploymentStatus * LayoffCause + EmploymentLength * 
##     LayoffCause, data = Employment)
## 
## Statistics:
##                       X^2 df    P(&gt; X^2)
## Likelihood Ratio 24.63004 10 0.006092652
## Pearson          26.07206 10 0.003644473</code></pre>
<p>이번에는 <strong>LayoffCause</strong>이 제어될 때,
<strong>EmploymentStatus</strong>와 <strong>EmploymentLength</strong>은
서로 독립이라는 가정을 하는 <strong>[EmploymentStatus][LayoffCause]
[EmploymentLength][LayoffCause]</strong> 모형을 적합시켜 보았다.</p>
<p>LR방법을 통해 계산된 유의확률은 유의수준 0.05보다 크므로 귀무가설을
기각하지 못한다. 하지만, 피어슨 검정통계량 방법을 통해 계산된 유의확률은
유의수준 0.05보다 작으므로 귀무가설을 기각한다. 즉 두 방법에 대해 다른
결과가 나온 것을 확인할 수 있다.<br />
이러한 결과를 더 자세히 살펴보기 위해, 부분 관계에 대한 별도의 모델을
적합시켜본다.</p>
<div class="sourceCode" id="cb712"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="#cb712-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(Employment, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span> <span class="sc">:</span> <span class="dv">4</span>), <span class="at">expected =</span> <span class="sc">~</span> EmploymentStatus <span class="sc">*</span> LayoffCause <span class="sc">+</span> EmploymentLength <span class="sc">*</span> LayoffCause,</span>
<span id="cb712-2"><a href="#cb712-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;EmploymentStatus * Cause + Length * Cause&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-330-1.png" width="960" /></p>
<p>모자이크 플롯을 살펴본 결과, <strong>EmploymentLength가 3달 이하인
경우, LayoffCause = Replaced라고 하더라도, Unemployed일 빈도</strong>가
높았다.</p>
<div class="sourceCode" id="cb713"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="#cb713-1" aria-hidden="true" tabindex="-1"></a>mods.list <span class="ot">&lt;-</span></span>
<span id="cb713-2"><a href="#cb713-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(Employment, <span class="st">&quot;LayoffCause&quot;</span>,</span>
<span id="cb713-3"><a href="#cb713-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) <span class="fu">loglm</span>(<span class="sc">~</span> EmploymentStatus <span class="sc">+</span> EmploymentLength, <span class="at">data =</span> x))</span>
<span id="cb713-4"><a href="#cb713-4" aria-hidden="true" tabindex="-1"></a>mods.list</span></code></pre></div>
<pre><code>## $Closure
## Call:
## loglm(formula = ~EmploymentStatus + EmploymentLength, data = x)
## 
## Statistics:
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 1.478564  5 0.9155302
## Pearson          1.483492  5 0.9149669
## 
## $Replaced
## Call:
## loglm(formula = ~EmploymentStatus + EmploymentLength, data = x)
## 
## Statistics:
##                       X^2 df     P(&gt; X^2)
## Likelihood Ratio 23.15148  5 0.0003157832
## Pearson          24.58856  5 0.0001672716</code></pre>
<p>결과를 더 자세히 살펴보기 위해, 해고 원인의 두 수준에 대해서
<strong>EmploymentStatus</strong>,<strong>EmploymentLength</strong>에
대한 <code>loglm</code>개별 모델을 적합시켰다.</p>
<p><strong>Layoffcause = Closure</strong>일때의 <code>loglm</code>결과는
유의확률이 모두 유의수준 0.05보다 크므로 귀무가설을 기각하지 못한다.
따라서, <strong>EmploymentLength</strong>와
<strong>EmploymentStatus</strong>는 서로 독립이라고 할 수 있다.</p>
<p><strong>Layoffcause = Replaced</strong>일때의
<code>loglm</code>결과는 유의확률이 모두 유의수준 0.05보다 작으므로
귀무가설을 기각한다. 따라서, <strong>EmploymentLength</strong>와
<strong>EmploymentStatus</strong>는 서로 독립이 아니라고 할 수 있다.</p>
<div class="sourceCode" id="cb715"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="#cb715-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(Employment[,,<span class="st">&quot;Closure&quot;</span>], <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb715-2"><a href="#cb715-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span> <span class="sc">:</span> <span class="dv">4</span>),</span>
<span id="cb715-3"><a href="#cb715-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">margin =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;Layoff: Closure&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-332-1.png" width="960" /></p>
<p>모자이크 플롯을 통해서도 두 로그선형모델의 결과를 쉽게 이해할 수
있다.<br />
<strong>Layoffcause = Closure</strong>인 경우, 특별한 패턴은 보이지 않고
<strong>EmploymentLength</strong>과 <strong>EmploymentStatus</strong>는
독립인 것처럼 보인다.</p>
<div class="sourceCode" id="cb716"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="#cb716-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(Employment[,,<span class="st">&quot;Replaced&quot;</span>],<span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb716-2"><a href="#cb716-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span> <span class="sc">:</span> <span class="dv">4</span>),</span>
<span id="cb716-3"><a href="#cb716-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">margin =</span> <span class="fu">c</span>(<span class="at">right =</span> <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;Layoff: Replaced&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-333-1.png" width="960" /></p>
<p><strong>Layoffcause = Replaced</strong>인 경우,
<strong>EmploymentLength</strong>가 3개월 이하인 사람의 경우
<strong>EmploymentStatus = NewJob</strong>일 빈도가 낮지만
<strong>EmploymentLength</strong>가 3개월을 초과하는
<strong>EmploymentStatus = Unemployed</strong> 빈도가 상당히 낮은 것을
확인할 수 있다.</p>
<p>이렇게 전체적인 모델을 살펴볼때에는 드러나지 않는 패턴이 부분 관계에
대해 별도의 모델을 적합시키게 되면 쉽게 패턴을 찾을 수 있다.</p>
<p><em>Example 5.11: Corporal punishment data</em></p>
<div class="sourceCode" id="cb717"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="#cb717-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Punishment&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb717-2"><a href="#cb717-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Punishment)</span></code></pre></div>
<pre><code>##   Freq attitude memory  education   age
## 1    1       no    yes elementary 15-24
## 2    3       no    yes elementary 25-39
## 3   20       no    yes elementary   40-
## 4    2       no    yes  secondary 15-24
## 5    8       no    yes  secondary 25-39
## 6    4       no    yes  secondary   40-</code></pre>
<div class="sourceCode" id="cb719"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Punishment, <span class="at">vec.len =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    36 obs. of  5 variables:
##  $ Freq     : num  1 3 20 2 8 ...
##  $ attitude : Factor w/ 2 levels &quot;no&quot;,&quot;moderate&quot;: 1 1 1 1 1 ...
##  $ memory   : Factor w/ 2 levels &quot;yes&quot;,&quot;no&quot;: 1 1 1 1 1 ...
##  $ education: Factor w/ 3 levels &quot;elementary&quot;,&quot;secondary&quot;,..: 1 1 1 2 2 ...
##  $ age      : Factor w/ 3 levels &quot;15-24&quot;,&quot;25-39&quot;,..: 1 2 3 1 2 ...</code></pre>
<p><code>punishment</code>데이터는 아동 체벌에 대한 1,456명의 무작위
표본에 관한 데이터로 <code>vcd</code>패키지에 포함돼있다.</p>
<ul>
<li>Freq: 빈도 (Discrete variable)</li>
<li>attitude: 아이들에 대한 처벌 여부 (Factor variable -
no,moderate)</li>
<li>memory: 어릴때 체벌에 대한 기억이 있는지에 대한 여부 (Factor
variable - yes, no)</li>
<li>education: 최종학력 (Factor variable - elementary, secondary,
high)</li>
<li>age: 조사된 나이 그룹 (Factor variable - 15~24, 25~39, 40~)</li>
</ul>
<div class="sourceCode" id="cb721"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="#cb721-1" aria-hidden="true" tabindex="-1"></a>pun <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> memory <span class="sc">+</span> attitude <span class="sc">+</span> age <span class="sc">+</span> education, <span class="at">data =</span> Punishment)</span>
<span id="cb721-2"><a href="#cb721-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(pun) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb721-3"><a href="#cb721-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Memory =</span> <span class="fu">c</span>(<span class="st">&quot;yes&quot;</span>,<span class="st">&quot;no&quot;</span>),</span>
<span id="cb721-4"><a href="#cb721-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Attitude =</span> <span class="fu">c</span>(<span class="st">&quot;no&quot;</span>,<span class="st">&quot;moderate&quot;</span>),</span>
<span id="cb721-5"><a href="#cb721-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age =</span> <span class="fu">c</span>(<span class="st">&quot;15-24&quot;</span>, <span class="st">&quot;25-39&quot;</span>, <span class="st">&quot;40+&quot;</span>),</span>
<span id="cb721-6"><a href="#cb721-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Education =</span> <span class="fu">c</span>(<span class="st">&quot;Elementary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;High&quot;</span>))</span></code></pre></div>
<p><code>xtabs</code>함수를 이용하여 행은 <strong>Attitude</strong> 열은
<strong>Memory</strong>이고 <strong>Age</strong>,
<strong>Education</strong>을 계층변수로 가지는 분할표의 형태로
만들어주었다.</p>
<div class="sourceCode" id="cb722"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="#cb722-1" aria-hidden="true" tabindex="-1"></a>(mod.cond <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Memory <span class="sc">*</span> Age <span class="sc">*</span> Education <span class="sc">+</span></span>
<span id="cb722-2"><a href="#cb722-2" aria-hidden="true" tabindex="-1"></a>                     Attitude <span class="sc">*</span> Age <span class="sc">*</span> Education, <span class="at">data =</span> pun))</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~Memory * Age * Education + Attitude * Age * 
##     Education, data = pun)
## 
## Statistics:
##                       X^2 df     P(&gt; X^2)
## Likelihood Ratio 39.67937  9 8.685120e-06
## Pearson          34.60409  9 6.996362e-05</code></pre>
<p><code>loglm</code>함수를 사용하여 <strong>Age</strong>,
<strong>Education</strong>이 제어될 때, <strong>Memory</strong>,
<strong>Attitude</strong>가 조건부 독립이라는 가정을 한 후
로그선형모델에 적합시켜 보았다.<br />
적합시킨 모형의 유의확률이 모두 유의수준 0.05보다 작으므로 귀무가설을
기각한다.<br />
따라서, <strong>Age</strong>, <strong>Education</strong>이 제어될 때,
<strong>Memory</strong>, <strong>Attitude</strong>가 조건부 독립이
아니라고 할 수 있다. 즉, <strong>Memory</strong>와
<strong>Attitude</strong>는 서로 연관이있다고 할 수 있다.</p>
<div class="sourceCode" id="cb724"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="#cb724-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1071</span>)</span>
<span id="cb724-2"><a href="#cb724-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coindep_test</span>(pun, <span class="at">margin =</span> <span class="fu">c</span>(<span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Education&quot;</span>),</span>
<span id="cb724-3"><a href="#cb724-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">indepfun =</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">aggfun =</span> sum)</span></code></pre></div>
<pre><code>## 
##  Permutation test for conditional independence
## 
## data:  pun
## f(x) = 34.604, p-value &lt; 2.2e-16</code></pre>
<p><code>coindep_test</code>함수를 이용하여 분할표의 conditional 독립성
검정을 진행할수도 있다. <code>coindep_test</code>의 유의확률 또한
유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서
<strong>Memory</strong>와 <strong>Attitude</strong>는 서로 독립이
아니라고 할 수 있다.</p>
<div class="sourceCode" id="cb726"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="#cb726-1" aria-hidden="true" tabindex="-1"></a>mods.list <span class="ot">&lt;-</span> <span class="fu">apply</span>(pun, <span class="fu">c</span>(<span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Education&quot;</span>),</span>
<span id="cb726-2"><a href="#cb726-2" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x) <span class="fu">loglm</span>(<span class="sc">~</span> Memory <span class="sc">+</span> Attitude, <span class="at">data =</span> x)<span class="sc">$</span>pearson)</span></code></pre></div>
<p><code>apply</code>함수를 이용하여 <strong>Age, Education</strong>가
제어될 때, <code>loglm(~Memory + Attitude)</code>의 <strong>pearson
검정통계량</strong>을 확인하였다.<br />
전반적으로 전체 연령에서 <strong>Education = Elementary</strong>의
검정통계량이 높게 나오는 것을 확인할 수 있고 <strong>Age = 40+,
Education = Elementary</strong>일때의 검정통계량이 가장 높은것을 확인할
수 있다. 즉, <strong>Age = 40+, Education = Elementary</strong>일때
<strong>Memory</strong>와 <strong>Attitude</strong>변수의 연관성이 가장
강하다고 할 수 있다.</p>
<div class="sourceCode" id="cb727"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="#cb727-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1071</span>)</span>
<span id="cb727-2"><a href="#cb727-2" aria-hidden="true" tabindex="-1"></a>pun_cotab <span class="ot">&lt;-</span> <span class="fu">cotab_coindep</span>(pun, <span class="at">condvars =</span> <span class="dv">3</span> <span class="sc">:</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">&quot;mosaic&quot;</span>,</span>
<span id="cb727-3"><a href="#cb727-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">varnames =</span> <span class="cn">FALSE</span>, <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb727-4"><a href="#cb727-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">test =</span> <span class="st">&quot;sumchisq&quot;</span>, <span class="at">interpolate =</span> <span class="dv">1</span> <span class="sc">:</span> <span class="dv">2</span>)</span>
<span id="cb727-5"><a href="#cb727-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cotabplot</span>(<span class="sc">~</span> Memory <span class="sc">+</span> Attitude <span class="sc">|</span> Age <span class="sc">+</span> Education,</span>
<span id="cb727-6"><a href="#cb727-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> pun, <span class="at">panel =</span> pun_cotab)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-339-1.png" width="960" /></p>
<p><code>cotabplot</code>함수를 이용하여 여러 개의 모자이크 플롯을
나이와 교육수준에 따라 패널별로 살펴볼 수 있게 하였다.<br />
교육수준이 Elementary인 경우, <strong>Attitude = No, Memory =
Yes</strong>인 빈도가 낮은 경향을 보이는 것을 확인할 수 있었고 나이가
25세 이상인 경우, <strong>Attitude = moderate, Memory = yes</strong>인
빈도가 높은 경향을 보이는 것을 알 수 있었다.</p>
<div class="sourceCode" id="cb728"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="#cb728-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(<span class="sc">~</span> Memory <span class="sc">+</span> Attitude <span class="sc">|</span> Age <span class="sc">+</span> Education, <span class="at">data =</span> pun,</span>
<span id="cb728-2"><a href="#cb728-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span> <span class="sc">:</span> <span class="dv">4</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-340-1.png" width="960" /></p>
<p><code>cotabplot</code>함수를 이용하지 않고
<code>mosaic</code>함수에서도 <code>|</code>표현을 이용하여 다중
모자이크 플롯을 이용할 수 있다. 하지만 패널로 나누어진
<strong>cotabplot</strong>에 비해 한 눈에 보기 어렵다는 것을 알 수
있다.<br />
하지만, <strong>mosaic</strong>를 이용할 경우,
<strong>cotabplot</strong>과 다르게 나이와 교육수준의 조합에 대한 타일의
상대적 크기를 결정해주는 것을 살펴볼 수 있다.</p>
<p>두 그림을 봤을 때, <strong>Education = elementary</strong>인 경우
연령이 높아질수록 <strong>Attitude</strong>와 <strong>Memory</strong>
사이에 연관성이 강해지는 것을 확인할 수 있다.</p>
<p>특히, .<strong>Education = elementary, age = 40+</strong>그룹의 경우
<strong>Attitude = no</strong>일때에는 <strong>Memory = no</strong>일
관찰빈도가 높지만, <strong>Attitude = Yes</strong>일때에는
<strong>Memory = Yes</strong>일 관찰빈도가 높아지는 것을 확인할 수
있다.</p>
<hr />
</div>
</div>
<div id="mosaic-matrices-for-categorical-data" class="section level2">
<h2>5.6 Mosaic matrices for categorical data</h2>
<div id="mosaic-matrices-for-pairwise-associations"
class="section level3">
<h3>5.6.1 Mosaic matrices for pairwise associations</h3>
<p><em>Example 5.12: Bartlett data on plum-root cuttings</em></p>
<div class="sourceCode" id="cb729"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(Bartlett, <span class="at">gp =</span> shading_Friendly2)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-341-1.png" width="960" /></p>
<p><code>pairs</code>함수는 일반적으로 연속형 변수에 대해 모든 연속형
변수의 쌍별 조합을 하나의 패널안에 나타내 패턴을 찾고자할때 사용한다.
하지만, 연속형 변수뿐만 아니라 범주형 변수에서도 산점도 행렬을 통해 쉽게
패턴을 감지할 수 있다.<br />
- <code>pairs(x)</code></p>
<ul>
<li>x: 산점도 행렬을 그릴 데이터</li>
</ul>
<p><code>Bartlett</code>데이터는 자른 길이와 심은 시간이 생존에 미치는
영향을 조사하기 위한 데이터로 <code>vcdExtra</code>패키지에
포함돼있다.</p>
<ul>
<li>Length: 자른 길이 (Factor variable - Long, Short)</li>
<li>Time: 심은 시간 (Factor variable - Now, Spring)</li>
<li>Alive: 생존여부 (Factor variable - Alive, Dead)</li>
</ul>
<p><code>pairs</code>함수를 범주형 자료에 사용할 경우 위와 같은 그림을
얻을 수 있다. 모자이크 플롯과 더불어 각 범주형 변수의 수준에 대한 열과
행의 합을 도출해준다.</p>
<p>위의 모자이크 그림을 통해 <strong>Alive &amp; Time</strong>,
<strong>Alive &amp; Length</strong> 사이에서는 연관성이 존재하는 것처럼
보이지만, <strong>Time &amp; Length</strong> 사이에서는 연관성이
존재하지 않는 것(독립)처럼 보인다.</p>
<p><strong>Time &amp; Alive</strong>의 경우, <strong>Time = Now, Alive =
Alive</strong>일때 관찰빈도가 기대빈도보다 높지만, <strong>Time =
Spring, Alive = Dead</strong>일때는 관찰빈도가 기대빈도보다 낮은 것을
확인할 수 있다.</p>
<p><em>Example 5.13: Marital status and pre- and extramarital
sex</em></p>
<div class="sourceCode" id="cb730"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="#cb730-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;PreSex&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb730-2"><a href="#cb730-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(PreSex, <span class="at">gp =</span> shading_Friendly2, <span class="at">space =</span> <span class="fl">0.25</span>,</span>
<span id="cb730-3"><a href="#cb730-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb730-4"><a href="#cb730-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">diag_panel_args =</span> <span class="fu">list</span>(<span class="at">offset_varnames =</span> <span class="sc">-</span>.<span class="dv">5</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-342-1.png" width="960" /></p>
<p><code>PreSex</code>데이터에 <code>pairs</code>를 적용하여 다중
모자이크 플롯, 변수의 행과 열의 총빈도를 살펴본 결과이다.<br />
대략적인 모자이크 플롯을 봤을 때, <strong>Divorced &amp;
Gender</strong>변수(모자이크 플롯을 살펴보면 음영이 진하지 않고 선의
형태만 바뀐것을 볼 수 있으므로, 독립이다.)를 제외한 나머지 변수끼리는
어느 정도 연관성이 존재하는 것처럼 보인다.</p>
<p><em>Example 5.14: Berkeley admissions</em></p>
<div class="sourceCode" id="cb731"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb731-1"><a href="#cb731-1" aria-hidden="true" tabindex="-1"></a>largs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">labeling =</span> <span class="fu">labeling_border</span>(<span class="at">varnames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb731-2"><a href="#cb731-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">labels =</span> <span class="fu">c</span>(T,T,F,T),</span>
<span id="cb731-3"><a href="#cb731-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">alternate_labels =</span> <span class="cn">FALSE</span>))</span>
<span id="cb731-4"><a href="#cb731-4" aria-hidden="true" tabindex="-1"></a>dargs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">gp_varnames =</span> <span class="fu">gpar</span>(<span class="at">fontsize =</span> <span class="dv">20</span>), <span class="at">offset_varnames =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">labeling =</span> <span class="fu">labeling_border</span>(<span class="at">alternate_labels =</span> <span class="cn">FALSE</span>))</span>
<span id="cb731-5"><a href="#cb731-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(UCBAdmissions, <span class="at">shade =</span> <span class="cn">TRUE</span>, <span class="at">space =</span> <span class="fl">0.25</span>,</span>
<span id="cb731-6"><a href="#cb731-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">diag_panel_args =</span> dargs,</span>
<span id="cb731-7"><a href="#cb731-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper_panel_args =</span> largs,</span>
<span id="cb731-8"><a href="#cb731-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower_panel_args =</span> largs)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-343-1.png" width="960" /></p>
<p>위의 그림은 <code>UCBAdmissions</code> 데이터에
<code>pairs</code>함수를 적용하여 나타낸 결과이다.
<code>UCBAdmissions</code>데이터에서 <strong>Dept</strong>변수의 경우
많은 수준을 가지고 있기 때문에, 폰트, 여백등 다양한 옵션을 조정하여
시각화를 세밀하게 조정한 것을 살펴볼 수 있다.</p>
<p><code>Admit</code>을 볼 때, <strong>Admit = Admitted</strong> 보다
<strong>Admit = Rejected</strong>가 더 많은 것을 볼 수 있고,
<code>Gender</code>의 경우에는 <strong>Gender = Female</strong>보다
<strong>Gender = Male</strong>이 지원자가 더 많은 것을 확인할 수
있다.</p>
<p><strong>Gender &amp; Admit</strong>의 관계를 살펴보면, <strong>Gender
= Male</strong>이 <strong>Gender = Female</strong>보다 <strong>Admit =
Admitted</strong>이 더 많이 되는 경향이 있음을 보여준다.<br />
<strong>Gender &amp; Dept</strong>의 관계를 살펴보면, <strong>Gender =
Male</strong>은 <strong>Dept = A, Dept = B</strong>에 많이 지원한다.
<strong>Gender = Female</strong>의 경우에는 <strong>Dept = A, Dept =
B</strong>는 적게 지원하는 반면, <strong>Dept = C</strong> 부서에 가장
많은 지원을 하는 것을 볼 수 있다.<br />
<strong>Admit &amp; Dept</strong>의 관계를 살펴보면, <strong>Dept = A,
Dept = B</strong>에 <strong>Admit = Admitted</strong> 경향이 높게
나타나고 있으며, <strong>Dept = E, Dept = F</strong>에서 <strong>Admit =
Rejected</strong>하는 경우가 많은 것을 알 수 있다.</p>
</div>
<div id="generalized-mosaic-matrices-and-pairs-plots"
class="section level3">
<h3>5.6.2 Generalized mosaic matrices and pairs plots</h3>
<p><em>Example 5.15: Berkeley admissions</em></p>
<div class="sourceCode" id="cb732"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb732-1"><a href="#cb732-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(UCBAdmissions, <span class="at">space =</span> <span class="fl">0.2</span>,</span>
<span id="cb732-2"><a href="#cb732-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower_panel =</span> <span class="fu">pairs_mosaic</span>(<span class="at">type =</span> <span class="st">&quot;joint&quot;</span>),</span>
<span id="cb732-3"><a href="#cb732-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper_panel =</span> <span class="fu">pairs_mosaic</span>(<span class="at">type =</span> <span class="st">&quot;total&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-344-1.png" width="960" /></p>
<p><code>pairs</code>옵션에서
<code>lower_panel, upper_panel</code>옵션을 통해 앞서 살펴본 type을
지정할 수 있다.<br />
<code>lower_panel</code>은 왼쪽 아래에 3개의 모자이크 플롯을 나타내고
<code>upper_paenl</code>은 오른쪽 위에 3개의 모자이크 플롯을
나타낸다.</p>
<ul>
<li>type = “pairwise”: 다른 모든 변수들에 대해 <strong>이변량
marginal</strong> 관계를 보여준다.<br />
</li>
<li>type = “total”: <strong>상호 독립성</strong>에 대한 모자이크 플롯을
보여준다.<br />
</li>
<li>type = “conditional”: 모든 다른 변수들이 주어진 <strong>conditional
독립성</strong>에 대한 모자이크 그림을 보여준다.<br />
</li>
<li>type = “joint”: 모든 변수 쌍의 <strong>결합 독립성</strong>에 대한
모자이크 플롯을 보여준다.</li>
</ul>
<p><strong>joint</strong>를 가정하는 경우, <strong>Dept</strong>와
<strong>Admit</strong>은 연관이 없는 것처럼 보인다. 하지만,
<strong>total</strong>을 가정하는 경우, <strong>Dept</strong>와
<strong>Admit</strong>은 연관이 있는 것처럼 보인다.</p>
<div class="sourceCode" id="cb733"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="#cb733-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(UCBAdmissions, <span class="at">type =</span> <span class="st">&quot;conditional&quot;</span>, <span class="at">space =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-345-1.png" width="960" /></p>
<p>위 그림의 경우, <code>type = conditional</code>으로 지정했기 때문에
모든 다른 변수들이 주어진 conditional 독립성에 대한 모자이크 그림을
보여준다.<br />
앞서 살펴본 그림과 다르게, conditional 독립성을 가정하고 살펴보게 되면,
<strong>Admit</strong>변수와 <strong>Gender</strong>변수는 관련성이 없는
것처럼 보인다.</p>
<p>반면, <strong>Gender</strong>변수와 <strong>Dept</strong>변수를
살펴보면 앞서 살펴본 결과와 동일하게 <strong>Gender = Male</strong>의
경우에는 <strong>Dept = A, Dept = B</strong>에 많이 지원을하고
<strong>Gender = Female</strong>의 경우에는 <strong>Dept = A, Dept =
B</strong>에는 적게 지원하며, <strong>Dept = C</strong>에 많이 지원하는
경향을 보인다.<br />
따라서, conditional 독립성을 가정해도 <strong>Gender</strong>와
<strong>Dept</strong>는 서로 연관이 있는 것처럼 보인다.</p>
<p><em>Example 5.16: Arthritis treatment</em></p>
<div class="sourceCode" id="cb734"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb734-1"><a href="#cb734-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gpairs)</span>
<span id="cb734-2"><a href="#cb734-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span></code></pre></div>
<p><code>gpairs</code>패키지는 대부분의 데이터셋에 범주형 연속형
데이터가 모두 포함되어 있다는 가정하에 더욱 일반화된 산점도 행렬을
제공하는 패키지이다.</p>
<div class="sourceCode" id="cb735"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb735-1"><a href="#cb735-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gpairs</span>(Arthritis[,<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)],</span>
<span id="cb735-2"><a href="#cb735-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">diag.pars =</span> <span class="fu">list</span>(<span class="at">fontsize =</span> <span class="dv">20</span>),</span>
<span id="cb735-3"><a href="#cb735-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mosaic.pars =</span> <span class="fu">list</span>(<span class="at">gp =</span> shading_Friendly,</span>
<span id="cb735-4"><a href="#cb735-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">gp_args =</span> <span class="fu">list</span>(<span class="at">interpolate =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-347-1.png" width="960" /></p>
<p><code>gpairs</code>함수는 복잡한 데이터셋에서 연속형 변수와 범주형
변수간의 패턴을 보여주는 산점도 행렬을 그릴 수 있게해주는 함수로,
<code>gpairs</code>패키지안에 포함돼있다.<br />
- <code>gpairs(data,mosaic.pars)</code></p>
<ul>
<li>data: gpairs함수를 적용할 데이터</li>
<li>mosaic.pars: 산점도 행렬에 모자이크 플랏 구성 여부 (gp, gp_args를
통해 추가적인 옵션 지정 가능)</li>
</ul>
<p><code>Arthritis*</code>데이터에 <code>gpairs</code>함수를 적용시켜
보았다.<br />
출력 결과, 기존의 모자이크 플롯과 더불어 변수의 분포까지 출력해 주며,
가장 오른쪽 패널에 두 변수 간 산점도 또한 출력해주는 것을 확인할 수
있다.</p>
<p><strong>Treatment</strong>의 경우 <strong>Treatment =
Placebo</strong>, <strong>Treatment = Treated</strong>의 비율이 동일해
보이며, <strong>Sex</strong>의 경우 <strong>Sex = Female</strong>이
<strong>Sex = Male</strong>보다 빈도가 2배 정도 많은 것으로 보인다.</p>
<hr />
</div>
</div>
<div id="d-mosaics" class="section level2">
<h2>5.7 3D mosaics</h2>
<div class="sourceCode" id="cb736"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="#cb736-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic3d</span>(Bartlett)</span></code></pre></div>
<pre><code>## 필요한 네임스페이스를 로딩합니다: rgl</code></pre>
<p><code>mosaic3d</code>함수는 데이터의 모자이크 플롯을 2차원이 아닌
3차원의 플롯으로 확장해주는 함수로 <code>vcdExtra</code>패키지 안에
포함돼있다.<br />
- <code>mosiac3d*(table)</code></p>
<ul>
<li>table: 3차원의 모자이크 플롯을 적용하고자 하는 데이터</li>
</ul>
<hr />
</div>
<div id="visualizing-the-structure-of-loglinear-models"
class="section level2">
<h2>5.8 Visualizing the structure of loglinear models</h2>
<div class="sourceCode" id="cb738"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="#cb738-1" aria-hidden="true" tabindex="-1"></a>struc <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">10</span>,<span class="dv">312</span>,<span class="dv">44</span>,<span class="dv">37</span>,<span class="dv">31</span>,<span class="dv">192</span>,<span class="dv">76</span>),</span>
<span id="cb738-2"><a href="#cb738-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb738-3"><a href="#cb738-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">Age =</span> <span class="fu">c</span>(<span class="st">&quot;Young&quot;</span>, <span class="st">&quot;Old&quot;</span>),</span>
<span id="cb738-4"><a href="#cb738-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Sex =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;M&quot;</span>),</span>
<span id="cb738-5"><a href="#cb738-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Disease =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>)))</span>
<span id="cb738-6"><a href="#cb738-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-7"><a href="#cb738-7" aria-hidden="true" tabindex="-1"></a>struc <span class="ot">&lt;-</span> <span class="fu">as.table</span>(struc)</span>
<span id="cb738-8"><a href="#cb738-8" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(struc)</span></code></pre></div>
<pre><code>##               Sex   F   M
## Age   Disease            
## Young No            6 312
##       Yes          37 192
## Old   No           10  44
##       Yes          31  76</code></pre>
<p>임의의 데이터 <code>struc</code>를 생성한 후, 테이블 형태로
바꿔주었다.</p>
<ul>
<li>Disease: 질병여부 (Factor variable - No,Yes)</li>
<li>Age: 나이 (Facotr variable - Young, Old)</li>
<li>Sex: 성별 (Factor variable - F,M)</li>
</ul>
<div class="sourceCode" id="cb740"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="#cb740-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(struc, <span class="at">shade =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-350-1.png" width="960" /></p>
<p>모자이크 플롯을 살펴본 결과, <strong>Age = Young, Sex = M</strong>인
경우 질병 발생 빈도가 낮지만, <strong>Age = Old, Sex = M</strong> 질병
발생 빈도가 높은 것을 확인할 수 있다.<br />
<strong>Sex = F</strong>의 경우, <strong>Age = Young</strong>일 때 질병
발생 빈도가 높지만, <strong>Age = Old</strong>일 경우에도 질병 발생
빈도가 높은 것을 확인할 수 있다.<br />
유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각하므로
<strong>Sex,Age</strong>는 <strong>Disease</strong>와 독립이 아닌 것을
알 수 있다.</p>
<div class="sourceCode" id="cb741"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(struc, <span class="at">type =</span> <span class="st">&quot;expected&quot;</span>,<span class="at">shade=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-351-1.png" width="960" /></p>
<p>기대빈도를 통해 모자이크 플롯의 타일을 재구성한 결과, 관찰빈도와
비슷한 모자이크 플롯이 구성되는 것을 확인할 수 있다.<br />
유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각하므로
<strong>Sex,Age</strong>는 <strong>Disease</strong>와 독립이 아닌 것을
알 수 있다.</p>
<div id="mutual-independence" class="section level3">
<h3>5.8.1 Mutual independence</h3>
<div class="sourceCode" id="cb742"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb742-1"><a href="#cb742-1" aria-hidden="true" tabindex="-1"></a>mutual <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Age <span class="sc">+</span> Sex <span class="sc">+</span> Disease, <span class="at">data =</span> struc, <span class="at">fitted =</span> <span class="cn">TRUE</span>)</span>
<span id="cb742-2"><a href="#cb742-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">as.table</span>(<span class="fu">fitted</span>(mutual))</span>
<span id="cb742-3"><a href="#cb742-3" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(fit)</span></code></pre></div>
<pre><code>##               Sex          F          M
## Age   Disease                          
## Young No           34.099109 253.307670
##       Yes          30.799196 228.794025
## Old   No           10.036484  74.556737
##       Yes           9.065211  67.341569</code></pre>
<p><strong>Age,Sex,Disease</strong> 변수들의 상호 독립을 가정한 후,
주어진 데이터를 로그 선형 모델에 적합시켜보았다.<br />
<code>fit</code>변수는 적합된 로그 선형 모델을 통해 기대빈도를 구한
결과이다.</p>
<div class="sourceCode" id="cb744"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb744-1"><a href="#cb744-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(fit,<span class="at">gp =</span> shading_Friendly2, <span class="at">type =</span> <span class="st">&quot;total&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-353-1.png" width="960" /></p>
<p>적합된 로그 선형 모델의 기대빈도를 이용하여 <strong>모자이크
플롯</strong>을 그려보았다.<br />
하지만, 기대빈도를 통해 재구성한 모자이크 플롯은 위와 같이 <strong>세
변수간 연관성이 없는 것</strong> 처럼 보인다.</p>
<div class="sourceCode" id="cb745"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="#cb745-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic3d</span>(fit)</span></code></pre></div>
<p><code>mosaic3d</code>함수를 통해 <code>fit</code>변수의 적합된 값에
대한 <strong>3D 모자이크 플롯</strong>을 그릴 수 있다.</p>
</div>
<div id="joint-independence" class="section level3">
<h3>5.8.2 Joint Independence</h3>
<div class="sourceCode" id="cb746"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="#cb746-1" aria-hidden="true" tabindex="-1"></a>joint <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Age <span class="sc">*</span> Sex <span class="sc">+</span> Disease, <span class="at">data =</span> struc, <span class="at">fitted =</span> <span class="cn">TRUE</span>)</span>
<span id="cb746-2"><a href="#cb746-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">as.table</span>(<span class="fu">fitted</span>(joint))</span>
<span id="cb746-3"><a href="#cb746-3" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(fit)</span></code></pre></div>
<pre><code>##               Sex         F         M
## Age   Disease                        
## Young No           22.59322 264.81356
##       Yes          20.40678 239.18644
## Old   No           21.54237  63.05085
##       Yes          19.45763  56.94915</code></pre>
<p><strong>Disease</strong>변수가 <strong>Age, Sex</strong>변수에 대해서
공동으로 독립이라고 가정한 후, 다시 한 번 로그선형모델에
적합시켜보았다.</p>
<div class="sourceCode" id="cb748"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="#cb748-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(fit, <span class="at">gp =</span> shading_Friendly2)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-356-1.png" width="960" /></p>
<p><strong>joint independence</strong>를 가정한 후, 모자이크 플롯을
그려보았다. 그 결과, 앞선 결과와는 다르게
<strong>Age,Sex</strong>변수간에 약간의 연관성이 나타나는 것을 확인할 수
있다. 하지만, 여전히 전체적인 모형을 고려해볼때,
<strong>Age,Sex</strong>는 강한 연관성을 보여주는 것 같지는
않아보인다.</p>
<hr />
</div>
</div>
<div id="related-visualization-methods" class="section level2">
<h2>5.9 Related visualization methods</h2>
<p><code>Doubledecker plot</code>은 추가 범주형 변수에 대한 범주형 변수
(전형적으로 이항)의 의존성을 시각화한다. 즉, 종속 변수를 나타내는 변수를
제외한 모든 독립 변수에 대해 수직 분할이 있는 모자이크 플롯이다.<br />
이를 통해, 설명 변수의 조합과 관련된 조건부 반응 비율 간의 차이를 더
쉽게 읽을 수 있다는 장점이 있다.</p>
<p><code>Doubledecker plot</code>은 <code>vcd</code>패키지 안에
포함돼있다.<br />
- <code>Doubledecker(formula,data)</code></p>
<ul>
<li>formula: 데이터에서 사용할 변수들 및 Doubledecker의 구성 형태
지정(일반적으로 종속변수 ~ 설명변수 + 설명변수 +…의 형태)</li>
<li>data: Doubledecker 그림을 그릴 데이터</li>
</ul>
<div id="doubledecker-plots" class="section level3">
<h3>5.9.1 Doubledecker plots</h3>
<p><em>Example 5.18: Berkeley admissions</em></p>
<div class="sourceCode" id="cb749"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb749-1"><a href="#cb749-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doubledecker</span>(Admit <span class="sc">~</span> Dept <span class="sc">+</span> Gender, <span class="at">data =</span>UCBAdmissions[<span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>,,])</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-357-1.png" width="960" /></p>
<p><code>UCBAdmissions</code>데이터를 통해 더블데커 플랏을
그려보았다.<br />
종속변수의 수준에 따라 음영처리를 한 것을 볼 수 있다(<strong>Admit =
Admitted: 검은색</strong>, <strong>Admit = Rejected:
회색</strong>).<br />
<strong>Dept = A, Dept = B</strong>의 경우에는 <strong>Gender =
Male</strong>의 직사각형의 너비가 <strong>Gender = Female</strong>보다
넓은 것으로 보아 더 많이 지원한 것을 알 수 있으며, <strong>Dept = C,
Dept = E</strong>에서는 <strong>Gender = Female</strong>이
<strong>Gender = Male</strong>보다 지원을 많이 했고 <strong>Dept = D,
Dept = F</strong>에서는 <strong>Gender = Male, Gender = Female</strong>
모두 동일한 지원 빈도를 보여준다.<br />
<strong>Gender = Male, Gender = Female</strong> 모두 <strong>Dept = A,
Dept = B</strong>에서 <strong>Admit = Admitted</strong>가 제일 높은 것을
볼 수 있다.</p>
<p><em>Example 5.18: Titanic data</em></p>
<div class="sourceCode" id="cb750"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="#cb750-1" aria-hidden="true" tabindex="-1"></a><span class="fu">doubledecker</span>(Survived <span class="sc">~</span> Class <span class="sc">+</span> Age <span class="sc">+</span> Sex, Titanic)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-358-1.png" width="960" /></p>
<p><code>Titanic</code> 데이터에 대한 더블데커 플랏을 그려보았다. 모든
Class에서 <strong>Sex = Female</strong>의 <strong>Survived =
Yes</strong>빈도가 높으며, <strong>Sex = Male</strong>의 경우
<strong>Survived = Yes</strong>가 낮은 것을 확인할 수 있다.<br />
또한, <strong>Class = Crew</strong>인 곳에 사람이 가장 많이 타고 있는
것을 알 수 있으며, <strong>Age = Children</strong>의 경우 <strong>Class
= 3rd</strong>인 곳에 가장 많이 탑승한 것을 볼 수 있다.</p>
</div>
<div id="generalized-odds-ratios" class="section level3">
<h3>5.9.2 Generalized odds ratios</h3>
<p><em>Example 5.20: Corporal punishment data</em></p>
<div class="sourceCode" id="cb751"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="#cb751-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Punishment&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb751-2"><a href="#cb751-2" aria-hidden="true" tabindex="-1"></a>pun_lor <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(Freq <span class="sc">~</span> memory <span class="sc">+</span> attitude <span class="sc">|</span> age <span class="sc">+</span> education, </span>
<span id="cb751-3"><a href="#cb751-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> Punishment)</span>
<span id="cb751-4"><a href="#cb751-4" aria-hidden="true" tabindex="-1"></a>pun_lor_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pun_lor)</span></code></pre></div>
<p><code>loddsratio</code>함수를 통해 <code>Punishment</code>데이터의
로그 오즈비를 구한 후, <code>pun_lor_df</code> 객체에 데이터프레임의
형태로 저장해 주었다.</p>
<div class="sourceCode" id="cb752"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="#cb752-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pun_lor)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-360-1.png" width="960" /></p>
<p>오즈비가 저장된 객체를 plot의 입력값으로 주게 되면 위와 같이 인자의
수준에 따른 오즈비의 변화를 보여준다.</p>
<p><strong>Education = high</strong>의 경우, <strong>age</strong>그룹의
나이가 증가함에 따라서 <strong>로그오즈비</strong>가 낮아지는 경향이
있고 <strong>Education = Elementary</strong>의 경우,
<strong>age</strong>그룹의 나이가 증가함에 따라서
<strong>로그오즈비</strong>가 증가하는 경향이 있다.</p>
<p>즉, 최종학력이 고등학교인 사람들의 경우 처벌에 대한 기억이 나이가
증가할수록 점점 사라지지만, 최종학력이 초등학교인 사람들의 경우 처벌에
대한 기억이 나이가 증가할수록 점점 높아지는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb753"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb753-1"><a href="#cb753-1" aria-hidden="true" tabindex="-1"></a>pun_lor_df <span class="ot">&lt;-</span> <span class="fu">transform</span>(pun_lor_df, </span>
<span id="cb753-2"><a href="#cb753-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">as.numeric</span>(age), </span>
<span id="cb753-3"><a href="#cb753-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> <span class="fu">as.numeric</span>(education))</span>
<span id="cb753-4"><a href="#cb753-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb753-5"><a href="#cb753-5" aria-hidden="true" tabindex="-1"></a>pun_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(LOR <span class="sc">~</span> age <span class="sc">*</span> education, <span class="at">data =</span> pun_lor_df, </span>
<span id="cb753-6"><a href="#cb753-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">weights =</span> <span class="dv">1</span> <span class="sc">/</span> ASE<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb753-7"><a href="#cb753-7" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(pun_mod)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: LOR
##               Df Sum Sq Mean Sq F value  Pr(&gt;F)  
## age            1 1.0437  1.0437  2.7167 0.16022  
## education      1 1.8395  1.8395  4.7883 0.08028 .
## age:education  1 5.0441  5.0441 13.1299 0.01516 *
## Residuals      5 1.9208  0.3842                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>로그오즈비</strong>를 <strong>age,education</strong> 변수에
대한 선형회귀모형으로 적합시켜 보았다.<br />
<code>anova</code>를 통해 <strong>age,education</strong>의 상호작용에
대한 유의성 검정을 진행한 결과, 유의확률이 0.015로 유의수준 0.05보다
작다. 따라서, <strong>age,education</strong>간의 상호작용은 유의한
변수임을 알 수 있다.</p>
<p><em>Example 5.21: Titanic data</em></p>
<div class="sourceCode" id="cb755"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="#cb755-1" aria-hidden="true" tabindex="-1"></a>Titanic2 <span class="ot">&lt;-</span> Titanic[, , <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb755-2"><a href="#cb755-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-3"><a href="#cb755-3" aria-hidden="true" tabindex="-1"></a>Titanic2[<span class="st">&quot;Crew&quot;</span>, , <span class="st">&quot;Child&quot;</span>,] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb755-4"><a href="#cb755-4" aria-hidden="true" tabindex="-1"></a>titanic_lor1 <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(<span class="sc">~</span> Survived <span class="sc">+</span> Age <span class="sc">|</span> Class <span class="sc">+</span> Sex,</span>
<span id="cb755-5"><a href="#cb755-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> Titanic2)</span>
<span id="cb755-6"><a href="#cb755-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(titanic_lor1)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-362-1.png" width="960" /></p>
<p><code>Titanic</code>데이터의 생존 오즈비를 나이에 따라
살펴보았다.</p>
<p>성인의 생존 로그오즈비 대 아동의 생존 로그오즈비를 비교해 봤을 때,
여성의 생존 로그 오즈비가 항상 남성보다 높은 것을 확인할 수 있다.</p>
<p>남성과 여성 모두, <strong>Class가 1st -&gt; 2nd</strong> 변할 때
로그오즈비가 작아지다가 <strong>Class가 2nd -&gt; 3rd</strong>로 변할 때
로그오즈비가 커지는 것을 확인할 수 있다.<br />
특히, <strong>Class = 1st, Class = 2nd</strong>에서는 남성과 여성의
로그오즈비 차이가 크지만 <strong>Class = 3rd</strong>일때 로그오즈비의
차이가 크게 줄어든다.<br />
이를 통해, 여성의 경우에는 <strong>class = 1st</strong>일 때, 그렇지
않은 경우보다 생존할 오즈가 <strong>10.40(exp(2.3425))</strong>배 높았고
남성의 경우에는 <strong>Class = 3rd</strong>일 때, 그렇지 않은 경우보다
생존할 오즈가 <strong>0.512(exp(-0.6687))</strong>배 높았다는 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb756"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb756-1"><a href="#cb756-1" aria-hidden="true" tabindex="-1"></a>titanic_lor2 <span class="ot">&lt;-</span> <span class="fu">loddsratio</span>(<span class="sc">~</span> Survived <span class="sc">+</span> Sex <span class="sc">|</span> Class <span class="sc">+</span> Age,</span>
<span id="cb756-2"><a href="#cb756-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> Titanic2)</span>
<span id="cb756-3"><a href="#cb756-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(titanic_lor2)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-363-1.png" width="960" /></p>
<div class="sourceCode" id="cb757"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="#cb757-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(titanic_lor2<span class="sc">$</span>coefficients)</span></code></pre></div>
<pre><code>##  1st:Adult  2nd:Adult  3rd:Adult Crew:Adult  1st:Child  2nd:Child  3rd:Child 
## 0.01554124 0.01573901 0.22794856 0.04901693 3.66666667 0.85185185 0.45896066 
## Crew:Child 
##         NA</code></pre>
<div class="sourceCode" id="cb759"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(titanic_lor2)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-363-2.png" width="960" /></p>
<p><code>Titanic</code>데이터의 생존 로그오즈비를 성별에 따라
살펴보았다.</p>
<p>남성의 생존 로그오즈비 대 여성의 생존 오즈비는 성인보다 항상
어린아이의 생존오즈비가 더 높은 것을 확인할 수 있다.</p>
<p>어린이의 경우, <strong>Class = 1st</strong>에서 <strong>Class =
3rd</strong>로 이동함에 따라, 로그오즈비가 낮아지는 것을 확인할 수 있고
성인의 경우, <strong>Class = 1st</strong>에서 <strong>Class =
3rd</strong>로 이동함에 따라, 로그오즈비가 증가하는 것을 볼 수 있다.</p>
<p>어린이는 <strong>Class = 1</strong>일때, 그렇지 않은 경우보다 생존할
오즈가 <strong>exp(1.2992) = 3.667</strong>배 높은 것을 알 수 있고,
성인의 경우 <strong>Class = 3rd</strong>에서, 그렇지 않은 경우보다
생존할 오즈가 <strong>exp(-1.47) = 0.23</strong>배 높은 것을 알 수
있다.</p>
</div>
<div id="dount-plot" class="section level3">
<h3>5.9.3 Dount plot</h3>
<p><code>Donut plot</code>은 <strong>pie chart</strong>와 비슷하지만,
<strong>pie chart</strong>와 다르게 중간이 뚫려 있다는 차이점이
있다.<br />
<strong>pie chart</strong>의 경우 중간이 뚫려있지 않고 채워져있기 때문에
정보를 표시하는 공간이 제한적이다. 하지만, <code>Dount plot</code>의
경우 중심의 여백을 이용해 텍스트를 추가적으로 삽입하거나 추가적인
<strong>Pie chart</strong>를 삽입하는 등 더 많은 정보를 표시할 수 있다는
장점이 있다.</p>
<p>아쉽게도 <code>Dount plot</code>을 편리하게 그리기 위한 함수를 R에서
제공하고 있지 않기 때문에 <code>ggplot2</code>패키지의
<code>ggplot</code>함수를 통해 시각화할 수 있다.</p>
<div class="sourceCode" id="cb760"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb760-1"><a href="#cb760-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb760-2"><a href="#cb760-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">language =</span> <span class="fu">c</span>(<span class="st">&quot;SPSS&quot;</span>,<span class="st">&quot;Minitab&quot;</span>,<span class="st">&quot;R&quot;</span>,<span class="st">&quot;Python&quot;</span>), <span class="at">Freq =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">12</span>)) <span class="co"># 데이터 생성</span></span>
<span id="cb760-3"><a href="#cb760-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>fraction <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(data<span class="sc">$</span>Freq <span class="sc">/</span> <span class="fu">sum</span>(data<span class="sc">$</span>Freq)) <span class="co"># 데이터의 퍼센트 구하기</span></span>
<span id="cb760-4"><a href="#cb760-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ymax <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(data<span class="sc">$</span>fraction) <span class="co"># 누적합 구하기. 각 데이터의 끝을 나타냄.</span></span>
<span id="cb760-5"><a href="#cb760-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ymin <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">head</span>(data<span class="sc">$</span>ymax, <span class="at">n =</span> <span class="sc">-</span><span class="dv">1</span>)) <span class="co"># 각 데이터의 하단을 나타냄.</span></span>
<span id="cb760-6"><a href="#cb760-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>labelPosition <span class="ot">&lt;-</span> (data<span class="sc">$</span>ymax <span class="sc">+</span> data<span class="sc">$</span>ymin) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb760-7"><a href="#cb760-7" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>label <span class="ot">&lt;-</span> <span class="fu">paste0</span>(data<span class="sc">$</span>language, <span class="st">&quot;</span><span class="sc">\n</span><span class="st"> Frequency: &quot;</span>, data<span class="sc">$</span>Freq)</span>
<span id="cb760-8"><a href="#cb760-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##   language Freq  fraction      ymax      ymin labelPosition
## 1     SPSS    4 0.1428571 0.1428571 0.0000000    0.07142857
## 2  Minitab    5 0.3214286 0.4642857 0.1428571    0.30357143
## 3        R    7 0.5714286 1.0357143 0.4642857    0.75000000
## 4   Python   12 1.0000000 2.0357143 1.0357143    1.53571429
##                    label
## 1    SPSS\n Frequency: 4
## 2 Minitab\n Frequency: 5
## 3       R\n Frequency: 7
## 4 Python\n Frequency: 12</code></pre>
<p>위의 데이터는 임의로 생성한 데이터로, 통계분석을 위한 컴퓨터
프로그래밍 언어 중 어떠한 언어를 선호하는지에 대해 나타내는
데이터이다.<br />
<code>fraction</code>은 빈도의 누적 비율을 나타내고, <code>ymax</code>는
각 비율에 대한 누적합을 구한 결과로 각 데이터의 끝을 나타내며,
<code>ymin</code>은 각 데이터의 하단을 나타낸다.<br />
<code>labelPosition</code>은 <code>donutplot</code>에서
<code>text</code>를 표시하고자 할 때, 각 영역의 중앙에 오도록
<strong>(ymax + ymin)/2</strong>로 설정한 값이다.</p>
<div class="sourceCode" id="cb762"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb762-1"><a href="#cb762-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">ymax =</span> ymax, <span class="at">ymin =</span> ymin, <span class="at">xmax =</span> <span class="dv">4</span>, <span class="at">xmin =</span> <span class="dv">3</span>, <span class="at">fill =</span> language))<span class="sc">+</span></span>
<span id="cb762-2"><a href="#cb762-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>() <span class="sc">+</span></span>
<span id="cb762-3"><a href="#cb762-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">x =</span> <span class="fl">3.5</span>, <span class="fu">aes</span>(<span class="at">y =</span> labelPosition, <span class="at">label =</span> label), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb762-4"><a href="#cb762-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb762-5"><a href="#cb762-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb762-6"><a href="#cb762-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb762-7"><a href="#cb762-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb762-8"><a href="#cb762-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span><span class="dv">2</span>, <span class="at">label =</span> <span class="st">&quot;Students&#39;s favorite Computer language</span><span class="sc">\n</span><span class="st"> in Statistics&quot;</span>,<span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb762-9"><a href="#cb762-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;Black&quot;</span>)</span></code></pre></div>
<pre><code>## Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-365-1.png" width="960" /></p>
<p><code>dount plot</code>을 그리기 위해서는 위에 얻어진 데이터를 이용해
<code>geom_rect</code>함수를 통해 직사각형을 그린 후, 이 직사각형의
앞부분을 짜르게 된다.<br />
직사각형의 앞부분을 짜른 후, <code>coord_polar</code>함수를 이용하여
원형으로 바꿔주게 되면 직사각형의 앞면이 뚫려있으므로, 원형으로 바꿨을
때 가운데가 뚫리게 되어 <code>donut plot</code>을 완성할 수 있게
된다.</p>
<p><code>annotate</code>함수는 원하는 위치에 원하는 텍스트를 넣을 수
있게 하는 옵션으로, 뚫린 가운데 원에 제목을 넣기 때문에 시각화한 결과를
조금 더 한 눈에 들어올 수 있게 만들어준다.</p>
</div>
<div id="balloon-plot" class="section level3">
<h3>5.9.4 Balloon plot</h3>
<p><code>Balloon plot</code>은 교차표로 만들어진 데이터를 시각화 하는데
유용하게 사용되는 기법 중 하나로, R에서는 <code>gplots</code>패키지에
포함된 <code>Balloonplot</code>함수를 이용하여 그릴 수 있다.</p>
<p><code>gplots</code>패키지는 데이터를 시각화하기 위한 도구로
회귀진단에 사용되는 <code>lmplot2, residplot</code>, 신뢰구간을
시각화하기 위한 <code>plotCI, plotmeans</code>등 다양한 향상된 시각화
함수들을 제공하는 패키지이다.<br />
- <code>balloonplot(data,label,show.margins)</code></p>
<ul>
<li>data: balloonplot을 그릴 데이터 (반드시 교차표의 형태)</li>
<li>label: 빈도표시 여부</li>
<li>show.margins: margin 테이블 표시 여부</li>
</ul>
<div class="sourceCode" id="cb764"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb764-1"><a href="#cb764-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb764-2"><a href="#cb764-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;gplots&#39;:
##   method         from 
##   reorder.factor gdata</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<div class="sourceCode" id="cb768"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb768-1"><a href="#cb768-1" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Age =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;20&quot;</span>,<span class="dv">16</span>),<span class="fu">rep</span>(<span class="st">&quot;30&quot;</span>,<span class="dv">22</span>),<span class="fu">rep</span>(<span class="st">&quot;40&quot;</span>,<span class="dv">21</span>),<span class="fu">rep</span>(<span class="st">&quot;50&quot;</span>,<span class="dv">11</span>)))</span>
<span id="cb768-2"><a href="#cb768-2" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;SPSS&quot;</span>,<span class="st">&quot;Minitab&quot;</span>,<span class="st">&quot;R&quot;</span>,<span class="st">&quot;Python&quot;</span>),<span class="dv">70</span>,<span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb768-3"><a href="#cb768-3" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data1,data2)</span>
<span id="cb768-4"><a href="#cb768-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data1)[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">&quot;language&quot;</span></span>
<span id="cb768-5"><a href="#cb768-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span>Age <span class="sc">+</span> language, <span class="at">data =</span> data1)</span>
<span id="cb768-6"><a href="#cb768-6" aria-hidden="true" tabindex="-1"></a><span class="fu">balloonplot</span>(df, <span class="at">main =</span> <span class="st">&quot;Favorite Computer language in statistics by Age&quot;</span>,<span class="at">label =</span><span class="cn">FALSE</span>,<span class="at">show.margins =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-366-1.png" width="960" /></p>
<p>데이터의 경우, 앞서 사용한 학생들이 가장 좋아하는 컴퓨팅 언어에서
연령 변수를 추가하여 연령에따른 컴퓨팅 언어 선호도 데이터를
만들어주었다.<br />
<code>balloonplot</code>함수를 사용하여 위와 같은 그림을 얻을 수
있다.</p>
<p>각 셀에 위치한 풍선처럼 생긴 원은 각 셀의 빈도를 나타낸다. 원이
클수록 셀의 빈도가 높다는 의미이고 원이 작을수록 셀의 빈도가 낮다는
의미이다.</p>
<div class="sourceCode" id="cb769"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="#cb769-1" aria-hidden="true" tabindex="-1"></a><span class="fu">balloonplot</span>(df, <span class="at">main =</span> <span class="st">&quot;Favorite Computer language in statistics by Age&quot;</span>,</span>
<span id="cb769-2"><a href="#cb769-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">TRUE</span>,</span>
<span id="cb769-3"><a href="#cb769-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.margins =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-367-1.png" width="960" /></p>
<p><code>label, show.margins</code>옵션을 <code>TRUE</code>로 지정하게
되면 각 셀마다의 빈도 및 셀의 <strong>marginal sum</strong>을 출력하도록
만들어 줄 수 있다.<br />
제일 많이 선호되는 언어는 Minitab이 22명으로 가장 많고, 연령대의 경우
22명으로 30대가 가장 많은 것을 쉽게 살펴볼 수 있다.<br />
20대의 경우 SPSS를 선호하며, 30대의 경우 모든 컴퓨팅 언어가 거의 비슷한
빈도를 가지며, 40대의 경우에는 Minitab, Python을, 50대의 경우에는
Minitab을 가장 선호하는 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb770"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb770-1"><a href="#cb770-1" aria-hidden="true" tabindex="-1"></a><span class="fu">balloonplot</span>(df, <span class="at">main =</span> <span class="st">&quot;Favorite Computer language in statistics by Age&quot;</span>,</span>
<span id="cb770-2"><a href="#cb770-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">label =</span> <span class="cn">TRUE</span>,</span>
<span id="cb770-3"><a href="#cb770-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.margins =</span> <span class="cn">TRUE</span>, </span>
<span id="cb770-4"><a href="#cb770-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">dotcolor =</span> <span class="st">&quot;#D1B2FF&quot;</span>,<span class="at">dotchar =</span> <span class="dv">17</span>,</span>
<span id="cb770-5"><a href="#cb770-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">label.color=</span><span class="st">&quot;#0054FF&quot;</span>,<span class="at">text.color =</span> <span class="st">&quot;#F15F5F&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-368-1.png" width="960" /></p>
<p><code>dotcolor, dotchar, label.color, text.color</code>을 통해 도형,
텍스트의 색깔이나 모양을 쉽게 바꿔줄 수 있다.</p>
<div class="sourceCode" id="cb771"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="#cb771-1" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data1 <span class="sc">%&gt;%</span> </span>
<span id="cb771-2"><a href="#cb771-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Age,language) <span class="sc">%&gt;%</span> </span>
<span id="cb771-3"><a href="#cb771-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">freq=</span><span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;Age&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb773"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code></pre></div>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;ggpubr&#39;
## 
## The following object is masked from &#39;package:plyr&#39;:
## 
##     mutate</code></pre>
<div class="sourceCode" id="cb775"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="#cb775-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggballoonplot</span>(data2, <span class="at">x =</span> <span class="st">&quot;Age&quot;</span>,<span class="at">y =</span> <span class="st">&quot;language&quot;</span>, <span class="at">size=</span><span class="st">&quot;freq&quot;</span>,</span>
<span id="cb775-2"><a href="#cb775-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;freq&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-369-1.png" width="960" /></p>
<p><code>ggpubs</code>패키지에 있는 <code>ggballoonplot</code>함수를
이용하여 <strong>balloon plot</strong>을 그릴수도 있다.<br />
<code>ggpubs</code>패키지는 <code>ggplot2</code>에 기반한 패키지로 더욱
전문적이고 깔끔한 시각화를 진행할 수 있는 함수를 제공하는
패키지이다.<br />
- <code>ggballoonplot(data,x,y,size,fill,facet.by)</code></p>
<ul>
<li>data: <strong>balloonplot</strong>을 그리고자 하는 데이터</li>
<li>x: x축의 변수</li>
<li>y: y축의 변수</li>
<li>size: 원의 크기를 정할 기준 변수</li>
<li>fill: 농도를 정할 기준 변수</li>
<li>facet.by: 패널을 나눌 변수</li>
</ul>
<p><code>ggballoonplot</code>을 통해 <strong>balloon plot</strong>을
그린 결과이다.<br />
<code>fill = freq</code>로 지정하였기 때문에 원의 빈도에 따라 색깔의
농도가 진해지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb776"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb776-1"><a href="#cb776-1" aria-hidden="true" tabindex="-1"></a>data2<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;서울&quot;</span>,<span class="st">&quot;경기&quot;</span>,<span class="st">&quot;인천&quot;</span>,<span class="st">&quot;강원도&quot;</span>),<span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb776-2"><a href="#cb776-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggballoonplot</span>(data2, <span class="at">x =</span> <span class="st">&quot;Age&quot;</span>,<span class="at">y =</span> <span class="st">&quot;language&quot;</span>, <span class="at">size=</span><span class="st">&quot;freq&quot;</span>,</span>
<span id="cb776-3"><a href="#cb776-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;freq&quot;</span>,<span class="at">facet.by =</span> <span class="st">&quot;location&quot;</span>) <span class="sc">+</span> </span>
<span id="cb776-4"><a href="#cb776-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-370-1.png" width="960" /></p>
<p><code>facet.by</code>함수를 통해 원하는 변수에 따라서 패널을 나누고
<strong>balloon plot</strong>을 그릴수도 있다.</p>
<hr />
</div>
</div>
<div id="summary-of-chapter5" class="section level2">
<h2>Summary of Chapter5</h2>
<ul>
<li><strong>모자이크 플롯</strong>은 2-way, 3-way, … , n-way등의 고차원
분할표를 시각화하고 변수들의 패턴을 파악하는데에 유용하게 사용할 수 있는
방법이다.<br />
</li>
<li><strong>로그선형모델</strong>은 고차원의 분할표를 이용하는 경우,
다양한 독립성 유형의 모델을 가정한 후, 데이터를 모형에 적합시키고 싶을
때, 사용할 수 있는 방법이다.<br />
</li>
<li>흔히 자주 사용되는 독립성 유형으로는 모든 변수가 상호독립이라는
가정을 하는 <strong>Complete Independence</strong>, 특정 변수들이
분석하고자 하는 변수에 대한 공동적인 독립이라는 가정을 하는
<strong>Joint Independence</strong>, 특정 변수들이 제어될 때 분석하고자
하는 변수들이 조건부 독립이라는 가정을 하는 <strong>Conditional
Independence</strong>, 어떠한 쌍도 독립적이지않다 라는 가정을 하는
<strong>No three -way interaction</strong>유형이 있다.<br />
</li>
<li>3원 분할표 혹은 고차원의 분할표에서 분석하고자 하는 두 변수 사이에
계층 변수인 C가 일부 수준에서는 연관되지만 다른 수준에서는 연관되지 않을
수 있다. 이러한 경우, 전체 모형에 대해 영향을 끼치게 되므로 부분적으로
계층 변수의 수준에 따라 두 변수의 관계가 어떻게 변하는지 탐구하는 것이
필요하다. 이러한 방법을 <strong>부분 연관(Partial
association)</strong>이라고 한다.<br />
</li>
<li><strong>산점도 행렬</strong>은 일반적으로 연속형 변수의 패턴을
보기위해 많이 사용하지만, 범주형 변수의 패턴을 보기위해 사용할수도
있다.<br />
</li>
<li><strong>오즈비</strong>의 변화를 단순히 결과창을 통해 해석하면서
비교하는 것보다는 한 객체에 저장한 후, <code>plot</code>함수를 통해
변수의 수준 변화에 따라 어떻게 변하는지 보는 것이 좋다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap7-logistic-regression-models" class="section level1">
<h1>Chap7 Logistic Regression Models</h1>
<p>반응변수가 범주형(보통 이항이지만, 셋 이상)인 경우에는 연속형 변수와
다른 모델링 프레임워크 및 시각화 방법을 사용해야 한다.<br />
기존에 사용하던 선형회귀모델을 적합시키게 되면, 반응변수가 범주형이기
때문에 모델이 적절한 예측을 제공하지 못할수도 있다.<br />
또한, 설명변수에 모델을 적합시킨 후에는 유의한 설명변수가 무엇인지를
확인하고 잔차진단 과정을 통해 결과를 왜곡할 수 있는 이상치를 탐지하고
결과를 통해 통계적 추론 및 예측을 진행한다.</p>
<hr />
<div id="introduction-2" class="section level2">
<h2>7.1 Introduction</h2>
<p>지금까지 우리가 살펴본 Chapter를 통해 범주형 변수 간의 관계를
확인하고 이러한 결과를 시각화 할 수 있는 방법들에 대해서
알아보았다.<br />
Chpater7에서는 <strong>반응변수가 범주형 변수</strong>인 경우의 데이터
분석을 위핸 모델링 기반 방법에 대해서 알아본다.<br />
여기서 사용되는 모델들은 관측치에 대해 확률 분포를 고려하고 모델에 의해
설명되는 체계적 성분과 그렇지 않은 무작위 성분을 명확히 구별한다는
점에서 우리가 이전에 살펴봤던 모델들과는 차이가 있다.<br />
모델 기반 접근방식을 통해 불확실성에 대한 측정과 동시에 설명 변수 범위에
대해 예측 값을 추정할 수 있는 능력을 통해 범주형 데이터를 간결하게
요약할 수 있다.</p>
<hr />
</div>
<div id="the-logistic-regression-model" class="section level2">
<h2>7.2 The logistic regression model</h2>
<p><strong>로지스틱 회귀 모형(Logistic regression model)</strong>은
반응변수가 이산형 변수일 때, 반응변수와 설명 변수 집합 사이의 관계를
설명하는데 사용된다.<br />
선형 회귀분석이 독립변수와 종속변수 사이의 선형적 관계를 살펴보는
것이라면, 로지스틱 회귀분석은 일반화 선형모형의 특수한 경우로 그래프가
S형 곡선을 가지고 있는 것이 특징이다.</p>
<p>또한, 로짓(logit)함수를 사용하여 출력값의 범위를 [0,1]로 제한하는데,
이는 로지스틱 회귀모형의 핵심 아이디어 중 하나로 확률적으로 결과를
해석할 수 있도록 돕는다.</p>
<p><span class="math display">\[
logit(\pi) = log (\frac{\pi}{ 1- \pi}) \\ (여기서,  \pi = 확률)
\]</span></p>
<p>일반적으로 출력값이 0.5보다 클 경우, 사건이 발생한다고 예측하고
출력값이 0.5보다 작을 경우에는 사건이 발생하지 않는다고 가정한다.<br />
EX)</p>
<ul>
<li>고객 신용도 평가 (우량 / 불량),</li>
<li>심장병 예측 (발생 / 발생 X) 등</li>
</ul>
<p>이때, <strong>threshold</strong>로 사용되는 0.5의 경우 연구자의
연구목적에 따라 다른 값을 지정할 수도 있다.</p>
<div class="sourceCode" id="cb777"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="#cb777-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb777-2"><a href="#cb777-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">0.95</span>)</span>
<span id="cb777-3"><a href="#cb777-3" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">&lt;-</span> p <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> p)</span>
<span id="cb777-4"><a href="#cb777-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(p,</span>
<span id="cb777-5"><a href="#cb777-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">odds =</span> <span class="fu">as.character</span>(<span class="fu">fractions</span>(odds)),</span>
<span id="cb777-6"><a href="#cb777-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">logit =</span> <span class="fu">log</span>(odds))</span></code></pre></div>
<pre><code>##      p odds     logit
## 1 0.05 1/19 -2.944439
## 2 0.10  1/9 -2.197225
## 3 0.25  1/3 -1.098612
## 4 0.50    1  0.000000
## 5 0.75    3  1.098612
## 6 0.90    9  2.197225
## 7 0.95   19  2.944439</code></pre>
<p><code>logit</code>함수는 앞서 설명한 것처럼 오즈에
<strong>log</strong>를 취한 형태로 쓰이는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb779"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="#cb779-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(popbio)</span>
<span id="cb779-2"><a href="#cb779-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb779-3"><a href="#cb779-3" aria-hidden="true" tabindex="-1"></a><span class="fu">logi.hist.plot</span>(Arthritis<span class="sc">$</span>Age, Arthritis<span class="sc">$</span>Improved <span class="sc">&gt;</span> <span class="st">&quot;None&quot;</span>, <span class="at">type =</span> <span class="st">&quot;hist&quot;</span>,</span>
<span id="cb779-4"><a href="#cb779-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">counts =</span> <span class="cn">TRUE</span>, <span class="at">ylabel =</span> <span class="st">&quot;Probability (Better)&quot;</span>,<span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-372-1.png" width="960" /></p>
<p><code>pobio</code>패키지는 연령 또는 단계별로 표시된 데이터에 대한
투영 행렬 모델을 구성하고 분석하도록 도와주는 패키지이다.</p>
<p><code>logi.hist.plot</code>함수는 히스토그램과 상자그림을 이용하여 더
나은 반응에 대한 관측치의 확률의 조건부 분포를 확인할 수 있다.<br />
- <code>logi.hist.plot(x,y,type,counts)</code></p>
<ul>
<li>x: x축에 사용될 데이터</li>
<li>y: y축에 사용될 데이터</li>
<li>type: 시각화 타입</li>
<li>counts: 빈도표시 여부</li>
</ul>
<p><code>logi.hist.plot</code>을 <code>Arthritis</code>데이터의
<strong>Age, Improved</strong>변수를 통해 그려보았다. 0과 1로 분류될
경우에 각 연령에 대한 빈도 및 히스토그램, 상자그림을 통해 반응변수에
대한 전반적인 설명변수의 분포를 확인할 수 있다.<br />
또한, <strong>나이가 증가할수록 약의효과가 좋게 나타날 확률이 점점
높아지는 것</strong>을 볼 수 있다.</p>
<div id="fitting-a-logistic-regression-model" class="section level3">
<h3>7.2.1 Fitting a logistic regression model</h3>
<p>R에서는 <code>glm</code>함수를 사용하여 로지스틱 회귀모형을 적합시킬
수 있다.<br />
이때, <code>family = binomial(link = logit)</code>옵션을 적용하는데,
로지스틱 회귀모형의 경우 반응변수가 이항변수가 되도록 설정해야하며
<strong>logit link function</strong>을 사용해야 하기때문에
<code>family = binomial</code>옵션을 지정한다.<br />
<code>family = binomial</code>옵션을 지정하게 되면
<code>link</code>옵션을 입력하지 않아도 <code>link function</code>은
자동으로 <strong>logit</strong>으로 설정이 된다.</p>
<p><em>Example 7.1: Arthritis treatment</em></p>
<div class="sourceCode" id="cb780"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="#cb780-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb780-2"><a href="#cb780-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>, <span class="at">package  =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb780-3"><a href="#cb780-3" aria-hidden="true" tabindex="-1"></a>Arthritis<span class="sc">$</span>Better <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Arthritis<span class="sc">$</span>Improved <span class="sc">&gt;</span> <span class="st">&quot;None&quot;</span>)</span></code></pre></div>
<p><strong>Improved = None</strong>이 아닐 경우 1을 가지고
<strong>Improved = None</strong>인 경우에는 0을 가지는 변수
<code>Better</code>을 새로 생성하였다.</p>
<div class="sourceCode" id="cb781"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb781-1"><a href="#cb781-1" aria-hidden="true" tabindex="-1"></a>arth.logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(Better <span class="sc">~</span> Age, <span class="at">data =</span> Arthritis, <span class="at">family =</span> binomial)</span>
<span id="cb781-2"><a href="#cb781-2" aria-hidden="true" tabindex="-1"></a>arth.logistic</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = Better ~ Age, family = binomial, data = Arthritis)
## 
## Coefficients:
## (Intercept)          Age  
##    -2.64207      0.04925  
## 
## Degrees of Freedom: 83 Total (i.e. Null);  82 Residual
## Null Deviance:       116.4 
## Residual Deviance: 109.2     AIC: 113.2</code></pre>
<p><strong>Better</strong>를 반응변수로 하고 <strong>Age</strong>를
설명변수로 하는 로지스틱 회귀모형 <code>arth.logistic</code>을
생성하였다.<br />
로지스틱 회귀모형을 적합시키게 되면, 추정된 설명변수의 계수와 모형의
잔차, AIC 등의 정보를 얻을 수 있다.</p>
<div class="sourceCode" id="cb783"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb783-1"><a href="#cb783-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code></pre></div>
<pre><code>## 필요한 패키지를 로딩중입니다: zoo</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<div class="sourceCode" id="cb787"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb787-1"><a href="#cb787-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arth.logistic)</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##              Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept) -2.642071   1.073167 -2.4619  0.01382 *
## Age          0.049249   0.019357  2.5443  0.01095 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>lmtest</code>패키지는 선형 회귀 분석 모형에서 진단 검사를 위한
검정, 데이터 집합 예제를 제공하며 <strong>parametric</strong>모델의
추론을 도와주는 함수를 제공한다.</p>
<p><code>coeftest</code>는 추정된 계수에 대해
<strong>Wald</strong>검정을 수행하고 검정에 대한 신뢰구간을 계산하기위한
함수이며, <code>lmtest</code>패키지에 포함돼있다.<br />
- <code>coeftest(model)</code></p>
<ul>
<li>model: wald 검정을 수행할 적합된 모델</li>
</ul>
<p><code>coeftest</code>를 <code>arth.logistic</code>모델에 사용한 결과,
<strong>절편, Age</strong>는 유의확률이 유의수준 0.05보다 작으므로
귀무가설을 기각한다.</p>
<ul>
<li>H0: 주어진 설명변수의 계수는 0이다. 즉, 주어진 설명변수는 유의하지
않다.</li>
<li>H1: 주어진 설명변수의 계수는 0이 아니다. 즉, 주어진 설명변수는
유의하다.</li>
</ul>
<p>따라서, <strong>Age</strong>는 유의한 변수임을 확인할 수 있다.</p>
<p><code>arth.logistic</code>모형을 통해 추정된 식은 다음과 같다.</p>
<p><span class="math display">\[
logit(\pi) = -2.642071 + 0.049249 * Age
\]</span></p>
<div class="sourceCode" id="cb789"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb789-1"><a href="#cb789-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(arth.logistic))</span></code></pre></div>
<pre><code>## (Intercept)         Age 
##   0.0712136   1.0504819</code></pre>
<p>추정된 로지스틱 회귀모형의 계수에 <code>exp</code>를 취하게 되면 각
설명변수에 대한 오즈비를 구할 수 있다.<br />
나이가 1단위 증가할수록 약의 효과가 뚜렷할 오즈가 <strong>exp(0.049249)
= 1.05</strong>배 증가한다.</p>
<div class="sourceCode" id="cb791"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb791-1"><a href="#cb791-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="fu">coef</span>(arth.logistic)[<span class="st">&quot;Age&quot;</span>])</span></code></pre></div>
<pre><code>##      Age 
## 1.636386</code></pre>
<p>계수에 10을 곱하게 되면 단위가 10으로 바뀌게 되므로, 나이가 10단위
증가할수록 약의 효과가 뚜렷할 오즈가 <strong>1.63</strong>배 증가하는
것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb793"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb793-1"><a href="#cb793-1" aria-hidden="true" tabindex="-1"></a>arth.lm <span class="ot">&lt;-</span> <span class="fu">glm</span>(Better <span class="sc">~</span> Age, <span class="at">data =</span> Arthritis)</span>
<span id="cb793-2"><a href="#cb793-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(arth.lm)</span></code></pre></div>
<pre><code>## (Intercept)         Age 
## -0.10716962  0.01137935</code></pre>
<p><code>glm</code>함수의 옵션에서 <code>family = binomial</code>옵션을
지정하지 않을 경우, 로지스틱 회귀모형이 아닌 일반 선형회귀 모델에
적합시키게 된다.<br />
일반 선형회귀 모형에 데이터를 적합시키게 되면 추정된 계수가 달라질
뿐만아니라 로지스틱 회귀모형과 다른 결과가 도출될수도 있다.</p>
<div class="sourceCode" id="cb795"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb795-1"><a href="#cb795-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arth.lm)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Better ~ Age, data = Arthritis)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -0.67801  -0.47602   0.05527   0.43579   0.79993  
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) -0.107170   0.228415  -0.469   0.6402   
## Age          0.011379   0.004165   2.732   0.0077 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 0.2347266)
## 
##     Null deviance: 21.000  on 83  degrees of freedom
## Residual deviance: 19.248  on 82  degrees of freedom
## AIC: 120.61
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<p>일반 선형회귀 모델에 데이터를 적합시킨 결과, 절편은 유의하지 않지만
<strong>Age</strong>는 유의확률이 유의수준 0.05보다 작으므로 유의한
변수임을 알 수 있다.<br />
<code>Arthritis</code> 데이터의 경우, 로지스틱 회귀 모델, 일반 선형회귀
모델 모두 설명변수 <strong>Age</strong>가 유의하게 나오는 것을 확인할 수
있다.</p>
</div>
<div id="model-tests-for-simple-logistic-regression"
class="section level3">
<h3>7.2.2 Model tests for simple logistic regression</h3>
<p>로지스틱 회귀 모형에 대해 수행할 수 있는 두 가지 주요 가설 검정
유형이 있다. 이 주제에 대해서는 7.3에서 더 자세히 다루며, 여기서는
<code>Arthritis</code>데이터를 이용하여 주요 아이디어를 살펴본다.<br />
가장 기본적인 가설 검정은 <span class="math inline">\(logit(\pi) =
\alpha\)</span>일때보다 얼마나 나은가 즉, <span
class="math inline">\(H_0: \beta = 0\)</span>에 대한 검정을
진행한다.</p>
<p>두 번째 가설 검정은 데이터를 통해 얻은 모델이 포화모델과 비교했을 때,
얼마나 나쁜 모델인가에 대한 검정을 진행하는 것이다.<br />
여러 데이터를 추가하여 모델은 더 복잡해졌지만, 모델의 잔차가 기존의
간단한 모델과 비교했을 때 비슷한 수준이라면, 복잡한 모델을 사용할 필요가
없다.</p>
<div class="sourceCode" id="cb797"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb797-1"><a href="#cb797-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(arth.logistic, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: Better
## 
## Terms added sequentially (first to last)
## 
## 
##      Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)   
## NULL                    83     116.45            
## Age   1   7.2852        82     109.16 0.006953 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>anova</code>를 통해 기존에 절편만으로 설명된 모델에
<strong>Age</strong>변수를 추가할 경우, <strong>Age</strong>변수는
유의한 영향을 미치는지에 대한 검정을 진행해 보았다.<br />
<strong>Age</strong>의 유의확률이 유의수준 0.05보다 작으므로 귀무가설을
기각한다. 따라서, <strong>Age</strong>변수의 계수는 0이 아니며, 모형에
유의한 영향을 주는 변수임을 알 수 있다.</p>
<div class="sourceCode" id="cb799"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="#cb799-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb799-2"><a href="#cb799-2" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(arth.logistic)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##                  AIC    BIC LR Chisq Df Pr(&gt;Chisq)  
## arth.logistic 113.16 118.03   109.16 82    0.02416 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>LRstats</code>를 통해 모형의 검정을 진행한 결과, 유의확률이
유의수준 0.05보다 작으므로 <strong>포화모델의 잔차</strong>와
<strong>적합시킨 모델의 잔차</strong>는 서로 유의한 차이가 있는 것을 알
수 있다.<br />
따라서, 기존모델에 <strong>Age</strong>변수를 추가하여 모델을 적합시키는
것은 유의하다고 볼 수 있다.</p>
</div>
<div id="plotting-a-binary-response" class="section level3">
<h3>7.2.3 Plotting a binary response</h3>
<p>이항 반응 변수에 대한 모델을 적응 시킨 후 결과만을 통해 변수들의
관계를 해석하는 것과 이해하는 것은 쉽지않다.<br />
이러한 경우, 적합시킨 모형과 함께 시각화 방법을 이용하면 모형을 이해하는
데 큰 도움이 된다.</p>
<p><em>Example 7.2: Arthritis treatment - Plotting logistic regression
with base graphics</em></p>
<div class="sourceCode" id="cb801"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="#cb801-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">jitter</span>(Better, .<span class="dv">1</span>) <span class="sc">~</span> Age, <span class="at">data =</span> Arthritis,</span>
<span id="cb801-2"><a href="#cb801-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">85</span>), <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb801-3"><a href="#cb801-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability (Better)&quot;</span>)</span>
<span id="cb801-4"><a href="#cb801-4" aria-hidden="true" tabindex="-1"></a>xvalues <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">85</span>, <span class="dv">5</span>)</span>
<span id="cb801-5"><a href="#cb801-5" aria-hidden="true" tabindex="-1"></a>pred.logistic <span class="ot">&lt;-</span> <span class="fu">predict</span>(arth.logistic,</span>
<span id="cb801-6"><a href="#cb801-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">Age =</span> xvalues),</span>
<span id="cb801-7"><a href="#cb801-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb801-8"><a href="#cb801-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb801-9"><a href="#cb801-9" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> pred.logistic<span class="sc">$</span>fit <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> pred.logistic<span class="sc">$</span>se.fit</span>
<span id="cb801-10"><a href="#cb801-10" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> pred.logistic<span class="sc">$</span>fit <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> pred.logistic<span class="sc">$</span>se.fit</span>
<span id="cb801-11"><a href="#cb801-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb801-12"><a href="#cb801-12" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(xvalues, <span class="fu">rev</span>(xvalues)),</span>
<span id="cb801-13"><a href="#cb801-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(upper, <span class="fu">rev</span>(lower)),</span>
<span id="cb801-14"><a href="#cb801-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">2</span>), <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb801-15"><a href="#cb801-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xvalues, pred.logistic<span class="sc">$</span>fit, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb801-16"><a href="#cb801-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(arth.lm, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb801-17"><a href="#cb801-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">lowess</span>(Arthritis<span class="sc">$</span>Age, Arthritis<span class="sc">$</span>Better, <span class="at">f =</span> .<span class="dv">9</span>),</span>
<span id="cb801-18"><a href="#cb801-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-382-1.png" width="960" /></p>
<p>적합된 로지스틱 모형의 경우, 로지스틱 회귀 분석을 저장한 객체를 통해
얻을 수 있으며, 이 모형을 통해 적합된 곡선과 새로운 데이터에 대한 예측을
진행할 수 있다.</p>
<p>새로운 데이터를 얻었을 때, 적합된 모델을 새로운 데이터에 대한 예측에
사용하기 위해서는 <code>predict</code>함수를 사용한다.<br />
- <code>predict(model,newdata,type,se.fit)</code></p>
<ul>
<li>model: 적합시킬 모델<br />
</li>
<li>newdata: 새로운 데이터<br />
</li>
<li>type: 예측의 형태 (“response”로 지정하게 되면 반응변수가 0 ~ 1
사이의 값을 가짐)<br />
</li>
<li>se.fit: 표준오차 포함 여부</li>
</ul>
<p><strong>검은색 점</strong>의 경우, 새로운 데이터를 로지스틱
회귀모형에 적합시켰을때의 출력값을 나타내며, 가운데의 <strong>보라색
band</strong>는 로지스틱 회귀 곡선에 대한 신뢰수준 95%의 band를
나타낸다.<br />
<strong>파란색 선</strong>의 경우 예측값에 대한 로지스틱 회귀 곡선,
<strong>빨간색 선</strong>의 경우 우리가 적합한 데이터에 대한 비모수적인
회귀 곡선을 나타낸다.</p>
<p><em>Example 7.3: Arthritis treatment - Plotting logistic regression
with ggplot2</em></p>
<div class="sourceCode" id="cb802"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb802-1"><a href="#cb802-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb802-2"><a href="#cb802-2" aria-hidden="true" tabindex="-1"></a><span class="co"># basic logistic regression plot</span></span>
<span id="cb802-3"><a href="#cb802-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Arthritis, <span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> Better)) <span class="sc">+</span></span>
<span id="cb802-4"><a href="#cb802-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>, <span class="dv">95</span>) <span class="sc">+</span></span>
<span id="cb802-5"><a href="#cb802-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.02</span>, <span class="at">width =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb802-6"><a href="#cb802-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> binomial,</span>
<span id="cb802-7"><a href="#cb802-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb802-8"><a href="#cb802-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">fullrange =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb803"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="#cb803-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb803-2"><a href="#cb803-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb803-3"><a href="#cb803-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fullrange =</span> <span class="cn">TRUE</span>)</span>
<span id="cb803-4"><a href="#cb803-4" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> gg <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb803-5"><a href="#cb803-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">span =</span> <span class="fl">0.95</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<div class="sourceCode" id="cb804"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb804-1"><a href="#cb804-1" aria-hidden="true" tabindex="-1"></a>gg</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-385-1.png" width="960" /></p>
<p>기본적인 plot함수를 이용하지 않고 <code>ggplot</code>함수를 통해서도
시각화를 진행할 수 있다.<br />
ggplot을 통해 시각화를 진행한 결과, 앞서 그렸던 그림과 상당히 유사한
그림을 얻는 것을 확인할 수 있다.<br />
<code>stat_smooth(method = glm, family = binomial)</code>을 지정하게
되면 로지스틱 회귀 모형에 대한 적합선을,
<code>stat_smooth(method = lm)</code>은 선형 회귀모형에 대한 적합선,
<code>stat_smooth(method = loess)</code>은 비모수적 접근을 통한 회귀
적합선을 나타낸다.</p>
<p><strong>파란색</strong>선이 로지스틱 회귀모형의 적합선,
<strong>검은색</strong>선이 선형 회귀모형의 적합선,
<strong>빨간색</strong>선이 비모수적인 접근을 통한 회귀 적합선을
나타낸다.<br />
<strong>보라색</strong>band는 앞선 plot과 동일하게 로지스틱 회귀
적합선에 대한 신뢰수준 95%의 band를 나타낸다.</p>
</div>
<div id="grouped-binomial-data" class="section level3">
<h3>7.2.4 Grouped binomial data</h3>
<p>이항 변수의 데이터가 관측치가 아닌 성공, 실패에 대해 기록된 형태의
데이터로 주어질 수 있다.</p>
<p>이때, 실패횟수, 성공횟수에 대한 2열의 행렬로 구성된 응답으로 데이터를
재구성해야 하며, 적합 모형을 확률로 표시할 때에는 일반적으로 성공에 대한
비율을 사용한다. 또는, trials를 이용하여 모형을 적합시킬수도 있다.</p>
<p><em>Example 7.4: Space shuttle disaster</em></p>
<div class="sourceCode" id="cb806"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb806-1"><a href="#cb806-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;SpaceShuttle&quot;</span> , <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb806-2"><a href="#cb806-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SpaceShuttle)</span></code></pre></div>
<pre><code>##   FlightNumber Temperature Pressure Fail nFailures Damage
## 1            1          66       50   no         0      0
## 2            2          70       50  yes         1      4
## 3            3          69       50   no         0      0
## 4            4          80       50 &lt;NA&gt;        NA     NA
## 5            5          68       50   no         0      0
## 6            6          67       50   no         0      0</code></pre>
<p><code>SpaceShuttle</code>데이터는 NASA의 우주왕복선 프로그램의 O-ring
실패에 관한 자료이며, <code>vcd</code>패키지에 포함돼있다.</p>
<ul>
<li>FlightNumber: 비행번호 (Norminal variable)</li>
<li>Temperature: 시작시 온도 (Discrete variable)</li>
<li>Pressure: 압력 (Discrete variable)</li>
<li>Fail: O-ring 실패 발생여부 (Factor variable - No,Yes)</li>
<li>nFailures: O-ring 실패횟수 (Discrete variable)</li>
<li>Damage: 피해지수 (Damage index)</li>
</ul>
<div class="sourceCode" id="cb808"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb808-1"><a href="#cb808-1" aria-hidden="true" tabindex="-1"></a>shuttle.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(nFailures, <span class="dv">6</span> <span class="sc">-</span> nFailures) <span class="sc">~</span> Temperature, <span class="at">data =</span> SpaceShuttle, <span class="at">na.action =</span> na.exclude,</span>
<span id="cb808-2"><a href="#cb808-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> binomial)</span></code></pre></div>
<p><code>shuttle.mod</code>은 이항 반응변수에 대해서 성공, 실패에 대해
2열의 행렬로 구성한 후, <strong>Temperature</strong>를 설명변수로 하는
로지스틱 회귀모형을 적합시킨 결과이다.<br />
<code>na.action = na.exclude</code>는 결측치를 제거하고 분석을
진행하라는 옵션이다.</p>
<div class="sourceCode" id="cb809"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="#cb809-1" aria-hidden="true" tabindex="-1"></a>SpaceShuttle<span class="sc">$</span>trials <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb809-2"><a href="#cb809-2" aria-hidden="true" tabindex="-1"></a>shuttle.modw <span class="ot">&lt;-</span> <span class="fu">glm</span>(nFailures <span class="sc">/</span> trials <span class="sc">~</span> Temperature,</span>
<span id="cb809-3"><a href="#cb809-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weight=</span> trials, <span class="at">data =</span> SpaceShuttle,</span>
<span id="cb809-4"><a href="#cb809-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">na.action =</span> na.exclude, <span class="at">family =</span> binomial)</span></code></pre></div>
<p><code>shuttle.modw</code>은 이항 반응 변수에 대해서 trials과
실패횟수를 활용한후, <strong>Temperature</strong>를 설명변수로 하는
로지스틱 회귀모형을 적합시킨 결과이다.</p>
<div class="sourceCode" id="cb810"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb810-1"><a href="#cb810-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">coef</span>(shuttle.mod), <span class="fu">coef</span>(shuttle.modw))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code>all.equal</code>을 통해 두 모형의 계수를 확인해 본 결과,
반응변수에 대해서 각각 다른 방법을 사용하여 설정하고 로지스틱 회귀모형을
적합했어도 서로 같은 계수값을 가지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb812"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb812-1"><a href="#cb812-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(shuttle.mod, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: binomial, link: logit
## 
## Response: cbind(nFailures, 6 - nFailures)
## 
## Terms added sequentially (first to last)
## 
## 
##             Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)  
## NULL                           22     24.230           
## Temperature  1    6.144        21     18.086  0.01319 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>anova</code>를 통해 기존에 절편만으로 설명된 모델에
<strong>Temperature</strong>변수를 추가할 경우,
<strong>Temperature</strong>변수는 유의한 영향을 미치는지에 대한 검정을
진행해 보았다.<br />
<strong>Temperature</strong>의 유의확률이 유의수준 0.05보다 작으므로
귀무가설을 기각한다. 따라서, <strong>Temperature</strong>변수의 계수는
0이 아니며, 모형에 유의한 영향을 주는 변수임을 알 수 있다.</p>
<div class="sourceCode" id="cb814"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="#cb814-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb814-2"><a href="#cb814-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(SpaceShuttle, <span class="fu">aes</span>(<span class="at">x =</span> Temperature, <span class="at">y =</span> nFailures <span class="sc">/</span> trials)) <span class="sc">+</span></span>
<span id="cb814-3"><a href="#cb814-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">30</span>, <span class="dv">81</span>) <span class="sc">+</span></span>
<span id="cb814-4"><a href="#cb814-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Temperature (F)&quot;</span>) <span class="sc">+</span></span>
<span id="cb814-5"><a href="#cb814-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;O-Ring Failure Probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb814-6"><a href="#cb814-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.01</span>), <span class="fu">aes</span>(<span class="at">size =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb814-7"><a href="#cb814-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb814-8"><a href="#cb814-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> binomial, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="fu">aes</span>(<span class="at">weight =</span> trials), <span class="at">fullrange =</span> <span class="cn">TRUE</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>,<span class="at">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-391-1.png" width="960" /></p>
<p><code>ggplot</code>을 이용하여 <strong>Temperature</strong>의
관측값에 따른 로지스틱 회귀분석 결과에 대한 시각화를 진행하였다.<br />
<code>fullrange = TRUE</code>로 설정할 경우, 적합 회귀 곡선과 신뢰
밴드를 전체 범위로 확장한다.<br />
<strong>파란선</strong>의 경우 적합 로지스틱회귀 곡선,
<strong>보라색</strong>의 경우 적합식에 대한 신뢰수준 95% band를
나타낸다.</p>
<p>그림을 보면 <strong>Temperature</strong>이 높아질수록
<strong>Probability</strong>가 0에 가까워지는 것을 확인할 수 있다. 즉,
<strong>Temperature</strong>이 높을수록 반응변수의 사건이 발생하지 않을
것으로 분류할 확률이 높다라고 할 수 있다.</p>
<hr />
</div>
</div>
<div id="multiple-logistic-regression-models" class="section level2">
<h2>7.3 Multiple logistic regression models</h2>
<p>일반선형회귀 모형의 경우, 독립변수가 하나인 단순회귀, 독립변수가
여러개인 다중회귀로 구분할 수 있다.<br />
로지스틱 회귀모형 또한 <strong>독립변수를 여러개</strong>를 사용하여
<strong>다중 로지스틱 회귀모델</strong>을 생성할 수 있다.</p>
<p><em>Example 7.5: Arthritis treatment</em></p>
<div class="sourceCode" id="cb816"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb816-1"><a href="#cb816-1" aria-hidden="true" tabindex="-1"></a>arth.logistic2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Better <span class="sc">~</span> <span class="fu">I</span>(Age<span class="dv">-50</span>) <span class="sc">+</span> Sex <span class="sc">+</span> Treatment,</span>
<span id="cb816-2"><a href="#cb816-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> Arthritis,</span>
<span id="cb816-3"><a href="#cb816-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> binomial)</span></code></pre></div>
<p><code>Arthritis</code>데이터의 <strong>Better</strong>를
반응변수로하고 <strong>Age, Sex, Treatment</strong>를 독립변수로
활용하는 <strong>다중 로지스틱 회귀분석</strong>을 진행해 보았다.
여기서, 절편 해석의 용이함을 위해 <strong>Age</strong>가 아닌
<strong>Age-50</strong>을 적합시켜 평균에 조금 더 가까운 모형을
적합시켰다.<br />
<strong>Age-50</strong>을 적합시키게 되면, <strong>Age</strong>변수의
계수는 그대로이지만, 절편의 계수만 바뀌는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb817"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb817-1"><a href="#cb817-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arth.logistic2)</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##                   Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)      -0.578134   0.367378 -1.5737 0.115562   
## I(Age - 50)       0.048747   0.020663  2.3591 0.018318 * 
## SexMale          -1.487831   0.594769 -2.5015 0.012366 * 
## TreatmentTreated  1.759804   0.536495  3.2802 0.001037 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>coeftest</code>를 통해 계수에 대한 검정을 진행해 보았다.<br />
절편을 제외한 <strong>Age, Sex, Treatment</strong>변수 모두 유의확률이
유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서, 설명변수들의
계수는 0이 아니므로 유의한 변수들임을 확인할 수 있다.</p>
<p>모형을 통해 추정된 로지스틱 회귀식은 아래와 같다.</p>
<p><span class="math display">\[
logit(\pi) = -0.578134 + 0.048747 Age -1.487831sex + 1.759804 Treatment
\]</span></p>
<p>위의 식에서 <strong>Sex = Male이면 1, Sex = Female이면 0</strong>의
값을 가지고 <strong>Treatment = Treated이면 1, Treatment = Placebo이면
0</strong>의 값을 가진다.</p>
<div class="sourceCode" id="cb819"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb819-1"><a href="#cb819-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">cbind</span>(<span class="at">OddsRatio =</span> <span class="fu">coef</span>(arth.logistic2),</span>
<span id="cb819-2"><a href="#cb819-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">confint</span>(arth.logistic2)))</span></code></pre></div>
<pre><code>## 프로파일링이 완료되길 기다리는 중입니다...</code></pre>
<pre><code>##                  OddsRatio      2.5 %     97.5 %
## (Intercept)      0.5609441 0.26474942  1.1323435
## I(Age - 50)      1.0499542 1.01000124  1.0963021
## SexMale          0.2258620 0.06523759  0.6890789
## TreatmentTreated 5.8112990 2.11870182 17.7265830</code></pre>
<p><code>exp</code>를 통해 오즈비를 계산하고 <code>confint</code>를
이용하여 오즈비에 대한 95% 신뢰구간을 구했다.<br />
오즈비를 살펴본 결과, <strong>Treatment = Treated</strong>일 경우 그렇지
않은 사람에 비해서 약의 효능이 좋을 오즈가 <strong>5.81배</strong> 높은
것을 알 수 있었고 나이가 한 단위 증가할수록 그렇지 않은 사람보다 약의
효능이 좋을 오즈가 <strong>1.04배</strong> 증가하는 것을 확인할 수
있었다.</p>
<div id="conditional-plots" class="section level3">
<h3>7.3.1 Conditional plots</h3>
<p>가장 간단한 그림에서는 하나 이상의 반응 변수에 대해, 정의된 데이터의
부분 집합에 대해 개별적으로 적합 관계(예측값, 신뢰구간 band)를
표시한다.<br />
또한, 여러 패널을 통해 데이터에 대해서 수준 별로 시각화를 진행할수도
있다.</p>
<p><em>Example 7.6: Arthritis treatment - conditional plots</em></p>
<div class="sourceCode" id="cb822"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb822-1"><a href="#cb822-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb822-2"><a href="#cb822-2" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Arthritis, <span class="fu">aes</span>(Age, Better, <span class="at">color =</span> Treatment)) <span class="sc">+</span></span>
<span id="cb822-3"><a href="#cb822-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>,<span class="dv">95</span>)<span class="sc">+</span></span>
<span id="cb822-4"><a href="#cb822-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb822-5"><a href="#cb822-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.02</span>, <span class="at">width =</span><span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb822-6"><a href="#cb822-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> binomial,</span>
<span id="cb822-7"><a href="#cb822-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="fu">aes</span>(<span class="at">fill =</span> Treatment),</span>
<span id="cb822-8"><a href="#cb822-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">fullrange =</span> <span class="cn">TRUE</span>)</span>
<span id="cb822-9"><a href="#cb822-9" aria-hidden="true" tabindex="-1"></a>gg</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-395-1.png" width="960" /></p>
<p>위 그림의 경우, 데이터가 <strong>Treatment = Treated일 때
파란색</strong>, <strong>Treatment = Placebo일 때, 빨간색</strong>으로
구분하여 각 데이터의 위치, 적합 회귀선, 신뢰구간 band를
나타내었다.<br />
<strong>Treatment = Treated</strong>인 경우, 0보다는 1(약의 효능이
있다.)로 더 많이 분류하는 것을 볼 수 있었고 나이가 증가함에 따라 적합
회귀선 또한 <strong>Treatment = Placebo</strong>에 비해 1로 더 빠르게
수렴하는 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb824"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb824-1"><a href="#cb824-1" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> Sex)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-396-1.png" width="960" /></p>
<p><code>facet_wrap</code>함수는 1d 시퀀스의 패널을 2d로 전환해주는
함수로 <code>ggplot2</code>패키지에 포함돼있다.<br />
- <code>facet_wrap(variable)</code></p>
<ul>
<li>variable: 패널을 나누고자 하는 기준 변수</li>
</ul>
<p>기존에 그린 그림에서 <code>facet_wrap</code>함수를 사용하여
<strong>Sex의 수준(Female, Male)</strong>에 따라 패널을 분리하였다.</p>
<p><strong>Sex = Female</strong>의 경우 앞서 살펴본 그림과 동일하게
<strong>Treatment = Treated</strong>일 때, 나이가 증가함에 따라 1의
확률로 더 빠르게 수렴한다.<br />
하지만, <strong>Sex = Male</strong>의 경우 <strong>Sex =
Female</strong>과 다르게 <strong>Treatment = Treated</strong>일 경우
나이가 증가함에 따라 <strong>Better</strong>에 대한 확률이 감소하며,
<strong>Treatment = Placebo</strong>일 경우 나이가 증가함에 따라
<strong>Better</strong>에 대한 확률이 증가하는 <strong>Age</strong>와
<strong>Treatment</strong>의 단계 기능에 대한 역설적이고 부정적인 관계를
보여주는것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb826"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb826-1"><a href="#cb826-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">xtabs</span>(<span class="sc">~</span>Sex <span class="sc">+</span> Treatment, <span class="at">data =</span> Arthritis), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##         Treatment
## Sex      Placebo Treated Sum
##   Female      32      27  59
##   Male        11      14  25</code></pre>
<p><code>addmargins</code>함수를 통해 분할표의 빈도를 살펴본 결과,
<strong>Sex = Male</strong>의 총빈도는 <strong>Sex = Female</strong>의
절반도 안 되는 것을 볼 수 있다.<br />
이러한 표본부족 문제 때문에 <strong>Age</strong>와
<strong>Treatment</strong>간 역설적이고 부정적인 관계를 보여줄수도
있다는 추측을 해볼 수 있다.</p>
</div>
<div id="full-model-plots" class="section level3">
<h3>7.3.2 Full-model plots</h3>
<p>두 개 이상의 설명변수를 가지는 모형의 경우, 조건의 변수에 의해
층화되기 보다 모든 설명 변수를 반응 변수와 함께 표현하는 것이
좋다.<br />
이러한 그림은 반응변수의 예측값을 선택한 설명 변수와 비교하면서
보여준다.</p>
<p><code>vcd</code>패키지 에서는 예측된 반응 변수를 시각화 하도록
<code>binreg_plot</code>함수를 제공한다.<br />
이 함수의 경우, 적합 모형 개체에서 이항 결과에 대한 설명 변수의 부분
집합을 사용하여 개별 그림을 생성할 수 있다.<br />
- <code>binreg_plot(model, type)</code></p>
<ul>
<li>model: 적합시킨 모델</li>
<li>type: fitted value의 표시 방법 (“response” = 0~1의 확률값, “link” =
선형직선)</li>
</ul>
<p><em>Example 7.7: Arthritis treatment - full model plots</em></p>
<div class="sourceCode" id="cb828"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb828-1"><a href="#cb828-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb828-2"><a href="#cb828-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-398-1.png" width="960" /></p>
<p>반응변수 <code>better</code>에 대해서 x축을 수치형 변수인
<em>Age</em>로 설정하고 사용한
<strong>설명변수(sex,treatment)</strong>의 조합에 따른 적합 회귀선과 각
데이터의 분포를 살펴볼 수 있다.<br />
<strong>sex = Female, Treatment = Treated</strong>일 때, 적합 회귀선이
가장 높은 것(Better일 가능성이 높다.)을 확인할 수 있고 <strong>sex =
Male, Treatment = Treated</strong>일 때, 적합 회귀선이 가장 작은
것(Better일 가능성이 낮다.)을 확인할 수 있다.</p>
<div class="sourceCode" id="cb829"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb829-1"><a href="#cb829-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Female&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-399-1.png" width="960" /></p>
<div class="sourceCode" id="cb830"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb830-1"><a href="#cb830-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Male&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-399-2.png" width="960" /></p>
<p><code>binreg_plot</code>에서 <code>subset</code>옵션을 통해 원하는
변수의 수준만을 사용한 결과를 살펴볼 수 있다.<br />
<code>type = link</code>옵션은 독립변수 들의 결과를 선형형태로 반환하는
역할을 하기에 추정 회귀선이 직선이 나오는 것을 알 수 있다.</p>
<p>위의 그림의 경우, <strong>Sex = Female</strong>인 경우만을 고려하였고
아래 그림의 경우, <strong>Sex = Male</strong>인 경우만을
고려하였다.<br />
두 그림 모두 <strong>Treatment = Treated</strong>인 경우에 추정 회귀선이
더 높은 것(Better일 가능성이 높다.)을 알 수 있다.</p>
<div class="sourceCode" id="cb831"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb831-1"><a href="#cb831-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Female&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-400-1.png" width="960" /></p>
<div class="sourceCode" id="cb832"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb832-1"><a href="#cb832-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Male&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-400-2.png" width="960" /></p>
<div class="sourceCode" id="cb833"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb833-1"><a href="#cb833-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Female&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-401-1.png" width="960" /></p>
<div class="sourceCode" id="cb834"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb834-1"><a href="#cb834-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(arth.logistic2, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">subset =</span> Sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Male&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">75</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-401-2.png" width="960" /></p>
<p><code>type = 'response'</code>로 지정하거나 아예 <code>type</code>을
지정해주지 않으면 위와 같이 0~1의 확률값을 가지는 곡선 형태의 추정
회귀선이 나오는 것을 확인할 수 있다.<br />
이는, <code>type = link</code>와는 다르게 선형적으로 가정하지 않고
설명변수들에 대한 반응변수 결과를 확률로 나타내기 때문이다.</p>
<p>앞선 결과와 동일하게, <code>type = response</code>로 설정하여도
<strong>Sex = Male</strong>, <strong>Sex = Female</strong>모두
<strong>Treatment = Treated</strong>의 추정 회귀선이 더 높은 곳에 있으며
나이가 증가함에 따라 1에 확률에 더 빠르게 수렴하는 것을 확인할 수
있다.</p>
</div>
<div id="effect-plots" class="section level3">
<h3>7.3.3 Effect plots</h3>
<p>두 개 이상의 변수에서, 반응변수에 대한 모형 그림은 교호작용이
포함되어 있거나 주효과 또는 교호작용에 관심이 집중되어 다른 설명 변수를
제어할 때 번거로울 수 있다.<br />
<strong>effects display</strong>의 경우 이러한 문제에 대해 유용한
해결책이 될 수 있다. R에서는 <code>effects</code>패키지를 통해 사용할 수
있다.<br />
<code>effects</code>패키지는 선형 예측변수를 사용하는 다양한 통계 모형에
대해 그래픽 및 표 형식의 교호작용을 표시해주는 함수들을 제공한다.</p>
<p><strong>effects display</strong>의 아이디어는 매우 간단하지만 매우
일반적이며 임의 복잡성의 모델을 처리한다.<br />
주어진 선형 모델 또는 일반화된 선형 모델에서 시각화하고자 하는 설명
변수의 특정 부분 집합을 고려하여 변수의 주효과와 교호작용을 포함하는
모든 적합치를 계산한다. 이때, 다른 모든 변수는 일반적인 값으로
고정됨으로써 제어된다.</p>
<div id="partial-residuals" class="section level4">
<h4>7.3.3.2 Partial residuals</h4>
<p>이산형 반응 데이터의 경우 데이터를 적합된 관계와 함께 데이터가 있는
위치를 확인하는 것이 중요하다. <strong>효과 패키지</strong>에서는 부분
잔차를 표시할 수 있으므로 이러한 아이디어를 더욱 발전 시킬 수
있다.<br />
<strong>부분 잔차</strong>를 <strong>effects display</strong>에
추가하게되면 <strong>비선형 관계 또는 생략된 교호작용</strong>과 같은
연속형 설명 변수로 인한 반응 평균의 적합성 결여 또는 잘못 지정된
데이터를 확인하는데 도움이 된다.</p>
<p><em>Example 7.8: Arthritis treatment</em></p>
<div class="sourceCode" id="cb835"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb835-1"><a href="#cb835-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span></code></pre></div>
<pre><code>## 필요한 패키지를 로딩중입니다: carData</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;carData&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:vcdExtra&#39;:
## 
##     Burt</code></pre>
<pre><code>## Use the command
##     lattice::trellis.par.set(effectsTheme())
##   to customize lattice options for effects plots.
## See ?effectsTheme for details.</code></pre>
<div class="sourceCode" id="cb840"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb840-1"><a href="#cb840-1" aria-hidden="true" tabindex="-1"></a>arth.eff2 <span class="ot">&lt;-</span> <span class="fu">allEffects</span>(arth.logistic2, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>)</span>
<span id="cb840-2"><a href="#cb840-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(arth.eff2)</span></code></pre></div>
<pre><code>## [1] &quot;I(Age-50)&quot; &quot;Sex&quot;       &quot;Treatment&quot;</code></pre>
<p><code>allEffects</code>는 모델에서 모든 고차항을 식별하고 반응변수의
예측된 확률을 계산할 수 있도록 도와주는 함수로,
<code>effects</code>패키지에 포함돼있다.<br />
- <code>allEffectS(model,partial.residuals)</code></p>
<ul>
<li>model; allEffects 함수를 적용할 모형</li>
<li>partial.residuals: 부분 잔차 표시 여부</li>
</ul>
<p>위의 코드는 <strong>Age,Sex,Treatment</strong>에 대한 반응변수의
예측된 확률을 계산한다.</p>
<div class="sourceCode" id="cb842"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb842-1"><a href="#cb842-1" aria-hidden="true" tabindex="-1"></a>arth.eff2[[<span class="st">&quot;Sex&quot;</span>]]</span></code></pre></div>
<pre><code>## 
##  Sex effect
## Sex
##    Female      Male 
## 0.6093229 0.2605014</code></pre>
<p>반응변수 <code>Better</code>에 대한 <strong>Sex = Female</strong>의
효과는 약 0.609, <strong>Sex = Male</strong>의 효과는 약 0.260으로 약
2.5배 정도 차이가 존재하는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb844"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb844-1"><a href="#cb844-1" aria-hidden="true" tabindex="-1"></a>arth.eff2[[<span class="st">&quot;Sex&quot;</span>]]<span class="sc">$</span>model.matrix</span></code></pre></div>
<pre><code>##   (Intercept) I(Age - 50) SexMale TreatmentTreated
## 1           1    3.357143       0        0.4880952
## 2           1    3.357143       1        0.4880952
## attr(,&quot;assign&quot;)
## [1] 0 1 2 3
## attr(,&quot;contrasts&quot;)
## attr(,&quot;contrasts&quot;)$Sex
## [1] &quot;contr.treatment&quot;
## 
## attr(,&quot;contrasts&quot;)$Treatment
## [1] &quot;contr.treatment&quot;</code></pre>
<p><strong>Sex</strong>에 대한 주효과 매트릭스를 살펴본 결과 <strong>Sex
= Female</strong>일 경우 <strong>Sex</strong>는 0의 값을 가지며,
<strong>Sex = Male</strong>일 경우 <strong>Sex</strong>는 1의 값을
가지고 나머지 계수들은 동일한 값을 가지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb846"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb846-1"><a href="#cb846-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arth.eff2, <span class="at">rows =</span> <span class="dv">1</span>, <span class="at">cols =</span> <span class="dv">3</span>,</span>
<span id="cb846-2"><a href="#cb846-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">residuals.pch =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-405-1.png" width="960" /></p>
<p><code>allEffects</code>의 결과를 <strong>plot</strong>으로 나타내게
되면 각 설명변수의 수준의 변화에 따른 <strong>Better</strong>에 대한
예측 확률의 변화를 시각적으로 살펴볼 수 있다.<br />
<code>Age effect plot</code>을 통해 <strong>Age</strong>가 증가할수록
<strong>Better</strong>에 대한 확률이 높아진다.(약의 효능이 있을 확률이
높다.)<br />
<code>Sex effect plot</code>을 통해 <strong>Sex = Male</strong>일
경우보다 <strong>Sex = Female</strong>일때 <strong>Better</strong>에
대한 확률이 높아진다.<br />
<code>Treatment effect plot</code>을 통해 <strong>Treatment =
Placebo</strong>일 경우보다 <strong>Treatment = Treated</strong>일
경우에 <strong>Better</strong>에 대한 확률이 높아지는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb847"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb847-1"><a href="#cb847-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arth.eff2, <span class="at">rows =</span> <span class="dv">1</span>, <span class="at">cols =</span> <span class="dv">3</span>,</span>
<span id="cb847-2"><a href="#cb847-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">residuals.pch =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-406-1.png" width="960" /></p>
<p><code>type = link</code>옵션을 사용하는 경우,
<code>Sex effect plot</code>, <code>Treatment effect plot</code>에서
<code>type = response</code>를 지정했을 때 보다 변수의 수준에 따른
효과의 차이가 더 크게나는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb848"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb848-1"><a href="#cb848-1" aria-hidden="true" tabindex="-1"></a>arth.full <span class="ot">&lt;-</span> <span class="fu">Effect</span>(<span class="fu">c</span>(<span class="st">&quot;Age&quot;</span>, <span class="st">&quot;Treatment&quot;</span>, <span class="st">&quot;Sex&quot;</span>),</span>
<span id="cb848-2"><a href="#cb848-2" aria-hidden="true" tabindex="-1"></a>                    arth.logistic2)</span></code></pre></div>
<p><code>Effect</code>함수의 경우 한 변수를 제어변수로 설정하고 그 제어
변수에 따른 나머지 변수들의 반응변수에 대한 수준 변화를 보여준다.<br />
<code>Effect</code>함수는 <code>effects</code>패키지에 포함돼있다.<br />
- <code>Effect(term,model)</code></p>
<ul>
<li>term: 반응변수에 대한 수준 변화를 관찰할 변수들 (마지막 변수가
제어변수가 된다.)</li>
<li>model: 변수들을 이용하여 적합시킨 모델</li>
</ul>
<p>위의 코드에서는 <code>Effect</code>함수에서 마지막에 들어가는 변수를
<strong>Sex</strong>로 설정했으므로, <strong>Sex</strong>가 제어변수가
된다.</p>
<div class="sourceCode" id="cb849"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="#cb849-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arth.full, <span class="at">multiline =</span> <span class="cn">TRUE</span>, <span class="at">ci.style =</span> <span class="st">&quot;bands&quot;</span>,</span>
<span id="cb849-2"><a href="#cb849-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb849-3"><a href="#cb849-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ticks =</span> <span class="fu">list</span>(<span class="at">at =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>)),</span>
<span id="cb849-4"><a href="#cb849-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">key.args =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.52</span>, <span class="at">y =</span> <span class="fl">0.92</span>, <span class="at">columns =</span> <span class="dv">1</span>,</span>
<span id="cb849-5"><a href="#cb849-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">grid =</span> <span class="cn">TRUE</span>)</span>
<span id="cb849-6"><a href="#cb849-6" aria-hidden="true" tabindex="-1"></a>     )</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-408-1.png" width="960" /></p>
<p><code>Effect</code>를 사용하여 얻은 결과에 대해서
<code>plot</code>함수를 이용하여 시각화를 진행하면 위와 같다.
<strong>Sex</strong>에 따라 패널 구별되는 것을 볼 수 있고, 앞선 결과들과
같이 <strong>Sex = Female</strong>일 때 <strong>Treatment</strong>의
수준에 상관없이 반응변수에 대한 확률이 <strong>Sex = Male</strong>일
때보다 모두 더 높게 나타나는 것을 것을 확인할 수 있다.</p>
<p><code>multiline</code>옵션은 마지막 제어변수의 모든 수준의 조합을
고려하여 패널을 나눌지 혹은 제어변수의 각 수준만을 고려하여 패널을
나눌지 결정한다. <strong>TRUE</strong>로 지정하게 되면 제어변수의 각
수준만을 고려하여 패널을 나눈다.<br />
<code>ci.style</code>은 신뢰구간의 스타일을 결정하는 것으로 여기에서는
<code>bands</code>로 설정하여 각 회귀 적합선에 대한 95% 신뢰수준
<strong>band</strong>가 출력된다.</p>
<div class="sourceCode" id="cb850"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb850-1"><a href="#cb850-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arth.full, <span class="at">multiline =</span> <span class="cn">TRUE</span>, <span class="at">ci.style =</span> <span class="st">&quot;bands&quot;</span>,</span>
<span id="cb850-2"><a href="#cb850-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb850-3"><a href="#cb850-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>), <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb850-4"><a href="#cb850-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">key.args =</span> <span class="fu">list</span>(<span class="at">x =</span> .<span class="dv">52</span>, <span class="at">y =</span> .<span class="dv">92</span>, <span class="at">columns =</span> <span class="dv">1</span>),</span>
<span id="cb850-5"><a href="#cb850-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">grid =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-409-1.png" width="960" /></p>
<p><code>type = response</code>로 지정하게 되면 적합선이 선형적인 직선이
아니라 0~1의 확률값을 가지는 곡선의 형태를 띄는 것을 확인할 수
있다.<br />
앞선 결과와 동일하게 <strong>Sex = Female</strong>인 경우
<strong>Treatment</strong>의 수준에 관계없이 <strong>Sex =
Male</strong>보다 추정 회귀선이 항상 높은 값을 갖는 것을 알 수 있다.</p>
<hr />
</div>
</div>
</div>
<div id="case-studies" class="section level2">
<h2>7.4 Case studies</h2>
<p>아래 예제는 다중 로지스틱 회귀 모델에서 데이터 분석, 모델 구축 및
시각화의 몇 가지 문제를 설명한다.<br />
우리는 주어진 모델을 해석하기 위한 데이터, 모델링 단계 및 그래프를 보기
위한 탐색 플롯의 조합에 초점을 맞춘다.</p>
<div id="simple-models-group-comparisions-and-effect-plots"
class="section level3">
<h3>7.4.1 Simple models: Group comparisions and effect plots</h3>
<p><em>Example 7.9: Donner Party</em></p>
<div class="sourceCode" id="cb851"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="#cb851-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Donner&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb851-2"><a href="#cb851-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code></pre></div>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<div class="sourceCode" id="cb854"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="#cb854-1" aria-hidden="true" tabindex="-1"></a><span class="fu">some</span>(Donner, <span class="dv">8</span>)</span></code></pre></div>
<pre><code>##                         family age    sex survived      death
## Breen, Edward            Breen  13   Male        1       &lt;NA&gt;
## Fosdick, Sarah        FosdWolf  22 Female        1       &lt;NA&gt;
## Graves, Elizabeth C.    Graves  47 Female        0 1847-03-12
## Hardkoop, Mr.            Other  60   Male        0 1846-10-10
## Murphy, Mary M.      MurFosPik  14 Female        1       &lt;NA&gt;
## Reinhardt, Joseph        Other  30   Male        0 1846-12-21
## Shoemaker, Samuel        Other  25   Male        0 1846-12-21
## Williams, Baylis         Other  24   Male        0 1846-12-15</code></pre>
<p><code>Donner</code>데이터는 1847년 미국 시에라 네바다 산맥의 동쪽에서
발생한 눈보라에 대한 생존자 및 사망자에 대한 데이터로,
<code>vcdExtra</code>패키지에 포함돼있다.</p>
<ul>
<li>row: 사람의 이름</li>
<li>family: 가족 이름 (Factor variable - Other, Breen, Donner, Graves
…)</li>
<li>age: 나이 (Discrete variable)</li>
<li>sex: 성별 (Factor variable - Male, Female)</li>
<li>survived: 생존여부 (Factor variable - 0,1)</li>
<li>death: 사망날짜 (POSIXct)</li>
</ul>
<p><code>car</code> 패키지는 대부분 선형 모델 및 일반화된 선형 모델에
대한 기능과 회귀진단, 특히 그래픽 진단을 할 수 있는 다양한 함수들을
제공한다.</p>
<div class="sourceCode" id="cb856"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="#cb856-1" aria-hidden="true" tabindex="-1"></a>Donner<span class="sc">$</span>survived <span class="ot">&lt;-</span> <span class="fu">factor</span>(Donner<span class="sc">$</span>survived, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>))</span></code></pre></div>
<p><strong>Survived</strong>변수를 0 또는 1에서
<strong>No,Yes</strong>의 수준을 가지는 <strong>Factor
variable</strong>로 바꿔주었다.</p>
<div class="sourceCode" id="cb857"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="#cb857-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> family, <span class="at">data =</span> Donner)</span></code></pre></div>
<pre><code>## family
##     Breen    Donner      Eddy  FosdWolf    Graves  Keseberg McCutchen MurFosPik 
##         9        14         4         4        10         4         3        12 
##     Other      Reed 
##        23         7</code></pre>
<p><code>xtabs</code>함수를 이용하여 <code>Donner</code>데이터의
<strong>family</strong>변수에 대한 빈도를 살펴보았다.<br />
<code>Donner</code>데이터에서, <strong>기타(Other)</strong>가 가장 많이
있으며, 그 다음으로는 <strong>Donner</strong>,
<strong>MurFosPik</strong> 가족 순으로 많은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb859"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="#cb859-1" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> Donner<span class="sc">$</span>family</span>
<span id="cb859-2"><a href="#cb859-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(fam)[<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">9</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Other&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb860"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="#cb860-1" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">=</span> <span class="fu">factor</span>(fam,<span class="fu">levels</span>(fam)[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">3</span>)])</span>
<span id="cb860-2"><a href="#cb860-2" aria-hidden="true" tabindex="-1"></a>Donner<span class="sc">$</span>family <span class="ot">&lt;-</span> fam</span>
<span id="cb860-3"><a href="#cb860-3" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span>family, <span class="at">data =</span> Donner)</span></code></pre></div>
<pre><code>## family
##     Breen    Donner    Graves MurFosPik      Reed     Other 
##         9        14        10        12         7        38</code></pre>
<p>가족 그룹에 대해서 일정 빈도가 넘는 가족들의 변수는 그대로 사용하고
작은 가족들의 경우에는 기타 범주로 통합하였다.<br />
<strong>family</strong>변수의 수준이 기존 10개에서 4개로 축소된 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb862"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="#cb862-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> survived <span class="sc">+</span> family, <span class="at">data =</span> Donner)</span></code></pre></div>
<pre><code>##         family
## survived Breen Donner Graves MurFosPik Reed Other
##      no      0      7      3         6    1    25
##      yes     9      7      7         6    6    13</code></pre>
<div class="sourceCode" id="cb864"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="#cb864-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(survived <span class="sc">~</span> family, <span class="at">data =</span> Donner, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;pink&quot;</span>, <span class="st">&quot;lightblue&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-416-1.png" width="960" /></p>
<p>재구성한 가족 그룹에 대한 생존빈도를 살펴보기 위해 Plot을 그려
보았다.<br />
<strong>Breen</strong> 가족의 경우 모든 가족이 생존해 있는 것을 알 수
있었으며, <strong>Donner</strong>, <strong>MurFosPik</strong> 가족은
절반은 생존, 절반은 사망했고 <strong>Reed</strong> 가족은 1명 사망, 6명
생존인 것을 확인할 수 있었다.</p>
<div class="sourceCode" id="cb865"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb865-1"><a href="#cb865-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gpairs)</span>
<span id="cb865-2"><a href="#cb865-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb865-3"><a href="#cb865-3" aria-hidden="true" tabindex="-1"></a><span class="fu">gpairs</span>(Donner[,<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>)],</span>
<span id="cb865-4"><a href="#cb865-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">diag.pars =</span> <span class="fu">list</span>(<span class="at">fontsize =</span> <span class="dv">20</span>, <span class="at">hist.color =</span> <span class="st">&quot;gray&quot;</span>),</span>
<span id="cb865-5"><a href="#cb865-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">mosaic.pars =</span> <span class="fu">list</span>(<span class="at">gp =</span> shading_Friendly),</span>
<span id="cb865-6"><a href="#cb865-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">outer.rot =</span> <span class="fu">c</span>(<span class="dv">45</span>,<span class="dv">45</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-417-1.png" width="960" /></p>
<p><code>Donner</code>데이터에 대한 변수 간 패턴을 파악하기 위해
<code>gpairs</code>함수를 사용해 보았다.<br />
반응변수 <strong>survived</strong>는 <strong>survived = yes</strong>가
약간 빈도가 더 많긴 하지만 한 쪽으로 심하게 치우치는 문제는 발생하지
않은 것처럼 보인다.<br />
<strong>Sex, Survived</strong>의 모자이크 플롯을 살펴보면, <strong>Sex =
Male</strong>일 때 <strong>survived = Yes</strong>는 음의 잔차를 가지는
것을 확인할 수 있고 <strong>Sex = Female</strong>일 때 <strong>Survived
= Yes</strong>는 양의 잔차를 가지는 것을 확인할 수 있다.<br />
이를 통해, 성별이 남성인 경우 생존을 하지 못할 빈도가 높은 경향이 있고
성별이 여성인 경우 생존할 빈도가 높은 경향이 있는 것을 알 수 있다.</p>
<p><strong>family, Survived</strong>의 모자이크 플롯을 살펴보면 앞선
결과와 동일하게 <strong>Breen</strong>가족만이 <strong>Survived =
Yes</strong>일때 양의 잔차를 가지고 나머지 가족들은 <strong>Survived =
Yes</strong>일때 음의 잔차를 가지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb866"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="#cb866-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Donner, <span class="fu">aes</span>(age, <span class="fu">as.numeric</span>(survived <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>),</span>
<span id="cb866-2"><a href="#cb866-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb866-3"><a href="#cb866-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Survived&quot;</span>) <span class="sc">+</span></span>
<span id="cb866-4"><a href="#cb866-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb866-5"><a href="#cb866-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.02</span>, <span class="at">width =</span> <span class="dv">0</span>))</span></code></pre></div>
<div class="sourceCode" id="cb867"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="#cb867-1" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">methd =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> binomial,</span>
<span id="cb867-2"><a href="#cb867-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb867-3"><a href="#cb867-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb867-4"><a href="#cb867-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb867-5"><a href="#cb867-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">fill =</span> sex))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-419-1.png" width="960" /></p>
<p><strong>Age</strong>를 x축으로 설정하고, <strong>Survived</strong>를
y축으로 설정한 후, 로지스틱 회귀모형에 적합시킨뒤,
<strong>sex</strong>에 따른 생존율을 살펴보았다.<br />
<strong>Age</strong>가 40대 이하인 경우 <strong>Sex = Female</strong>의
생존율이 <strong>Sex = Male</strong>의 생존율보다 높았지만,
<strong>Age</strong>가 40대 이상인 경우 <strong>Sex = Male</strong>의
생존율이 <strong>Sex = Female</strong>의 생존율보다 높아지는 것을 확인할
수 있었다.</p>
<div class="sourceCode" id="cb869"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="#cb869-1" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">metohd =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">family =</span> binomial,</span>
<span id="cb869-2"><a href="#cb869-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x,<span class="dv">2</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb869-3"><a href="#cb869-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">fill =</span> sex))</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-420-1.png" width="960" /></p>
<p><code>poly</code>함수를 사용하여 <strong>Age</strong>에 대한 2차
관계를 허용하여 그림을 다시 그려보았다. <strong>2차 곡선</strong>으로
그리게 될 경우, 앞서 살펴본 그림에 비해서 <strong>Sex = Male</strong>과
<strong>Sex = Female</strong>간의 확률차이가 현저히 줄어든 것을 확인할
수 있다.</p>
<div class="sourceCode" id="cb871"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="#cb871-1" aria-hidden="true" tabindex="-1"></a>gg <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">metohd =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">span =</span> <span class="fl">0.9</span>,</span>
<span id="cb871-2"><a href="#cb871-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb871-3"><a href="#cb871-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb871-4"><a href="#cb871-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">1.05</span>))</span></code></pre></div>
<pre><code>## Coordinate system already present. Adding new coordinate system, which will replace the existing one.</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-421-1.png" width="960" /></p>
<p><code>metohd = "loess"</code>(비선형 곡선)를 이용하는 경우,
<code>method = glm, family = binomial</code>과 같이
<strong>Age</strong>가 40대 이하에서 <strong>Sex = Female</strong>의
생존확률이 <strong>Sex = Male</strong>보다 높고 <strong>Age</strong>가
40대가 넘어가는 경우 <strong>Sex = Male</strong>의 생존확률이
<strong>Sex = Female</strong>의 생존확률보다 높아지는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb874"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="#cb874-1" aria-hidden="true" tabindex="-1"></a>donner.mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age <span class="sc">+</span> sex,</span>
<span id="cb874-2"><a href="#cb874-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb874-3"><a href="#cb874-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(donner.mod1)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: survived
##     LR Chisq Df Pr(&gt;Chisq)   
## age   5.5182  1   0.018820 * 
## sex   6.7274  1   0.009494 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>반응변수 <strong>Survived</strong>에 대한 <strong>age, sex</strong>를
설명변수로 하는 로지스틱 회귀 모형 적합 결과, 두 설명변수의 유의확률이
모두 유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, 두 설명변수 <strong>age, sex</strong>는 계수가 0이 아니므로
유의한 설명변수라고 할 수 있다.</p>
<div class="sourceCode" id="cb876"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="#cb876-1" aria-hidden="true" tabindex="-1"></a>donner.mod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age <span class="sc">*</span> sex,</span>
<span id="cb876-2"><a href="#cb876-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb876-3"><a href="#cb876-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(donner.mod2)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: survived
##         LR Chisq Df Pr(&gt;Chisq)   
## age       5.5182  1   0.018820 * 
## sex       6.7274  1   0.009494 **
## age:sex   0.4003  1   0.526922   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>age,sex</strong>변수의 교호작용을 고려하기 위해 Formula를
**age*sex<strong>로 지정하였다.<br />
주효과 </strong>age,sex<strong> 변수는 유의확률이 유의수준 0.05보다
작으므로 유의하하다.<br />
두 변수의 </strong>교호작용(age:sex)**은 유의확률이 유의수준 0.05보다
크므로 귀무가설을 기각하지 못한다. 따라서, 계수가 0이므로 유의하지 않은
것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb878"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="#cb878-1" aria-hidden="true" tabindex="-1"></a>donner.mod3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> <span class="fu">poly</span>(age, <span class="dv">2</span>) <span class="sc">+</span> sex,</span>
<span id="cb878-2"><a href="#cb878-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb878-3"><a href="#cb878-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(donner.mod3)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: survived
##              LR Chisq Df Pr(&gt;Chisq)   
## poly(age, 2)   9.9144  2   0.007033 **
## sex            8.0908  1   0.004449 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>age</strong>변수의 2차항을 고려하기 위해
<code>poly()</code>함수를 사용하였다.<br />
2차항을 적용한 결과, <strong>poly(age,2),sex</strong> 변수 모두
유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각한다. 따라서,
계수가 0이 아니라고 할 수 있으므로 유의한 변수임을 확인할 수 있었다.</p>
<div class="sourceCode" id="cb880"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="#cb880-1" aria-hidden="true" tabindex="-1"></a>donner.mod4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">2</span>) <span class="sc">*</span> sex,</span>
<span id="cb880-2"><a href="#cb880-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb880-3"><a href="#cb880-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(donner.mod4)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: survived
##                  LR Chisq Df Pr(&gt;Chisq)   
## poly(age, 2)       9.9144  2   0.007033 **
## sex                8.0908  1   0.004449 **
## poly(age, 2):sex   8.9321  2   0.011492 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>age의 2차항</strong>과 <strong>Sex</strong>를 설명변수로
고려한 후, 두 변수의 교호작용을 살펴보았다.<br />
앞선 1차식들의 교호작용과는 달리, <strong>age의 2차항과 Sex</strong>의
교호작용의 유의확률은 유의수준 0.05보다 작으므로 귀무가설을 기각한다.
따라서 계수가 0이 아니므로 유의한 변수라고 할 수 있다.<br />
또한, <strong>age의 2차항</strong> 주효과인 <strong>Sex</strong>도
유의확률이 유의수준 0.05보다 작으므로 유의한 변수임을 확인할 수
있었다.</p>
<div class="sourceCode" id="cb882"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="#cb882-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb882-2"><a href="#cb882-2" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(donner.mod1,donner.mod2,donner.mod3,donner.mod4)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##                AIC    BIC LR Chisq Df Pr(&gt;Chisq)  
## donner.mod1 117.13 124.63  111.128 87    0.04159 *
## donner.mod2 118.73 128.73  110.727 86    0.03755 *
## donner.mod3 114.73 124.73  106.731 86    0.06439 .
## donner.mod4 109.80 124.80   97.799 84    0.14408  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>LRstats()</code>함수를 사용하여 모델들의 주요 적합치를 비교해
보았다.<br />
<strong>donner.mod1, donner.mod2는</strong> 유의확률이 유의수준 0.05보다
낮으므로 변수를 추가하는것은 포화모델과 비교할 때, 유의한 잔차의 차이를
발생시키는 것임을 알 수 있다.<br />
반면, <strong>donner.mod3,donner.mod4</strong>는 유의확률이 유의수준
0.05보다 높으므로 포화모델에 가까운 모델임(변수를 추가했을때, 유의한
잔차의 차이가 발생하지 않음.)을 확인할 수 있었다.</p>
<div class="sourceCode" id="cb884"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="#cb884-1" aria-hidden="true" tabindex="-1"></a>mods <span class="ot">&lt;-</span> <span class="fu">list</span>(donner.mod1, donner.mod2, donner.mod3, donner.mod4)</span>
<span id="cb884-2"><a href="#cb884-2" aria-hidden="true" tabindex="-1"></a>LR <span class="ot">&lt;-</span> <span class="fu">sapply</span>(mods, <span class="cf">function</span>(x) x<span class="sc">$</span>deviance)</span>
<span id="cb884-3"><a href="#cb884-3" aria-hidden="true" tabindex="-1"></a>LR <span class="ot">&lt;-</span> <span class="fu">matrix</span>(LR,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb884-4"><a href="#cb884-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(LR) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;additive&quot;</span>, <span class="st">&quot;non-add&quot;</span>)</span>
<span id="cb884-5"><a href="#cb884-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(LR) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;linear&quot;</span>, <span class="st">&quot;non-lin&quot;</span>)</span>
<span id="cb884-6"><a href="#cb884-6" aria-hidden="true" tabindex="-1"></a>LR <span class="ot">&lt;-</span> <span class="fu">cbind</span>(LR, <span class="at">diff =</span> LR[,<span class="dv">1</span>] <span class="sc">-</span> LR[,<span class="dv">2</span>])</span>
<span id="cb884-7"><a href="#cb884-7" aria-hidden="true" tabindex="-1"></a>LR <span class="ot">&lt;-</span> <span class="fu">rbind</span>(LR, <span class="at">diff =</span> <span class="fu">c</span>(LR[<span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">-</span> LR[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="cn">NA</span>))</span>
<span id="cb884-8"><a href="#cb884-8" aria-hidden="true" tabindex="-1"></a>LR</span></code></pre></div>
<pre><code>##              linear    non-lin      diff
## additive 111.127504 106.731334  4.396171
## non-add  110.727180  97.799206 12.927974
## diff       0.400324   8.932128        NA</code></pre>
<p>LR통계량을 추출하여 행 및 열의 차이를 함께 표에 배열해서 모형을
비교해 보았다.<br />
결과적으로, <strong>Survived</strong>와 <strong>Age</strong>와의 관계가
<strong>Sex = Male</strong>과 <strong>Sex = Female</strong>에 따라
다르다는 증거가 있지만 선형적인 로지스틱에 의해서 잘 설명되지는 않는것을
확인할 수 있다(잔차의 차이가 크지 않기 때문이다.).</p>
<div class="sourceCode" id="cb886"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="#cb886-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb886-2"><a href="#cb886-2" aria-hidden="true" tabindex="-1"></a>donner.mod5 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> <span class="fu">ns</span>(age,<span class="dv">2</span>) <span class="sc">*</span> sex,</span>
<span id="cb886-3"><a href="#cb886-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb886-4"><a href="#cb886-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(donner.mod5)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: survived
##                LR Chisq Df Pr(&gt;Chisq)   
## ns(age, 2)       9.2813  2   0.009651 **
## sex              7.9778  1   0.004735 **
## ns(age, 2):sex   8.7058  2   0.012869 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>단순성을 위해 2차 효과인 <code>poly()</code>함수가 아닌
<code>splines</code>패키지의 <code>ns()</code>함수를 사용하여 스플라인을
사용하여 다시 한 번 분석을 진행해 보았다.<br />
<code>splines</code>패키지는 <code>spline</code>을 하기 위한 다양한
함수를 제공하며 그 중 <code>ns</code>는 <strong>natural cubic
spline</strong>을 생성할 수 있게 도와주는 함수이다.</p>
<p><code>ns(age,2)</code>를 통해 spline을 적용하여 분석을 진행한 결과,
<strong>주효과와 교호작용</strong> 모두 유의확률이 유의수준 0.05보다
작으므로 유의한 변수인 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb888"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="#cb888-1" aria-hidden="true" tabindex="-1"></a>donner.mod6 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> <span class="fu">ns</span>(age,<span class="dv">4</span>) <span class="sc">*</span> sex,</span>
<span id="cb888-2"><a href="#cb888-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb888-3"><a href="#cb888-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(donner.mod6)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: survived
##                LR Chisq Df Pr(&gt;Chisq)    
## ns(age, 4)      22.0482  4   0.000196 ***
## sex             10.4912  1   0.001199 ** 
## ns(age, 4):sex   8.5404  4   0.073672 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>ns(age,4)</code>를 사용하여 <strong>age</strong>변수를 4차
스플라인의 형태로 만들어 로지스틱 회귀분석을 진행한 결과,
<strong>주효과들</strong>은 유의확률이 유의수준 0.05보다 작으므로
유의하게 나타나지만, <strong>교호작용</strong>은 유의확률이 유의수준
0.05보다 크므로 유의하지 않은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb890"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="#cb890-1" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(donner.mod4, donner.mod5, donner.mod6)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##                AIC    BIC LR Chisq Df Pr(&gt;Chisq)
## donner.mod4 109.80 124.80   97.799 84     0.1441
## donner.mod5 110.66 125.66   98.659 84     0.1310
## donner.mod6 106.06 131.06   86.057 80     0.3016</code></pre>
<p><strong>donner.mod4, donner.mod5, donner.mod6</strong> 모두
유의확률이 유의수준 0.05보다 크므로 귀무가설을 기각하지 못한다. 즉,
주어진 모형에 변수를 추가시키는 것은 유의한 잔차의 차이를 발생시키지
못한다는 것을 알 수 있다.<br />
따라서, <code>spline</code>을 이용하여 모형을 적합시키는 것은 적절한
방법이 아닌 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb892"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="#cb892-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb892-2"><a href="#cb892-2" aria-hidden="true" tabindex="-1"></a>donner.eff6 <span class="ot">&lt;-</span> <span class="fu">allEffects</span>(donner.mod6, <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">5</span>)))</span>
<span id="cb892-3"><a href="#cb892-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(donner.eff6, <span class="at">tickcs =</span> <span class="fu">list</span>(<span class="at">at=</span><span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>,<span class="fl">0.9</span>,<span class="fl">0.95</span>,<span class="fl">0.99</span>,<span class="fl">0.999</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-431-1.png" width="960" /></p>
<p><strong>donner.mod6</strong>를 이용하여 <em>effects plot</em>을
그려보았다. <strong>Sex = Female</strong>의 경우, 0-15세 사이에서
생존확률이 가장 높았고 <strong>Age</strong>가 증가할수록 생존확률이 점점
떨어지는 것을 확인할 수 있었다.<br />
<strong>Sex = Male</strong>의 경우, <strong>Age</strong>가 0-15세
사이에서 생존확률이 가장 높았고 <strong>Age</strong>가 15-25세
생존확률이 전반적으로 낮았지만, <strong>Age</strong>가 25세 이후부터
생존확률이 다시 조금씩 증가하는 것을 볼 수 있다.</p>
<p><em>Example 7.10: Racial profiling: Arrests for marijuana
possession</em></p>
<div class="sourceCode" id="cb893"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="#cb893-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb893-2"><a href="#cb893-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arrests&quot;</span>, <span class="at">package =</span> <span class="st">&quot;effects&quot;</span>)</span>
<span id="cb893-3"><a href="#cb893-3" aria-hidden="true" tabindex="-1"></a>Arrests[<span class="fu">sample</span>(<span class="fu">nrow</span>(Arrests),<span class="dv">6</span>),]</span></code></pre></div>
<pre><code>##      released colour year age    sex employed citizen checks
## 3745      Yes  White 2001  15   Male      Yes     Yes      2
## 651        No  White 1999  28   Male      Yes     Yes      3
## 1500      Yes  Black 1997  26   Male      Yes     Yes      2
## 4416      Yes  Black 1999  22   Male      Yes     Yes      4
## 3645      Yes  Black 1998  17 Female      Yes     Yes      0
## 2139       No  Black 2001  20   Male      Yes     Yes      4</code></pre>
<p><code>Arrests</code>데이터는 토론토 경찰에 의한 인종 프로파일링
가능성에 대한 조사 데이터로 <code>effects</code>패키지에
포함돼있다.<br />
신문이 분석한 대마초 소지 혐의로 5,226건의 구속 기록을 담고 있으며, 반응
변수는 <strong>released</strong>로 주요 설명 변수는 체포된 사람의
피부색이다.</p>
<ul>
<li>released: 구속된 사람이 소환장과 함께 풀려났는지에 대한 여부 (Factor
variable - No, Yes)</li>
<li>colour: 체포자의 인종 (Factor variable - White, Black)</li>
<li>year: 년도 (Discrete variable)</li>
<li>age: 나이 (Discrete variable)</li>
<li>sex: 성별 (Factor variable - Male, Female)</li>
<li>employed: 고용상태 (Factor variable - No,Yes)</li>
<li>citizen: 시민여부 (Factor variable - No,Yes)</li>
<li>checks: 체포인의 이름이 나타난 경찰 데이터 베이스 수 (Discrete
variable)</li>
</ul>
<div class="sourceCode" id="cb895"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="#cb895-1" aria-hidden="true" tabindex="-1"></a>Arrests<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(Arrests<span class="sc">$</span>year)</span>
<span id="cb895-2"><a href="#cb895-2" aria-hidden="true" tabindex="-1"></a>arrests.mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(released <span class="sc">~</span> employed <span class="sc">+</span> citizen <span class="sc">+</span> checks <span class="sc">+</span></span>
<span id="cb895-3"><a href="#cb895-3" aria-hidden="true" tabindex="-1"></a>                     colour<span class="sc">*</span>year <span class="sc">+</span> colour<span class="sc">*</span>age,</span>
<span id="cb895-4"><a href="#cb895-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> binomial, <span class="at">data =</span> Arrests)</span></code></pre></div>
<p><strong>year</strong>변수를 <strong>factor</strong>의 형태로 변환해
준 후, <strong>released</strong>를 반응변수로하고 <strong>employed,
citizen, checks, colour &amp; year의 교호작용, Colour &amp; age의
교호작용</strong>을 설명변수로 하는 로지스틱 회귀모형을 적합시켰다.</p>
<div class="sourceCode" id="cb896"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="#cb896-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(arrests.mod)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: released
##             LR Chisq Df Pr(&gt;Chisq)    
## employed      72.673  1  &lt; 2.2e-16 ***
## citizen       25.783  1  3.820e-07 ***
## checks       205.211  1  &lt; 2.2e-16 ***
## colour        19.572  1  9.687e-06 ***
## year           6.087  5  0.2978477    
## age            0.459  1  0.4982736    
## colour:year   21.720  5  0.0005917 ***
## colour:age    13.886  1  0.0001942 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>로지스틱 회귀분석 결과, <strong>year,age</strong>를 제외한 모든
설명변수들의 유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각하여
유의한 설명변수임을 확인할 수 있었다.<br />
특히, <strong>colour:year</strong>, <strong>colour:age</strong>의
교호작용 또한 유의한 변수임을 알 수 있다.</p>
<div class="sourceCode" id="cb898"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="#cb898-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(arrests.mod)</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##                        Estimate Std. Error  z value  Pr(&gt;|z|)    
## (Intercept)           0.3444334  0.3100749   1.1108 0.2666514    
## employedYes           0.7350645  0.0847701   8.6713 &lt; 2.2e-16 ***
## citizenYes            0.5859841  0.1137717   5.1505 2.598e-07 ***
## checks               -0.3666425  0.0260322 -14.0842 &lt; 2.2e-16 ***
## colourWhite           1.2125167  0.3497751   3.4666 0.0005272 ***
## year1998             -0.4311794  0.2603589  -1.6561 0.0977023 .  
## year1999             -0.0944343  0.2615447  -0.3611 0.7180519    
## year2000             -0.0108975  0.2592073  -0.0420 0.9664655    
## year2001              0.2430630  0.2630151   0.9241 0.3554129    
## year2002              0.2129549  0.3532786   0.6028 0.5466444    
## age                   0.0287279  0.0086191   3.3330 0.0008590 ***
## colourWhite:year1998  0.6519565  0.3134898   2.0797 0.0375555 *  
## colourWhite:year1999  0.1559504  0.3070430   0.5079 0.6115161    
## colourWhite:year2000  0.2957537  0.3062034   0.9659 0.3341076    
## colourWhite:year2001 -0.3805413  0.3040538  -1.2516 0.2107305    
## colourWhite:year2002 -0.6173178  0.4192551  -1.4724 0.1409086    
## colourWhite:age      -0.0373729  0.0102003  -3.6639 0.0002484 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>lmtest</code>패키지의 <code>coeftest</code>를 통해 변수들의
계수 추정치 및 Wald검정 결과를 확인할 수 있다.<br />
<strong>Employed, citizen, checks, colour, age, colourwhite:year1998,
colourwhite:age</strong>변수들은 유의확률이 유의수준 0.05보다 작으므로
귀무가설을 기각하여 유의한 설명변수임을 알 수 있다.</p>
<p>특히, 앞선 결과에서 <strong>age</strong>변수는 유의하지 않게 나왔는데
앞선 검정은 <strong>age</strong>를 주효과가 아닌 교호작용의 일부로
인식한 후 검정을 진행하였고 <strong>Wald</strong>검정은
<strong>age</strong>를 주효과로 인식한 후 검정을 진행하였기 때문에
유의한 결과가 나온 것으로 생각된다.</p>
<p><strong>colour = White</strong>의 경우 <strong>colour =
Black</strong>인 경우보다 <strong>released = Yes</strong>일 오즈가
<strong>exp(1.21) = 3.36배</strong> 높은 것을 알 수 있었다.<br />
<strong>Employed = Yes</strong>의 경우 <strong>Employed = No</strong>인
경우보다 <strong>released = Yes</strong>일 오즈가 <strong>exp(0.735) =
2.12배</strong> 높은 것을 알 수 있었다.<br />
<strong>age</strong>가 한 단위 증가함에 따라, <strong>released =
Yes</strong>일 오즈가 <strong>exp(0.028) = 1.02</strong>배 증가하는 것을
알 수 있었다.</p>
<div class="sourceCode" id="cb900"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="#cb900-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="st">&quot;colour&quot;</span>, arrests.mod),</span>
<span id="cb900-2"><a href="#cb900-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">ci.style =</span> <span class="st">&quot;bands&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb900-3"><a href="#cb900-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">list</span>(<span class="st">&quot;Skin color of arrestee&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb900-4"><a href="#cb900-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">list</span>(<span class="st">&quot;Probability(released)&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-436-1.png" width="960" /></p>
<p><strong>relased</strong>에 대한 <strong>colour = White</strong>의
확률이 <strong>colour = Black</strong>보다 높은 것으로 보아 흑인에 비해
백인은 심한대우를 덜 받은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb901"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="fu">c</span>(<span class="st">&quot;colour&quot;</span>, <span class="st">&quot;age&quot;</span>), arrests.mod),</span>
<span id="cb901-2"><a href="#cb901-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">multiline =</span> <span class="cn">TRUE</span>, <span class="at">ci.style =</span> <span class="st">&quot;bands&quot;</span>,</span>
<span id="cb901-3"><a href="#cb901-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">list</span>(<span class="st">&quot;Age&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb901-4"><a href="#cb901-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">list</span>(<span class="st">&quot;Probability(released)&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb901-5"><a href="#cb901-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">key.args =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.99</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">columns=</span><span class="dv">1</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-437-1.png" width="960" /></p>
<p><strong>Age</strong>와 같이 고려하여 <strong>Effect
display</strong>를 살펴본 결과, <strong>Age</strong>가 30대 이하인 젊은
흑인의 경우 동등한 나이의 백인에 비해 더 심한대우를 받았지만
<strong>Age</strong>가 많아짐에 따라 오히려 흑인이 백인에 비해
심한대우를 덜 받은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb902"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="#cb902-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="fu">c</span>(<span class="st">&quot;colour&quot;</span>,<span class="st">&quot;year&quot;</span>), arrests.mod),</span>
<span id="cb902-2"><a href="#cb902-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">multiline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb902-3"><a href="#cb902-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="fu">list</span>(<span class="st">&quot;Year&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb902-4"><a href="#cb902-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">list</span>(<span class="st">&quot;Probability(released)&quot;</span>, <span class="at">cex =</span> <span class="fl">1.25</span>),</span>
<span id="cb902-5"><a href="#cb902-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">key.args =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.7</span>, <span class="at">y =</span> <span class="fl">0.99</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">columns =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-438-1.png" width="960" /></p>
<p><strong>Age</strong>와 <strong>Year</strong>를 같이 고려하여
<strong>released</strong>반응변수에 대한 <strong>effects
display</strong>를 그려보았다.<br />
<strong>2001년 이전</strong>까지 흑인과 백인간 차별대우가 많았지만,
<strong>2000년 이후</strong>부터는 그 차이가 많이 줄어든 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb903"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="#cb903-1" aria-hidden="true" tabindex="-1"></a>arrests.effects <span class="ot">&lt;-</span> <span class="fu">allEffects</span>(arrests.mod,</span>
<span id="cb903-2"><a href="#cb903-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">xlevels =</span> <span class="fu">list</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">45</span>,<span class="dv">5</span>)))</span>
<span id="cb903-3"><a href="#cb903-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arrests.effects,</span>
<span id="cb903-4"><a href="#cb903-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Probability(released)&quot;</span>,</span>
<span id="cb903-5"><a href="#cb903-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ci.style =</span> <span class="st">&quot;bands&quot;</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-439-1.png" width="960" /></p>
<p><code>allEffects</code>함수를 사용하여 시각화를 하게 되면 각
설명변수의 수준 혹은 값이 변화함에 따라 반응변수에 대한 확률 변화를 한
패널안에서 확인할 수 있다. <strong>Employed = Yes</strong>인 경우,
<strong>Employed = No</strong>인 사람에 비해 심한대우를 덜 받았음을 알
수 있고 <strong>Citizen = Yes</strong>인 경우, <strong>Citizen =
No</strong>인 사람에 비해 심한대우를 덜 받았으며,
<strong>checks</strong>가 낮을수록 심한대우를 덜 받았던 것을 확인할 수
있다.</p>
</div>
<div id="more-complex-models-model-selection-and-visualization"
class="section level3">
<h3>7.4.2 More complex models: Model selection and visualization</h3>
<p><em>Example 7.11: Death in the ICU</em></p>
<div class="sourceCode" id="cb904"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="#cb904-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ICU&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcdExtra&quot;</span>)</span>
<span id="cb904-2"><a href="#cb904-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ICU)</span></code></pre></div>
<pre><code>##  [1] &quot;died&quot;     &quot;age&quot;      &quot;sex&quot;      &quot;race&quot;     &quot;service&quot;  &quot;cancer&quot;  
##  [7] &quot;renal&quot;    &quot;infect&quot;   &quot;cpr&quot;      &quot;systolic&quot; &quot;hrtrate&quot;  &quot;previcu&quot; 
## [13] &quot;admit&quot;    &quot;fracture&quot; &quot;po2&quot;      &quot;ph&quot;       &quot;pco&quot;      &quot;bic&quot;     
## [19] &quot;creatin&quot;  &quot;coma&quot;     &quot;white&quot;    &quot;uncons&quot;</code></pre>
<p><code>ICU</code> 데이터 세트는 호스머, 레메쇼와 스투르디반트와
프렌들리에서 도출된 성인 중환자실 입원후 환자의 생존에 대한 훨씬 더 큰
연구의 일부인 200명의 피험자 샘플로 구성되 있으며,
<code>vcdExtra</code>패키지에 포함돼있다.<br />
이 연구의 목표는 환자의 병원 퇴원 시 생존 확률을 예측하고 ICU 사망률과
관련된 위험 요인을 연구하는 로지스틱 회귀 모델을 개발하는 것이었다.</p>
<ul>
<li>died: 퇴원 전 사망여부 (Factor variable - No, Yes)</li>
<li>age: 나이 (Discrete variable)</li>
<li>sex: 성별 (Factor variable - Female, Male)</li>
<li>race: 환자의 인종 (Factor variable - Black, Other, White)</li>
<li>service: ICU 입원 서비스 (Factor variable - Medical, Surgical)</li>
<li>cancer: 현재 문제가 암인지에 대한 여부 (Factor variable - No,
Yes)</li>
<li>renal: 만성 신부전 병력 여부 (Factor variable - No, Yes)</li>
<li>infect: 중환자실 입원 시 감염 가능성 여부 (Factor variable - No,
Yes)</li>
<li>cpr: 중환자실 입원 전 cpr 여부 (Factor variable - No, Yes)</li>
<li>systolic: 입원 시 수축기 혈압 (Discrete variable)</li>
<li>hrtrate: 심박수 (Discrete variable)</li>
<li>previcu: 6개월 이내에 ICU에 입원한 적 있는지에 대한 여부 (Factor
variable - No, Yes)</li>
<li>admit: 입원 유형 (Factor variable - Elective, Emergency)</li>
<li>fracture: 고관절 골절 관련 입원 여부 (Factor variable - No,
Yes)</li>
<li>po2: 시작 혈액 가스의 PO2수치 (Factor variable - &gt;60,
&lt;=60)</li>
<li>ph: 시작 혈액 가스의 PH수치 (Factor variable - &gt;=7.25,
&lt;7.25)</li>
<li>pco: 시작 혈액 가스의 PCO2수치 (Factor variable - &lt;=45,
&gt;45)</li>
<li>bic: 시작 혈액 가스의 Bicarbonate수치 (Factor variable - &gt;=18,
&lt;18)</li>
<li>creatin: 시작 혈액 가스의 Creatin수치 (Factor variable - &lt;=2,
&gt;2)</li>
<li>coma: 중환자실에 입원 했을 때 의식 수준 (Factor variable - None,
Stupor Coma)</li>
<li>white: race 변수의 재코딩 (Factor variable - White, Non-White)</li>
<li>uncons: coma 변수의 재코딩 (Factor variable - No, Yes)</li>
</ul>
<div class="sourceCode" id="cb906"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="#cb906-1" aria-hidden="true" tabindex="-1"></a>ICU <span class="ot">&lt;-</span> ICU[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">20</span>)]</span></code></pre></div>
<p><code>ICU</code>데이터에서 <strong>race</strong>와
<strong>coma</strong>는 재코딩된 변수가 존재하기 때문에 각각 2개의
변수를 가지고 있다.<br />
따라서, 변수가 겹치지않도록 두 개의 변수 중 각각 하나씩 제거한 후,
분석을 진행한다.</p>
<div class="sourceCode" id="cb907"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="#cb907-1" aria-hidden="true" tabindex="-1"></a>icu.full <span class="ot">&lt;-</span> <span class="fu">glm</span>(died <span class="sc">~</span>., <span class="at">data =</span> ICU, <span class="at">family =</span> binomial)</span>
<span id="cb907-2"><a href="#cb907-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(icu.full)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = died ~ ., family = binomial, data = ICU)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.80396  -0.56064  -0.20440  -0.08635   2.97729  
## 
## Coefficients:
##                  Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     -6.726704   2.385512  -2.820  0.00481 ** 
## age              0.056393   0.018624   3.028  0.00246 ** 
## sexMale          0.639725   0.531393   1.204  0.22864    
## serviceSurgical -0.673522   0.601902  -1.119  0.26315    
## cancerYes        3.107051   1.045846   2.971  0.00297 ** 
## renalYes        -0.035708   0.801647  -0.045  0.96447    
## infectYes       -0.204933   0.553191  -0.370  0.71104    
## cprYes           1.053483   1.006614   1.047  0.29530    
## systolic        -0.015472   0.008497  -1.821  0.06864 .  
## hrtrate         -0.002769   0.009607  -0.288  0.77317    
## previcuYes       1.131942   0.671450   1.686  0.09183 .  
## admitEmergency   3.079583   1.081584   2.847  0.00441 ** 
## fractureYes      1.411402   1.029705   1.371  0.17047    
## po2&lt;=60          0.073822   0.857044   0.086  0.93136    
## ph&lt;7.25          2.354078   1.208804   1.947  0.05148 .  
## pco&gt;45          -3.018442   1.253448  -2.408  0.01604 *  
## bic&lt;18          -0.709284   0.909777  -0.780  0.43561    
## creatin&gt;2        0.295143   1.116925   0.264  0.79159    
## whiteNon-white   0.565729   0.926828   0.610  0.54160    
## unconsYes        5.232292   1.226303   4.267 1.98e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 200.16  on 199  degrees of freedom
## Residual deviance: 120.78  on 180  degrees of freedom
## AIC: 160.78
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p><strong>반응변수(died)</strong>를 제외한 모든 데이터를 설명변수로
사용하여 로지스틱 회귀 분석을 진행하였다.<br />
<strong>age, cancerYes, admit, pco, uncons</strong>변수는 유의확률이
유의수준 0.05보다 작으므로 귀무가설을 기각하게 된다. 따라서, 유의한
변수임을 알 수 있다.<br />
그 외의 설명변수들은 유의확률이 유의수준 0.05보다 크므로 귀무가설을
기각하지 못하게된다. 따라서, 유의하지 않은 변수임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb909"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="#cb909-1" aria-hidden="true" tabindex="-1"></a>LRtest <span class="ot">&lt;-</span> <span class="cf">function</span>(model){</span>
<span id="cb909-2"><a href="#cb909-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">LRchisq =</span> (model<span class="sc">$</span>null.deviance <span class="sc">-</span> model<span class="sc">$</span>deviance),</span>
<span id="cb909-3"><a href="#cb909-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> (model<span class="sc">$</span>df.null <span class="sc">-</span> model<span class="sc">$</span>df.residual))</span>
<span id="cb909-4"><a href="#cb909-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb909-5"><a href="#cb909-5" aria-hidden="true" tabindex="-1"></a>(LR <span class="ot">&lt;-</span> <span class="fu">LRtest</span>(icu.full))</span></code></pre></div>
<pre><code>##  LRchisq       df 
## 79.38262 19.00000</code></pre>
<div class="sourceCode" id="cb911"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="#cb911-1" aria-hidden="true" tabindex="-1"></a>(pvalue <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(LR[<span class="dv">1</span>],LR[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>##      LRchisq 
## 2.375397e-09</code></pre>
<p>우리가 적합시킨 <code>icu.full</code>모델의 L0와 L1잔차 비교를 통해
모형의 적합도 검정을 진행해 보았다.<br />
L0-L1의 검정통계량 값은 79.38262으로 카이제곱 분포를 따르며, 유의확률이
유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, 기존 모델에 변수를 추가하여 적합된 <code>icu.full</code>모델은
적합한 모형임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb913"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="#cb913-1" aria-hidden="true" tabindex="-1"></a>icu.full1 <span class="ot">&lt;-</span> <span class="fu">update</span>(icu.full, . <span class="sc">~</span> . <span class="sc">-</span> renal <span class="sc">-</span> fracture)</span>
<span id="cb913-2"><a href="#cb913-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(icu.full1, icu.full, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: died ~ age + sex + service + cancer + infect + cpr + systolic + 
##     hrtrate + previcu + admit + po2 + ph + pco + bic + creatin + 
##     white + uncons
## Model 2: died ~ age + sex + service + cancer + renal + infect + cpr + 
##     systolic + hrtrate + previcu + admit + fracture + po2 + ph + 
##     pco + bic + creatin + white + uncons
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1       182     122.48                     
## 2       180     120.78  2   1.6994   0.4275</code></pre>
<p><code>update</code>함수를 통해 전체 모델에서 <strong>renal,
fracture</strong>를 제거한 후 로지스틱 회귀모형을 다시 한 번 적합시켜
보았다.<br />
anova 검정결과, <strong>renal, fracture</strong>를 제외한 모델과
제외하지 않은 모델간 잔차의 차이는 약 1.7로 매우 작으며, 유의확률이
유의수준 0.05보다 크므로 귀무가설을 기각하지 못한다. 따라서,
<strong>renal, fracture</strong>를 제거 하는 것은 모형에 대해서 유의한
잔차의 차이를 만들어내지 못한다고 할 수 있다.</p>
<div class="sourceCode" id="cb915"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="#cb915-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span></code></pre></div>
<pre><code>## 필요한 패키지를 로딩중입니다: Hmisc</code></pre>
<pre><code>## 필요한 패키지를 로딩중입니다: survival</code></pre>
<pre><code>## 필요한 패키지를 로딩중입니다: Formula</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;Hmisc&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:xtable&#39;:
## 
##     label, label&lt;-</code></pre>
<pre><code>## The following objects are masked from &#39;package:plyr&#39;:
## 
##     is.discrete, summarize</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     src, summarize</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     format.pval, units</code></pre>
<pre><code>## 필요한 패키지를 로딩중입니다: SparseM</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;SparseM&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     backsolve</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;rms&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:car&#39;:
## 
##     Predict, vif</code></pre>
<pre><code>## The following object is masked from &#39;package:lmtest&#39;:
## 
##     lrtest</code></pre>
<div class="sourceCode" id="cb930"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="#cb930-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(ICU[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb930-2"><a href="#cb930-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">&quot;dd&quot;</span>)</span>
<span id="cb930-3"><a href="#cb930-3" aria-hidden="true" tabindex="-1"></a>icu.lrm1 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(died <span class="sc">~</span> ., <span class="at">data =</span> ICU)</span>
<span id="cb930-4"><a href="#cb930-4" aria-hidden="true" tabindex="-1"></a>icu.lrm1 <span class="ot">&lt;-</span> <span class="fu">update</span>(icu.lrm1, . <span class="sc">~</span> . <span class="sc">-</span> renal <span class="sc">-</span> fracture)</span></code></pre></div>
<p>모델 선택을 고려하기 전에 계수 및 중요도 테스트 표를 보는 것보다
모델에 대해서 시각적으로 살펴보는 것이 더 유용하다.<br />
R에서 이러한 방법은 <code>rms</code>패키지를 통해 사용할 수 있는데,
<code>rms</code>패키지는 회귀 모형화, 검정, 추정 검증과 더불어 그례픽을
통해 모델의 성능을 표현하도록 도와준다.<br />
<code>lrm</code>함수는 <code>rms</code>패키지에 포함된 함수로 최대우도
추정 혹은 패널티된 최대우도 추정치를 사용하여 이항 및 비례 승산 순서형
로지스틱 회귀모형을 적합시킨다.<br />
도출된 모형의 결과를 시각화하기 위해서는 <code>glm</code>이 아닌
<code>rms</code>패키지의 <code>lrm</code>함수롤 통해 로지스틱 회귀모형에
적합시켜야한다.<br />
- <code>lrm(formula,data)</code></p>
<ul>
<li>formula: 분석가가 원하고자 하는 모델의 형태 (변수들의 구성)</li>
<li>data: 로지스틱 모형을 적합시킬 데이터</li>
</ul>
<p><code>lrm</code>을 통해 <strong>ICU</strong>데이터에 대해 다시 한 번
로지스틱 회귀모형을 적합시켜 보았다.</p>
<div class="sourceCode" id="cb931"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="#cb931-1" aria-hidden="true" tabindex="-1"></a>sum.lrm1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(icu.lrm1)</span>
<span id="cb931-2"><a href="#cb931-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sum.lrm1, <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">&quot;Odds ratio for &#39;died&quot;</span>,</span>
<span id="cb931-3"><a href="#cb931-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.25</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fu">c</span>(<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-446-1.png" width="960" /></p>
<p><code>lrm</code>을 통해 로지스틱 회귀모형을 적합시킨 후,
<code>summary</code>함수를 통해 적합된 모형에 대해 훨씬 더 상세한 정보를
생성할 수 있다.<br />
또한, <code>sumamry</code>된 <code>lrm</code>의 결과를 저장하여
<code>plot</code>함수를 통해 시각화를 하게 되면 신뢰구간과 함께 모형
항에 대한 오즈비를 제공한다.<br />
이 그림에서는 연속형 변수가 맨 위에 먼저 표시된다.<br />
각 선은 오즈비에 대한 신뢰 구간을 표시하고 세모는 추정된 오즈비를
나타낸다.</p>
<p><strong>uncons, Cancer, age, ph</strong>의 오즈비가 다른 설명변수들에
비해 크게 추정되는 것을 확인할 수 있다. 즉, 종속변수
<strong>died</strong>에 영향을 많이 끼치는 변수라고 할 수 있다.</p>
<div class="sourceCode" id="cb932"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="#cb932-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb932-2"><a href="#cb932-2" aria-hidden="true" tabindex="-1"></a>icu.step1 <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(icu.full1, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb932-3"><a href="#cb932-3" aria-hidden="true" tabindex="-1"></a>icu.step1<span class="sc">$</span>anova</span></code></pre></div>
<pre><code>## Stepwise Model Path 
## Analysis of Deviance Table
## 
## Initial Model:
## died ~ age + sex + service + cancer + infect + cpr + systolic + 
##     hrtrate + previcu + admit + po2 + ph + pco + bic + creatin + 
##     white + uncons
## 
## Final Model:
## died ~ age + cancer + systolic + admit + ph + pco + uncons
## 
## 
##         Step Df   Deviance Resid. Df Resid. Dev      AIC
## 1                                182   122.4777 158.4777
## 2      - po2  1 0.06244633       183   122.5402 156.5402
## 3  - creatin  1 0.05908007       184   122.5993 154.5993
## 4  - hrtrate  1 0.07237058       185   122.6716 152.6716
## 5   - infect  1 0.12277184       186   122.7944 150.7944
## 6    - white  1 0.33499941       187   123.1294 149.1294
## 7  - service  1 0.67131343       188   123.8007 147.8007
## 8      - bic  1 0.37752109       189   124.1782 146.1782
## 9      - cpr  1 1.14825976       190   125.3265 145.3265
## 10     - sex  1 1.54352276       191   126.8700 144.8700
## 11 - previcu  1 1.56997616       192   128.4400 144.4400</code></pre>
<div class="sourceCode" id="cb934"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="#cb934-1" aria-hidden="true" tabindex="-1"></a>icu.step2 <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(icu.full, <span class="at">trace =</span> <span class="cn">FALSE</span>, <span class="at">k =</span> <span class="fu">log</span>(<span class="dv">200</span>))</span>
<span id="cb934-2"><a href="#cb934-2" aria-hidden="true" tabindex="-1"></a>icu.step2<span class="sc">$</span>anova</span></code></pre></div>
<pre><code>## Stepwise Model Path 
## Analysis of Deviance Table
## 
## Initial Model:
## died ~ age + sex + service + cancer + renal + infect + cpr + 
##     systolic + hrtrate + previcu + admit + fracture + po2 + ph + 
##     pco + bic + creatin + white + uncons
## 
## Final Model:
## died ~ age + cancer + admit + uncons
## 
## 
##          Step Df    Deviance Resid. Df Resid. Dev      AIC
## 1                                  180   120.7783 226.7447
## 2     - renal  1 0.001988058       181   120.7803 221.4484
## 3       - po2  1 0.006796768       182   120.7871 216.1568
## 4   - creatin  1 0.062146344       183   120.8493 210.9207
## 5   - hrtrate  1 0.065886950       184   120.9152 205.6882
## 6    - infect  1 0.203322074       185   121.1185 200.5933
## 7     - white  1 0.367317995       186   121.4858 195.6623
## 8       - bic  1 0.600299257       187   122.0861 190.9642
## 9   - service  1 0.767630316       188   122.8537 186.4335
## 10 - fracture  1 1.324508649       189   124.1782 182.4597
## 11      - cpr  1 1.148259760       190   125.3265 178.3097
## 12      - sex  1 1.543522756       191   126.8700 174.5549
## 13  - previcu  1 1.569976164       192   128.4400 170.8265
## 14       - ph  1 4.441236967       193   132.8812 169.9695
## 15      - pco  1 2.730293352       194   135.6115 167.4014
## 16 - systolic  1 3.523102783       195   139.1346 165.6262</code></pre>
<p><code>stepwise(단계적 변수선택법)</code>을 통해 다차원의 변수를
저차원으로 줄일 수 있다. 이때, 표본 크기가 상당히 큰 경우 일반적으로 더
작은 모델을 선택하는 <code>(k=log())</code>를 지정하여 사용할 수
있다.<br />
R에서는 <code>stepAIC</code>함수를 사용하여 stepwise를 사용할수
있다.<br />
- <code>stepAIC(model)</code></p>
<ul>
<li>model: stepwise를 적용하고자 하는 모델</li>
</ul>
<div class="sourceCode" id="cb936"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="#cb936-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(icu.step2)</span></code></pre></div>
<pre><code>## 
## z test of coefficients:
## 
##                 Estimate Std. Error z value  Pr(&gt;|z|)    
## (Intercept)    -6.869779   1.318818 -5.2090 1.898e-07 ***
## age             0.037176   0.012770  2.9112 0.0036003 ** 
## cancerYes       2.097107   0.838473  2.5011 0.0123808 *  
## admitEmergency  3.102182   0.918597  3.3771 0.0007326 ***
## unconsYes       3.705460   0.876473  4.2277 2.361e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>stepwise</code>를 사용하여 변수를 선택한 결과, <strong>age,
admitEmergency,cancer, uncons</strong>변수가 선택되었고 네 변수 모두
유의확률이 유의수준 0.05보다 작으므로 유의한 것을 확인할 수 있다.<br />
앞선 분석에서, <code>lrm</code>의 <code>plot</code>을 통해 오즈비의
추정값이 높았던 4개의 설명변수와 동일한 변수가 선택된 것 또한 살펴볼 수
있다.</p>
<div class="sourceCode" id="cb938"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="#cb938-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(icu.step2, icu.step1, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: died ~ age + cancer + admit + uncons
## Model 2: died ~ age + cancer + systolic + admit + ph + pco + uncons
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
## 1       195     139.13                       
## 2       192     128.44  3   10.695   0.0135 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>(k=log())</code>를 적용한 <code>icu.step2</code>와 사용하지
않은 <code>icu.step1</code>을 비교한 결과, 유의확률이 유의수준 0.05보다
작으므로 유의한 잔차의 차이가 있는 것을 확인할 수 있다.<br />
위의 결과를 통해, <code>Model2(k=log()를 적용하지 않은 모델)</code>의
잔차가 더 작으므로 <code>Model1</code>에 비해 더 적합한 모델임을 확인할
수 있다.</p>
<div class="sourceCode" id="cb940"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="#cb940-1" aria-hidden="true" tabindex="-1"></a>icu.glm3 <span class="ot">&lt;-</span> <span class="fu">update</span>(icu.step2, . <span class="sc">~</span> . <span class="sc">-</span> age <span class="sc">+</span> <span class="fu">ns</span>(age,<span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb940-2"><a href="#cb940-2" aria-hidden="true" tabindex="-1"></a>                     (cancer <span class="sc">+</span> admit <span class="sc">+</span> uncons) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb940-3"><a href="#cb940-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(icu.step2, icu.glm3, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: died ~ age + cancer + admit + uncons
## Model 2: died ~ cancer + admit + uncons + ns(age, 3) + cancer:admit + 
##     cancer:uncons + admit:uncons
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1       195     139.13                     
## 2       191     135.40  4   3.7329   0.4434</code></pre>
<p><code>ns(age,3)</code>을 통해 <strong>age</strong>변수에 대한 3차원의
스플라인과 <strong>cancer,admit,uncons</strong>의 2차식을 추가한 후,
다시 한 번 로지스틱 회귀모형을 적합시켜 보았다.<br />
<code>anova</code>함수를 통해 <code>stepwise</code>를 통해 적합시킨 이전
모델과 비교해본 결과 잔차의 차이는 3.73이고 유의확률은 유의수준 0.05보다
크므로 귀무가설을 기각하지 못한다.<br />
따라서, 변수를 추가하는 것은 유의미한 잔차의 차이를 만들어내지 못하며,
적합하지 않은 모델이라고 할 수 있다.</p>
<div class="sourceCode" id="cb942"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="#cb942-1" aria-hidden="true" tabindex="-1"></a>icu.glm4 <span class="ot">&lt;-</span> <span class="fu">update</span>(icu.step2, . <span class="sc">~</span> . <span class="sc">+</span> age <span class="sc">*</span> (cancer <span class="sc">+</span> admit <span class="sc">+</span> uncons))</span>
<span id="cb942-2"><a href="#cb942-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(icu.step2, icu.glm4, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: died ~ age + cancer + admit + uncons
## Model 2: died ~ age + cancer + admit + uncons + age:cancer + age:admit + 
##     age:uncons
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1       195     139.13                     
## 2       192     133.76  3   5.3712   0.1465</code></pre>
<p>기존 모형에 <strong>cancer,admit,uncons</strong>변수들의 교호작용을
고려하여 새로운 모델을 만든 후, <code>stepwise</code>를 통해 적합시킨
모형들과 비교를 해본 결과, 잔차의 차이는 5.3712이고 유의확률은 유의수준
0.05보다 커 귀무가설을 기각하지 못한다.<br />
따라서, 교호작용 term을 추가하는 것은 유의미한 잔차의 차이를 만들어내지
못하며, 적합하지 않은 모델이라고 할 수 있다.</p>
<p><em>Example 7.12: Death in the ICU - Visualization</em></p>
<p>한 가지 흥미로운 시각화 방법은 다양한 설명 변수의 값이 로그 오즈
예측값으로 변환되는 방법과 이러한 예측에 미치는 영향의 상대적 강도를
보여주는 <strong>노모그램(nomogram)</strong>이다.<br />
<code>nomogram</code>은 <code>rms</code>패키지에 포함돼있으며,
<code>lrm</code>을 사용한 모델에만 적용되므로 이 점을 반드시
유의해야한다.<br />
- <code>nomogram(model)</code></p>
<ul>
<li>model: <code>lrm</code>함수를 이용하여 적합시킨 모델</li>
</ul>
<div class="sourceCode" id="cb944"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="#cb944-1" aria-hidden="true" tabindex="-1"></a>icu.lrm2 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(died <span class="sc">~</span> age <span class="sc">+</span> cancer <span class="sc">+</span> admit <span class="sc">+</span> uncons, <span class="at">data =</span> ICU)</span>
<span id="cb944-2"><a href="#cb944-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">nomogram</span>(icu.lrm2), <span class="at">cex.var =</span> <span class="fl">1.2</span>, <span class="at">lplabel =</span> <span class="st">&quot;Log odds death&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-453-1.png" width="960" /></p>
<p>노모그램에서 각 설명변수는 공통척도 100점에 대한 효과의 크기에 따라
크기가 조정된다.</p>
<p>예를들어, <strong>Age = 60</strong>이고 <strong>Cancer = No</strong>,
<strong>admit = Emergency</strong>, <strong>uncons = Yes</strong>인
사람이 있다고 가정하자.<br />
이러한 경우 총점 척도는 50 + 0 + 84 + 100 = 234점이며, 로그 오즈의
척도는 약 2.2로 계산될 수 있다.</p>
<div class="sourceCode" id="cb945"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="#cb945-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ICU<span class="sc">$</span>cancer) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;Cancer&quot;</span>)</span>
<span id="cb945-2"><a href="#cb945-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ICU<span class="sc">$</span>admit) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;Emerg&quot;</span>)</span>
<span id="cb945-3"><a href="#cb945-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ICU<span class="sc">$</span>uncons) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;Uncons&quot;</span>)</span>
<span id="cb945-4"><a href="#cb945-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb945-5"><a href="#cb945-5" aria-hidden="true" tabindex="-1"></a>icu.glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(died <span class="sc">~</span> age <span class="sc">+</span> cancer <span class="sc">+</span> admit <span class="sc">+</span> uncons,</span>
<span id="cb945-6"><a href="#cb945-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> ICU, <span class="at">family =</span> binomial)</span>
<span id="cb945-7"><a href="#cb945-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb945-8"><a href="#cb945-8" aria-hidden="true" tabindex="-1"></a><span class="fu">binreg_plot</span>(icu.glm2, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>, <span class="at">conf_level =</span> <span class="fl">0.68</span>,</span>
<span id="cb945-9"><a href="#cb945-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb945-10"><a href="#cb945-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">labels =</span> <span class="cn">TRUE</span>, <span class="at">labels_just =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>,<span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb945-11"><a href="#cb945-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">cex =</span> <span class="dv">0</span>, <span class="at">point_size =</span> <span class="fl">0.8</span>, <span class="at">pch =</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span>,</span>
<span id="cb945-12"><a href="#cb945-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">ylab =</span> <span class="st">&quot;Log odds(died)&quot;</span>,</span>
<span id="cb945-13"><a href="#cb945-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="dv">4</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-454-1.png" width="960" /></p>
<p>위의 그림의 경우, <code>labels = TRUE, legend = FALSE</code>를
이용하여 범례가 박스가 아닌 선에 직접 레이블에 붙여쓰도록 했다.<br />
사망에 대한 로그오즈는 모든 경우에 <strong>Age</strong>가 증가할수록
서서히 커지는 것을 확인할 수 있다.<br />
특히, 환자가 <strong>admit = Emergency</strong>인 경우에 로그오즈가
높으며, <strong>admit = Emergency</strong>이면서 <strong>uncons =
Yes</strong>일 경우 사망에 대한 로그오즈가 가장 높아진다.</p>
<hr />
</div>
</div>
<div id="influence-and-diagnostic-plots" class="section level2">
<h2>7.5 Influence and diagnostic plots</h2>
<p>OLS 회귀분석에서 <strong>영향 측도(레버리지, Cook의 D,
DFBETA등)</strong> 및 관련 그림을 사용하면 개별 사례가 개별 설명 변수의
적합된 회귀 모델에 과도햔 영향을 미치는지 여부를 결정한다.<br />
프레기븐은 로지스틱 모델과 가중 최소 제곱 사이의 관계를 이용하여 이러한
방법에 대한 이론적 기초를 제공한다.</p>
<div id="residuals-and-leverage" class="section level3">
<h3>7.5.1 Residuals and leverage</h3>
<p><strong>잔차(residuals)</strong>는 실제값과 모형으로부터 예측된
값과의 차이를 의미한다.</p>
<p><strong>레버리지(leverage)</strong>는 개별 사례가 결과에 미치는
잠재적 영향을 측정하며, 개별 사례가 예측 변수 공간의 중심으로부터 얼마나
떨어져 있는지에 정비례한다.</p>
<p><strong>쿡의거리(Cook’s Distance)</strong>는 i번째 관측치를
포함했을때와 포함하지 않았을 때의 적합치 사이의 거리를 계산한다.
일반적으로 기준값이 1보다 클 경우 이상치로 간주한다.</p>
<p><strong>DFBETA</strong>는 i번째 관측치가 DFBETA의 기준값인 2 또는
<span class="math inline">\(2/sqrt(n)\)</span>보다 크면 이상치로
간주한다.</p>
</div>
<div id="influence-diagnostics" class="section level3">
<h3>7.5.2 Influence diagnostics</h3>
<p><em>Example 7.13: Donner Party</em></p>
<div class="sourceCode" id="cb946"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="#cb946-1" aria-hidden="true" tabindex="-1"></a>inf1 <span class="ot">&lt;-</span> <span class="fu">influence.measures</span>(donner.mod3)</span>
<span id="cb946-2"><a href="#cb946-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(inf1)</span></code></pre></div>
<pre><code>## [1] &quot;infmat&quot; &quot;is.inf&quot; &quot;call&quot;</code></pre>
<p>적합시킨 모델에 대한 모든 진단 측정의 세부사항은
<code>influence.measures</code>함수를 사용하여 얻을 수 있다.<br />
- <code>influence.measures(model)</code></p>
<ul>
<li>model: 진단하고자 하는 적합된 모델</li>
</ul>
<div class="sourceCode" id="cb948"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="#cb948-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(inf1)</span></code></pre></div>
<pre><code>## Potentially influential observations of
##   glm(formula = survived ~ poly(age, 2) + sex, family = binomial,      data = Donner) :
## 
##                      dfb.1_ dfb.p(,2)1 dfb.p(,2)2 dfb.sxMl dffit   cov.r  
## Breen, Patrick        0.08   0.65       0.56       0.23     0.69_*  0.93  
## Donner, Elizabeth    -0.26  -0.34      -0.22       0.12    -0.40    1.15_*
## Graves, Elizabeth C. -0.24  -0.37      -0.26       0.10    -0.42    1.20_*
##                      cook.d hat    
## Breen, Patrick        0.32   0.09  
## Donner, Elizabeth     0.03   0.14_*
## Graves, Elizabeth C.  0.03   0.16_*</code></pre>
<p><code>influence.measures</code>를 적용한 결과를
<code>summary</code>함수를 통해 쉽게 살펴볼 수 있다.<br />
영향치로 판단되는 경우 <code>*</code>표시가 나타나는 것을 볼 수
있다.<br />
<strong>Breen, Patrick</strong>의 경우, <strong>dffit</strong> 측도가
영향치라고 판단을 하며, <strong>Donner, Elizabetch</strong>,
<strong>Graves, Elizabetch C.</strong>의 경우, <strong>cov.r,
hat</strong>측도가 영향치라고 판단했다.</p>
<div class="sourceCode" id="cb950"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="#cb950-1" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">+</span> .<span class="dv">1</span>, <span class="at">cex.lab =</span> <span class="fl">1.2</span>)</span>
<span id="cb950-2"><a href="#cb950-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">influencePlot</span>(donner.mod3, <span class="at">id.col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">scale =</span> <span class="dv">8</span>, <span class="at">id.n =</span> <span class="dv">2</span>)</span>
<span id="cb950-3"><a href="#cb950-3" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">coef</span>(donner.mod3))</span>
<span id="cb950-4"><a href="#cb950-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Donner)</span>
<span id="cb950-5"><a href="#cb950-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">*</span> k <span class="sc">/</span> n, <span class="at">y =</span> <span class="sc">-</span><span class="fl">1.8</span>, <span class="fu">c</span>(<span class="st">&quot;2k/n&quot;</span>, <span class="st">&quot;3k/n&quot;</span>), <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-457-1.png" width="960" /></p>
<p>위의 그래프의 경우, <code>donner.mod3</code>에 대한 영향 측정 진단 및
진단 그림이며, <strong>쿡의 D</strong>값을 보여주기 위해 플롯 기호의
크기를 추가로 사용하는 <code>car</code>패키지의
<code>influencePlot</code>의 결과이다.<br />
<code>influenceplot</code>은 원의 영역이 쿡의 거리에 비례하는 관측치를
나타내는 <strong>표준화 잔차</strong>대 <strong>hat value</strong>의 원
그림을 그려준다.<br />
- <code>influenceplot(model)</code></p>
<ul>
<li>model; 영향 측정 진단을 하고자 하는 적합된 모델</li>
</ul>
<p>점에 대한 영향 통계량이 포함된 데이터 프레임을 통해 이러한 점이
영향력 있는 것으로 간주되는 것을 알 수 있다.<br />
수평 및 수직 기준선은 주목할 만한 잔차 및 레버리지에 대한 일반적인
컷오프 값을 나타낸다.<br />
<code>id.n</code>인수는 각 표준화된 잔차, hat value, Cook’s에 대해
<code>id.n</code>만큼의 가장 극단적인 관측치를 선택한다.</p>
<p>앞선 결과에서도 볼 수 있듯이, <strong>Donner, Elizabetch</strong>,
<strong>Graves, Elizabetch C.</strong>의 경우,
<strong>Hat-Values</strong>에서 영향치라고 판단하는 것을 다시 한 번 볼
수 있다.</p>
<div class="sourceCode" id="cb951"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="#cb951-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(Donner) <span class="sc">%in%</span> <span class="fu">rownames</span>(res))</span>
<span id="cb951-2"><a href="#cb951-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(Donner[idx,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>],res)</span></code></pre></div>
<pre><code>##                      age    sex survived   StudRes        Hat      CookD
## Breen, Patrick        51   Male      yes  2.501048 0.09148358 0.32353863
## Donner, Elizabeth     45 Female       no -1.113711 0.13540740 0.03409178
## Graves, Elizabeth C.  47 Female       no -1.018516 0.16322227 0.03417604
## Reed, James           46   Male      yes  2.097962 0.08161950 0.14363764</code></pre>
<p>극단적으로 관측된 값들만 출력을 해보았다.<br />
<strong>Breen, Patrick</strong>, <strong>Reed,James</strong>는 생존한
40~50대 남성이었고 둘 다 양의 잔차가 크기 때문에 특이하다는 것을 알 수
있다.<br />
<strong>Donner, Elizabetch</strong>, <strong>Graves, Elizabetch
C.</strong>는 40대인 젊은 여성임에도 불구하고 생존하지 못하였기 때문에
영향치로 판단했다고 추측된다.</p>
<div class="sourceCode" id="cb953"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="#cb953-1" aria-hidden="true" tabindex="-1"></a><span class="fu">influenceIndexPlot</span>(donner.mod3, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;Cook&quot;</span>, <span class="st">&quot;Studentized&quot;</span>, <span class="st">&quot;hat&quot;</span>), <span class="at">id.n=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-459-1.png" width="960" /></p>
<p><code>influenceIndexPlot</code>의 경우 데이터의 관측번호에 대한
다양한 영향 진단을 통해 극단적인 관측치들을 파악할 수 있으며,
<code>car</code>패키지에 포함돼있다.<br />
- <code>influenceIndexPlot(model,vars)</code></p>
<ul>
<li>model: 영향 진단을 하고자하는 적합된 모델</li>
<li>vars: 사용할 영향 측도</li>
</ul>
<p><code>Cook.s</code>에서는 <strong>Breen, Patrick</strong>,
<strong>Reed,James</strong>의 값이 1보다 크기 때문에 영향치로
판단하였고,<br />
<code>표준화잔차</code>에서도 <strong>Breen, Patrick</strong>,
<strong>Reed,James</strong>이 큰 양의 잔차를 갖기 때문에 영향치로
판단하였으며, <code>Hat-value</code>에서는 <strong>Donner,
Elizabetch</strong>, <strong>Graves, Elizabetch C.</strong>이 기준 값을
넘기 때문에 영향치로 판단하였다.</p>
<p><em>Example 7.14: Death in the ICU</em></p>
<div class="sourceCode" id="cb954"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb954-1"><a href="#cb954-1" aria-hidden="true" tabindex="-1"></a>icu.glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(died <span class="sc">~</span> age <span class="sc">+</span> cancer <span class="sc">+</span> admit <span class="sc">+</span> uncons,</span>
<span id="cb954-2"><a href="#cb954-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> ICU, <span class="at">family =</span> binomial)</span></code></pre></div>
<p><code>ICU</code>데이터에서 <strong>died</strong>를 종속변수로하고
<strong>age,cancer,admit,uncons</strong>를 독립변수로 하는 로지스틱
회귀모형을 적합시켰다.</p>
<div class="sourceCode" id="cb955"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="#cb955-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb955-2"><a href="#cb955-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">influencePlot</span>(icu.glm2, <span class="at">id.col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb955-3"><a href="#cb955-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">scale =</span> <span class="dv">8</span>, <span class="at">id.cex =</span> <span class="fl">1.5</span>, <span class="at">id.n =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-461-1.png" width="960" /></p>
<div class="sourceCode" id="cb956"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb956-1"><a href="#cb956-1" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(ICU) <span class="sc">%in%</span> <span class="fu">rownames</span>(res))</span>
<span id="cb956-2"><a href="#cb956-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(ICU[idx, <span class="fu">c</span>(<span class="st">&quot;died&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;cancer&quot;</span>, <span class="st">&quot;admit&quot;</span>, <span class="st">&quot;uncons&quot;</span>)],res)</span></code></pre></div>
<pre><code>##     died age cancer admit uncons   StudRes        Hat      CookD
## 766   No  31 Cancer Emerg      - -1.028188 0.17061852 0.02955116
## 881   No  89      - Emerg Uncons -2.717799 0.03080649 0.16858459
## 127  Yes  19      - Emerg      -  2.564904 0.01679238 0.07418793
## 208  Yes  70      -     - Uncons  1.661771 0.29536641 0.20870044</code></pre>
<div class="sourceCode" id="cb958"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb958-1"><a href="#cb958-1" aria-hidden="true" tabindex="-1"></a><span class="fu">influenceIndexPlot</span>(icu.glm2, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;Cook&quot;</span>, <span class="st">&quot;Studentized&quot;</span>,<span class="st">&quot;hat&quot;</span>),<span class="at">id.n=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-463-1.png" width="960" /></p>
<p><strong>ICU</strong>데이터에 대해 <code>influencePlot</code>,
<code>influenceIndexPlot</code>를 이용하여 극단적인 관측치 판단을 진행해
보았다.<br />
<strong>127, 208, 766, 881</strong>번 인덱스를 가지는 데이터가 극단치로
감지되었다.<br />
특히, 208번 데이터의 경우 <strong>Cancer = no</strong>,
<strong>Age</strong>가 70세인 노인이지만 사망한 결과가 있다. 또한,
선택적 절차를 통해 입원을 했지만 의식이 없었다는 점에서 매우 이상한 것을
확인할 수 있다. 이는 코딩 오류 혹은 다른 이상 징후가 있었을지도 모른다는
신호이다.</p>
<p>또한, 881번 환자의 경우 의식불명이 었었지만 살아난 것을 확인할 수
있고 다른 2명 또한 사망했지만 암이 없고 의식도 있어 예측이 잘 안되는
것을 알 수 있다.<br />
그러나 이러한 결과들은 <strong>Cook’s D</strong>의 값이 기준값보다
상대적으로 작으므로 모델에 큰 영향을 미치지않는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb959"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="#cb959-1" aria-hidden="true" tabindex="-1"></a>inf1 <span class="ot">&lt;-</span> <span class="fu">influence.measures</span>(icu.glm2)</span>
<span id="cb959-2"><a href="#cb959-2" aria-hidden="true" tabindex="-1"></a>dfbetas <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(inf1<span class="sc">$</span>infmat[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb959-3"><a href="#cb959-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dfbetas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;dfb.age&quot;</span>, <span class="st">&quot;dfb.cancer&quot;</span>, <span class="st">&quot;dfb.admit&quot;</span>,</span>
<span id="cb959-4"><a href="#cb959-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;dfb.uncons&quot;</span>)</span>
<span id="cb959-5"><a href="#cb959-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dfbetas)</span></code></pre></div>
<pre><code>##        dfb.age  dfb.cancer    dfb.admit  dfb.uncons
## 8   0.04733967 0.013418002  0.004066771 0.009253540
## 12  0.01898756 0.018411953 -0.004174352 0.018105763
## 14 -0.00105108 0.014882364  0.026277782 0.005555015
## 28  0.03156245 0.018424160 -0.001511499 0.016639891
## 32 -0.16408413 0.003787997 -0.036505068 0.023488029
## 38 -0.02152522 0.016539495 -0.011936576 0.020803347</code></pre>
<p><code>influence.measures</code>함수를 통해 각 변수들에 대한
<strong>DFBETA</strong>통계량을 쉽게 얻을 수 있다.</p>
<div class="sourceCode" id="cb961"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="#cb961-1" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">+</span> .<span class="dv">1</span>)</span>
<span id="cb961-2"><a href="#cb961-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ICU<span class="sc">$</span>died <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb961-3"><a href="#cb961-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dfbetas[,<span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;h&quot;</span>, <span class="at">col =</span> cols,</span>
<span id="cb961-4"><a href="#cb961-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Observation index&quot;</span>,</span>
<span id="cb961-5"><a href="#cb961-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="fu">expression</span>(Delta <span class="sc">*</span> beta[Age]),</span>
<span id="cb961-6"><a href="#cb961-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.3</span>)</span>
<span id="cb961-7"><a href="#cb961-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dfbetas[,<span class="dv">1</span>], <span class="at">col =</span> cols)</span>
<span id="cb961-8"><a href="#cb961-8" aria-hidden="true" tabindex="-1"></a>big <span class="ot">&lt;-</span> <span class="fu">abs</span>(dfbetas[,<span class="dv">1</span>]) <span class="sc">&gt;</span> .<span class="dv">25</span></span>
<span id="cb961-9"><a href="#cb961-9" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(dfbetas)</span>
<span id="cb961-10"><a href="#cb961-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(idx[big], dfbetas[big,<span class="dv">1</span>], <span class="at">label =</span> <span class="fu">rownames</span>(dfbetas)[big],</span>
<span id="cb961-11"><a href="#cb961-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.9</span>, <span class="at">pos =</span> <span class="fu">ifelse</span>(dfbetas[big,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">1</span>),</span>
<span id="cb961-12"><a href="#cb961-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xpd =</span> <span class="cn">TRUE</span>)</span>
<span id="cb961-13"><a href="#cb961-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>, <span class="dv">0</span>, .<span class="dv">25</span>), <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-465-1.png" width="960" /></p>
<div class="sourceCode" id="cb962"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb962-1"><a href="#cb962-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span></code></pre></div>
<p><code>ICU</code>데이터 모형에서 <strong>DFBETA(AGE)</strong>에 대한
인덱스 그림을 나타내었다. 환자의 생존여부에 따라 색깔을 다르게
지정하는데, <strong>died = yes</strong>인 경우 <strong>빨간색</strong>,
<strong>died = no</strong>인 경우 <strong>파란색</strong>으로
표시된다.<br />
<strong>DFBETA</strong>의 절대값이 0.2보다 큰 경우의 관측치의 인덱스가
plot에 표시되는 것을 확인할 수 있다.<br />
127번, 165번, 204번, 222번, 380번을 극단적인 관측치로 판단한 것을 살펴볼
수 있으며, 모두 <strong>died = yes</strong>인 관측치들 이었다.</p>
<div class="sourceCode" id="cb963"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="#cb963-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplotMatrix</span>(dfbetas, <span class="at">smooth =</span> <span class="cn">FALSE</span>, <span class="at">id.n =</span> <span class="dv">2</span>,</span>
<span id="cb963-2"><a href="#cb963-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ellipse =</span> <span class="cn">TRUE</span>, <span class="at">levels =</span> <span class="fl">0.95</span>, <span class="at">robust =</span> <span class="cn">FALSE</span>,</span>
<span id="cb963-3"><a href="#cb963-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">diagonal =</span> <span class="st">&quot;histogram&quot;</span>,</span>
<span id="cb963-4"><a href="#cb963-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">groups =</span> ICU<span class="sc">$</span>died, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-466-1.png" width="960" /></p>
<p><code>scatterplotMatrix</code>함수를 통해 대각선의 일변량 표시와
다양한 적합선, 타원체 등 향상된 삼점도 행렬을 그릴 수 있다.<br />
따라서, 우리는 <code>scatterplotMatrix</code>함수를 통해 변수별 표준화된
<strong>DFBETA</strong>의 scatterplot을 그릴 수 있다. 각 쌍의 그림에서
비정상적인 점을 식별하며, 각 비대각 패널에서 95% 데이터 타원과 선형
회귀선은 두 측정값 사이의 한계 관계를 보여준다.<br />
<code>scatterplotMatrix</code>는 <code>car</code>패키지에
포함돼있다.<br />
- <code>scatterplotMatrix(x)</code></p>
<ul>
<li>x: 산점도 행렬을 생성하고자 하는 데이터</li>
</ul>
<p>산점도 행렬에 표시되는 색은 환자의 생존여부에 따라 구분하였다.
<strong>died = No</strong>인 경우 파란색, <strong>died = Yes</strong>인
경우 빨간색으로 지정하였다.<br />
다른 변수들에 비해 <strong>Age</strong>변수의
<strong>DFBETA</strong>값을 가지고 있는 <strong>dfb.age</strong>의 경우
환자의 생존여부에 따라 분포가 큰 차이가 나는 것을 확인할 수 있다.<br />
이에따라, <strong>dfb.age</strong>와 다른 변수들간의 관계를 살펴보게
되면 <strong>died = Yes</strong>에 관한 타원형의 너비가 상대적으로 큰
것을 확인할 수 있다.</p>
</div>
<div id="other-diagnostic-plots" class="section level3">
<h3>7.5.3 Other diagnostic plots</h3>
<p>이 절에서 설명하는 그래픽 방법은 각각 주어진 방식으로 표현되는 특정
설명변수 집합을 가진 특정 모델의 적합성에 대한 간단한 지표이다.<br />
설명 변수 및 설명 변수의 관계가 선형인지 여부, 여기에는
<strong>Component-plus-residual plot</strong>, <strong>added-variable
plot</strong>, <strong>constructed variable plot</strong>이
포함된다.</p>
<div id="component-plus-residual-plots" class="section level4">
<h4>7.5.3.1 Component-plus-residual plots</h4>
<p><em>Example 7.15: Donner Party</em></p>
<div class="sourceCode" id="cb964"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="#cb964-1" aria-hidden="true" tabindex="-1"></a>donner.mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> age <span class="sc">+</span> sex,</span>
<span id="cb964-2"><a href="#cb964-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span>
<span id="cb964-3"><a href="#cb964-3" aria-hidden="true" tabindex="-1"></a>donner.mod3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> <span class="fu">poly</span>(age,<span class="dv">2</span>) <span class="sc">+</span> sex,</span>
<span id="cb964-4"><a href="#cb964-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Donner, <span class="at">family =</span> binomial)</span></code></pre></div>
<p><code>donner.mod1</code>객체에는 <strong>survived</strong>를
종속변수로 하고 <strong>age,sex</strong>를 설명변수로하는 로지스틱
회귀모형을, <code>donner.mod3</code>객체에는 <strong>survived</strong>를
종속변수로 하고 <strong>age의 2차식,sex</strong>를 설명변수로하는
로지스틱 회귀모형을 적합시켰다.</p>
<div class="sourceCode" id="cb965"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="#cb965-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crPlots</span>(donner.mod1, <span class="sc">~</span>age, <span class="at">id.n=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-468-1.png" width="960" /></p>
<p><code>crPlots</code>의 경우 선형 및 일반화된 선형 모델에 대해
<strong>부분 잔차 그림</strong>이라고도 하며 <strong>성분 +
잔차</strong>그림을 구성한다.<br />
<code>crPlots</code>함수는 <code>car</code>패키지안에 포함돼있다.<br />
- <code>crPlots(model,variable)</code></p>
<ul>
<li>model: 성분+잔차 그림을 살펴보고자 하는 모델</li>
<li>variable: 모델에 적합된 변수들 중 살펴보고자 하는 변수</li>
</ul>
<p>이는 우리가 지정한 변수와 반응 변수간의 비선형 관계를 확인할 수
있다.</p>
<p><strong>파란색 파선</strong>은 전체 모델에 대한 <strong>Age</strong>
기울기를 나타내고 <strong>빨간색 곡선</strong>은 <strong>loess
fit(비선형 곡선)</strong>을 나타낸다.<br />
각 점은 각 관찰값들의 <strong>잔차</strong>를 표시하며 몇 개의 데이터가
극단적인 잔차값을 가지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb966"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="#cb966-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crPlots</span>(donner.mod3, <span class="sc">~</span><span class="fu">poly</span>(age,<span class="dv">2</span>), <span class="at">id.n=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-469-1.png" width="960" /></p>
<p>2차식을 사용할 경우, 앞선 그림과 달리 <strong>잔차</strong>들이 특정
위치에 몰려있는 것을 확인할 수 있다.<br />
또한, 제곱을 하는 2차식을 사용했기 때문에 몇몇의 극단적인 잔차들의 값이
더욱 커진 것을 살펴볼 수 있다.</p>
</div>
<div id="added-variable-plots" class="section level4">
<h4>7.5.3.2 Added-variable plots</h4>
<p><em>Example 7.16: Donner Party</em></p>
<div class="sourceCode" id="cb967"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="#cb967-1" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Donner<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</span>
<span id="cb967-2"><a href="#cb967-2" aria-hidden="true" tabindex="-1"></a>pch <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Donner<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>, <span class="dv">16</span>, <span class="dv">17</span>)</span>
<span id="cb967-3"><a href="#cb967-3" aria-hidden="true" tabindex="-1"></a><span class="fu">avPlots</span>(donner.mod1, <span class="at">id.n =</span> <span class="dv">2</span>,</span>
<span id="cb967-4"><a href="#cb967-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> col, <span class="at">pch =</span> pch, <span class="at">col.lines =</span> <span class="st">&quot;darkgreen&quot;</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-470-1.png" width="960" /></p>
<p><code>avPlots</code>은 로지스틱 회귀 분석 및 기타 선형 또는 일반화된
선형 모델의 문제를 진단하기 위한 또다른 중요한 도구이다. 이들은
기본적으로 조정된 반응 변수와 조정된 설명 변수에 대해 다른 모든 설명
변수 사이의 조건부 관계를 나타내는 그림이다.<br />
R에서는 <code>car</code> 패키지를 통해 <code>avPlots</code>함수를 사용할
수 있다.<br />
- <code>avPlots(model, id.n)</code></p>
<ul>
<li>model: 문제를 진단하기 위한 모델</li>
<li>id.n: 가장 극단적인 관측치 중 출력할 관측치의 갯수</li>
</ul>
<p><code>Donner</code>데이터에 대한 문제를 진단하기 위해
<code>avPlots</code>의 일부 기능을 나타낼 수 있다.</p>
<p>색깔의 경우, <strong>Survived = Yes</strong>이면 파란색,
<strong>Survived = No</strong>이면 빨간색으로 출력하게 설정하였다.<br />
또한, 점의 모양의 경우 <strong>Sex = Male</strong>이면 원, <strong>Sex =
Female</strong>이면 삼각형으로 그려지도록 설정하였다.</p>
<p>왼쪽패널은 <strong>Age</strong>에 대한 <code>avPlots</code>그림을
나타낸다.<br />
초록색 직선은 <strong>Age</strong>변수의 변화에 따른 생존확률의 변화를
나타내며, <strong>Age</strong>가 증가함에 따라 생존확률이 점차
감소한다.<br />
<strong>Donner, Jacob</strong>, <strong>Keyes, Sarah</strong>를 극단적인
관측치로 판단한 것을 살펴볼 수 있다.<br />
<strong>Age</strong>변수가 30세보다 큰 값을 가지게 되면 거의 모든 변수에
대해서 <strong>Survived = No</strong>로 분류하는 것을 확인할 수
있다.</p>
<p>오른쪽패널은 <strong>Sex</strong>에 대한 <code>avPlots</code>그림을
나타낸다.<br />
초록색 직선은 <strong>Sex</strong>변수의 변화에 따른 생존확률의 변화를
나타낸다. <strong>Sex</strong>가 <strong>Male</strong>로 변화함에 따라
생존확률이 점차 감소한다.<br />
<strong>Breen, Margaret I., Pike, Harriet</strong>을 극단적인 관측치로
판단한 것을 살펴볼 수 있다.</p>
<p><em>Example 7.17: Death in the ICU</em></p>
<div class="sourceCode" id="cb968"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="#cb968-1" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="fl">2.5</span>) <span class="sc">+</span> .<span class="dv">1</span>, <span class="at">cex.lab =</span> <span class="fl">1.4</span>)</span>
<span id="cb968-2"><a href="#cb968-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(died <span class="sc">~</span> age, <span class="at">data =</span> ICU, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;pink&quot;</span>))</span>
<span id="cb968-3"><a href="#cb968-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(died <span class="sc">~</span> cancer, <span class="at">data =</span> ICU, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;pink&quot;</span>))</span>
<span id="cb968-4"><a href="#cb968-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(died <span class="sc">~</span> admit, <span class="at">data =</span> ICU, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;pink&quot;</span>))</span>
<span id="cb968-5"><a href="#cb968-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(died <span class="sc">~</span> uncons, <span class="at">data =</span> ICU, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;pink&quot;</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-471-1.png" width="960" /></p>
<p><strong>반응변수(died)</strong>에 대한 각 독립변수의
<code>Marginal plot</code>을 그려보았다.<br />
색깔이 분홍색인 경우, <strong>died = No</strong>인 비율을 나타내고
색깔이 하늘색인 경우, <strong>died = Yes</strong>인 비율을
나타낸다.<br />
<strong>age</strong>가 높아질수록, <strong>died = Yes</strong>인 비율이
높았고 응급하게 병원에 입원한 경우에는 입원절차를 밟고 입원한 환자보다
<strong>died = Yes</strong>인 비율이 높았으며, 환자가 의식불명인 경우,
그렇지 않은 사람보다 <strong>died = Yes</strong>비율이 높은 것을 확인할
수 있다.</p>
<div class="sourceCode" id="cb969"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="#cb969-1" aria-hidden="true" tabindex="-1"></a>pch <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(ICU<span class="sc">$</span>died <span class="sc">==</span><span class="st">&quot;No&quot;</span>, <span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb969-2"><a href="#cb969-2" aria-hidden="true" tabindex="-1"></a><span class="fu">avPlots</span>(icu.glm2, <span class="at">id.n =</span> <span class="dv">2</span>, <span class="at">pch =</span> pch, <span class="at">cex.lab =</span> <span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-472-1.png" width="960" /></p>
<p><strong>died =No</strong>인 경우, 점의 형태를 원으로하고 <strong>died
= Yes</strong>인 경우 점의 형태를 삼각형으로 지정해주었다.<br />
적합시킨 로지스틱 회귀모형을 <code>avPlots</code>함수를 이용하여
추가변수 플랏을 그려보았다.</p>
<p>각 패널의 라벨링된 점은 다른 설명변수 1개가 주어졌을 때, 잔차가
극단적인 값을 갖는 데이터를 말한다.<br />
앞서, 극단적인 값으로 확인된 <strong>127,881</strong>번 데이터의 경우,
모든 패널에서 극단적인 값으로 인식되는 것을 확인할 수 있다.<br />
특히, 127번은 매우 극단적인 양의 잔차를 가지며 881번의 경우 매우
극단적인 음의 잔차를 가지는 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb970"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="#cb970-1" aria-hidden="true" tabindex="-1"></a>icu.glm2a <span class="ot">&lt;-</span> <span class="fu">glm</span>(died <span class="sc">~</span> age <span class="sc">+</span> cancer <span class="sc">+</span> admit <span class="sc">+</span> uncons <span class="sc">+</span> systolic,</span>
<span id="cb970-2"><a href="#cb970-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> ICU, <span class="at">family =</span> binomial)</span>
<span id="cb970-3"><a href="#cb970-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(icu.glm2, icu.glm2a, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: died ~ age + cancer + admit + uncons
## Model 2: died ~ age + cancer + admit + uncons + systolic
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
## 1       195     139.13                       
## 2       194     135.61  1   3.5231  0.06052 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>glm2</code> 모델과 <strong>systolic</strong>를 추가한
<code>glm2a</code>모델이 유의한 차이가 있는지 <code>anova</code>검정을
실시해 보았다.<br />
두 모형의 잔차차이는 3.5231이고 유의확률은 유의수준 0.05보다 높으므로
귀무가설을 기각하지 못한다. 따라서, 유의한 잔차의 차이가 발생하지 않는
것을 확인할 수 있다.<br />
하지만, 유의확률이 0.06으로 유의수준인 0.05와 크게 차이가 없는 것으로
보아 약간의 유의한 잔차의 차이는 존재하는 것으로 생각된다.</p>
<div class="sourceCode" id="cb972"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="#cb972-1" aria-hidden="true" tabindex="-1"></a><span class="fu">avPlot</span>(icu.glm2a, <span class="st">&quot;systolic&quot;</span>, <span class="at">id.n =</span> <span class="dv">3</span>, <span class="at">pch =</span> pch)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-474-1.png" width="960" /></p>
<p>적합시킨 <code>glm2a</code>모델의 <strong>systolic</strong>데이터를
이용하여<code>avPlot</code>을 그려보았다.<br />
이 그림에서 <strong>331번</strong>은 부분 레버리지가 높지만 영향력이
없다.<br />
그러나 <strong>84번,80번</strong>의 경우 레버리지가 높고 잔차가 크기
때문에 모델에 영향을 미칠 수 있다.<br />
또한, <strong>systolic</strong>가 커질수록 <strong>died = Yes</strong>일
확률이 점점 작아지는 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
</div>
<div id="a.-appendix" class="section level2">
<h2>7.A. Appendix</h2>
<p>R을 통해 시각화를 진행하여 Markdown으로 생성하는 경우,
경고메시지(Warning)가 많이 뜨는 경우가 종종 있다.<br />
이 때, 경고메시지를 Markdown에 표시되지 않게 만들어 정리 된 Markdown을
만들고 싶다면 Chunk를 생성할 때, <code>{r}</code>이 아닌
<code>{r warning = FALSE}</code>로 만들어주면 된다.<br />
<code>{r warning = FALSE}</code>를 지정해주게 되면 Markdown에서
경고메시지가 사라지는 것을 확인할 수 있다.</p>
<hr />
</div>
<div id="summary-of-chapter7" class="section level2">
<h2>Summary of Chapter7</h2>
<ul>
<li><strong>로지스틱 회귀분석</strong>은 반응변수가 연속형이 아닌
<strong>이산형 변수</strong>일 때, 사용된다. 일반적인 선형회귀분석은
설명변수를 통해 종속변수를 예측하는 것이 목적이지만, 로지스틱 회귀분석은
<strong>이산형 반응변수에 대해</strong> 0 또는 1로 분류될 확률을
예측하는 것이 목적이다.<br />
</li>
<li>일반적으로 로지스틱 회귀분석의 분류 <strong>threshold</strong>는
0.5의 값을 사용한다. 즉, 추정된 확률값이 0.5보다 크면 반응변수를 1로
분류하고 추정된 확률값이 0.5보다 작으면 0으로 분류한다. 이러한
<strong>threshold</strong>는 분석가가 데이터의 분포에 따라 정할 수
있다.<br />
</li>
<li>R에서는 <strong>로지스틱 회귀모형</strong>을 적합시킬때에
<code>glm</code>함수를 가장 일반적으로 사용한다.
<code>type = response(link = logit)</code>옵션을 통해 이산형 반응변수를
가지며, <strong>link function</strong>은 <strong>logit</strong>함수를
사용하는 로지스틱 회귀모형을 적합시킬 수 있다.<br />
</li>
<li><code>coeftest</code>는 주어진 모델의 변수에 대해
<strong>Wald</strong>검정을 수행하여 각 설명변수의 유의성을 판단할 수
있도록 도와준다.<br />
</li>
<li><strong>로지스틱 회귀모형</strong>의 적합도를 구하는 방법 중 하나는
LR방법을 통해 잔차의 차이를 계산하는 것이다. 간단한 모형과 원하는 변수를
추가시킨 모형의 잔차를 비교하여, 유의한 잔차의 차이를 보이는 경우,
원하는 변수를 추가시킨 모형은 유의하다고 할 수 있다.<br />
</li>
<li><code>Effects</code>함수와 <code>Allefects</code>함수를 사용하게
되면 변수의 수준 변화에 따른 반응변수의 확률값 변화를 시각화를 통해
나타낼 수 있다.<br />
</li>
<li><code>rms</code>패키지의 <code>lrm</code>함수는 최대우도 추정법 혹은
페널티가 부여된 최대우도 추정법을 사용하여 <strong>비례 승산 순서형
로지스틱 회귀모형</strong>에 적합시킨다. <code>lrm</code>을 통해
적합시킨 로지스틱 회귀모형에 <code>plot</code>함수를 사용하게 되면,
변수들의 오즈비 추정값, 추정된 오즈비의 95% 신뢰구간 등의 정보를 시각할
수 있다.<br />
</li>
<li>회귀모형을 적합한 후, 잔차진단을 통해 모형에 영향을 미치는 극단적인
관찰값이 없는지 확인하는 것이 중요하다. 이러한 측도로는
<strong>쿡의거리, Hat-value, 잔차</strong>등이 있으며, R에서는
추가변수를 통해 극단값을 확인하는 <code>avPlot</code>또는 성분과 잔차를
한 그림안에 나타내주는 <code>crPlots</code>함수를 사용하여 잔차진단을 할
수 있다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap8-models-for-polytomous-responses" class="section level1">
<h1>Chap8 Models for Polytomous Responses</h1>
<p>Chapter7에서 우리는 binary response에 대해서 알아보았다.<br />
Chapter8에서는 <strong>binary</strong>가 아닌 <strong>다중 범주를
갖고있는 반응 변수</strong>를 처리하기위한 방법들에 대해서 알아본다.</p>
<p>또한, 범주형 변수의 경우 명목형 변수인지 순서형 변수인지로 나누게
되는데, 변수가 명목형 변수일때와 순서형 변수일 때 서로 다른 모형을
사용할 수 있게 되므로 어떠한 모형을 적용할 수 있는지에 대해서도
알아본다.</p>
<p>일반적으로 다중 반응 변수는 범주형 변수의 수준이 3개 이상인 경우를
말한다.<br />
EX)</p>
<ul>
<li>환자의 약 복용효과: “Marked”, “Some”, “None”</li>
<li>학생들의 교육수준: “Middle school”, “High school”, “University”</li>
<li>대한민국 성인의 소득수준: “low”, “Middle”, “High”</li>
</ul>
<p>다중 반응 확률을 모형화하는 방법 중 하나는 예측변수가 주어졌을 때,
<strong>그룹에 대한 반응 확률</strong>을 구한 후, 반응에 대한 모형을
설명 변수에서 요인을 처리하는 방법과 유사한 방식으로 구성하는
것이다.</p>
<hr />
<div id="ordinal-response-proportional-odds-model"
class="section level2">
<h2>8.1 Ordinal response: Proportional odds model</h2>
<p>가장 간단한 방법은 <strong>Proportional odds model</strong>이다. 이
모델은 반응변수가 순서형 변수이고 <strong>proportional odds
assumptions</strong>이 성립할 때 사용이 가능하다.<br />
<strong>proportional odds assumptions</strong>은 모형에 포함된 각 항에
대해 반응변수들의 수준에서 결과의 각 쌍 사이의 <strong>기울기</strong>
추정치는 우리가 고려한 분할에 관계없이 동일하다고 가정하는 것이다.<br />
즉, <strong>Proportional odds model</strong>의 설명 변수(x)는 모든
누적logit에 대해 <strong>동일한 기울기</strong>를 갖도록 제한된다.</p>
<p>반응변수 Y의 수준이 순서형인 경우, 연속적인 범주 사이의 인접 범주
컷포인트에 기초한 로짓을 통해 순서적 특성을 고려할 수 있다.</p>
<div id="latent-variable-interpretation" class="section level3">
<h3>8.1.1 Latent variable Interpretation</h3>
<p>이항 반응 변수의 경우, 로지스틱 회귀에 대해서 관측된 Y의 관계를
실패가 아닌 성공의 성향을 나타내면, (잠재적) 관측되지 않은 연속 반응
변수에서 발생한다고 간주한다.<br />
<strong>잠재 반응</strong>은 예측 변수 x와 선형적으로 관련이 있다고
가정하지만, 그 잠재반응이 특정 임계값을 지날 때 볼 수 있으며, 일부
편리한 스케일링을 통해 모델에 따른 순서형 반응으로 직접 확장될 수
있다.</p>
</div>
<div id="fitting-the-proportional-odds-model" class="section level3">
<h3>8.1.2 Fitting the proportional odds model</h3>
<p>R에서는 <code>MASS</code>패키지의 <code>polr</code>함수를 통해
<strong>proportional odds model</strong>을 만들 수 있다.<br />
<code>polr</code>함수는 <strong>로지스틱</strong> 또는
<strong>프로빗(정규분포의 누적확률의 역확률) 회귀모형</strong>을 순서가
지정된 요인 반응변수에 대해 적합시키는 함수이다.<br />
반응 변수에 숫자값이 없는 경우, 반응 변수가 순서형인지 명목형인지
확인하는 것이 중요하다.<br />
- <code>polr(,data)</code></p>
<ul>
<li>formula: 분석가가 만들고자 하는 모델의 형태</li>
<li>data: 모델 구성에 사용할 데이터</li>
</ul>
<div class="sourceCode" id="cb973"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="#cb973-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>, <span class="at">package =</span> <span class="st">&quot;vcd&quot;</span>)</span>
<span id="cb973-2"><a href="#cb973-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Arthritis<span class="sc">$</span>Improved, <span class="dv">8</span>)</span></code></pre></div>
<pre><code>## [1] Some   None   None   Marked Marked Marked None   Marked
## Levels: None &lt; Some &lt; Marked</code></pre>
<p><code>Arthritis</code> 데이터셋의 반응변수 <code>Improved</code>는
수준이 None - Some - Marked의 순서로 이루어진 순서형 변수이다.</p>
<div class="sourceCode" id="cb975"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="#cb975-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb975-2"><a href="#cb975-2" aria-hidden="true" tabindex="-1"></a>arth.polr <span class="ot">&lt;-</span> <span class="fu">polr</span>(Improved <span class="sc">~</span> Sex <span class="sc">+</span> Treatment <span class="sc">+</span> Age,</span>
<span id="cb975-3"><a href="#cb975-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> Arthritis, <span class="at">Hess =</span> <span class="cn">TRUE</span>)</span>
<span id="cb975-4"><a href="#cb975-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arth.polr)</span></code></pre></div>
<pre><code>## Call:
## polr(formula = Improved ~ Sex + Treatment + Age, data = Arthritis, 
##     Hess = TRUE)
## 
## Coefficients:
##                     Value Std. Error t value
## SexMale          -1.25168    0.54636  -2.291
## TreatmentTreated  1.74529    0.47589   3.667
## Age               0.03816    0.01842   2.072
## 
## Intercepts:
##             Value   Std. Error t value
## None|Some    2.5319  1.0571     2.3952
## Some|Marked  3.4309  1.0912     3.1443
## 
## Residual Deviance: 145.4579 
## AIC: 155.4579</code></pre>
<p>순서형 반응변수에 대해 설명변수 <strong>Sex, Treatment,
Age</strong>를 이용하여 <code>polr</code>함수를 통해
<strong>proportional odds model</strong>을 적용한 결과이다.<br />
독립변수들의 계수, 표준오차, t value등을 제공하며, 반응변수간 순서에
따른 Intercepts도 확인이 가능하다.</p>
<div class="sourceCode" id="cb977"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="#cb977-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb977-2"><a href="#cb977-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(arth.polr)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: Improved
##           LR Chisq Df Pr(&gt;Chisq)    
## Sex         5.6880  1  0.0170812 *  
## Treatment  14.7095  1  0.0001254 ***
## Age         4.5715  1  0.0325081 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>단, <code>polr</code> 함수의의 결과는 유의확률을 유의성 검정을
제공하지 않으므로, <code>car</code>패키지의 <code>Anova</code>함수를
통해 설명변수들의 유의성 검정을 진행한다.<br />
설명변수 <strong>Sex, Treatment, Age</strong>의 유의확률이 유의수준
0.05보다 작으므로 모두 유의한 설명변수인 것을 확인할 수 있다.</p>
</div>
<div id="testing-the-proportional-odds-assumption"
class="section level3">
<h3>8.1.3 Testing the proportional odds assumption</h3>
<p><strong>proportional odds model</strong>은 지정된 데이터 집합에 대해
유지되는 경우에만 달성된다.<br />
본질적으로 이 가정애 대한 검정에는 <strong>proportional odds
model</strong>과 반응 범주 전체에 걸쳐 설명변수의 서로 다른 효과를
허용하는 일반화된 로짓 <strong>NPO</strong> 모델 간의 대조가 수반된다.
가장 일반적인 검정은 두 모형을 모두 적합시키고 우도비 검정을 통해 모형을
비교하는 것이다.</p>
<p><strong>partial proportional odds model</strong>은 예측 변수의 한
부분 집합이 <strong>proportional odds assumptions</strong>을 만족하도록
허용하고 나머지 설명변수 X의 <strong>NPO</strong>는 반응 변수수준에 따라
기울기가 달라진다.</p>
<p>R에서 PO와 NPO모델은 <code>VGAM</code>패키지의
<code>vglm</code>함수를 사용하여 둘 다 적합시킴으로써 쉽게 대조할 수
있다.<br />
<code>VGAM</code>패키지는 <code>glm</code>방법중에서도 다변량의 데이터를
고려하여 통계적 회귀 모델을 도출해야하는 경우, 유용하게 사용할 수 있는
패키지이다.<br />
<code>vglm</code>함수는 벡터 일반화 선형 모형을 적합시키는 모델로
일반적으로 클래스가 매우 많은 모델에 대하여 특별한 <code>glm</code>을
적합시키고자 할때 사용한다.<br />
- <code>vglm(,data)</code></p>
<ul>
<li>: 분석가가 만들고자 하는 모델의 형태</li>
<li>data: 모델 구성에 사용할 데이터</li>
</ul>
<div class="sourceCode" id="cb979"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="#cb979-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VGAM)</span></code></pre></div>
<pre><code>## 필요한 패키지를 로딩중입니다: stats4</code></pre>
<pre><code>## 
## 다음의 패키지를 부착합니다: &#39;VGAM&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:rms&#39;:
## 
##     calibrate, lrtest</code></pre>
<pre><code>## The following object is masked from &#39;package:car&#39;:
## 
##     logit</code></pre>
<pre><code>## The following object is masked from &#39;package:lmtest&#39;:
## 
##     lrtest</code></pre>
<div class="sourceCode" id="cb985"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="#cb985-1" aria-hidden="true" tabindex="-1"></a>arth.po <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Improved <span class="sc">~</span> Sex <span class="sc">+</span> Treatment <span class="sc">+</span> Age, <span class="at">data =</span> Arthritis, <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> <span class="cn">TRUE</span>))</span>
<span id="cb985-2"><a href="#cb985-2" aria-hidden="true" tabindex="-1"></a>arth.po</span></code></pre></div>
<pre><code>## 
## Call:
## vglm(formula = Improved ~ Sex + Treatment + Age, family = cumulative(parallel = TRUE), 
##     data = Arthritis)
## 
## 
## Coefficients:
##    (Intercept):1    (Intercept):2          SexMale TreatmentTreated 
##       2.53199006       3.43098785       1.25167130      -1.74530408 
##              Age 
##      -0.03816279 
## 
## Degrees of Freedom: 168 Total; 163 Residual
## Residual deviance: 145.4579 
## Log-likelihood: -72.72896</code></pre>
<p><strong>po모델</strong>의 경우, <code>parallel = TRUE</code>로
지정한다.<br />
<strong>po모델</strong>은 반응변수의 모든 누적 로짓 확률에 대해서 동일한
기울기를 같게하므로, 절편을 제외하고 모두 동일한 기울기가 출력되는 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb987"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="#cb987-1" aria-hidden="true" tabindex="-1"></a>arth.npo <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Improved <span class="sc">~</span> Sex <span class="sc">+</span> Treatment <span class="sc">+</span> Age, <span class="at">data =</span> Arthritis, <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span> <span class="cn">FALSE</span>))</span>
<span id="cb987-2"><a href="#cb987-2" aria-hidden="true" tabindex="-1"></a>arth.npo</span></code></pre></div>
<pre><code>## 
## Call:
## vglm(formula = Improved ~ Sex + Treatment + Age, family = cumulative(parallel = FALSE), 
##     data = Arthritis)
## 
## 
## Coefficients:
##      (Intercept):1      (Intercept):2          SexMale:1          SexMale:2 
##         2.61853875         3.43117450         1.50982704         0.86643395 
## TreatmentTreated:1 TreatmentTreated:2              Age:1              Age:2 
##        -1.83692928        -1.70401146        -0.04086648        -0.03729421 
## 
## Degrees of Freedom: 168 Total; 160 Residual
## Residual deviance: 143.5741 
## Log-likelihood: -71.78703</code></pre>
<p><strong>npo모델</strong>의 경우, <code>parallel = FALSE</code>을
옵션을 추가하여 적합시킬 수 있다.<br />
<strong>npo모델</strong>은 반응변수에 대해 설명변수들의 다른 효과를
허용하게 되므로, <strong>po</strong>모델과 달리 절편을 포함하여 다른
모든 설명변수들이 반응변수의 수준에 따라 다른 기울기를 갖고있는 것을 알
수 있다.</p>
<div class="sourceCode" id="cb989"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="#cb989-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(arth.po, <span class="at">matrix =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##                  logitlink(P[Y&lt;=1]) logitlink(P[Y&lt;=2])
## (Intercept)              2.53199006         3.43098785
## SexMale                  1.25167130         1.25167130
## TreatmentTreated        -1.74530408        -1.74530408
## Age                     -0.03816279        -0.03816279</code></pre>
<div class="sourceCode" id="cb991"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="#cb991-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(arth.npo, <span class="at">matrix =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##                  logitlink(P[Y&lt;=1]) logitlink(P[Y&lt;=2])
## (Intercept)              2.61853875         3.43117450
## SexMale                  1.50982704         0.86643395
## TreatmentTreated        -1.83692928        -1.70401146
## Age                     -0.04086648        -0.03729421</code></pre>
<p><code>coef</code>를 통해 각 누적 로짓 확률에 대한 대한 변수들의
계수를 살펴볼 수 있다.<br />
<strong>po</strong>모델의 경우, 누적 로짓 확률이 변해도 동일한 기울기를
갖지만, <strong>npo</strong>모델의 경우, 누적 로짓 확률이 변하면
기울기가 달라지는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb993"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="#cb993-1" aria-hidden="true" tabindex="-1"></a>VGAM<span class="sc">::</span><span class="fu">lrtest</span>(arth.npo, arth.po)</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: Improved ~ Sex + Treatment + Age
## Model 2: Improved ~ Sex + Treatment + Age
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)
## 1 160 -71.787                     
## 2 163 -72.729  3 1.8838     0.5969</code></pre>
<p>모형에 대한 우도비 검정 결과, 유의확률은 유의수준 0.05보다 크므로
귀무가설을 기각하지 못한다.<br />
따라서, <strong>두 모형(po모델, np모델)</strong>간 차이가 없는 것을 알
수 있다.</p>
<div class="sourceCode" id="cb995"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="#cb995-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb995-2"><a href="#cb995-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deviance =</span> <span class="fu">c</span>(<span class="fu">deviance</span>(arth.npo), <span class="fu">deviance</span>(arth.po)),</span>
<span id="cb995-3"><a href="#cb995-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">c</span>(<span class="fu">df.residual</span>(arth.npo), <span class="fu">df.residual</span>(arth.po))</span>
<span id="cb995-4"><a href="#cb995-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb995-5"><a href="#cb995-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tab, <span class="fu">diff</span>(tab))</span>
<span id="cb995-6"><a href="#cb995-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GenLogit&quot;</span>, <span class="st">&quot;PropOdds&quot;</span>, <span class="st">&quot;LR test&quot;</span>)</span>
<span id="cb995-7"><a href="#cb995-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tab, <span class="at">pvalue =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(tab[,<span class="dv">1</span>], tab[,<span class="dv">2</span>]))</span>
<span id="cb995-8"><a href="#cb995-8" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>##            Deviance  df    pvalue
## GenLogit 143.574067 160 0.8196626
## PropOdds 145.457915 163 0.8343527
## LR test    1.883849   3 0.5968607</code></pre>
<p>두 모델의 <strong>Deviance</strong> 비교를 통해서도 모델의 적합도를
확인할 수 있다.<br />
모델의 잔차 차이는 1.88로 크지않고 유의확률 또한 유의수준 0.05보다
크므로 귀무가설을 기각하지 못한다.<br />
따라서, 두 모델간 유의한 잔차의 차이는 존재하지 않는 것을 알 수
있다.</p>
<div class="sourceCode" id="cb997"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="#cb997-1" aria-hidden="true" tabindex="-1"></a>arth.ppo <span class="ot">&lt;-</span> <span class="fu">vglm</span>(Improved <span class="sc">~</span> Sex <span class="sc">+</span> Treatment <span class="sc">+</span> Age,</span>
<span id="cb997-2"><a href="#cb997-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> Arthritis, <span class="at">family =</span> <span class="fu">cumulative</span>(<span class="at">parallel =</span>  <span class="cn">FALSE</span> <span class="sc">~</span> Sex))</span>
<span id="cb997-3"><a href="#cb997-3" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(arth.ppo, <span class="at">matrix =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##                  logitlink(P[Y&lt;=1]) logitlink(P[Y&lt;=2])
## (Intercept)              2.54245216         3.61556073
## SexMale                  1.48333554         0.86736192
## TreatmentTreated        -1.77574178        -1.77574178
## Age                     -0.03962233        -0.03962233</code></pre>
<p><code>vglm</code>은 또한 partial <strong>proportional odds
model</strong>을 만들 수 있다.<br />
<code>Arthritis</code> 데이터에서 <strong>Sex</strong>변수를 제외한
나머지 변수는 병렬을 가정하고, <strong>Sex</strong>변수는 병렬을
가정하지 않았다.<br />
그 결과, <strong>Sex</strong>변수는 로짓의 누적 확률에 따라 기울기가
다르지만 <strong>Treatment, Age</strong>변수는 로짓의 누적 확률에 따라
기울기가 동일한 것을 확인할 수 있다.</p>
</div>
<div id="graphical-assessment-of-proportional-oods"
class="section level3">
<h3>8.1.4 Graphical assessment of proportional oods</h3>
<p><strong>proportional odds assumption</strong>를 시각적으로 평가하기
위한 다양한 그래픽 방법이 있다.<br />
한 가지 아이디어는 반응 변수 Y의 수준에서 주어진 예측 변수 X의 기대값을
표시하는 것이다.</p>
<div class="sourceCode" id="cb999"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="#cb999-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb999-2"><a href="#cb999-2" aria-hidden="true" tabindex="-1"></a>arth.po2 <span class="ot">&lt;-</span> <span class="fu">lrm</span>(Improved <span class="sc">~</span> Sex <span class="sc">+</span> Treatment <span class="sc">+</span> Age, <span class="at">data =</span> Arthritis)</span>
<span id="cb999-3"><a href="#cb999-3" aria-hidden="true" tabindex="-1"></a>arth.po2</span></code></pre></div>
<pre><code>## Logistic Regression Model
##  
##  lrm(formula = Improved ~ Sex + Treatment + Age, data = Arthritis)
##  
##                         Model Likelihood    Discrimination    Rank Discrim.    
##                               Ratio Test           Indexes          Indexes    
##  Obs            84    LR chi2      24.46    R2       0.291    C       0.750    
##   None          42    d.f.             3    R2(3,84) 0.225    Dxy     0.500    
##   Some          14    Pr(&gt; chi2) &lt;0.0001    R2(3,70) 0.264    gamma   0.503    
##   Marked        28                          Brier    0.187    tau-a   0.309    
##  max |deriv| 1e-07                                                             
##  
##                    Coef    S.E.   Wald Z Pr(&gt;|Z|)
##  y&gt;=Some           -2.5320 1.0570 -2.40  0.0166  
##  y&gt;=Marked         -3.4310 1.0911 -3.14  0.0017  
##  Sex=Male          -1.2517 0.5464 -2.29  0.0220  
##  Treatment=Treated  1.7453 0.4759  3.67  0.0002  
##  Age                0.0382 0.0184  2.07  0.0382  
## </code></pre>
<p>Chapter7에서 살펴본 <code>lrm</code>함수를 통해 모형을 적합시키고,
모형에 대한 다양한 시각화를 진행할 수 있다.</p>
<div class="sourceCode" id="cb1001"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="#cb1001-1" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1001-2"><a href="#cb1001-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.xmean.ordinaly</span>(Improved <span class="sc">~</span> Sex <span class="sc">+</span> Treatment <span class="sc">+</span> Age,</span>
<span id="cb1001-3"><a href="#cb1001-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> Arthritis,</span>
<span id="cb1001-4"><a href="#cb1001-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">subn =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-486-1.png" width="960" /></p>
<p><code>rms</code> 패키지의 <code>plot.xmean.ordinaly</code>을 통해
반응 변수 수준에 따른 X의 기대값을 확인할 수 있다.<br />
<code>plot.xmean,ordinaly(,data)</code></p>
<ul>
<li>: 시각화를 진행할 식 (일반적으로 반응변수 ~ 독립변수 +
독립변수..)</li>
<li>data:: 식에 사용되는 데이터</li>
</ul>
<p><strong>실선</strong>은 X가 주어졌을 때 Y의 계층화된 평균을 연결하고
<strong>점선</strong>은 X에 대해 <strong>비례 승산 모델</strong>이
유지되는 경우의 Y의 기대값을 나타낸다.<br />
<strong>비례 승산 모델</strong>의 기울기는 일반적으로 완만한 것을 볼 수
있다.</p>
<p><strong>Treatment = Treated</strong>일 때, <strong>Improved =
None</strong>일 확률이 높고 <strong>Improved = Marked</strong>인 확률이
낮은 것을 볼 수 있다.<br />
<strong>Age</strong>의 경우, <strong>Age</strong>가 증가함에 따라
<strong>Marked</strong>의 확률이 높아진다.</p>
</div>
<div id="visualizing-result-for-the-proportioanl-odds-model"
class="section level3">
<h3>8.1.5 Visualizing result for the proportioanl odds model</h3>
<p>앞에서 살펴본 비슷한 아이디어를 통해 <strong>PO</strong>모델의 결과
또한 시각적으로 표현할 수 있다.<br />
여기서, Chapter7에서 배운 <code>effect plots</code>는 여전히 유용하게
사용할 수 있는 함수이다.</p>
<div id="full-model-plots-1" class="section level4">
<h4>8.1.5.1 Full-model plots</h4>
<div class="sourceCode" id="cb1002"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="#cb1002-1" aria-hidden="true" tabindex="-1"></a>arth.fitp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Arthritis,</span>
<span id="cb1002-2"><a href="#cb1002-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">predict</span>(arth.polr, <span class="at">type =</span> <span class="st">&quot;probs&quot;</span>))</span>
<span id="cb1002-3"><a href="#cb1002-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(arth.fitp)</span></code></pre></div>
<pre><code>##   ID Treatment  Sex Age Improved      None      Some    Marked
## 1 57   Treated Male  27     Some 0.7326185 0.1380586 0.1293229
## 2 46   Treated Male  29     None 0.7174048 0.1444325 0.1381627
## 3 77   Treated Male  30     None 0.7096042 0.1476259 0.1427699
## 4 17   Treated Male  32   Marked 0.6936286 0.1540035 0.1523679
## 5 36   Treated Male  46   Marked 0.5702499 0.1950359 0.2347142
## 6 23   Treated Male  58   Marked 0.4563432 0.2171302 0.3265266</code></pre>
<p>적합시킨 모델 <code>arth.polr</code>을 이용하여 각 데이터가 주어졌을
때, 순서형 반응변수에 대한 예측 확률값을 <code>predict</code>함수를
이용하여 구하였다.</p>
<div class="sourceCode" id="cb1004"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="#cb1004-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1004-2"><a href="#cb1004-2" aria-hidden="true" tabindex="-1"></a>plotdat <span class="ot">&lt;-</span> <span class="fu">melt</span>(arth.fitp,</span>
<span id="cb1004-3"><a href="#cb1004-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;Sex&quot;</span>,<span class="st">&quot;Treatment&quot;</span>,<span class="st">&quot;Age&quot;</span>,<span class="st">&quot;Improved&quot;</span>),</span>
<span id="cb1004-4"><a href="#cb1004-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span>,<span class="st">&quot;Some&quot;</span>,<span class="st">&quot;Marked&quot;</span>),</span>
<span id="cb1004-5"><a href="#cb1004-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">variable.name =</span> <span class="st">&quot;Level&quot;</span>,</span>
<span id="cb1004-6"><a href="#cb1004-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">value.name =</span> <span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb1004-7"><a href="#cb1004-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plotdat,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##    Sex Treatment Age Improved Level Probability
## 1 Male   Treated  27     Some  None   0.7326185
## 2 Male   Treated  29     None  None   0.7174048
## 3 Male   Treated  30     None  None   0.7096042
## 4 Male   Treated  32   Marked  None   0.6936286
## 5 Male   Treated  46   Marked  None   0.5702499</code></pre>
<p><code>melt</code>함수를 이용하여 시각화를 진행하기 유용한 데이터의
형태로 바꿔주었다.</p>
<div class="sourceCode" id="cb1006"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1006-2"><a href="#cb1006-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb1006-3"><a href="#cb1006-3" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plotdat, <span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> Probability, <span class="at">colour =</span> Level)) <span class="sc">+</span></span>
<span id="cb1006-4"><a href="#cb1006-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">10</span>,<span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb1006-5"><a href="#cb1006-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1006-6"><a href="#cb1006-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Sex <span class="sc">~</span> Treatment,</span>
<span id="cb1006-7"><a href="#cb1006-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1006-8"><a href="#cb1006-8" aria-hidden="true" tabindex="-1"></a><span class="fu">direct.label</span>(gg)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-489-1.png" width="960" /></p>
<p><strong>여성</strong>과 <strong>남성</strong>의 경우,
<strong>Treated</strong> 그룹에서 나이가 증가함에 따라 <strong>Improved
= Marked</strong>일 확률이 높아지는 것을 확인할 수 있고 <strong>Improved
= None</strong>일 확률이 감소하는 것을 알 수 있다.<br />
<strong>Placebo</strong>그룹에서도 나이가 증가함에따라 <strong>Improved
= None</strong>일 확률이 줄어들고 <strong>Improved =
Some,Marked</strong>일 확률이 증가하는것을 확인할 수 있다.<br />
하지만, <strong>Treated</strong>그룹에 비해 <strong>Improved =
None</strong>일 확률이 매우 높고 <strong>Improved = Marked</strong>일
확률이 매우 낮은 것을 확인할 수 있다.</p>
</div>
<div id="effect-plots-1" class="section level4">
<h4>8.1.5.2 Effect plots</h4>
<p><code>effects</code>패키지를 통해 그려지는 곡선은 예측 확률에 대한
지정된 효과의 서로 다른 반응 수준에 대해 표시해준다.</p>
<div class="sourceCode" id="cb1007"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="#cb1007-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb1007-2"><a href="#cb1007-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="st">&quot;Age&quot;</span>,arth.polr))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-490-1.png" width="960" /></p>
<div class="sourceCode" id="cb1008"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="#cb1008-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="st">&quot;Age&quot;</span>,arth.polr),<span class="at">style =</span> <span class="st">&quot;stacked&quot;</span>,</span>
<span id="cb1008-2"><a href="#cb1008-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">key.args =</span> <span class="fu">list</span>(<span class="at">x =</span> .<span class="dv">55</span>, <span class="at">y =</span> .<span class="dv">9</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-490-2.png" width="960" /></p>
<p>기본적인 <strong>Age effect plot</strong>과 <strong>Stacked
plot</strong>을 통해 나이가 증가함에 따라, <strong>Improved =
Marked</strong>일 확률이 높아지고, <strong>Improved = None</strong>일
확률이 줄어드는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1009"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="#cb1009-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="fu">c</span>(<span class="st">&quot;Treatment&quot;</span>,<span class="st">&quot;Sex&quot;</span>,<span class="st">&quot;Age&quot;</span>),arth.polr),</span>
<span id="cb1009-2"><a href="#cb1009-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">style =</span> <span class="st">&quot;stacked&quot;</span>,<span class="at">key.arg =</span> <span class="fu">list</span>(<span class="at">x =</span> .<span class="dv">8</span>, <span class="at">y =</span> .<span class="dv">9</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-491-1.png" width="960" /></p>
<p><strong>Treatment = Placebo</strong>그룹의 경우 <strong>Improved =
None</strong>이 차지하는 확률이 높지만, <strong>Treatment =
Treated</strong>그룹의 경우 <strong>Improved = Marked 또는
Some</strong>이 차지하는 확률이 높고 <strong>Improved = None</strong>이
차지하는 확률이 작은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1010"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="#cb1010-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="fu">c</span>(<span class="st">&quot;Treatment&quot;</span>,<span class="st">&quot;Age&quot;</span>),</span>
<span id="cb1010-2"><a href="#cb1010-2" aria-hidden="true" tabindex="-1"></a>            arth.polr,<span class="at">latent =</span> <span class="cn">TRUE</span>), <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-492-1.png" width="960" /></p>
<p><code>latent = TRUE</code>옵션을 지정하게 되면 각 반응변수의 수준으로
분류될 수 있는 기준점을 보여주고 각 그룹에 대하여
<code>Effect plot</code>중 변화가 가장 뚜렷한 <strong>plot</strong>만을
패널에 출력한다.</p>
<p><strong>Treatment = Placebo</strong>의 경우, 나이가 증가함에도
불구하고 <strong>Improved = None</strong>에서 <strong>Improved =
Some</strong>으로 가는 수준의 기준점을 넘지못한다.<br />
하지만, <strong>Treatment = Treated</strong>의 경우, 나이가 증가함에
따라 <strong>Improved = Marked</strong>의 기준에 가까워지고 나아기
60세가 되는 시점에 직선이 <strong>Improved = Marked</strong>의 기준
점선을 넘는 것을 확인할 수 있다.</p>
<hr />
</div>
</div>
</div>
<div id="nested-dichotomies" class="section level2">
<h2>8.2 Nested dichotomies</h2>
<p>반응 변수가 명목형인 경우 혹은 <strong>proportional odds
assumptions</strong>이 성립하지 않는다. 따라서, <strong>nested
dichotomies</strong>이라는 모형을 사용하게 되는데, 이 방법을 사용하면
반응변수의 수준간의 차이를 분산 분석의 직교대비처럼 확인할 수
있다.<br />
이 방법에는 순서형 반응변수나 특별한 소프트웨어가 필요하지 않으며, 반응
범주 간의 계층적으로 내포된 비교 집합에 대해 개별 모형을
적합시킨다.(독립가정)</p>
<p><em>Example 8.1: Women’s labor force participation</em></p>
<div class="sourceCode" id="cb1011"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="#cb1011-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1011-2"><a href="#cb1011-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Womenlf&quot;</span>, <span class="at">package =</span> <span class="st">&quot;car&quot;</span>)</span>
<span id="cb1011-3"><a href="#cb1011-3" aria-hidden="true" tabindex="-1"></a><span class="fu">some</span>(Womenlf)</span></code></pre></div>
<pre><code>##       partic hincome children   region
## 55  parttime       9  present Atlantic
## 64  parttime      23   absent  Prairie
## 74  not.work      17  present  Ontario
## 98  fulltime      15   absent  Ontario
## 180 fulltime      13   absent       BC
## 181 fulltime      17  present Atlantic
## 184 fulltime      18   absent  Ontario
## 209 not.work       9  present   Quebec
## 222 not.work      11  present   Quebec
## 225 not.work      15  present   Quebec</code></pre>
<p><code>womenlf</code>데이터는 1977년 캐나다의 인구조사에 따른
데이터이며, 여성의 생활에 관련된 정보를 담고있다.<br />
<code>womenlf</code>데이터는 <code>car</code>패키지에 포함돼있다.</p>
<ul>
<li>partic: 여성의 노동력 참여 (Factor variable - fulltime, nt.work,
parttime)</li>
<li>hincome: 남편의 수입 &lt;기준은 1000달러&gt; (discrete
variable)</li>
<li>children: 아이의 유무 (Factor variable - absent, present)</li>
<li>region: 지역 (Factor variable - Atlantic, BC, Ontario, Prairie,
Quebec)</li>
</ul>
<div class="sourceCode" id="cb1013"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="#cb1013-1" aria-hidden="true" tabindex="-1"></a>Womenlf <span class="ot">&lt;-</span> <span class="fu">within</span>(Womenlf,{</span>
<span id="cb1013-2"><a href="#cb1013-2" aria-hidden="true" tabindex="-1"></a>  working <span class="ot">&lt;-</span> <span class="fu">recode</span>(partic, <span class="st">&quot; &#39;not.work&#39; = &#39;no&#39;; else = &#39;yes&#39; &quot;</span>)</span>
<span id="cb1013-3"><a href="#cb1013-3" aria-hidden="true" tabindex="-1"></a>  fulltime <span class="ot">&lt;-</span> <span class="fu">recode</span>(partic,</span>
<span id="cb1013-4"><a href="#cb1013-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; &#39;fulltime&#39; = &#39;yes&#39;; &#39;parttime&#39; = &#39;no&#39;; &#39;not.work&#39; = NA&quot;</span>)})</span>
<span id="cb1013-5"><a href="#cb1013-5" aria-hidden="true" tabindex="-1"></a><span class="fu">some</span>(Womenlf)</span></code></pre></div>
<pre><code>##       partic hincome children  region fulltime working
## 17  not.work       5  present Ontario     &lt;NA&gt;      no
## 35  not.work       9   absent Ontario     &lt;NA&gt;      no
## 53  not.work       9   absent Ontario     &lt;NA&gt;      no
## 89  not.work      35   absent Ontario     &lt;NA&gt;      no
## 90  not.work      35   absent Ontario     &lt;NA&gt;      no
## 143 not.work      11  present Prairie     &lt;NA&gt;      no
## 207 not.work      11  present  Quebec     &lt;NA&gt;      no
## 219 not.work      19  present  Quebec     &lt;NA&gt;      no
## 232 not.work      13  present  Quebec     &lt;NA&gt;      no
## 237 fulltime       5  present  Quebec      yes     yes</code></pre>
<div class="sourceCode" id="cb1015"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="#cb1015-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Womenlf, <span class="fu">table</span>(partic, working))</span></code></pre></div>
<pre><code>##           working
## partic      no yes
##   fulltime   0  66
##   not.work 155   0
##   parttime   0  42</code></pre>
<div class="sourceCode" id="cb1017"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="#cb1017-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(Womenlf, <span class="fu">table</span>(partic, fulltime, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>))</span></code></pre></div>
<pre><code>##           fulltime
## partic      no yes &lt;NA&gt;
##   fulltime   0  66    0
##   not.work   0   0  155
##   parttime  42   0    0</code></pre>
<p><code>Womenlf</code>데이터에 대해서 <code>recode</code>함수를
이용하여 연구자가 원하는 형태로 범주를 재구성하여 데이터에 대한 전처리를
진행한다.</p>
<div class="sourceCode" id="cb1019"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="#cb1019-1" aria-hidden="true" tabindex="-1"></a>mod.working <span class="ot">&lt;-</span> <span class="fu">glm</span>(working <span class="sc">~</span> hincome <span class="sc">+</span> children, <span class="at">family =</span> binomial, <span class="at">data =</span> Womenlf)</span>
<span id="cb1019-2"><a href="#cb1019-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.working)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = working ~ hincome + children, family = binomial, 
##     data = Womenlf)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6767  -0.8652  -0.7768   0.9292   1.9970  
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      1.33583    0.38376   3.481   0.0005 ***
## hincome         -0.04231    0.01978  -2.139   0.0324 *  
## childrenpresent -1.57565    0.29226  -5.391    7e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 356.15  on 262  degrees of freedom
## Residual deviance: 319.73  on 260  degrees of freedom
## AIC: 325.73
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>일을하는 여성과 일을하지 않는 여성만으로 나눈 <code>working</code>을
반응변수로 하여 <strong>로지스틱 회귀 모형</strong>을 적합시켜
보았다.<br />
설명변수 <strong>hincome, children</strong>모두 유의확률이 유의수준
0.05보다 작으므로 유의한 설명변수인 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1021"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="#cb1021-1" aria-hidden="true" tabindex="-1"></a>mod.fulltime <span class="ot">&lt;-</span> <span class="fu">glm</span>(fulltime <span class="sc">~</span> hincome <span class="sc">+</span> children, <span class="at">family =</span> binomial, <span class="at">data =</span> Womenlf)</span>
<span id="cb1021-2"><a href="#cb1021-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.fulltime)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = fulltime ~ hincome + children, family = binomial, 
##     data = Womenlf)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4047  -0.8678   0.3949   0.6213   1.7641  
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      3.47777    0.76711   4.534 5.80e-06 ***
## hincome         -0.10727    0.03915  -2.740  0.00615 ** 
## childrenpresent -2.65146    0.54108  -4.900 9.57e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 144.34  on 107  degrees of freedom
## Residual deviance: 104.49  on 105  degrees of freedom
##   (결측으로 인하여 155개의 관측치가 삭제되었습니다.)
## AIC: 110.49
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>일을하지 않는 여성은 결측값으로하고 알바를 할경우 <strong>No</strong>
정규직의 경우에는 <strong>Yes</strong>로 재코딩을한 변수인
<code>fulltime</code>을 반응변수로 하여 다시 한 번 로지스틱 회귀모형을
적합시켜 보았다.<br />
<code>mod.working</code> 모델과 같이 <strong>hincome,
children</strong>모두 유의확률이 유의수준 0.05보다 작으므로 유의한
설명변수임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1023"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="#cb1023-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">working =</span> <span class="fu">coef</span>(mod.working), <span class="at">fulltime =</span> <span class="fu">coef</span>(mod.fulltime))</span></code></pre></div>
<pre><code>##                     working   fulltime
## (Intercept)      1.33582979  3.4777735
## hincome         -0.04230843 -0.1072679
## childrenpresent -1.57564843 -2.6514557</code></pre>
<p>적합시킨 두 모형에 대한 계수를 확인해본 결과, <strong>hincome,
children</strong> 모두 계수가 음수이므로 여성의 근로 선택에 대해서 로짓
확률을 감소 시키는 변수임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1025"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="#cb1025-1" aria-hidden="true" tabindex="-1"></a>LRtest <span class="ot">&lt;-</span> <span class="cf">function</span>(model){</span>
<span id="cb1025-2"><a href="#cb1025-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">LRchisq =</span> model<span class="sc">$</span>null.deviance <span class="sc">-</span> model<span class="sc">$</span>deviance,</span>
<span id="cb1025-3"><a href="#cb1025-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> model<span class="sc">$</span>df.null <span class="sc">-</span> model<span class="sc">$</span>df.residual)</span>
<span id="cb1025-4"><a href="#cb1025-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1025-5"><a href="#cb1025-5" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="at">working =</span> <span class="fu">LRtest</span>(mod.working),</span>
<span id="cb1025-6"><a href="#cb1025-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">fulltime =</span> <span class="fu">LRtest</span>(mod.fulltime))</span>
<span id="cb1025-7"><a href="#cb1025-7" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(tab, <span class="at">All =</span> <span class="fu">colSums</span>(tab))</span>
<span id="cb1025-8"><a href="#cb1025-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(tab, <span class="at">pvalue =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(tab[,<span class="dv">1</span>], tab[,<span class="dv">2</span>]))</span>
<span id="cb1025-9"><a href="#cb1025-9" aria-hidden="true" tabindex="-1"></a>tab</span></code></pre></div>
<pre><code>##           LRchisq df       pvalue
## working  36.41835  2 1.235536e-08
## fulltime 39.84682  2 2.225215e-09
## All      76.26518  4 1.110223e-15</code></pre>
<p>각 모형의 포화모형과의 잔차비교를 통해 모형의 적합도를 확인해
보았다.<br />
계산하기 위한 함수 <code>LRtest</code>를 직접 만들고 계산한 결과,
유의확률은 유의수준 0.05보다 작으므로, 우리가 적합시킨 2개의 모델 모두
포화모형과 비교해 볼때, 유의한 잔차의 차이가 있으므로, 유의한 모형임을
확인할 수 있다.</p>
<div class="sourceCode" id="cb1027"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="#cb1027-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod.working)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: working
##          LR Chisq Df Pr(&gt;Chisq)    
## hincome    4.8264  1    0.02803 *  
## children  31.3229  1  2.185e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb1029"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="#cb1029-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod.fulltime)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: fulltime
##          LR Chisq Df Pr(&gt;Chisq)    
## hincome     8.981  1   0.002728 ** 
## children   32.136  1  1.437e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>Anova</code>함수를 통해 개별 설명변수에 대한 검정을 진행할 수
있다.<br />
두 모델의 <strong>hincome</strong>변수를 살펴보면, 카이제곱 검정통계량은
4.826 + 8.981 = 13.807이고 자유도는 2이다.<br />
이러한 통계치를 통해 설명변수의 적합 여부를 확인할 수 있다.</p>
<div class="sourceCode" id="cb1031"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="#cb1031-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">hincome =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,</span>
<span id="cb1031-2"><a href="#cb1031-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">children =</span> <span class="fu">c</span>(<span class="st">&#39;absent&#39;</span>, <span class="st">&#39;present&#39;</span>))</span>
<span id="cb1031-3"><a href="#cb1031-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(predictors,</span>
<span id="cb1031-4"><a href="#cb1031-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p.working =</span> <span class="fu">predict</span>(mod.working,predictors,<span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb1031-5"><a href="#cb1031-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">p.fulltime =</span> <span class="fu">predict</span>(mod.fulltime,predictors, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb1031-6"><a href="#cb1031-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">l.working =</span> <span class="fu">predict</span>(mod.working,predictors,<span class="at">type =</span> <span class="st">&quot;link&quot;</span>),</span>
<span id="cb1031-7"><a href="#cb1031-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">l.fulltime =</span> <span class="fu">predict</span>(mod.fulltime,predictors, <span class="at">type =</span> <span class="st">&quot;link&quot;</span>))</span>
<span id="cb1031-8"><a href="#cb1031-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">some</span>(fit,<span class="dv">5</span>), <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##    hincome children p.working p.fulltime l.working l.fulltime
## 35      35   absent    0.4638     0.4313    -0.145     -0.277
## 56       6  present    0.3790     0.5456    -0.494      0.183
## 87      37  present    0.1412     0.0414    -1.805     -3.143
## 90      40  present    0.1265     0.0303    -1.932     -3.464
## 98      48  present    0.0936     0.0131    -2.271     -4.323</code></pre>
<p><code>predict</code>를 통해 만들어진 모델을 이용하여 새로운 데이터에
대한 예측을 진행한다.<br />
<code>type = response</code>는 예측에 대한 확률 값을 제공해주며,
<code>type = link</code>는 독립변수들의 선형 모델 결과(log-odds)를
출력해준다.</p>
<div class="sourceCode" id="cb1033"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="#cb1033-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">within</span>(fit, {</span>
<span id="cb1033-2"><a href="#cb1033-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;full-time&#39;</span> <span class="ot">&lt;-</span> p.working <span class="sc">*</span> p.fulltime </span>
<span id="cb1033-3"><a href="#cb1033-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;part-time&#39;</span> <span class="ot">&lt;-</span> p.working <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p.fulltime)</span>
<span id="cb1033-4"><a href="#cb1033-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;not working&#39;</span> <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> p.working</span>
<span id="cb1033-5"><a href="#cb1033-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><strong>full-time</strong>과 <strong>part-time</strong>에 대해서
<strong>unconditional</strong>한 확률을 위와 같이 계산해 주었다.</p>
<div class="sourceCode" id="cb1034"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="#cb1034-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(fit,</span>
<span id="cb1034-2"><a href="#cb1034-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;full-time&quot;</span>,<span class="st">&quot;part-time&quot;</span>,<span class="st">&quot;not working&quot;</span>),</span>
<span id="cb1034-3"><a href="#cb1034-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">variable.name =</span> <span class="st">&quot;Participation&quot;</span>,</span>
<span id="cb1034-4"><a href="#cb1034-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.name =</span> <span class="st">&quot;Probability&quot;</span>)</span></code></pre></div>
<p>적합치를 시각화하기 위해 <code>melt</code>함수를 이용하여 데이터의
형태를 재구성하였다.</p>
<div class="sourceCode" id="cb1035"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="#cb1035-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fit2,</span>
<span id="cb1035-2"><a href="#cb1035-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> hincome, <span class="at">y =</span> Probability,</span>
<span id="cb1035-3"><a href="#cb1035-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colour =</span> Participation)) <span class="sc">+</span></span>
<span id="cb1035-4"><a href="#cb1035-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> children) <span class="sc">+</span></span>
<span id="cb1035-5"><a href="#cb1035-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1035-6"><a href="#cb1035-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">55</span>)) <span class="sc">+</span></span>
<span id="cb1035-7"><a href="#cb1035-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb1035-8"><a href="#cb1035-8" aria-hidden="true" tabindex="-1"></a><span class="fu">direct.label</span>(gg, <span class="fu">list</span>(<span class="st">&quot;top.bumptwice&quot;</span>, <span class="fu">dl.trans</span>(<span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.2</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-506-1.png" width="960" /></p>
<p><code>ggplot</code>을 통해 <strong>남편의 수입</strong>에 따른
<strong>여성의 노동형태 확률</strong>을 시각화하였고 <strong>아이의
유무</strong>에 따라 패널을 구분하였다.<br />
위의 그림은 <code>type = response</code>를 통해 확률을 예측한
모형이다.<br />
<strong>partic = not working</strong>인 여성은 <code>hincome</code>이
증가함에 따라 확률이 증가하는 것을 볼 수 있는데, 자녀가 있을 경우,
확률이 더 높은 것을 확인할 수 있다.<br />
반대로, <strong>partic = full-time</strong> 여성들은
<code>hincome</code>이 증가함에 따라 확률이 크게 감소하는 것을 살펴볼 수
있다.</p>
<div class="sourceCode" id="cb1036"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="#cb1036-1" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">melt</span>(fit,</span>
<span id="cb1036-2"><a href="#cb1036-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;l.working&quot;</span>, <span class="st">&quot;l.fulltime&quot;</span>),</span>
<span id="cb1036-3"><a href="#cb1036-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">variable.name =</span> <span class="st">&quot;Participation&quot;</span>,</span>
<span id="cb1036-4"><a href="#cb1036-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.name =</span> <span class="st">&quot;LogOdds&quot;</span>)</span>
<span id="cb1036-5"><a href="#cb1036-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(fit3<span class="sc">$</span>Participation) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;working&quot;</span>, <span class="st">&quot;full-time&quot;</span>)</span>
<span id="cb1036-6"><a href="#cb1036-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1036-7"><a href="#cb1036-7" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fit3,</span>
<span id="cb1036-8"><a href="#cb1036-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> hincome, <span class="at">y =</span> LogOdds, <span class="at">colour =</span> Participation)) <span class="sc">+</span></span>
<span id="cb1036-9"><a href="#cb1036-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> children) <span class="sc">+</span></span>
<span id="cb1036-10"><a href="#cb1036-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1036-11"><a href="#cb1036-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb1036-12"><a href="#cb1036-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">4</span>))</span>
<span id="cb1036-13"><a href="#cb1036-13" aria-hidden="true" tabindex="-1"></a><span class="fu">direct.label</span>(gg, <span class="fu">list</span>(<span class="st">&quot;top.bumptwice&quot;</span>, <span class="fu">dl.trans</span>(<span class="at">y =</span> y <span class="sc">+</span> <span class="dv">0</span>,<span class="dv">2</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-507-1.png" width="960" /></p>
<p><code>type = link</code>를 통해 예측한 모델의 결과에 대한 시각화를
진행해 보았다. 앞선 결과와 달리 직선의 형태를 가지는 것을 볼 수
있다.<br />
<strong>partic = fulltime, wokring</strong>모두
<code>hincome</code>변수가 증가함에 따라 <strong>로그오즈</strong>가
감소하는 것을 볼 수 있는데, <strong>partic = fulltime</strong>이
<strong>partic = working</strong>보다 더욱 빠르게 감소하는 것을 확인할
수 있다.</p>
<hr />
</div>
<div id="generalized-logit-model" class="section level2">
<h2>8.3 Generalized logit model</h2>
<p>다중의 수준을 가지는 반응변수에 대한 가장 일반적인 접근법은 일반화된
로짓 모델이라고 불리는 <strong>다항 로짓 모델(multinomial logit
model)</strong>을 사용하는 것이다. <strong>일반화 로짓 (또는 다중
로짓)</strong>이라 불리는 방법은 m개의 반응 범주 카테고리를 m-1개의
로짓의 집합으로 모델링한다.<br />
이를 통해, 첫 번째 범주를 기준으로 나머지 반응범주와 비교를 통해 모델을
적합시키고 해석한다.<br />
R에서는 <code>nnet</code>패키지의 <code>multinom</code>함수를 통해
사용할 수 있다.</p>
<p><code>nnet</code>패키지는 단일 히든 레이어로 구성된 피드포워드 신경망
또는 다항 모델을 위한 함수들을 제공하는 패키지이다.<br />
<code>multinom</code>함수는 주어진 데이터에 대해서 <strong>다항 로그
선형 모델</strong>을 적합시키고자 할때 사용하는 함수이며,
<code>nnet</code>패키지에 포함돼있다.<br />
- <code>multinom(, data)</code></p>
<ul>
<li>formula: 분석가가 만들고자 하는 모델의 형태</li>
<li>data: 모형에 적합할 데이터</li>
</ul>
<p><em>Example 8.2: Women’s labor force participation</em></p>
<div class="sourceCode" id="cb1037"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="#cb1037-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Womenlf<span class="sc">$</span>partic)</span></code></pre></div>
<pre><code>## [1] &quot;fulltime&quot; &quot;not.work&quot; &quot;parttime&quot;</code></pre>
<div class="sourceCode" id="cb1039"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="#cb1039-1" aria-hidden="true" tabindex="-1"></a>Womenlf<span class="sc">$</span>partic <span class="ot">&lt;-</span> <span class="fu">relevel</span>(Womenlf<span class="sc">$</span>partic, <span class="at">ref =</span> <span class="st">&quot;not.work&quot;</span>)</span></code></pre></div>
<p><code>womenlf</code>의 반응변수인 <code>partic</code>의 기준범주를
<code>relevel</code>을 통해 <strong>not.work</strong>변수로
재구성한다.<br />
<code>relevel</code>은 범주의 기준 범주 수준을 바꿔주는 함수이다.<br />
- <code>relevel(data,ref)</code></p>
<ul>
<li>data: 범주의 수준을 재지정할 변수</li>
<li>ref: 변수의 수준중 기준 범주 수준으로 바꿔줄 수준</li>
</ul>
<div class="sourceCode" id="cb1040"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="#cb1040-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb1040-2"><a href="#cb1040-2" aria-hidden="true" tabindex="-1"></a>wlf.multinom <span class="ot">&lt;-</span> <span class="fu">multinom</span>(partic <span class="sc">~</span> hincome <span class="sc">+</span> children,</span>
<span id="cb1040-3"><a href="#cb1040-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> Womenlf, <span class="at">Hess =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # weights:  12 (6 variable)
## initial  value 288.935032 
## iter  10 value 211.454772
## final  value 211.440963 
## converged</code></pre>
<div class="sourceCode" id="cb1042"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="#cb1042-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wlf.multinom, <span class="at">Wald =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Call:
## multinom(formula = partic ~ hincome + children, data = Womenlf, 
##     Hess = TRUE)
## 
## Coefficients:
##          (Intercept)      hincome childrenpresent
## fulltime    1.982842 -0.097232073     -2.55860537
## parttime   -1.432321  0.006893838      0.02145558
## 
## Std. Errors:
##          (Intercept)    hincome childrenpresent
## fulltime   0.4841789 0.02809599       0.3621999
## parttime   0.5924627 0.02345484       0.4690352
## 
## Value/SE (Wald statistics):
##          (Intercept)    hincome childrenpresent
## fulltime    4.095266 -3.4607098     -7.06407045
## parttime   -2.417573  0.2939197      0.04574407
## 
## Residual Deviance: 422.8819 
## AIC: 434.8819</code></pre>
<p>반응변수는 <strong>partic</strong>로 설정하고, <strong>hincome,
children</strong>는 설명변수로 하는 다중 로짓모델을 적합시켜
보았다.<br />
<strong>계수, 표준오차, 왈드 검정의 통계량</strong>을 출력해주는 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb1044"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="#cb1044-1" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">summary</span>(wlf.multinom, <span class="at">Wald =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1044-2"><a href="#cb1044-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> stats<span class="sc">$</span>Wald.ratios</span>
<span id="cb1044-3"><a href="#cb1044-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(z)))</span>
<span id="cb1044-4"><a href="#cb1044-4" aria-hidden="true" tabindex="-1"></a><span class="fu">zapsmall</span>(p)</span></code></pre></div>
<pre><code>##          (Intercept)   hincome childrenpresent
## fulltime   0.0000422 0.0005388       0.0000000
## parttime   0.0156244 0.7688193       0.9635142</code></pre>
<p>앞서 적합시킨 모델들의 결과를 이용하여 개별 변수들에 대한 유의성
검정을 진행해 보았다.<br />
<strong>not.work</strong>를 <strong>partic</strong>의 기준 수준으로
지정했기 때문에, <strong>partic = fulltime</strong>, <strong>partic =
parttime</strong> 2개의 변수에 대한 추정 계수들만 출력되는 것을 확인할
수 있다.<br />
<strong>partic = fulltime</strong>의 경우, <strong>hincome,
children</strong>의 유의확률이 유의수준보다 작아 귀무가설을 기각하므로,
설명변수들이 유의하다고 판단된다.<br />
<strong>partic = parttime</strong>의 경우 절편을 제외하고
<strong>hincome, children</strong>의 유의확률이 유의수준보다 커
귀무가설을 기각하므로, 설명변수들이 유의하지 않다고 판단된다.</p>
<div class="sourceCode" id="cb1046"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="#cb1046-1" aria-hidden="true" tabindex="-1"></a>wlf.multinom2 <span class="ot">&lt;-</span> <span class="fu">multinom</span>(partic <span class="sc">~</span> hincome <span class="sc">*</span> children,</span>
<span id="cb1046-2"><a href="#cb1046-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> Womenlf, <span class="at">Hess =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # weights:  15 (8 variable)
## initial  value 288.935032 
## iter  10 value 210.797079
## final  value 210.714841 
## converged</code></pre>
<div class="sourceCode" id="cb1048"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="#cb1048-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(wlf.multinom2)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: partic
##                  LR Chisq Df Pr(&gt;Chisq)    
## hincome            15.153  2  0.0005123 ***
## children           63.559  2  1.579e-14 ***
## hincome:children    1.452  2  0.4837815    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><strong>hincome</strong>과 <strong>children</strong>의 교호작용을
살피기위해 <strong>formula</strong>를 수정한 후, 다시 한 번 모델을
적합시켜 보았다.<br />
그 결과, 설명변수들은 여전히 유의하지만, 두 변수의 교호작용은 유의확률이
유의수준 0.05보다 작으므로 유의하지 않은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1050"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="#cb1050-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">hincome =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>,</span>
<span id="cb1050-2"><a href="#cb1050-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">children =</span> <span class="fu">c</span>(<span class="st">&quot;absent&quot;</span>, <span class="st">&quot;present&quot;</span>))</span>
<span id="cb1050-3"><a href="#cb1050-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(predictors,</span>
<span id="cb1050-4"><a href="#cb1050-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">predict</span>(wlf.multinom,predictors,<span class="at">type =</span> <span class="st">&quot;probs&quot;</span>))</span></code></pre></div>
<p><code>predict</code>함수를 통해 적합시킨 모델을 이용하여 새로운
데이터에 대한 예측을 진행해 보았다.<br />
<code>type = probs</code>를 통해 예측결과가 확률로써 출력되게
설정해주었다.</p>
<div class="sourceCode" id="cb1051"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="#cb1051-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(fit,</span>
<span id="cb1051-2"><a href="#cb1051-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;not.work&quot;</span>,<span class="st">&quot;fulltime&quot;</span>,<span class="st">&quot;parttime&quot;</span>),</span>
<span id="cb1051-3"><a href="#cb1051-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">variable.name =</span> <span class="st">&quot;Participation&quot;</span>,</span>
<span id="cb1051-4"><a href="#cb1051-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">value.name =</span> <span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb1051-5"><a href="#cb1051-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(fit2<span class="sc">$</span>Participation) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;not working&quot;</span>, <span class="st">&quot;full-time&quot;</span>, <span class="st">&quot;part-time&quot;</span>)</span>
<span id="cb1051-6"><a href="#cb1051-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1051-7"><a href="#cb1051-7" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fit2,</span>
<span id="cb1051-8"><a href="#cb1051-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> hincome, <span class="at">y =</span> Probability, <span class="at">colour =</span> Participation)) <span class="sc">+</span></span>
<span id="cb1051-9"><a href="#cb1051-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>children) <span class="sc">+</span></span>
<span id="cb1051-10"><a href="#cb1051-10" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1051-11"><a href="#cb1051-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb1051-12"><a href="#cb1051-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.9</span>))</span>
<span id="cb1051-13"><a href="#cb1051-13" aria-hidden="true" tabindex="-1"></a><span class="fu">direct.label</span>(gg, <span class="fu">list</span>(<span class="st">&quot;top.bumptwice&quot;</span>, <span class="fu">dl.trans</span>(<span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.2</span>)))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-515-1.png" width="960" /></p>
<p>예측된 결과에 대해 시각화를 진행해본 결과, 우리가 앞서 살펴본
<strong>nested dichotomy models</strong>의 결과와 거의 유사한 것을
살펴볼 수 있다.<br />
<code>hincome</code>이 증가함에 따라, <strong>partic =
full-time</strong>의 확률은 점점 감소하고 <strong>partic
=not-working</strong>의 확률은 증가한다.<br />
그러나, <strong>일반화된 모델 로짓</strong>은 <strong>nested dichotomy
models</strong>과 다르게 <strong>children = absent</strong>인 경우,
<strong>hincome</strong>이 증가함에 따라 <strong>not-working</strong>의
확률이 가파르게 증가하지만, <strong>children = present`</strong> 경우
완만하게 증가하다가 같은 확률로 수렴하는 것을 볼 수 있다.</p>
<div class="sourceCode" id="cb1052"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="#cb1052-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(Womenlf<span class="sc">$</span>partic)</span></code></pre></div>
<pre><code>## [1] &quot;not.work&quot; &quot;fulltime&quot; &quot;parttime&quot;</code></pre>
<div class="sourceCode" id="cb1054"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="#cb1054-1" aria-hidden="true" tabindex="-1"></a>Womenlf<span class="sc">$</span>partic <span class="ot">&lt;-</span> <span class="fu">ordered</span>(Womenlf<span class="sc">$</span>partic,</span>
<span id="cb1054-2"><a href="#cb1054-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;not.work&quot;</span>,<span class="st">&quot;parttime&quot;</span>,<span class="st">&quot;fulltime&quot;</span>))</span>
<span id="cb1054-3"><a href="#cb1054-3" aria-hidden="true" tabindex="-1"></a>wlf.multinom <span class="ot">&lt;-</span> <span class="fu">update</span>(wlf.multinom, . <span class="sc">~</span> .)</span></code></pre></div>
<pre><code>## # weights:  12 (6 variable)
## initial  value 288.935032 
## iter  10 value 211.454772
## final  value 211.440963 
## converged</code></pre>
<p><code>effect plot</code>을 통해서도 모델의 결과를 시각화 할 수
있다.<br />
단, 이때 반응 범주의 순서를 연구자가 분석하고자 하는 순서대로 반드시
정렬해 준 후, 모델을 적합시켜야 한다.</p>
<div class="sourceCode" id="cb1056"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="#cb1056-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">Effect</span>(<span class="fu">c</span>(<span class="st">&quot;hincome&quot;</span>, <span class="st">&quot;children&quot;</span>), wlf.multinom),</span>
<span id="cb1056-2"><a href="#cb1056-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">style =</span> <span class="st">&quot;stacked&quot;</span>, <span class="at">key.args =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.05</span>, <span class="at">y =</span> <span class="fl">0.9</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-517-1.png" width="960" /></p>
<p><code>Effect plot</code>을 통해서도, <code>hincome</code>이 증가함에
따라, <strong>partic = fulltime</strong>의 면적이 점점 작아지고(확률이
작아지고) <strong>partic = notwork</strong>의 면적이 점점 커지는
것(확률이 커지고)을 쉽게 살펴볼 수 있다.</p>
<hr />
</div>
<div id="summary-of-chapter8" class="section level2">
<h2>Summary of chapter8</h2>
<ul>
<li>반응변수의 수준이 <strong>binary</strong>가 아닌 3개 이상 가지는
경우가 있을 수 있다. 이러한 경우, <strong>Chapter7</strong>에서 살펴본
모델과는 조금 다른 모델들을 사용해야한다.<br />
</li>
<li>특히, 반응변수의 수준이 많아지게 될때, 어떠한 수준을 기준으로
할것인지에 대해 고민하고 결정하는 것이 매우 중요하다.<br />
</li>
<li><strong>Proportional odds model</strong>은 각 설명변수들의
반응변수들에 대한 누적 로짓 확률이 같다고 가정(<strong>proportional odds
assumptions</strong>)하여 적합시키는 모델로, 설명변수의 기울기가 각
반응변수의 수준에서 모두 같다. 반응변수가 다중 순서형 변수일때
유용하다.</li>
<li><strong>partial proportional odds model</strong>은 특정 부분
변수에는 <strong>proportional odds assumptions</strong>을 하여 기울기가
같게하고 나머지 부분 변수에 대해서는 <strong>proportional odds
assumptions</strong>을 하지않아 기울기가 로그 누적 확률에 따라 변할 수
있게 적합시켜 주는 모델이다.<br />
</li>
<li>가장 일반적으로 사용되는 <strong>다항 로짓모형</strong>은 반응변수의
수준이 n개일때, 1개의 수준을 기준으로 정하고 n-1개의 반응변수에 대하여
설명변수를 이용하여 모형을 적합시키는 방법이다.<br />
</li>
<li>다중 반응변수를 통해 모델을 적합시키게 되면 모델의 파라미터가
많아지게 된다. 따라서, 이러한 경우 결과창을 시각화(예를 들어
<code>Effects</code>,<code>ggplot2</code>패키지를 활용)하여 요약된
결과를 살펴보는 것이 좋다.</li>
</ul>
<hr />
</div>
</div>
<div id="chap9-loglinear-and-logit-models-for-contingency-tables"
class="section level1">
<h1>Chap9 Loglinear and Logit Models for Contingency Tables</h1>
<p><strong>Chapter9</strong>에서는 분할표 데이터를 이용하여
<strong>Loglinear model</strong>과 <strong>Logit model</strong>을
적합시키는 방법에 대해서 알아본다.<br />
이러한 모델들은 <strong>mosaic plot</strong>을 통해 시각화 하는것이 가장
적합하다.</p>
<div id="introduction-3" class="section level2">
<h2>9.1 Introduction</h2>
<p><strong>로지스틱 회귀 모델</strong>의 경우 하나의 반응 변수의 예측에
대해 초점을 맞추지만, <strong>로그선형 모델</strong>의 경우 <strong>모든
변수를 대칭</strong>으로 처리하여, 각 변수사이의 <strong>중요한
연관성</strong>을 모형화한다. 여기서, 로그선형 모형의 목적은 변수간의
의존성 및 독립성의 패턴을 파악하는 것이다.</p>
<p>앞선 챕터에서, 로그 선형모형의 기본적인 측면을 살펴봤다면, 이번
장에서는 모형을 적합하고 해석하는데 초점을 둔다. 또한, 분할표의 차원이
큰 경우 <strong>로그 오즈 그림</strong> 혹은 <strong>모자이크
플롯</strong>을 통해 연관성의 특징을 보다 쉽게 이해할 수 있다.</p>
<hr />
</div>
<div id="loglinear-models-for-frequencies" class="section level2">
<h2>9.2 Loglinear models for frequencies</h2>
<p><strong>로그선형 모델</strong>은 양적 데이터에 대한 결합, 주변확률
사이의 곱셈 관계를 로그로 변환하여 사용한다. 카운트를 로그로 변환해주는
이유는 카운트가 0인 경우 결과가 0으로 나오기 때문에 로그를 적용하여
이러한 위험을 방지하는 것이다.</p>
<div class="sourceCode" id="cb1057"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="#cb1057-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&quot;contrasts&quot;</span>)</span></code></pre></div>
<pre><code>## $contrasts
##         unordered           ordered 
## &quot;contr.treatment&quot;      &quot;contr.poly&quot;</code></pre>
<p>인자에 대한 매개변수화는 주어진 인자가 명목형인지 순서형인지에 따라
달라지는 것을 확인할 수 있다.<br />
<code>unordered</code>의 경우, 처리에 대한 모수화를 사용하지만,
<code>ordered</code>의 경우 다항식에 기반한 모수화를 사용하는 것을
확인할 수 있다.</p>
<hr />
</div>
<div id="fitting-and-testing-loglinear-models" class="section level2">
<h2>9.3 Fitting and testing loglinear models</h2>
<p>로그선형 모델의 경우, 상호 독립을 가정하는
<strong>[A][B]][C]</strong>모델부터, 완벽한 포화모델인 [ABC]까지 다양한
독립성 가정을하여 모델을 적합시킬 수 있다.</p>
<div id="model-fitting-functions" class="section level3">
<h3>9.3.1 Model fitting functions</h3>
<div class="sourceCode" id="cb1059"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="#cb1059-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)   </span>
<span id="cb1059-2"><a href="#cb1059-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1059-3"><a href="#cb1059-3" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;a1&quot;</span>, <span class="st">&quot;a2&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1059-4"><a href="#cb1059-4" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;b2&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1059-5"><a href="#cb1059-5" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1059-6"><a href="#cb1059-6" aria-hidden="true" tabindex="-1"></a>Freq <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb1059-7"><a href="#cb1059-7" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(A, B, C, Freq)</span>
<span id="cb1059-8"><a href="#cb1059-8" aria-hidden="true" tabindex="-1"></a>mytable <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span> A <span class="sc">+</span> B <span class="sc">+</span> C, <span class="at">data =</span> mydata)</span></code></pre></div>
<div class="sourceCode" id="cb1060"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="#cb1060-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglin</span>(mytable, <span class="at">margin =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## 3 iterations: deviation 0.01472342</code></pre>
<pre><code>## $lrt
## [1] 6.196281
## 
## $pearson
## [1] 5.964879
## 
## $df
## [1] 1
## 
## $margin
## $margin[[1]]
## [1] &quot;A&quot; &quot;B&quot;
## 
## $margin[[2]]
## [1] &quot;A&quot; &quot;C&quot;
## 
## $margin[[3]]
## [1] &quot;B&quot; &quot;C&quot;</code></pre>
<p>로그선형 모델을 적합시키는 가장 기본적인 방법은
<strong>chapter5</strong>에서 살펴보았던
<code>loglin</code>함수이다.<br />
표 형식의 빈도데이터와 적합할 margin을 지정하여 모형을 적합시킨다.<br />
적합시킨 모형에 대한 피어슨 잔차와 자유도가 출력되는 것을 확인할 수
있다.<br />
또한, 독립성 유형을 어떻게 가정하였는지 알 수 있는데, 위의 모델같은
경우, 상호독립을 가정하는 <strong>[A][B][C]</strong>모델임을 알 수
있다.</p>
<div class="sourceCode" id="cb1063"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="#cb1063-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1063-2"><a href="#cb1063-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(<span class="sc">~</span> (A<span class="sc">+</span>B<span class="sc">+</span>C)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> mytable)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~(A + B + C)^2, data = mytable)
## 
## Statistics:
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 6.196281  1 0.0128019
## Pearson          5.964879  1 0.0145936</code></pre>
<p><strong>Chpater5</strong>에서 살펴보았던 <code>MASS</code>패키지의
<code>loglm</code>함수를 통해 더욱 다양한 로그 선형모델을 적합시킬 수
있다.<br />
위의 Formula는 <strong>[A][B][C]</strong>모델에 대한 로그선형 모델의
적합 결과이다.<br />
유의확률이 유의수준 0.05보다 작으므로 독립이 아닌 항이 존재하는 것을
확인할 수 있다.</p>
<div class="sourceCode" id="cb1065"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="#cb1065-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(Freq <span class="sc">~</span> (A<span class="sc">+</span>B<span class="sc">+</span>C)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> mydata)</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = Freq ~ (A + B + C)^2, data = mydata)
## 
## Statistics:
##                       X^2 df  P(&gt; X^2)
## Likelihood Ratio 68.22202 93 0.9749430
## Pearson          67.90936 93 0.9765542</code></pre>
<p>데이터에 빈도가 존재하는 경우, 빈도 데이터를 추가시켜
<strong>빈도</strong>에 따른 변수 간 로그선형 모델을 적합시킬 수
있다.<br />
유의확률이 유의수준 0.05보다 크므로 귀무가설을 기각한다.<br />
따라서, 빈도와 변수들은 서로 <strong>독립</strong>인 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb1067"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="#cb1067-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>(Freq <span class="sc">~</span> (A<span class="sc">+</span>B<span class="sc">+</span>C)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> mydata, <span class="at">family =</span> poisson)</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = Freq ~ (A + B + C)^2, family = poisson, data = mydata)
## 
## Coefficients:
## (Intercept)          Aa2          Bb2           CM      Aa2:Bb2       Aa2:CM  
##     3.30879      0.05623      0.10501      0.08111     -0.08680     -0.01198  
##      Bb2:CM  
##    -0.05337  
## 
## Degrees of Freedom: 99 Total (i.e. Null);  93 Residual
## Null Deviance:       70.81 
## Residual Deviance: 68.22     AIC: 605.3</code></pre>
<p><code>glm</code>함수를 통해서도 로그선형 모델을 적합시킬 수
있다.<br />
<code>glm</code>의 <code>Formula</code>에서 <strong>(변수들의
구성)^2</strong>을 하게 되면 <code>loglin</code>함수에서와 같이
<strong>[A][B][C]</strong>모형을 가정하는 것이다.<br />
<code>glm</code>의 옵션 중 하나인 <code>family</code>의 값을
<code>poisson</code>으로 지정하여 로그선형 모델을 만들 수 있다.
이렇게되면 <strong>link function</strong>을 <code>log</code>로
사용하기때문에 로그선형 모델에 적합이 되는 것이다.<br />
<code>glm</code>을 통해 로그선형 모델을 적합시키면 위와같이 각 변수에
따른 계수 추정치와 두 변수를 독립으로 가정했을 때의 계수 추정치를
출력하게 된다.</p>
<div class="sourceCode" id="cb1069"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="#cb1069-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Freq <span class="sc">~</span> (A<span class="sc">+</span>B<span class="sc">+</span>C)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> mydata, <span class="at">family =</span> poisson))</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Freq ~ (A + B + C)^2, family = poisson, data = mydata)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.94816  -0.57262  -0.02151   0.56034   1.83943  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  3.30879    0.08429  39.257   &lt;2e-16 ***
## Aa2          0.05623    0.08546   0.658    0.511    
## Bb2          0.10501    0.08547   1.229    0.219    
## CM           0.08111    0.08546   0.949    0.343    
## Aa2:Bb2     -0.08680    0.08056  -1.077    0.281    
## Aa2:CM      -0.01198    0.08048  -0.149    0.882    
## Bb2:CM      -0.05337    0.08069  -0.661    0.508    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 70.811  on 99  degrees of freedom
## Residual deviance: 68.222  on 93  degrees of freedom
## AIC: 605.3
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><code>glm</code>을 통해 로그선형 모델을 적합시킨 결과, 절편을 제외한
모든 변수들의 유의확률이 유의수준 0.05보다 큰것을 확인할 수 있다.<br />
따라서, 빈도에 따른 <strong>[A][B][C]</strong>모델을 적합시켰을 때,
주어진 변수들은 모두 빈도에 대해 독립이고 각 변수들 또한 서로 독립적인
것을 알 수 있으며, 설정한 로그선형 모형은 적합한 모형이 아닌 것을 알 수
있다.</p>
</div>
<div id="goodness-of-fit-tests" class="section level3">
<h3>9.3.2 Goodness-of-fit tests</h3>
<p>모델을 적합시킨 후에, 주어진 모델이 주어진 데이터를 얼마나 설명할 수
있고 얼마나 적합한지에 대해 <strong>Goodness-of-fit test</strong>를 통해
확인할 수 있다.<br />
가장 일반적으로 사용되는 방법은 앞에서 살펴본 <strong>Pearson
카이제곱검정</strong>, <strong>우도비 검정</strong> 등이 있으며,
<strong>Hosmer-Lemeshow test</strong> 또한 고려해볼 수 있다.</p>
<div class="sourceCode" id="cb1071"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="#cb1071-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;mtcars&quot;</span>)</span>
<span id="cb1071-2"><a href="#cb1071-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</code></pre>
<p><code>mtcars</code>데이터는 1974년 미국 자동차 트렌지 잡지에서 발췌한
것으로, 32개의 자동차에 대한 정보를 제공하는 데이터이다.</p>
<ul>
<li>mpg: 연비 (Continuous variable)</li>
<li>cyl: 실린더 갯수 (Discrete variable)</li>
<li>disp: 배기량 (Discrete variable)</li>
<li>hp: 마력 (Discrete variable)</li>
<li>drat: Rear 엑셀 비율 (Continuous variable)</li>
<li>wt: 무게 (Continuous variable)</li>
<li>qsec: 1/4마일에 도달하는 시간 (Continuous variable)</li>
<li>vs: 엔진 (Factor variable - 0,1)</li>
<li>am: 변속기 (Factor variable - 0,1)</li>
<li>gear: 전진 기어 갯수 (Discrete variable)</li>
<li>carb: 캬뷰레터 (Discrete variable)</li>
</ul>
<div class="sourceCode" id="cb1073"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="#cb1073-1" aria-hidden="true" tabindex="-1"></a>mtcars.fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(am <span class="sc">~</span> ., <span class="at">data =</span> mtcars, <span class="at">family =</span> binomial)</span></code></pre></div>
<pre><code>## Warning: glm.fit: 알고리즘이 수렴하지 않았습니다</code></pre>
<pre><code>## Warning: glm.fit: 적합된 확률값들이 0 또는 1 입니다</code></pre>
<div class="sourceCode" id="cb1076"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="#cb1076-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars.fit1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = am ~ ., family = binomial, data = mtcars)
## 
## Deviance Residuals: 
##        Min          1Q      Median          3Q         Max  
## -1.061e-05  -6.239e-07  -2.110e-08   2.110e-08   1.309e-05  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept) -1.164e+01  1.840e+06       0        1
## mpg         -8.809e-01  2.884e+04       0        1
## cyl          2.527e+00  1.236e+05       0        1
## disp        -4.155e-01  2.570e+03       0        1
## hp           3.437e-01  2.195e+03       0        1
## drat         2.320e+01  2.159e+05       0        1
## wt           7.436e+00  3.107e+05       0        1
## qsec        -7.577e+00  5.510e+04       0        1
## vs          -4.701e+01  2.405e+05       0        1
## gear         4.286e+01  2.719e+05       0        1
## carb        -2.157e+01  1.076e+05       0        1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 4.3230e+01  on 31  degrees of freedom
## Residual deviance: 6.4819e-10  on 21  degrees of freedom
## AIC: 22
## 
## Number of Fisher Scoring iterations: 25</code></pre>
<p><code>am</code>변수를 반응형변수로 하고 나머지 변수들을
설명변수로하는 <strong>mtcars.fit1</strong>모형을 적합시켜 보았다.<br />
적합결과, 모델은 수렴하지 않는다는 경고메시지를 볼 수 있다.<br />
또한, 설명변수들의 모든 유의확률은 1로 동일하고 계수 또한 적절하게
추정을 못하는 것을 볼 수 있다.<br />
이는 반응변수에 대한 너무 많은 설명변수를 넣었기 때문이며, 변수들을
선별하는 과정이 필요할 것으로 보인다.</p>
<div class="sourceCode" id="cb1078"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="#cb1078-1" aria-hidden="true" tabindex="-1"></a>mtcars.fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(am <span class="sc">~</span> mpg <span class="sc">+</span> hp, <span class="at">data =</span> mtcars, <span class="at">family =</span> binomial)</span>
<span id="cb1078-2"><a href="#cb1078-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars.fit2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = am ~ mpg + hp, family = binomial, data = mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.41460  -0.42809  -0.07021   0.16041   1.66500  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept) -33.60517   15.07672  -2.229   0.0258 *
## mpg           1.25961    0.56747   2.220   0.0264 *
## hp            0.05504    0.02692   2.045   0.0409 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.230  on 31  degrees of freedom
## Residual deviance: 19.233  on 29  degrees of freedom
## AIC: 25.233
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<p><strong>연비(mpg),마력(hp)</strong>를 설명변수로 하는
<strong>mtcars.fit2</strong>모델을 적합시켜 보았다.<br />
적합결과, 설명변수들의 유의확률이 유의수준 0.05보다 작으므로 모두 유의한
변수임을 확인할 수 있다.</p>
<p>모델의 적합도를 확인하기 위해서 우리는
<strong>Hosmer-Lemeshow-test</strong>라는 방법을 고려할 수 있다.<br />
<strong>Hosmer-Lemshow-test</strong>는 추정된 확률값을 순서대로 놓고,
확률이 작은 그룹과 확률이 높은 그룹으로 묶은 후, 자유도를 2를 뺀 결과가
카이제곱 분포를 따르느냐(즉 모형이 적합하냐)에 대한 검정을 진행하게
된다.</p>
<ul>
<li>H0: 모형이 카이제곱 분포를 따른다.(모형은 유의하다.)<br />
</li>
<li>H1: 모형이 카이제곱 분포를 따르지 않는다. (모형은
유의하지않다.)</li>
</ul>
<p><code>R</code>에서는 모형의 적합성 판단을 위해 다양한 함수를 제공하는
패키지인<code>ResourceSelection</code>안에 있는
함수<code>hoslem.test</code>를 통해
<strong>Hosmer-Lemeshow-test</strong>테스트를 진행할 수 있다.<br />
- <code>hoslem.test(label,prob)</code></p>
<ul>
<li>label: 모형에 적합시킨 데이터의 반응변수</li>
<li>prob: 추정된 모형에서 반응값에 대한 데이터의 추정확률</li>
</ul>
<div class="sourceCode" id="cb1080"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="#cb1080-1" aria-hidden="true" tabindex="-1"></a>ResourceSelection<span class="sc">::</span><span class="fu">hoslem.test</span>(mtcars<span class="sc">$</span>am, <span class="fu">fitted</span>(mtcars.fit2))</span></code></pre></div>
<pre><code>## 
##  Hosmer and Lemeshow goodness of fit (GOF) test
## 
## data:  mtcars$am, fitted(mtcars.fit2)
## X-squared = 4.1552, df = 8, p-value = 0.8429</code></pre>
<p><strong>mtcars.fit2</strong>모델의
<strong>Hosmer-Lemeshow-test</strong>결과는 위와같다.<br />
유의확률이 유의수준 0.05보다 크므로 귀무가설을 기각하지 못한다.<br />
따라서, 주어진 모형은 카이제곱 분포를 따르므로 유의한 모델임을 확인할 수
있다.</p>
</div>
<div id="residuals-for-loglinear-models" class="section level3">
<h3>9.3.3 Residuals for loglinear models</h3>
<p>모델의 적합도 검정을 진행한 후, 각 데이터의 패턴을 살펴보고 싶을 수
있다.<br />
이러한 경우, 쉽게 예시로 생각할 수 있는것 중 하나는 <strong>피어슨
잔차</strong>를 통해 데이터의 패턴을 살펴보는 것이다.<br />
앞선 chapter에서 살펴본대로, 잔차가 양의 값을 가질경우, 예상된
케이스보다 많은 것을 확인할 수 있고 음의 값을 가질경우, 예상된
케이스보다 적은 것을 확인할 수 있다.<br />
또 하나의 방법은 Haberman이 제시한 Pearson 잔차를 표준 오차로 나눈
이른바 <strong>신뢰 잔차</strong>라고 하는 값을 살펴보는 것이다.</p>
<p><code>R</code>에서는 <code>glm</code>을 통해 모델을 적합시키면
<code>hatvalue</code>를 얻을 수 있고 이 값을 통해 <strong>수정 잔차
값</strong>을 구할 수 있다.<br />
일반적으로 <strong>수정 잔차는</strong> <span
class="math inline">\(sqrt(1-h)\)</span>으로 정의한다.</p>
<div class="sourceCode" id="cb1082"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="#cb1082-1" aria-hidden="true" tabindex="-1"></a>berkeley <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(UCBAdmissions)</span>
<span id="cb1082-2"><a href="#cb1082-2" aria-hidden="true" tabindex="-1"></a>berk.glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Dept <span class="sc">*</span> (Gender <span class="sc">+</span> Admit), <span class="at">data =</span> berkeley,</span>
<span id="cb1082-3"><a href="#cb1082-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb1082-4"><a href="#cb1082-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fitted</span>(berk.glm1)</span>
<span id="cb1082-5"><a href="#cb1082-5" aria-hidden="true" tabindex="-1"></a>hat <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(berk.glm1)</span>
<span id="cb1082-6"><a href="#cb1082-6" aria-hidden="true" tabindex="-1"></a>stderr <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> hat)</span></code></pre></div>
<p><code>glm</code>에서 얻은 <code>hatvalue</code>와
<code>fit</code>값을 이용하여 <strong>수정잔차</strong>를 구한 후,
<strong>stderr</strong>객체에 저장하였다.</p>
<div class="sourceCode" id="cb1083"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="#cb1083-1" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">+</span>.<span class="dv">1</span>)</span>
<span id="cb1083-2"><a href="#cb1083-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, stderr, <span class="at">cex =</span> <span class="dv">5</span> <span class="sc">*</span>hat,</span>
<span id="cb1083-3"><a href="#cb1083-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Std.Error of Residual&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Fitted Frequency&quot;</span>,</span>
<span id="cb1083-4"><a href="#cb1083-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.2</span>)</span>
<span id="cb1083-5"><a href="#cb1083-5" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">with</span>(berkeley,</span>
<span id="cb1083-6"><a href="#cb1083-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">paste</span>(Dept, <span class="fu">substr</span>(Gender, <span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">ifelse</span>(Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span>, <span class="st">&quot;+&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb1083-7"><a href="#cb1083-7" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(berkeley<span class="sc">$</span>Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1083-8"><a href="#cb1083-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(fit,stderr,labs,<span class="at">col=</span>col,<span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-530-1.png" width="960" /></p>
<div class="sourceCode" id="cb1084"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="#cb1084-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span></code></pre></div>
<p>위의 결과는 앞서 구했던 <strong>수정잔차</strong>를 시각화한
결과이다.<br />
<strong>BM-, AM+</strong>의 <strong>symbol size</strong>가 제일 큰 것을
볼 수 있는데, 이는 <strong>레버리지 hi</strong>의 비율을 나타낸다.<br />
<strong>BF-, AF-</strong>의 <strong>Symbol size</strong>가 제일 작으므로
<strong>레버리지 hi</strong>의 비율이 작은것을 알 수 있다.<br />
전반적으로 Fitted Frequency가 높아질수록 <strong>잔차의 수정잔차가
낮아지는 것</strong>을 확인할 수 있다.</p>
</div>
<div id="using-loglm" class="section level3">
<h3>9.3.4 Using loglm()</h3>
<p><em>Example 9.1: Berkeley admissions</em></p>
<div class="sourceCode" id="cb1085"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="#cb1085-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;UCBAdmissions&quot;</span>)</span>
<span id="cb1085-2"><a href="#cb1085-2" aria-hidden="true" tabindex="-1"></a>berk.loglm0 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Dept <span class="sc">+</span> Gender <span class="sc">+</span> Admit, <span class="at">data =</span> UCBAdmissions, <span class="at">param =</span> <span class="cn">TRUE</span>, <span class="at">fitted =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1085-3"><a href="#cb1085-3" aria-hidden="true" tabindex="-1"></a>berk.loglm0</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~Dept + Gender + Admit, data = UCBAdmissions, 
##     param = TRUE, fitted = TRUE)
## 
## Statistics:
##                       X^2 df P(&gt; X^2)
## Likelihood Ratio 2097.671 16        0
## Pearson          2000.328 16        0</code></pre>
<p><code>UCBAdmissions</code>에 대해 <code>loglm</code>함수를 사용하여
로그선형 모델을 적합시켰다.<br />
출력된 유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, 주어진 변수들 중, 독립이 아닌 변수들이 존재하는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb1087"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="#cb1087-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1087-2"><a href="#cb1087-2" aria-hidden="true" tabindex="-1"></a><span class="fu">structable</span>(Dept <span class="sc">~</span> Admit <span class="sc">+</span> Gender, <span class="fu">fitted</span>((berk.loglm0)))</span></code></pre></div>
<pre><code>##                 Dept         A         B         C         D         E         F
## Admit    Gender                                                                 
## Admitted Male        215.10146 134.87069 211.64324 182.59417 134.64014 164.61141
##          Female      146.67825  91.96868 144.32008 124.51144  91.81147 112.24895
## Rejected Male        339.62744 212.94968 334.16719 288.30110 212.58566 259.90781
##          Female      231.59285 145.21095 227.86949 196.59328 144.96272 177.23182</code></pre>
<p><code>fitted</code>함수를 통해 로그선형 모델에 적합된 셀들의
기대빈도를 확인할 수 있다.<br />
<strong>Dept</strong>에 따른 <strong>Admit, Gender</strong>의 기대빈도를
구한 후, <code>structable</code>함수를 통해 표를 한 눈에 볼 수 있도록
하였다.<br />
<strong>Dept = A, Admit = Rejected, Gender = Male</strong>의 기대빈도가
가장 높고 <strong>Dept = E, Admit = Admitted, Gender = Female</strong>의
기대빈도가 가장 낮은 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1089"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="#cb1089-1" aria-hidden="true" tabindex="-1"></a>berk.loglm1 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> Dept <span class="sc">*</span>(Gender <span class="sc">+</span> Admit), <span class="at">data =</span> UCBAdmissions)</span>
<span id="cb1089-2"><a href="#cb1089-2" aria-hidden="true" tabindex="-1"></a>berk.loglm1</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~Dept * (Gender + Admit), data = UCBAdmissions)
## 
## Statistics:
##                       X^2 df    P(&gt; X^2)
## Likelihood Ratio 21.73551  6 0.001351993
## Pearson          19.93841  6 0.002840164</code></pre>
<p><strong>Dept</strong>를 <strong>공동적인 독립</strong>이라고 가정한
후, 다시 한 번 로그 선형모델을 적합시켜보았다.<br />
유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, <strong>Dept</strong>를 공동독립이라고 가정할 때,
<strong>Gender</strong>와 <strong>Admit</strong>은 서로 연관이 있는 것을
알 수 있다.</p>
<div class="sourceCode" id="cb1091"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="#cb1091-1" aria-hidden="true" tabindex="-1"></a>berk.loglm2 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> (Admit <span class="sc">+</span> Dept <span class="sc">+</span> Gender)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> UCBAdmissions)</span>
<span id="cb1091-2"><a href="#cb1091-2" aria-hidden="true" tabindex="-1"></a>berk.loglm2</span></code></pre></div>
<pre><code>## Call:
## loglm(formula = ~(Admit + Dept + Gender)^2, data = UCBAdmissions)
## 
## Statistics:
##                       X^2 df    P(&gt; X^2)
## Likelihood Ratio 20.20429  5 0.001144069
## Pearson          18.82255  5 0.002074020</code></pre>
<p>모델의 <strong>homogeneous association</strong>을 보기 위해,
Formula를 각 변수의 독립성을 살펴볼 수 있도록 바꿔준 후, 로그선형 모델을
다시 한 번 적합시켜 보았다.<br />
모델적합 결과, 유의확률이 유의수준 0.05보다 작으므로 귀무가설을
기각한다.<br />
따라서, 주어진 변수들 중 서로 독립이 아닌 변수들이 존재하는 것을 확인할
수 있다.</p>
<div class="sourceCode" id="cb1093"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="#cb1093-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(berk.loglm0, berk.loglm1, berk.loglm2, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## LR tests for hierarchical log-linear models
## 
## Model 1:
##  ~Dept + Gender + Admit 
## Model 2:
##  ~Dept * (Gender + Admit) 
## Model 3:
##  ~(Admit + Dept + Gender)^2 
## 
##             Deviance df  Delta(Dev) Delta(df) P(&gt; Delta(Dev)
## Model 1   2097.67121 16                                     
## Model 2     21.73551  6 2075.935706        10        0.00000
## Model 3     20.20429  5    1.531213         1        0.21593
## Saturated    0.00000  0   20.204294         5        0.00114</code></pre>
<p>모델간의 적합도를 살펴보기 위해 <code>anova</code>를통해 모델을
비교해보았다.</p>
<p><strong>Model1</strong>과 <strong>Model2</strong>의 잔차의 차이는
매우크고 유의확률 또한 유의수준 0.05보다 작은 것을 볼 수 있다.<br />
따라서, <strong>Model2</strong>는 <strong>Model1</strong>과 유의한 잔차
차이가 있으므로 유의한 모델임을 알 수 있다.</p>
<p><strong>Model2</strong>와 <strong>Model3</strong>의 잔차의 차이는
1.5312로 매우 작고 유의확률 또한 유의수준 0.05보다 큰 것을 볼 수
있다.<br />
따라서, <strong>Model2</strong>와 <strong>Model3</strong>과 유의한 잔차
차이가 없으므로 유의하지 않은 모델임을 알 수 있다.</p>
</div>
<div id="using-glm" class="section level3">
<h3>9.3.5 Using glm()</h3>
<p><em>Example 9.2: Berkeley admissions</em></p>
<p><code>glm</code>함수를 통해 로그선형 모델을 적합시키기 위해서는 앞서
살펴본대로 <code>family = poisson</code>으로 지정한 후 분석을
진행한다.</p>
<div class="sourceCode" id="cb1095"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="#cb1095-1" aria-hidden="true" tabindex="-1"></a>berkeley <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(UCBAdmissions)</span>
<span id="cb1095-2"><a href="#cb1095-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(berkeley)</span></code></pre></div>
<pre><code>##      Admit Gender Dept Freq
## 1 Admitted   Male    A  512
## 2 Rejected   Male    A  313
## 3 Admitted Female    A   89
## 4 Rejected Female    A   19
## 5 Admitted   Male    B  353
## 6 Rejected   Male    B  207</code></pre>
<p><code>glm</code>모형을 사용하기에 앞서 데이터의 형태를 데이터프레임
형태로 바꿔주어야 한다.</p>
<div class="sourceCode" id="cb1097"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="#cb1097-1" aria-hidden="true" tabindex="-1"></a>berk.glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Dept <span class="sc">*</span> (Gender <span class="sc">+</span> Admit),</span>
<span id="cb1097-2"><a href="#cb1097-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> berkeley, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb1097-3"><a href="#cb1097-3" aria-hidden="true" tabindex="-1"></a>berk.glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> (Dept <span class="sc">+</span> Gender <span class="sc">+</span> Admit)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1097-4"><a href="#cb1097-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> berkeley, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>)</span></code></pre></div>
<p><strong>berk.glm1</strong>의 경우, <strong>Dept</strong>를 공동적인
독립이라고 가정한 후, <strong>Freq</strong>에 따른 <strong>Gender,
Admit</strong>의 독립성을 살펴보는 모델이고 <strong>berk.glm2</strong>의
경우, 세 변수의 상호독립을 가정하고 독립성 검정을 진행한 모델이다.</p>
<div class="sourceCode" id="cb1098"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="#cb1098-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(berk.glm1, berk.glm2, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: Freq ~ Dept * (Gender + Admit)
## Model 2: Freq ~ (Dept + Gender + Admit)^2
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
## 1         6     21.735                     
## 2         5     20.204  1   1.5312   0.2159</code></pre>
<p><code>glm</code>을 사용해 적합한 로그 선형모델의 Anova 검정결과, 앞선
로그선형모델의 Anova 검정결과와 동일하게 <strong>Model1과
Model2</strong> (앞선 로그선형모델에서는 Model2, Model3)에는 유의한
잔차의 차이가 없는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1100-1"><a href="#cb1100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(berk.glm1, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: poisson, link: log
## 
## Response: Freq
## 
## Terms added sequentially (first to last)
## 
## 
##             Df Deviance Resid. Df Resid. Dev  Pr(&gt;Chi)    
## NULL                           23    2650.10              
## Dept         5   159.52        18    2490.57 &lt; 2.2e-16 ***
## Gender       1   162.87        17    2327.70 &lt; 2.2e-16 ***
## Admit        1   230.03        16    2097.67 &lt; 2.2e-16 ***
## Dept:Gender  5  1220.61        11     877.06 &lt; 2.2e-16 ***
## Dept:Admit   5   855.32         6      21.74 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>적합시킨 모형의 결과를 <code>anova</code>를 사용하여 개별 변수에 대한
유의성 검정 결과 또한 확인할 수 있다.<br />
모든 변수들의 유의확률이 유의수준 0.05보다 작으므로 귀무가설을
기각한다.<br />
따라서, 각 변수들은 빈도변수와 연관이 있고 <strong>Dept</strong>를
공동적인 독립으로 가정할 때, <strong>Gender, Admit</strong>은 서로
독립이 아닌 것을 알 수 있다.</p>
<div class="sourceCode" id="cb1102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="#cb1102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra)</span>
<span id="cb1102-2"><a href="#cb1102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(berk.glm1, <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1102-3"><a href="#cb1102-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">formula =</span> <span class="sc">~</span>Dept <span class="sc">+</span> Admit <span class="sc">+</span> Gender, <span class="at">split =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1102-4"><a href="#cb1102-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">residuals_type =</span> <span class="st">&quot;rstandard&quot;</span>,</span>
<span id="cb1102-5"><a href="#cb1102-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Model1: [AdmitDept][GenderDept]&quot;</span>,</span>
<span id="cb1102-6"><a href="#cb1102-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals,</span>
<span id="cb1102-7"><a href="#cb1102-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">abbreviate_labs =</span> <span class="fu">c</span>(<span class="at">Gender =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1102-8"><a href="#cb1102-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-540-1.png" width="960" /></p>
<p><code>residuals_type = "rstandard"</code>로 지정하게 되면, 표준화된
잔차를 출력할 수 있다.<br />
<strong>Dept</strong>를 공동 독립으로 가정한 후, <strong>로그선형
모델</strong>을 적합시켰을때의 결과를 모자이크 플랏을 통해
나타내었다.<br />
잔차의 색깔을 통해 <strong>Dept = A, Gender = Male, Admit =
Rejected</strong>는 관찰빈도가 기대빈도보다 높기 때문에, 남성의 경우
A부서에 탈락을 많이 하는 경향이 있음을 알 수 있고 <strong>Dept = A,
Gender = Female, Admit = Admitted</strong>는 관찰빈도가 기대빈도보다
높기 때문에, 여성의 경우 A부서에 합격을 많이 하는 경향이 있음을 알 수
있다.</p>
<div class="sourceCode" id="cb1103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="#cb1103-1" aria-hidden="true" tabindex="-1"></a>berkeley <span class="ot">&lt;-</span> <span class="fu">within</span>(berkeley,</span>
<span id="cb1103-2"><a href="#cb1103-2" aria-hidden="true" tabindex="-1"></a>                   dept1AG <span class="ot">&lt;-</span> (Dept <span class="sc">==</span> <span class="st">&quot;A&quot;</span>) <span class="sc">*</span></span>
<span id="cb1103-3"><a href="#cb1103-3" aria-hidden="true" tabindex="-1"></a>                     (Gender <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>) <span class="sc">*</span></span>
<span id="cb1103-4"><a href="#cb1103-4" aria-hidden="true" tabindex="-1"></a>                     (Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span>))</span>
<span id="cb1103-5"><a href="#cb1103-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(berkeley)</span></code></pre></div>
<pre><code>##      Admit Gender Dept Freq dept1AG
## 1 Admitted   Male    A  512       0
## 2 Rejected   Male    A  313       0
## 3 Admitted Female    A   89       1
## 4 Rejected Female    A   19       0
## 5 Admitted   Male    B  353       0
## 6 Rejected   Male    B  207       0</code></pre>
<p><strong>dept1AG</strong>변수의 경우, <strong>Dept = A, Gender =
Female, Admit = Admitted</strong>인 경우에 1을 갖고 나머지의 경우 0을
갖게한다.</p>
<div class="sourceCode" id="cb1105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="#cb1105-1" aria-hidden="true" tabindex="-1"></a>berk.glm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Dept <span class="sc">*</span> (Gender <span class="sc">+</span> Admit) <span class="sc">+</span> dept1AG,</span>
<span id="cb1105-2"><a href="#cb1105-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> berkeley, <span class="at">family =</span> <span class="st">&quot;poisson&quot;</span>)</span></code></pre></div>
<p>위의 모델은 <strong>Dept, (Gender,Admit)</strong>을
<strong>dept1AG</strong>에 대해 공동적인 독립을 가정한 모형을 적합시킨
모델이다.</p>
<div class="sourceCode" id="cb1106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="#cb1106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(berk.glm3)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##              AIC    BIC LR Chisq Df Pr(&gt;Chisq)
## berk.glm3 199.74 222.12   2.6815  5     0.7489</code></pre>
<p>유의확률이 유의수준 0.05보다 높으므로 귀무가설을 기각하지 못한다.
따라서, <strong>berk.glm3</strong>모형은 유의한 모형임을 확인할 수
있다.</p>
<div class="sourceCode" id="cb1108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="#cb1108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(berk.glm1, berk.glm3, <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: Freq ~ Dept * (Gender + Admit)
## Model 2: Freq ~ Dept * (Gender + Admit) + dept1AG
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1         6    21.7355                          
## 2         5     2.6815  1   19.054 1.271e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>또한, <code>anova</code>를 통해 <strong>berk.glm1</strong>과
<strong>berk.glm3</strong>를 비교해본 결과, 유의확률이 유의수준 0.05보다
작은것을 확인할 수 있다.<br />
따라서, 유의한 잔차의 차이가 있으므로 <strong>berk.glm3</strong>는
유의한 모델이라는 것을 한 번 더 확인할 수 있다.</p>
<div class="sourceCode" id="cb1110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="#cb1110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(berk.glm3)[[<span class="st">&quot;dept1AG&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 1.052076</code></pre>
<div class="sourceCode" id="cb1112"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="#cb1112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(berk.glm3)[[<span class="st">&quot;dept1AG&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 2.86359</code></pre>
<p><strong>berk.glm3</strong>의 <strong>dept1AG</strong>계수를 이용해
오즈비를 구한 결과, <strong>exp(1.05) = 2.86</strong>이라는 값을 얻을 수
있었다.<br />
이는 <strong>dept1AG</strong>변수가 한 단위 증가할때, 그렇지 않을
사람보다 빈도가 높아질 오즈가 약 2.86배 증가한다는 것을 확인할 수
있다.</p>
<div class="sourceCode" id="cb1114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="#cb1114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(berk.glm3, <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1114-2"><a href="#cb1114-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">formula =</span> <span class="sc">~</span> Dept <span class="sc">+</span> Admit <span class="sc">+</span> Gender, <span class="at">split =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1114-3"><a href="#cb1114-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">residuals_type =</span> <span class="st">&quot;rstandard&quot;</span>,</span>
<span id="cb1114-4"><a href="#cb1114-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> <span class="st">&quot;Model: [DeptGender][DeptAdmit] + DeptA*[GA]&quot;</span>,</span>
<span id="cb1114-5"><a href="#cb1114-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">labeling =</span> labeling_residuals,</span>
<span id="cb1114-6"><a href="#cb1114-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">abbreviate_labs =</span> <span class="fu">c</span>(<span class="at">Gender =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1114-7"><a href="#cb1114-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">keep_aspect_ratio =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-547-1.png" width="960" /></p>
<p><strong>berk.glm3</strong> 모델의 결과를 모자이크 플롯을 통해 나타낸
결과, 유의확률이 유의수준 0.05보다 크므로 모든 변수들은 서로 독립인 것을
알 수 있다.<br />
또한, 특정 잔차의 패턴이 보이지 않는 것을 확인할 수 있다.<br />
하지만, P-value가 0.05에 가까우므로 <strong>Partial
association</strong>분석을 통해 부분관계를 살펴봄으로써 연관된 변수를
찾을수도 있다.</p>
<hr />
</div>
</div>
<div id="equivalent-logit-models" class="section level2">
<h2>9.4 Equivalent logit models</h2>
<p>로그선형 모형은 설명변수와 반응변수를 구분하지 않지만,
<strong>logit모형</strong>은 설명변수를 통해 한 반응변수에 대한 로그
확률이 어떻게 변하는지를 보여준다.</p>
<p><em>Example 9.3: Berkeley admissions</em></p>
<div class="sourceCode" id="cb1115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="#cb1115-1" aria-hidden="true" tabindex="-1"></a>(obs <span class="ot">&lt;-</span> <span class="fu">log</span>(UCBAdmissions[<span class="dv">1</span>,,] <span class="sc">/</span> UCBAdmissions[<span class="dv">2</span>,,]))</span></code></pre></div>
<pre><code>##         Dept
## Gender            A          B          C          D          E          F
##   Male    0.4921214  0.5337493 -0.5355182 -0.7039581 -0.9569618 -2.7697438
##   Female  1.5441974  0.7537718 -0.6604399 -0.6219709 -1.1571488 -2.5808479</code></pre>
<p>log(<code>Admit = Admitted</code> / <code>Admit = Rejectd</code>)를
통해 로그 합격 확률을 구할 수 있다.</p>
<div class="sourceCode" id="cb1117"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="#cb1117-1" aria-hidden="true" tabindex="-1"></a>berk.logit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span> <span class="sc">~</span> Dept <span class="sc">+</span> Gender,</span>
<span id="cb1117-2"><a href="#cb1117-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> berkeley,</span>
<span id="cb1117-3"><a href="#cb1117-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> Freq,</span>
<span id="cb1117-4"><a href="#cb1117-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb1117-5"><a href="#cb1117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(berk.logit2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Admit == &quot;Admitted&quot; ~ Dept + Gender, family = &quot;binomial&quot;, 
##     data = berkeley, weights = Freq)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -25.3424  -13.0584   -0.1631   16.0167   21.3199  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.58205    0.06899   8.436   &lt;2e-16 ***
## DeptB        -0.04340    0.10984  -0.395    0.693    
## DeptC        -1.26260    0.10663 -11.841   &lt;2e-16 ***
## DeptD        -1.29461    0.10582 -12.234   &lt;2e-16 ***
## DeptE        -1.73931    0.12611 -13.792   &lt;2e-16 ***
## DeptF        -3.30648    0.16998 -19.452   &lt;2e-16 ***
## GenderFemale  0.09987    0.08085   1.235    0.217    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 6044.3  on 23  degrees of freedom
## Residual deviance: 5187.5  on 17  degrees of freedom
## AIC: 5201.5
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p><strong>Admit == Admitted</strong>를 반응변수로 하고 설명변수는
<strong>Dept, Gender</strong>로 하는 로짓 모형을 적합시켰다.<br />
<strong>Dept = B</strong>, <strong>Gender</strong>변수는 유의확률이
유의수준 크므로 유의하지 않은 변수임을 알 수 있다.<br />
<strong>Dept = B</strong>, <strong>Gender</strong>변수를 제외한 나머지
변수들의 유의확률은 유의수준 0.05보다 작으므로 유의한 변수임을 확인할 수
있다.</p>
<div class="sourceCode" id="cb1119"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="#cb1119-1" aria-hidden="true" tabindex="-1"></a>berkeley <span class="ot">&lt;-</span> <span class="fu">within</span>(berkeley,</span>
<span id="cb1119-2"><a href="#cb1119-2" aria-hidden="true" tabindex="-1"></a>                   dept1AG <span class="ot">&lt;-</span> (Dept <span class="sc">==</span> <span class="st">&quot;A&quot;</span>) <span class="sc">*</span> (Gender <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>))</span>
<span id="cb1119-3"><a href="#cb1119-3" aria-hidden="true" tabindex="-1"></a>berk.logit3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span> <span class="sc">~</span> Dept <span class="sc">+</span> Gender <span class="sc">+</span> dept1AG, <span class="at">data =</span> berkeley, <span class="at">weights =</span> Freq, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb1119-4"><a href="#cb1119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(berk.logit3)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Admit == &quot;Admitted&quot; ~ Dept + Gender + dept1AG, 
##     family = &quot;binomial&quot;, data = berkeley, weights = Freq)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -24.6314  -13.1867    0.0142   15.8566   22.1022  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.49212    0.07175   6.859 6.94e-12 ***
## DeptB         0.05206    0.11187   0.465    0.642    
## DeptC        -1.08802    0.11425  -9.523  &lt; 2e-16 ***
## DeptD        -1.14250    0.11157 -10.240  &lt; 2e-16 ***
## DeptE        -1.56102    0.13272 -11.762  &lt; 2e-16 ***
## DeptF        -3.15321    0.17336 -18.189  &lt; 2e-16 ***
## GenderFemale -0.03069    0.08676  -0.354    0.724    
## dept1AG       1.08277    0.27666   3.914 9.09e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 6044.3  on 23  degrees of freedom
## Residual deviance: 5169.8  on 16  degrees of freedom
## AIC: 5185.8
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p><strong>Dept = A, Gender = Female</strong>을 만족하는 변수를
<strong>dept1AG</strong>로 설정하여 다시 한 번 모형을 적합시켜
보았다.<br />
앞선 결과와 같이 <strong>Dept = B</strong>, <strong>Gender</strong>는
유의하지 않지만, <strong>dept1AG</strong>는 반응변수에 유의한 영향을
미치는 것읋 확인할 수 있다.</p>
<div class="sourceCode" id="cb1121"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="#cb1121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1121-2"><a href="#cb1121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(berk.logit2)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: Admit == &quot;Admitted&quot;
##        LR Chisq Df Pr(&gt;Chisq)    
## Dept     763.40  5     &lt;2e-16 ***
## Gender     1.53  1     0.2159    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb1123"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="#cb1123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(berk.logit3)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table (Type II tests)
## 
## Response: Admit == &quot;Admitted&quot;
##         LR Chisq Df Pr(&gt;Chisq)    
## Dept      646.72  5  &lt; 2.2e-16 ***
## Gender      0.13  1     0.7236    
## dept1AG    17.65  1  2.658e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>Anova</code>함수를 통해서도 각 변수들의 수준을 모두 고려했을 때
유의한지 유의하지 않은지를 확인할 수 있다.<br />
<strong>Gender</strong>변수는 유의하지 않은 것을 알 수 있고
<strong>Dept</strong>변수의 경우, <strong>Dept = B</strong>는 유의하지
않지만 나머지 <strong>Dept</strong>의 수준들이 유의하기 때문에 유의한
변수로 나오는 것을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1125"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="#cb1125-1" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(berkeley[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">fit =</span> <span class="fu">predict</span>(berk.logit2))</span>
<span id="cb1125-2"><a href="#cb1125-2" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">subset</span>(pred2, Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span>), <span class="at">obs =</span> <span class="fu">as.vector</span>(obs))</span>
<span id="cb1125-3"><a href="#cb1125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred2)</span></code></pre></div>
<pre><code>##       Admit Gender Dept        fit        obs
## 1  Admitted   Male    A  0.5820514  0.4921214
## 3  Admitted Female    A  0.6819215  1.5441974
## 5  Admitted   Male    B  0.5386535  0.5337493
## 7  Admitted Female    B  0.6385236  0.7537718
## 9  Admitted   Male    C -0.6805466 -0.5355182
## 11 Admitted Female    C -0.5806765 -0.6604399</code></pre>
<p><strong>berk.logit2</strong>모형을 통해 각 변수의 수준이 주어질때의
합격에 대한 예측확률과 앞서 구해봤던 로그 합격률을
<strong>pred2</strong>데이터에 적합시켰다.</p>
<div class="sourceCode" id="cb1127"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="#cb1127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1127-2"><a href="#cb1127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred2, <span class="fu">aes</span>(<span class="at">x =</span> Dept, <span class="at">y =</span> fit, <span class="at">group =</span> Gender, <span class="at">color =</span> Gender)) <span class="sc">+</span></span>
<span id="cb1127-3"><a href="#cb1127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb1127-4"><a href="#cb1127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Dept, <span class="at">y =</span> obs, <span class="at">group =</span> Gender, <span class="at">color =</span> Gender), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1127-5"><a href="#cb1127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Log odds (Admitted)&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1127-6"><a href="#cb1127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>),</span>
<span id="cb1127-7"><a href="#cb1127-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1127-8"><a href="#cb1127-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-554-1.png" width="960" /></p>
<div class="sourceCode" id="cb1128"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="#cb1128-1" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(berkeley[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">fit =</span> <span class="fu">predict</span>(berk.logit3))</span>
<span id="cb1128-2"><a href="#cb1128-2" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">subset</span>(pred3, Admit <span class="sc">==</span> <span class="st">&quot;Admitted&quot;</span>), <span class="at">obs =</span> <span class="fu">as.vector</span>(obs))</span>
<span id="cb1128-3"><a href="#cb1128-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pred2)</span></code></pre></div>
<pre><code>##       Admit Gender Dept        fit        obs
## 1  Admitted   Male    A  0.5820514  0.4921214
## 3  Admitted Female    A  0.6819215  1.5441974
## 5  Admitted   Male    B  0.5386535  0.5337493
## 7  Admitted Female    B  0.6385236  0.7537718
## 9  Admitted   Male    C -0.6805466 -0.5355182
## 11 Admitted Female    C -0.5806765 -0.6604399</code></pre>
<div class="sourceCode" id="cb1130"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="#cb1130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1130-2"><a href="#cb1130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred3, <span class="fu">aes</span>(<span class="at">x =</span> Dept, <span class="at">y =</span> fit, <span class="at">group =</span> Gender, <span class="at">color =</span> Gender)) <span class="sc">+</span></span>
<span id="cb1130-3"><a href="#cb1130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb1130-4"><a href="#cb1130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Dept, <span class="at">y =</span> obs, <span class="at">group =</span> Gender, <span class="at">color =</span> Gender), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1130-5"><a href="#cb1130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Log odds (Admitted)&quot;</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1130-6"><a href="#cb1130-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">9</span>),</span>
<span id="cb1130-7"><a href="#cb1130-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb1130-8"><a href="#cb1130-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-556-1.png" width="960" /></p>
<p>첫번째 그래프의 경우, <strong>dept1AG</strong>를 포함하지 않은 로짓
모형이고, 아래 그래프의 경우 <strong>dept1AG</strong>를 포함한 로짓
모형의 합격률에 대한 로그 오즈 변화율 그림이다.<br />
두 그림 모두, <strong>Dept = A</strong>에서는 <strong>Gender =
Female</strong>의 합격률이 <strong>Gender = Male</strong>보다 높지만
나머지 <strong>Dept</strong>에서는 큰 차이를 보이지 않는다.<br />
이를 통해, <strong>Dept = A를</strong> 제외하고
<strong>Gender</strong>변수가 합격률에 영향을 미치지 않는다는 것을 알 수
있고 <strong>Dept = A</strong>에서 <strong>Dept = B</strong>로 이동함에
따라, 합격률이 감소하는 것을 확인할 수 있다.</p>
<hr />
</div>
<div id="zero-frequencies" class="section level2">
<h2>9.5 Zero frequencies</h2>
<p>데이터에서 발생빈도가 0인경우, 로그선형 및 로짓모형을 적합시킴에 있어
문제를 발생시킬 수 있다.<br />
이러한 경우, 전처리를 통해 발생빈도가 없는 데이터를 제거하거나 데이터를
더 수집하여 발생빈도가 0이 나오지 않도록 하는 방법을 활용할 수 있다.</p>
<p><em>Example 9.4: Heath concerns of teenagers</em></p>
<div class="sourceCode" id="cb1131"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="#cb1131-1" aria-hidden="true" tabindex="-1"></a>Health <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">concerns =</span> <span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;menstrual&quot;</span>,</span>
<span id="cb1131-2"><a href="#cb1131-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;healthy&quot;</span>, <span class="st">&quot;nothing&quot;</span>),</span>
<span id="cb1131-3"><a href="#cb1131-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">age =</span> <span class="fu">c</span>(<span class="st">&quot;12-15&quot;</span>,<span class="st">&quot;16-17&quot;</span>),</span>
<span id="cb1131-4"><a href="#cb1131-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>))</span>
<span id="cb1131-5"><a href="#cb1131-5" aria-hidden="true" tabindex="-1"></a>Health<span class="sc">$</span>Freq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">42</span>,<span class="dv">57</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">7</span>,<span class="dv">20</span>,</span>
<span id="cb1131-6"><a href="#cb1131-6" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">9</span>,<span class="dv">4</span>,<span class="dv">19</span>,<span class="dv">71</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">21</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1132"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="#cb1132-1" aria-hidden="true" tabindex="-1"></a>health.glm0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> concerns <span class="sc">+</span> age <span class="sc">+</span> gender, <span class="at">data =</span> Health, <span class="at">subset =</span> (Freq <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">family =</span> poisson)</span>
<span id="cb1132-2"><a href="#cb1132-2" aria-hidden="true" tabindex="-1"></a>health.glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> concerns <span class="sc">+</span> age <span class="sc">*</span> gender, <span class="at">data =</span> Health, <span class="at">subset =</span> (Freq <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="at">family =</span> poisson)</span></code></pre></div>
<p><code>health</code>데이터의 경우, 발생빈도가 0인 데이터가 있는 것을
확인할 수 있다. 따라서, <code>subset</code>옵션을 활용하여 발생빈도가
0인 경우는 제외하고 모델을 적합시킨다.<br />
<strong>health.glm0</strong>의 경우 주효과들로만 모델을 적합시키고
<strong>health.glm1</strong>의 경우 주효과와 더불어
<strong>age</strong>와 <strong>gender</strong>의 교호작용 항도
포함시킨다.</p>
<div class="sourceCode" id="cb1133"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="#cb1133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(health.glm0, health.glm1)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##                 AIC    BIC LR Chisq Df Pr(&gt;Chisq)    
## health.glm0 100.742 104.58   27.744  8  0.0005256 ***
## health.glm1  99.884 104.36   24.886  7  0.0007951 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>두 모델에 대해 <strong>Likelihood ratio</strong> 검정을 진행한 결과,
유의확률이 유의수준 0.05보다 작으므로 귀무가설을 기각한다.<br />
따라서, 로지스틱 회귀분석을 이용하여 적합시킨 두 모델은 유의하지않은
모델임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1135"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="#cb1135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaic</span>(health.glm1, <span class="sc">~</span> concerns <span class="sc">+</span> age <span class="sc">+</span> gender,</span>
<span id="cb1135-2"><a href="#cb1135-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">residuals_type =</span> <span class="st">&quot;rstandard&quot;</span>,</span>
<span id="cb1135-3"><a href="#cb1135-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">rot_labels =</span> <span class="dv">0</span>,</span>
<span id="cb1135-4"><a href="#cb1135-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">just_labels =</span> <span class="fu">c</span>(<span class="at">left =</span> <span class="st">&quot;right&quot;</span>),</span>
<span id="cb1135-5"><a href="#cb1135-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">margin =</span> <span class="fu">c</span>(<span class="at">left =</span> <span class="dv">5</span>))</span></code></pre></div>
<p><img src="Statistical_Method2_files/figure-html/unnamed-chunk-560-1.png" width="960" /></p>
<p><strong>health.glm1</strong>의 결과를 모자이크 플롯을 통해 나타내
보았다.<br />
여성의 경우, 12-15세에는 월경에대한 걱정이 낮지만, 16-17세의 경우
월경에대한 걱정이 많아지는 것을 확인할 수 있다.<br />
또한, 12-15세의 남성의 경우 건강에대한 걱정이 많지만, 여성의 경우에는
낮은 것읋 확인할 수 있다.</p>
<div class="sourceCode" id="cb1136"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1136-1"><a href="#cb1136-1" aria-hidden="true" tabindex="-1"></a>health.glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> concerns<span class="sc">*</span>gender <span class="sc">+</span> concerns<span class="sc">*</span>age,</span>
<span id="cb1136-2"><a href="#cb1136-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Health, <span class="at">subset =</span> (Freq <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb1136-3"><a href="#cb1136-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> poisson)</span>
<span id="cb1136-4"><a href="#cb1136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(health.glm2)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##               AIC   BIC LR Chisq Df Pr(&gt;Chisq)
## health.glm2 87.66 94.69   4.6611  3     0.1984</code></pre>
<p><code>concerns</code>을 공동 독립 변수로 가정한 후,
<code>glm</code>의 <code>family = poisson</code>을 통해 공동 독립 모형을
가정해 보았다.<br />
유의확률이 유의수준 0.05보다 높으므로 귀무가설을 기각하지 못한다.<br />
따라서, <strong>health.glm2</strong>모델은 유의한 모델임을 확인할 수
있다.</p>
<div class="sourceCode" id="cb1138"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="#cb1138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(health.glm2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Freq ~ concerns * gender + concerns * age, family = poisson, 
##     data = Health, subset = (Freq &gt; 0))
## 
## Deviance Residuals: 
##       1        3        4        5        7        8        9       10  
##  0.2365   0.5852  -0.1734  -0.2999  -1.2022   0.3018  -0.1490   0.0000  
##      11       12       13       14       15       16  
## -0.7951   0.1576   0.1757   0.0000   1.3479  -0.2821  
## 
## Coefficients: (1 not defined because of singularities)
##                            Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                  1.2657     0.4451   2.843  0.00446 ** 
## concernsmenstrual           -0.8602     0.5865  -1.467  0.14246    
## concernshealthy              2.3803     0.4713   5.051  4.4e-07 ***
## concernsnothing              2.8003     0.4615   6.067  1.3e-09 ***
## genderF                      0.9808     0.4787   2.049  0.04047 *  
## age16-17                    -0.3677     0.4336  -0.848  0.39643    
## concernsmenstrual:genderF        NA         NA      NA       NA    
## concernshealthy:genderF     -1.5054     0.5330  -2.824  0.00474 ** 
## concernsnothing:genderF     -0.8028     0.5030  -1.596  0.11047    
## concernsmenstrual:age16-17   1.0609     0.7504   1.414  0.15741    
## concernshealthy:age16-17    -0.9099     0.5131  -1.773  0.07615 .  
## concernsnothing:age16-17    -0.7707     0.4693  -1.642  0.10052    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 252.4670  on 13  degrees of freedom
## Residual deviance:   4.6611  on  3  degrees of freedom
## AIC: 87.66
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><strong>cocenrs = healthy, concerns = nothing, gender = F, concerns =
healthy : gender = F</strong>변수를 제외하고 대부분의 변수들이 유의하지
않은 변수임을 확인할 수 있다.</p>
<div class="sourceCode" id="cb1140"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="#cb1140-1" aria-hidden="true" tabindex="-1"></a>health.tab <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq <span class="sc">~</span> concerns <span class="sc">+</span> age <span class="sc">+</span> gender, <span class="at">data =</span> Health)</span></code></pre></div>
<div class="sourceCode" id="cb1141"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="#cb1141-1" aria-hidden="true" tabindex="-1"></a>nonzeros <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(health.tab <span class="sc">&gt;</span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1141-2"><a href="#cb1141-2" aria-hidden="true" tabindex="-1"></a>health.loglm0 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> concerns <span class="sc">+</span> age <span class="sc">+</span> gender,</span>
<span id="cb1141-3"><a href="#cb1141-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> health.tab, <span class="at">start =</span> nonzeros)</span>
<span id="cb1141-4"><a href="#cb1141-4" aria-hidden="true" tabindex="-1"></a>health.loglm1 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> concerns <span class="sc">+</span> age <span class="sc">*</span> gender,</span>
<span id="cb1141-5"><a href="#cb1141-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> health.tab, <span class="at">start =</span> nonzeros)</span>
<span id="cb1141-6"><a href="#cb1141-6" aria-hidden="true" tabindex="-1"></a>health.loglm2 <span class="ot">&lt;-</span> <span class="fu">loglm</span>(<span class="sc">~</span> concerns<span class="sc">*</span>gender <span class="sc">+</span> concerns<span class="sc">*</span>age,</span>
<span id="cb1141-7"><a href="#cb1141-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> health.tab, <span class="at">start =</span> nonzeros)</span>
<span id="cb1141-8"><a href="#cb1141-8" aria-hidden="true" tabindex="-1"></a><span class="fu">LRstats</span>(health.loglm0, health.loglm1, health.loglm2)</span></code></pre></div>
<pre><code>## Likelihood summary table:
##                  AIC    BIC LR Chisq Df Pr(&gt;Chisq)    
## health.loglm0 104.74 110.92  27.7435  8  0.0005256 ***
## health.loglm1 103.88 110.84  24.8856  7  0.0007951 ***
## health.loglm2  93.66 104.48   4.6611  2  0.0972446 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>발생빈도가 0인 변수의 경우 0으로, 발생빈도가 0보다 큰 경우 1로 코딩을
한 후, 교차표를 만들어 로그 선형 모델에 적합시켜 보았다.<br />
앞선 결과와 동일하게 <strong>concerns</strong>를 공동독립을 가정하는
경우에만 모형이 유의하고 나머지 두 개의 모형은 유의하지 않게 나오는 것을
확인할 수 있다.</p>
<hr />
</div>
<div id="summary-of-chapter9" class="section level2">
<h2>Summary of chapter9</h2>
<ul>
<li><code>loglin</code>, <code>loglm</code>함수가 아닌
<code>glm</code>함수를 통해서도 로그선형 모델을 적합시킬 수 있다.
<code>family = poisson</code>으로 지정하게 되면 <strong>link
function</strong>을 <code>log</code>를 통해 계산하기 때문에 로그선형
모델과 동일하게 적합할 수 있다.<br />
</li>
<li><strong>로그선형 모델</strong>의 목적은 반응변수에 대한
확률예측보다는 <strong>변수들간의 관계</strong>를 파악하는 것이다.<br />
</li>
<li><strong>로지스틱 회귀모델</strong>의 목적은</li>
<li>분할표에서 관찰된 빈도가 0인 경우, 모형에 큰 영향을 끼칠 수 있다.
따라서 추가적인 데이터를 수집하여 빈도가 0이 아니도록 만들어주거나 변수
제거를 고려하는 등의 처리가 필요하다.<br />
</li>
<li>변수를 통해 모형을 적합하고자 하는 경우,
<strong>변수선택법</strong>과 같은 방법도 있지만, 다양한 변수를 통해
다양한 모델을 적합시키며 모델의 성능을 확인하면서 최적의 모형을 도출하는
과정이 필요하다.</li>
</ul>
<hr />
</div>
</div>
<div id="reference-of-all-chapters" class="section level1">
<h1>Reference of All chapters</h1>
<p><a href="http://ddar.datavis.ca/">Discrete Data Analysis with R</a>
<a
href="https://ko.wikipedia.org/wiki/%EC%9C%84%ED%82%A4%EB%B0%B1%EA%B3%BC:%EB%8C%80%EB%AC%B8">위키백과</a><br />
<a
href="https://m.blog.naver.com/PostView.nhn?isHttpsRedirect=true&amp;blogId=y4769&amp;logNo=220146051135&amp;proxyReferer=">보건과학통계
SPSS 이야기</a><br />
<a href="https://rfriend.tistory.com/">Rfriend</a><br />
<a href="https://specialscene.tistory.com/14">잔차진단</a></p>
<hr />
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
